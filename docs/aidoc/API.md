# Документация по коду

---

## Импортируемые зависимости

- **fest/object**: предоставляет функции для реактивности (`subscribe`, `observableArray`, `computed`, `observe`).
- **fest/dom**: предоставляет функции для отражения (рефлексии) поведения, хранилищ и миксинов на DOM-элементы.

---

## Интерфейс `Params`

Описывает параметры, которые могут быть переданы для создания и настройки DOM-элемента.

```ts
interface Params {
    classList?: Set<string>;
    attributes?: any;
    dataset?: any;
    properties?: any;
    behaviors?: any;
    stores?: any[]|Set<any>|Map<any,any>;
    style?: any|string;
    slot?: any|string;
    name?: any|string;
    type?: any|string;
    icon?: any|string;
    role?: any|string;
    inert?: boolean|string;
    mixins?: any;
    ctrls?: any;
    is?: any|string;
    part?: any|string;
    on?: any;
    hidden?: any;
    aria?: any;
    rules?: any[];
};
```

---

## Класс `El`

### Назначение

Класс-обёртка для создания и управления DOM-элементами с поддержкой реактивности и отражения параметров.

### Основные свойства

- **children**: массив дочерних элементов (реактивный).
- **params**: параметры для настройки элемента (см. `Params`).
- **selector**: селектор или сам элемент.

### Основные методы

#### `constructor(selector, params = {}, children?)`

- **selector**: строка-селектор или DOM-элемент.
- **params**: объект параметров (см. выше).
- **children**: дочерние элементы (по умолчанию — реактивный массив).

#### `reform()`

Обновляет дочерние элементы DOM-элемента.

#### `get element()`

Геттер, возвращающий DOM-элемент, соответствующий текущему объекту. Если элемент ещё не создан, создаёт его и применяет все параметры (`params`), включая атрибуты, стили, классы, свойства, dataset, aria, поведения, хранилища, миксины, контроллеры, правила стилей, обработчики событий, скрытие и т.д.

---

## Класс `Mp`

### Назначение

Класс для реактивного отображения массива элементов (маппинг), например, для списков.

### Основные свойства

- **`#observable`**: реактивный массив.
- **`#fragments`**: контейнер типа `DocumentFragment` для элементов.
- **`#mapCb`**: функция отображения (маппинга) элементов.
- **`#reMap`**: WeakMap для кэширования результатов отображения.

### Основные методы

#### `constructor(observable, mapCb = (el)=>el)`

- **observable**: реактивный массив.
- **mapCb**: функция отображения (по умолчанию — идентичность).

#### `get element()`

Возвращает контейнер с отображёнными элементами.

#### `get children()`

Возвращает исходный реактивный массив.

#### `get mapper()`

Возвращает функцию отображения с поддержкой кэширования.

#### `_onUpdate()`

Обновляет отображение при изменении массива.

---

## Класс `Sw`

### Назначение

Класс для реактивного переключения между элементами по индексу (например, для табов, слайдеров и т.п.).

### Основные свойства

- **params**: объект с индексом и массивом отображённых элементов.
- **current**: текущий индекс.

### Основные методы

#### `constructor(params: SwitchedParams)`

- **params**: объект с полями:
  - `index`: объект с полем `value` (текущий индекс).
  - `mapped`: массив элементов.

#### `get element()`

Возвращает текущий отображаемый элемент или пустой фрагмент, если индекс некорректен.

#### `_onUpdate()`

Обновляет отображение при изменении индекса.

---

## Вспомогательные функции

### `conditionalIndex(condList: any[])`

Создаёт реактивный индекс на основе массива условий (функций). Возвращает индекс первого истинного условия.

### Фабрики

- **M(observable, mapCb?)**: создаёт экземпляр `Mp`.
- **E(selector, params = {}, children?)**: создаёт экземпляр `El`.
- **S(params)**: создаёт экземпляр `Sw`.

---

## Экспорт по умолчанию

- **E**: экспортируется как значение по умолчанию.

---

## Пример использования

```ts
const el = E('div', { classList: new Set(['my-class']), style: 'color: red;' }, [
    E('span', {}, 'Hello')
]);
document.body.appendChild(el.element);
```

---

## Краткое описание

### Основное

- **E, M, S** — фабрики для быстрого создания соответствующих объектов.

### Internals

- **El** — реактивный обёртчик для DOM-элементов с поддержкой параметров и детей.
- **Mp** — реактивный список (маппинг) элементов.
- **Sw** — реактивный переключатель между элементами по индексу.
- **conditionalIndex** — реактивный индекс по условиям.
