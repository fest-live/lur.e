import { elementPointerMap } from "fest/lure";
import { DOMMixin, getCorrectOrientation, orientationNumberMap } from "fest/dom";
import { numberRef } from "fest/object";
import { vector2Ref } from "fest/lure";
//
export class UIOrientBox extends DOMMixin {
    constructor(name) { super(name); }
    // @ts-ignore
    connect(ws) {
        const self = ws?.deref?.() ?? ws;
        self.classList.add("ui-orientbox");
        //
        //const zoom = attrRef(self, "zoom", 1), orient = attrRef(self, "orient", 0);
        const zoom = numberRef(1), orient = numberRef(orientationNumberMap?.[getCorrectOrientation()] || 0);
        self.style.setProperty("--zoom", zoom.value);
        self.style.setProperty("--orient", orient.value);
        // TODO: broken, fix later
        //bindWith(self, "--zoom", zoom, handleStyleChange, null);
        //bindWith(self, "--orient", orient, handleStyleChange, null);
        // settings size is illogical! and not implemented!
        Object.defineProperty(self, "size", { get: () => size });
        //
        Object.defineProperty(self, "zoom", {
            get: () => parseFloat(zoom.value) || 1,
            set: (value) => { zoom.value = value; self.style.setProperty("--zoom", value); }
        });
        //
        Object.defineProperty(self, "orient", {
            get: () => parseInt(orient.value) || 0,
            set: (value) => { orient.value = value; self.style.setProperty("--orient", value); }
        });
        //
        const size = vector2Ref(self.clientWidth, self.clientHeight);
        const resizeObserver = new ResizeObserver((entries) => {
            for (const entry of entries) {
                if (entry?.contentBoxSize) {
                    const contentBoxSize = entry?.contentBoxSize?.[0];
                    size.x.value = (contentBoxSize?.inlineSize || size.x.value || 0);
                    size.y.value = (contentBoxSize?.blockSize || size.y.value || 0);
                }
            }
        });
        //
        resizeObserver.observe(self, { box: "content-box" });
        elementPointerMap.set(self, {
            pointerMap: new Map(),
            pointerCache: new Map()
        });
        //
        return this;
    }
}
//
new UIOrientBox("ui-orientbox");
export default UIOrientBox;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiT3JpZW50Qm94LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiT3JpZW50Qm94LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLFdBQVcsQ0FBQztBQUM5QyxPQUFPLEVBQUUsUUFBUSxFQUFFLHFCQUFxQixFQUFFLG9CQUFvQixFQUFFLE1BQU0sVUFBVSxDQUFDO0FBQ2pGLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFDeEMsT0FBTyxFQUFZLFVBQVUsRUFBRSxNQUFNLFdBQVcsQ0FBQztBQUVqRCxFQUFFO0FBQ0YsTUFBTSxPQUFPLFdBQVksU0FBUSxRQUFRO0lBQ3JDLFlBQVksSUFBSyxJQUFJLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFFbkMsYUFBYTtJQUNiLE9BQU8sQ0FBQyxFQUFFO1FBQ04sTUFBTSxJQUFJLEdBQVEsRUFBRSxFQUFFLEtBQUssRUFBRSxFQUFFLElBQUksRUFBRSxDQUFDO1FBQ3RDLElBQUksQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLGNBQWMsQ0FBQyxDQUFDO1FBRW5DLEVBQUU7UUFDRiw2RUFBNkU7UUFDN0UsTUFBTSxJQUFJLEdBQUcsU0FBUyxDQUFDLENBQUMsQ0FBQyxFQUFFLE1BQU0sR0FBRyxTQUFTLENBQUMsb0JBQW9CLEVBQUUsQ0FBQyxxQkFBcUIsRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7UUFDcEcsSUFBSSxDQUFDLEtBQUssQ0FBQyxXQUFXLENBQUMsUUFBUSxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUM3QyxJQUFJLENBQUMsS0FBSyxDQUFDLFdBQVcsQ0FBQyxVQUFVLEVBQUUsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBRWpELDBCQUEwQjtRQUMxQiwwREFBMEQ7UUFDMUQsOERBQThEO1FBRTlELG1EQUFtRDtRQUNuRCxNQUFNLENBQUMsY0FBYyxDQUFDLElBQUksRUFBRSxNQUFNLEVBQUUsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQztRQUV6RCxFQUFFO1FBQ0YsTUFBTSxDQUFDLGNBQWMsQ0FBQyxJQUFJLEVBQUUsTUFBTSxFQUFFO1lBQ2hDLEdBQUcsRUFBRSxHQUFHLEVBQUUsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUM7WUFDdEMsR0FBRyxFQUFFLENBQUMsS0FBSyxFQUFFLEVBQUUsR0FBRyxJQUFJLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsV0FBVyxDQUFDLFFBQVEsRUFBRSxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FDbkYsQ0FBQyxDQUFDO1FBRUgsRUFBRTtRQUNGLE1BQU0sQ0FBQyxjQUFjLENBQUMsSUFBSSxFQUFFLFFBQVEsRUFBRTtZQUNsQyxHQUFHLEVBQUUsR0FBRyxFQUFFLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDO1lBQ3RDLEdBQUcsRUFBRSxDQUFDLEtBQUssRUFBRSxFQUFFLEdBQUcsTUFBTSxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLFdBQVcsQ0FBQyxVQUFVLEVBQUUsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO1NBQ3ZGLENBQUMsQ0FBQztRQUVILEVBQUU7UUFDRixNQUFNLElBQUksR0FBRyxVQUFVLENBQUMsSUFBSSxDQUFDLFdBQVcsRUFBRSxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUM7UUFDN0QsTUFBTSxjQUFjLEdBQUcsSUFBSSxjQUFjLENBQUMsQ0FBQyxPQUFPLEVBQUUsRUFBRTtZQUNsRCxLQUFLLE1BQU0sS0FBSyxJQUFJLE9BQU8sRUFBRSxDQUFDO2dCQUMxQixJQUFJLEtBQUssRUFBRSxjQUFjLEVBQUUsQ0FBQztvQkFDeEIsTUFBTSxjQUFjLEdBQUcsS0FBSyxFQUFFLGNBQWMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDO29CQUNsRCxJQUFJLENBQUMsQ0FBQyxDQUFDLEtBQUssR0FBRyxDQUFDLGNBQWMsRUFBRSxVQUFVLElBQUksSUFBSSxDQUFDLENBQUMsQ0FBQyxLQUFLLElBQUksQ0FBQyxDQUFDLENBQUM7b0JBQ2pFLElBQUksQ0FBQyxDQUFDLENBQUMsS0FBSyxHQUFHLENBQUMsY0FBYyxFQUFFLFNBQVMsSUFBSSxJQUFJLENBQUMsQ0FBQyxDQUFDLEtBQUssSUFBSSxDQUFDLENBQUMsQ0FBQztnQkFDcEUsQ0FBQztZQUNMLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUU7UUFDRixjQUFjLENBQUMsT0FBTyxDQUFDLElBQUksRUFBRSxFQUFDLEdBQUcsRUFBRSxhQUFhLEVBQUMsQ0FBQyxDQUFDO1FBQ25ELGlCQUFpQixDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUU7WUFDeEIsVUFBVSxFQUFFLElBQUksR0FBRyxFQUFlO1lBQ2xDLFlBQVksRUFBRSxJQUFJLEdBQUcsRUFBZTtTQUN2QyxDQUFDLENBQUM7UUFFSCxFQUFFO1FBQ0YsT0FBTyxJQUFJLENBQUM7SUFDaEIsQ0FBQztDQUNKO0FBRUQsRUFBRTtBQUNGLElBQUksV0FBVyxDQUFDLGNBQWMsQ0FBQyxDQUFDO0FBQ2hDLGVBQWUsV0FBVyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZWxlbWVudFBvaW50ZXJNYXAgfSBmcm9tIFwiZmVzdC9sdXJlXCI7XG5pbXBvcnQgeyBET01NaXhpbiwgZ2V0Q29ycmVjdE9yaWVudGF0aW9uLCBvcmllbnRhdGlvbk51bWJlck1hcCB9IGZyb20gXCJmZXN0L2RvbVwiO1xuaW1wb3J0IHsgbnVtYmVyUmVmIH0gZnJvbSBcImZlc3Qvb2JqZWN0XCI7XG5pbXBvcnQgeyBWZWN0b3IyRCwgdmVjdG9yMlJlZiB9IGZyb20gXCJmZXN0L2x1cmVcIjtcblxuLy9cbmV4cG9ydCBjbGFzcyBVSU9yaWVudEJveCBleHRlbmRzIERPTU1peGluIHtcbiAgICBjb25zdHJ1Y3RvcihuYW1lPykgeyBzdXBlcihuYW1lKTsgfVxuXG4gICAgLy8gQHRzLWlnbm9yZVxuICAgIGNvbm5lY3Qod3MpIHtcbiAgICAgICAgY29uc3Qgc2VsZjogYW55ID0gd3M/LmRlcmVmPy4oKSA/PyB3cztcbiAgICAgICAgc2VsZi5jbGFzc0xpc3QuYWRkKFwidWktb3JpZW50Ym94XCIpO1xuXG4gICAgICAgIC8vXG4gICAgICAgIC8vY29uc3Qgem9vbSA9IGF0dHJSZWYoc2VsZiwgXCJ6b29tXCIsIDEpLCBvcmllbnQgPSBhdHRyUmVmKHNlbGYsIFwib3JpZW50XCIsIDApO1xuICAgICAgICBjb25zdCB6b29tID0gbnVtYmVyUmVmKDEpLCBvcmllbnQgPSBudW1iZXJSZWYob3JpZW50YXRpb25OdW1iZXJNYXA/LltnZXRDb3JyZWN0T3JpZW50YXRpb24oKV0gfHwgMCk7XG4gICAgICAgIHNlbGYuc3R5bGUuc2V0UHJvcGVydHkoXCItLXpvb21cIiwgem9vbS52YWx1ZSk7XG4gICAgICAgIHNlbGYuc3R5bGUuc2V0UHJvcGVydHkoXCItLW9yaWVudFwiLCBvcmllbnQudmFsdWUpO1xuXG4gICAgICAgIC8vIFRPRE86IGJyb2tlbiwgZml4IGxhdGVyXG4gICAgICAgIC8vYmluZFdpdGgoc2VsZiwgXCItLXpvb21cIiwgem9vbSwgaGFuZGxlU3R5bGVDaGFuZ2UsIG51bGwpO1xuICAgICAgICAvL2JpbmRXaXRoKHNlbGYsIFwiLS1vcmllbnRcIiwgb3JpZW50LCBoYW5kbGVTdHlsZUNoYW5nZSwgbnVsbCk7XG5cbiAgICAgICAgLy8gc2V0dGluZ3Mgc2l6ZSBpcyBpbGxvZ2ljYWwhIGFuZCBub3QgaW1wbGVtZW50ZWQhXG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShzZWxmLCBcInNpemVcIiwgeyBnZXQ6ICgpID0+IHNpemUgfSk7XG5cbiAgICAgICAgLy9cbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHNlbGYsIFwiem9vbVwiLCB7XG4gICAgICAgICAgICBnZXQ6ICgpID0+IHBhcnNlRmxvYXQoem9vbS52YWx1ZSkgfHwgMSxcbiAgICAgICAgICAgIHNldDogKHZhbHVlKSA9PiB7IHpvb20udmFsdWUgPSB2YWx1ZTsgc2VsZi5zdHlsZS5zZXRQcm9wZXJ0eShcIi0tem9vbVwiLCB2YWx1ZSk7IH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy9cbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHNlbGYsIFwib3JpZW50XCIsIHtcbiAgICAgICAgICAgIGdldDogKCkgPT4gcGFyc2VJbnQob3JpZW50LnZhbHVlKSB8fCAwLFxuICAgICAgICAgICAgc2V0OiAodmFsdWUpID0+IHsgb3JpZW50LnZhbHVlID0gdmFsdWU7IHNlbGYuc3R5bGUuc2V0UHJvcGVydHkoXCItLW9yaWVudFwiLCB2YWx1ZSk7IH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy9cbiAgICAgICAgY29uc3Qgc2l6ZSA9IHZlY3RvcjJSZWYoc2VsZi5jbGllbnRXaWR0aCwgc2VsZi5jbGllbnRIZWlnaHQpO1xuICAgICAgICBjb25zdCByZXNpemVPYnNlcnZlciA9IG5ldyBSZXNpemVPYnNlcnZlcigoZW50cmllcykgPT4ge1xuICAgICAgICAgICAgZm9yIChjb25zdCBlbnRyeSBvZiBlbnRyaWVzKSB7XG4gICAgICAgICAgICAgICAgaWYgKGVudHJ5Py5jb250ZW50Qm94U2l6ZSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBjb250ZW50Qm94U2l6ZSA9IGVudHJ5Py5jb250ZW50Qm94U2l6ZT8uWzBdO1xuICAgICAgICAgICAgICAgICAgICBzaXplLngudmFsdWUgPSAoY29udGVudEJveFNpemU/LmlubGluZVNpemUgfHwgc2l6ZS54LnZhbHVlIHx8IDApO1xuICAgICAgICAgICAgICAgICAgICBzaXplLnkudmFsdWUgPSAoY29udGVudEJveFNpemU/LmJsb2NrU2l6ZSB8fCBzaXplLnkudmFsdWUgfHwgMCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAvL1xuICAgICAgICByZXNpemVPYnNlcnZlci5vYnNlcnZlKHNlbGYsIHtib3g6IFwiY29udGVudC1ib3hcIn0pO1xuICAgICAgICBlbGVtZW50UG9pbnRlck1hcC5zZXQoc2VsZiwge1xuICAgICAgICAgICAgcG9pbnRlck1hcDogbmV3IE1hcDxudW1iZXIsIGFueT4oKSxcbiAgICAgICAgICAgIHBvaW50ZXJDYWNoZTogbmV3IE1hcDxudW1iZXIsIGFueT4oKVxuICAgICAgICB9KTtcblxuICAgICAgICAvL1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG59XG5cbi8vXG5uZXcgVUlPcmllbnRCb3goXCJ1aS1vcmllbnRib3hcIik7XG5leHBvcnQgZGVmYXVsdCBVSU9yaWVudEJveDtcbiJdfQ==