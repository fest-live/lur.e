import { RAFBehavior, orientOf, getBoundingOrientRect, setStyleProperty } from "fest/dom";
import { makeObjectAssignable, observe, affected, numberRef } from "fest/object";
import { makeShiftTrigger, LongPressHandler, clampCell, floorCell, bindDraggable } from "fest/lure";
import { convertOrientPxToCX, redirectCell } from "fest/core";
//
// Track registered CSS properties to avoid duplicate registration errors during HMR
const registeredCSSProperties = new Set();
[
    { name: "--drag-x", syntax: "<number>", inherits: false, initialValue: "0" },
    { name: "--drag-y", syntax: "<number>", inherits: false, initialValue: "0" },
    { name: "--grid-r", syntax: "<number>", inherits: false, initialValue: "0" },
    { name: "--grid-c", syntax: "<number>", inherits: false, initialValue: "0" },
    { name: "--resize-x", syntax: "<number>", inherits: false, initialValue: "0" },
    { name: "--resize-y", syntax: "<number>", inherits: false, initialValue: "0" },
    { name: "--shift-x", syntax: "<number>", inherits: false, initialValue: "0" },
    { name: "--shift-y", syntax: "<number>", inherits: false, initialValue: "0" },
    { name: "--cs-grid-r", syntax: "<number>", inherits: false, initialValue: "0" },
    { name: "--cs-grid-c", syntax: "<number>", inherits: false, initialValue: "0" },
    { name: "--cs-transition-r", syntax: "<length-percentage>", inherits: false, initialValue: "0px" },
    { name: "--cs-transition-c", syntax: "<length-percentage>", inherits: false, initialValue: "0px" },
    { name: "--cs-p-grid-r", syntax: "<number>", inherits: false, initialValue: "0" },
    { name: "--cs-p-grid-c", syntax: "<number>", inherits: false, initialValue: "0" },
    { name: "--os-grid-r", syntax: "<number>", inherits: false, initialValue: "0" },
    { name: "--os-grid-c", syntax: "<number>", inherits: false, initialValue: "0" },
    { name: "--rv-grid-r", syntax: "<number>", inherits: false, initialValue: "0" },
    { name: "--rv-grid-c", syntax: "<number>", inherits: false, initialValue: "0" },
    { name: "--cell-x", syntax: "<number>", inherits: false, initialValue: "0" },
    { name: "--cell-y", syntax: "<number>", inherits: false, initialValue: "0" },
].forEach((options) => {
    if (typeof CSS != "undefined" && !registeredCSSProperties.has(options.name)) {
        try {
            CSS?.registerProperty?.(options);
            registeredCSSProperties.add(options.name);
        }
        catch (e) {
            // Silently ignore duplicate registration errors (common during HMR)
        }
    }
});
//
//const setStyleProperty = (item, prop, value) => {
/*if (value == null || item?.style?.getPropertyValue?.(prop) === String(value)) { return; }
return item?.style?.setProperty?.(prop, value);*/
//}
//
//const computed = Symbol("@computed");
const depAxis = (axis = "x") => { const m = /*matchMedia("(orientation: portrait)").matches*/ true; return { ["x"]: m ? "c" : "r", ["y"]: m ? "r" : "c" }[axis]; };
const swapped = (axis = "x") => { const m = matchMedia("(orientation: portrait)").matches; return { ["x"]: m ? "x" : "y", ["y"]: m ? "y" : "x" }[axis]; };
// DragCoord
export const animationSequence = (DragCoord = 0, axis = "x") => {
    const drag = "--drag-" + axis;
    const axisKey = depAxis(axis);
    const rvProp = `--rv-grid-${axisKey}`;
    const gridProp = `--cs-grid-${axisKey}`;
    const prevGridProp = `--cs-p-grid-${axisKey}`;
    return [
        { [rvProp]: `var(${prevGridProp})`, [drag]: DragCoord }, // starting...
        { [rvProp]: `var(${gridProp})`, [drag]: 0 }
    ];
};
//
export const doAnimate = async (newItem, axis = "x", animate = false, signal) => {
    //
    //setProperty(newItem, "--cs-p-offset-" + swp, `${newItem?.[{"x": "offsetLeft", "y": "offsetTop"}[swp as any]] || 0}px`);
    //const oldOffset = `${newItem?.[{"x": "offsetLeft", "y": "offsetTop"}[swp as any]] || 0}px`;
    //setProperty(newItem, "--cs-p-grid-" + depAxis(axis), oldValue);
    const dragCoord = parseFloat(newItem?.style?.getPropertyValue?.("--drag-" + axis) || "0") || 0;
    //
    if (!animate) {
        await new Promise((r) => requestAnimationFrame(r));
    }
    ;
    //
    const animation = animate && !matchMedia("(prefers-reduced-motion: reduce)")?.matches ? newItem.animate(animationSequence(dragCoord, axis), {
        fill: "none",
        duration: 200,
        //duration: 150,
        easing: "linear"
    }) : null;
    //
    let shifted = false;
    const onShift = [(ev) => {
            if (!shifted) {
                shifted = true;
                animation?.finish?.();
            }
            //
            newItem?.removeEventListener?.("m-dragstart", ...onShift);
            signal?.removeEventListener?.("abort", ...onShift);
        }, { once: true }];
    // not fact, but for animation
    signal?.addEventListener?.("abort", ...onShift);
    newItem?.addEventListener?.("m-dragstart", ...onShift);
    //await new Promise((r)=>requestAnimationFrame(r));
    return animation?.finished?.catch?.(console.warn.bind(console));
    //if (!shifted) { onShift?.[0]?.(); } // commit dragging result
};
//
export const reflectCell = async (newItem, pArgs, withAnimate = false) => {
    const layout = [pArgs?.layout?.columns || pArgs?.layout?.[0] || 4, pArgs?.layout?.rows || pArgs?.layout?.[1] || 8];
    const { item, list, items } = pArgs;
    await new Promise((r) => queueMicrotask(() => r(true)));
    return affected?.(item, (state, property) => {
        const gridSystem = newItem?.parentElement;
        layout[0] = parseInt(gridSystem?.getAttribute?.("data-grid-columns") || "4") || layout[0];
        layout[1] = parseInt(gridSystem?.getAttribute?.("data-grid-rows") || "8") || layout[1];
        const args = { item, list, items, layout, size: [gridSystem?.clientWidth, gridSystem?.clientHeight] };
        if (item && !item?.cell) {
            item.cell = makeObjectAssignable(observe([0, 0]));
        }
        ; // @ts-ignore
        if (property == "cell") {
            const nc = redirectCell(item?.cell || [0, 0], args);
            if (nc[0] != item?.cell?.[0] && item?.cell) {
                item.cell[0] = nc?.[0];
            }
            if (nc[1] != item?.cell?.[1] && item?.cell) {
                item.cell[1] = nc?.[1];
            }
            setStyleProperty(newItem, "--p-cell-x", nc?.[0]);
            setStyleProperty(newItem, "--p-cell-y", nc?.[1]);
            setStyleProperty(newItem, "--cell-x", nc?.[0]);
            setStyleProperty(newItem, "--cell-y", nc?.[1]);
        }
    });
};
//
export const makeDragEvents = async (newItem, { layout, dragging, currentCell, syncDragStyles }, { item, items, list }) => {
    //
    const $updateLayout = (newItem) => {
        const gridSystem = newItem?.parentElement;
        if (!gridSystem) {
            return layout;
        }
        layout[0] = parseInt(gridSystem.getAttribute?.("data-grid-columns") || "4") || layout[0];
        layout[1] = parseInt(gridSystem.getAttribute?.("data-grid-rows") || "8") || layout[1];
        return layout;
    };
    //
    const getSpanOffset = (bounds, layoutSnapshot, size, orient) => {
        if (!bounds || !layoutSnapshot || !size || orient == null) {
            return [0, 0];
        }
        const safeLayout = [
            Math.max(layoutSnapshot?.[0] || 0, 1),
            Math.max(layoutSnapshot?.[1] || 0, 1)
        ];
        const orientedSize = orient % 2 ? [size?.[1] || 1, size?.[0] || 1] : [size?.[0] || 1, size?.[1] || 1];
        const cellSize = [
            (orientedSize[0] || 1) / safeLayout[0],
            (orientedSize[1] || 1) / safeLayout[1]
        ];
        const spanX = Math.max((bounds?.width || cellSize[0]) / (cellSize[0] || 1), 1);
        const spanY = Math.max((bounds?.height || cellSize[1]) / (cellSize[1] || 1), 1);
        return [(spanX - 1) / 2, (spanY - 1) / 2];
    };
    //
    const computeCellFromBounds = () => {
        const gridSystem = newItem?.parentElement;
        if (!gridSystem) {
            return null;
        }
        //
        const orient = orientOf(gridSystem);
        const cbox = getBoundingOrientRect(newItem, orient) ?? newItem?.getBoundingClientRect?.();
        const pbox = getBoundingOrientRect(gridSystem, orient) ?? gridSystem?.getBoundingClientRect?.();
        if (!cbox || !pbox) {
            return null;
        }
        //
        const layoutSnapshot = [...$updateLayout(newItem)];
        const parentRect = gridSystem.getBoundingClientRect?.();
        const gridSize = [
            gridSystem?.clientWidth || gridSystem?.offsetWidth || parentRect?.width || 1,
            gridSystem?.clientHeight || gridSystem?.offsetHeight || parentRect?.height || 1
        ];
        const inset = [
            //(cbox.left - pbox.left),
            //(cbox.top - pbox.top)
            (((cbox.left + cbox.right) / 2) - pbox.left),
            (((cbox.top + cbox.bottom) / 2) - pbox.top)
        ];
        const args = { item, items, list, layout: layoutSnapshot, size: gridSize };
        const spanOffset = getSpanOffset(cbox, layoutSnapshot, gridSize, orient);
        const projected = convertOrientPxToCX(inset, args, orient);
        projected[0] -= spanOffset[0];
        projected[1] -= spanOffset[1];
        const flooredCell = floorCell(projected);
        const redirectedCell = redirectCell([flooredCell.x.value, flooredCell.y.value], args);
        const clampedCell = clampCell(redirectedCell, layoutSnapshot);
        return {
            inset: [inset[0] - dragging?.[0]?.value, inset[1] - dragging?.[1]?.value],
            cell: [clampedCell.x.value, clampedCell.y.value] // Convert Vector2D back to array
        };
    };
    //
    const setCellAxis = (cell, axis = 0) => {
        if (!cell) {
            return;
        }
        if (currentCell?.[axis]?.value != cell?.[axis]) {
            try {
                currentCell[axis].value = cell[axis];
            }
            catch (e) { }
            ;
        }
        ;
    };
    //
    const setCell = (cell) => {
        const args = { item, items, list, layout, size: [newItem?.clientWidth || 0, newItem?.clientHeight || 0] };
        const redirectedCell = redirectCell(cell, args);
        const clampedCell = clampCell(redirectedCell, layout);
        cell = [clampedCell.x.value, clampedCell.y.value]; // Convert Vector2D back to array
        setCellAxis(cell, 0);
        setCellAxis(cell, 1);
    };
    //
    const syncInsetVars = (inset) => {
        if (!inset) {
            return;
        }
        setStyleProperty(newItem, "--cs-inset-x", `${inset[0] || 0}px`);
        setStyleProperty(newItem, "--cs-inset-y", `${inset[1] || 0}px`);
    };
    //
    const correctOffset = (dragging) => {
        // compute correct cell with span awareness
        const ctx = computeCellFromBounds();
        const cell = ctx?.cell;
        //
        if (cell) {
            syncInsetVars((ctx?.inset || [0, 0]));
            setCell(cell);
            setStyleProperty(newItem, "--p-cell-x", cell?.[0] ?? currentCell?.[0]?.value ?? item?.cell?.[0] ?? 0);
            setStyleProperty(newItem, "--p-cell-y", cell?.[1] ?? currentCell?.[1]?.value ?? item?.cell?.[1] ?? 0);
            setStyleProperty(newItem, "--cell-x", cell?.[0] ?? currentCell?.[0]?.value ?? item?.cell?.[0] ?? 0);
            setStyleProperty(newItem, "--cell-y", cell?.[1] ?? currentCell?.[1]?.value ?? item?.cell?.[1] ?? 0);
        }
        // reset dragging offset
        if (dragging && Array.isArray(dragging)) {
            try {
                dragging[0].value = 0, dragging[1].value = 0;
            }
            catch (e) { }
            ;
        }
        syncDragStyles?.(true);
        newItem?.setAttribute?.("data-dragging", "");
        return [0, 0];
    };
    //
    const resolveDragging = (dragging) => {
        // compute correct cell
        const ctx = computeCellFromBounds();
        const cell = ctx?.cell;
        //
        setStyleProperty(newItem, "--p-cell-x", currentCell?.[0]?.value ?? item?.cell?.[0] ?? cell?.[0]);
        setStyleProperty(newItem, "--p-cell-y", currentCell?.[1]?.value ?? item?.cell?.[1] ?? cell?.[1]);
        syncDragStyles?.(true);
        //
        if (cell) {
            setCell(cell);
            setStyleProperty(newItem, "--cell-x", cell?.[0] ?? currentCell?.[0]?.value ?? item?.cell?.[0] ?? 0);
            setStyleProperty(newItem, "--cell-y", cell?.[1] ?? currentCell?.[1]?.value ?? item?.cell?.[1] ?? 0);
        }
        //
        const animations = [
            doAnimate(newItem, "x", true),
            doAnimate(newItem, "y", true)
        ];
        //
        Promise.allSettled(animations).finally(() => {
            if (dragging && Array.isArray(dragging)) {
                try {
                    dragging[0].value = 0, dragging[1].value = 0;
                }
                catch (e) { }
                ;
            }
            //
            syncDragStyles?.(true);
            //
            if (cell) {
                setStyleProperty(newItem, "--p-cell-x", cell?.[0] ?? currentCell?.[0]?.value ?? item?.cell?.[0] ?? 0);
                setStyleProperty(newItem, "--p-cell-y", cell?.[1] ?? currentCell?.[1]?.value ?? item?.cell?.[1] ?? 0);
                setStyleProperty(newItem, "--cell-x", cell?.[0] ?? currentCell?.[0]?.value ?? item?.cell?.[0] ?? 0);
                setStyleProperty(newItem, "--cell-y", cell?.[1] ?? currentCell?.[1]?.value ?? item?.cell?.[1] ?? 0);
            }
            //
            newItem?.removeAttribute?.("data-dragging");
            delete newItem?.dataset?.dragging;
        });
        //
        return [0, 0];
    };
    //
    const customTrigger = (doGrab) => new LongPressHandler(newItem, {
        handler: "*",
        anyPointer: true,
        mouseImmediate: true,
        minHoldTime: 60 * 3600,
        maxHoldTime: 100
    }, makeShiftTrigger((ev) => { correctOffset(dragging); doGrab?.(ev, newItem); }));
    //
    return bindDraggable(customTrigger, resolveDragging, dragging);
};
// shifting - reactive basis
export const ROOT = typeof document != "undefined" ? document?.documentElement : null;
export const bindInteraction = (newItem, pArgs) => {
    reflectCell(newItem, pArgs, true);
    //
    const { item, items, list } = pArgs, layout = [pArgs?.layout?.columns || pArgs?.layout?.[0] || 4, pArgs?.layout?.rows || pArgs?.layout?.[1] || 8];
    const dragging = [numberRef(0, RAFBehavior()), numberRef(0, RAFBehavior())], currentCell = [numberRef(item?.cell?.[0] || 0), numberRef(item?.cell?.[1] || 0)];
    //
    setStyleProperty(newItem, "--cell-x", currentCell?.[0]?.value || 0);
    setStyleProperty(newItem, "--cell-y", currentCell?.[1]?.value || 0);
    //
    const applyDragStyles = () => {
        if (dragging?.[0]?.value != null)
            setStyleProperty(newItem, "--drag-x", dragging?.[0]?.value || 0);
        if (dragging?.[1]?.value != null)
            setStyleProperty(newItem, "--drag-y", dragging?.[1]?.value || 0);
    };
    //
    let dragStyleRaf = 0, lastRaf = null;
    const syncDragStyles = (flush = false) => {
        if (flush) {
            applyDragStyles();
            dragStyleRaf = 0;
            if (lastRaf) {
                cancelAnimationFrame(lastRaf);
            }
            lastRaf = null;
        }
        else if (!dragStyleRaf) {
            dragStyleRaf = 1;
            lastRaf = requestAnimationFrame(() => {
                applyDragStyles();
                dragStyleRaf = 0;
                lastRaf = null;
            });
        }
    };
    //
    affected([dragging?.[0], "value"], (val, prop) => { if (prop == "value") {
        syncDragStyles();
    } });
    affected([dragging?.[1], "value"], (val, prop) => { if (prop == "value") {
        syncDragStyles();
    } });
    syncDragStyles(true);
    //
    affected([currentCell?.[0], "value"], (val, prop) => {
        if (prop == "value" && item.cell != null && val != null) {
            setStyleProperty(newItem, "--cell-x", (item.cell[0] = val) || 0);
        }
    });
    //
    affected([currentCell?.[1], "value"], (val, prop) => {
        if (prop == "value" && item.cell != null && val != null) {
            setStyleProperty(newItem, "--cell-y", (item.cell[1] = val) || 0);
        }
    });
    //
    makeDragEvents(newItem, { layout: layout, currentCell, dragging, syncDragStyles }, { item, items, list });
    return currentCell;
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiSW50ZXJhY3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJJbnRlcmFjdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsV0FBVyxFQUFFLFFBQVEsRUFBRSxxQkFBcUIsRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLFVBQVUsQ0FBQztBQUMxRixPQUFPLEVBQUUsb0JBQW9CLEVBQUUsT0FBTyxFQUFFLFFBQVEsRUFBRSxTQUFTLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFDakYsT0FBTyxFQUFFLGdCQUFnQixFQUFFLGdCQUFnQixFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQUUsYUFBYSxFQUFFLE1BQU0sV0FBVyxDQUFDO0FBQ3BHLE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxZQUFZLEVBQUUsTUFBTSxXQUFXLENBQUM7QUFHOUQsRUFBRTtBQUNGLG9GQUFvRjtBQUNwRixNQUFNLHVCQUF1QixHQUFHLElBQUksR0FBRyxFQUFVLENBQUM7QUFFbEQ7SUFDSSxFQUFFLElBQUksRUFBRSxVQUFVLEVBQUUsTUFBTSxFQUFFLFVBQVUsRUFBRSxRQUFRLEVBQUUsS0FBSyxFQUFFLFlBQVksRUFBRSxHQUFHLEVBQUU7SUFDNUUsRUFBRSxJQUFJLEVBQUUsVUFBVSxFQUFFLE1BQU0sRUFBRSxVQUFVLEVBQUUsUUFBUSxFQUFFLEtBQUssRUFBRSxZQUFZLEVBQUUsR0FBRyxFQUFFO0lBQzVFLEVBQUUsSUFBSSxFQUFFLFVBQVUsRUFBRSxNQUFNLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBRSxLQUFLLEVBQUUsWUFBWSxFQUFFLEdBQUcsRUFBRTtJQUM1RSxFQUFFLElBQUksRUFBRSxVQUFVLEVBQUUsTUFBTSxFQUFFLFVBQVUsRUFBRSxRQUFRLEVBQUUsS0FBSyxFQUFFLFlBQVksRUFBRSxHQUFHLEVBQUU7SUFDNUUsRUFBRSxJQUFJLEVBQUUsWUFBWSxFQUFFLE1BQU0sRUFBRSxVQUFVLEVBQUUsUUFBUSxFQUFFLEtBQUssRUFBRSxZQUFZLEVBQUUs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T0FBTyxFQUFFLEVBQUMsTUFBTSxFQUFFLE1BQTBCLEVBQUUsV0FBVyxFQUFFLFFBQVEsRUFBRSxjQUFjLEVBQUMsRUFBRSxFQUFDLElBQUksRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFDLENBQUMsQ0FBQztJQUMxSCxPQUFPLFdBQXlCLENBQUM7QUFDckMsQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUkFGQmVoYXZpb3IsIG9yaWVudE9mLCBnZXRCb3VuZGluZ09yaWVudFJlY3QsIHNldFN0eWxlUHJvcGVydHkgfSBmcm9tIFwiZmVzdC9kb21cIjtcbmltcG9ydCB7IG1ha2VPYmplY3RBc3NpZ25hYmxlLCBvYnNlcnZlLCBhZmZlY3RlZCwgbnVtYmVyUmVmIH0gZnJvbSBcImZlc3Qvb2JqZWN0XCI7XG5pbXBvcnQgeyBtYWtlU2hpZnRUcmlnZ2VyLCBMb25nUHJlc3NIYW5kbGVyLCBjbGFtcENlbGwsIGZsb29yQ2VsbCwgYmluZERyYWdnYWJsZSB9IGZyb20gXCJmZXN0L2x1cmVcIjtcbmltcG9ydCB7IGNvbnZlcnRPcmllbnRQeFRvQ1gsIHJlZGlyZWN0Q2VsbCB9IGZyb20gXCJmZXN0L2NvcmVcIjtcbmltcG9ydCB0eXBlIHsgR3JpZEFyZ3NUeXBlIGFzIEdyaWRBcmdzVHlwZSwgR3JpZEl0ZW1UeXBlIH0gZnJvbSBcImZlc3QvY29yZVwiO1xuXG4vL1xuLy8gVHJhY2sgcmVnaXN0ZXJlZCBDU1MgcHJvcGVydGllcyB0byBhdm9pZCBkdXBsaWNhdGUgcmVnaXN0cmF0aW9uIGVycm9ycyBkdXJpbmcgSE1SXG5jb25zdCByZWdpc3RlcmVkQ1NTUHJvcGVydGllcyA9IG5ldyBTZXQ8c3RyaW5nPigpO1xuXG5bICAgLy8gQHRzLWlnbm9yZVxuICAgIHsgbmFtZTogXCItLWRyYWcteFwiLCBzeW50YXg6IFwiPG51bWJlcj5cIiwgaW5oZXJpdHM6IGZhbHNlLCBpbml0aWFsVmFsdWU6IFwiMFwiIH0sXG4gICAgeyBuYW1lOiBcIi0tZHJhZy15XCIsIHN5bnRheDogXCI8bnVtYmVyPlwiLCBpbmhlcml0czogZmFsc2UsIGluaXRpYWxWYWx1ZTogXCIwXCIgfSxcbiAgICB7IG5hbWU6IFwiLS1ncmlkLXJcIiwgc3ludGF4OiBcIjxudW1iZXI+XCIsIGluaGVyaXRzOiBmYWxzZSwgaW5pdGlhbFZhbHVlOiBcIjBcIiB9LFxuICAgIHsgbmFtZTogXCItLWdyaWQtY1wiLCBzeW50YXg6IFwiPG51bWJlcj5cIiwgaW5oZXJpdHM6IGZhbHNlLCBpbml0aWFsVmFsdWU6IFwiMFwiIH0sXG4gICAgeyBuYW1lOiBcIi0tcmVzaXplLXhcIiwgc3ludGF4OiBcIjxudW1iZXI+XCIsIGluaGVyaXRzOiBmYWxzZSwgaW5pdGlhbFZhbHVlOiBcIjBcIiB9LFxuICAgIHsgbmFtZTogXCItLXJlc2l6ZS15XCIsIHN5bnRheDogXCI8bnVtYmVyPlwiLCBpbmhlcml0czogZmFsc2UsIGluaXRpYWxWYWx1ZTogXCIwXCIgfSxcbiAgICB7IG5hbWU6IFwiLS1zaGlmdC14XCIsIHN5bnRheDogXCI8bnVtYmVyPlwiLCBpbmhlcml0czogZmFsc2UsIGluaXRpYWxWYWx1ZTogXCIwXCIgfSxcbiAgICB7IG5hbWU6IFwiLS1zaGlmdC15XCIsIHN5bnRheDogXCI8bnVtYmVyPlwiLCBpbmhlcml0czogZmFsc2UsIGluaXRpYWxWYWx1ZTogXCIwXCIgfSxcbiAgICB7IG5hbWU6IFwiLS1jcy1ncmlkLXJcIiwgc3ludGF4OiBcIjxudW1iZXI+XCIsIGluaGVyaXRzOiBmYWxzZSwgaW5pdGlhbFZhbHVlOiBcIjBcIiB9LFxuICAgIHsgbmFtZTogXCItLWNzLWdyaWQtY1wiLCBzeW50YXg6IFwiPG51bWJlcj5cIiwgaW5oZXJpdHM6IGZhbHNlLCBpbml0aWFsVmFsdWU6IFwiMFwiIH0sXG4gICAgeyBuYW1lOiBcIi0tY3MtdHJhbnNpdGlvbi1yXCIsIHN5bnRheDogXCI8bGVuZ3RoLXBlcmNlbnRhZ2U+XCIsIGluaGVyaXRzOiBmYWxzZSwgaW5pdGlhbFZhbHVlOiBcIjBweFwiIH0sXG4gICAgeyBuYW1lOiBcIi0tY3MtdHJhbnNpdGlvbi1jXCIsIHN5bnRheDogXCI8bGVuZ3RoLXBlcmNlbnRhZ2U+XCIsIGluaGVyaXRzOiBmYWxzZSwgaW5pdGlhbFZhbHVlOiBcIjBweFwiIH0sXG4gICAgeyBuYW1lOiBcIi0tY3MtcC1ncmlkLXJcIiwgc3ludGF4OiBcIjxudW1iZXI+XCIsIGluaGVyaXRzOiBmYWxzZSwgaW5pdGlhbFZhbHVlOiBcIjBcIiB9LFxuICAgIHsgbmFtZTogXCItLWNzLXAtZ3JpZC1jXCIsIHN5bnRheDogXCI8bnVtYmVyPlwiLCBpbmhlcml0czogZmFsc2UsIGluaXRpYWxWYWx1ZTogXCIwXCIgfSxcbiAgICB7IG5hbWU6IFwiLS1vcy1ncmlkLXJcIiwgc3ludGF4OiBcIjxudW1iZXI+XCIsIGluaGVyaXRzOiBmYWxzZSwgaW5pdGlhbFZhbHVlOiBcIjBcIiB9LFxuICAgIHsgbmFtZTogXCItLW9zLWdyaWQtY1wiLCBzeW50YXg6IFwiPG51bWJlcj5cIiwgaW5oZXJpdHM6IGZhbHNlLCBpbml0aWFsVmFsdWU6IFwiMFwiIH0sXG4gICAgeyBuYW1lOiBcIi0tcnYtZ3JpZC1yXCIsIHN5bnRheDogXCI8bnVtYmVyPlwiLCBpbmhlcml0czogZmFsc2UsIGluaXRpYWxWYWx1ZTogXCIwXCIgfSxcbiAgICB7IG5hbWU6IFwiLS1ydi1ncmlkLWNcIiwgc3ludGF4OiBcIjxudW1iZXI+XCIsIGluaGVyaXRzOiBmYWxzZSwgaW5pdGlhbFZhbHVlOiBcIjBcIiB9LFxuICAgIHsgbmFtZTogXCItLWNlbGwteFwiLCBzeW50YXg6IFwiPG51bWJlcj5cIiwgaW5oZXJpdHM6IGZhbHNlLCBpbml0aWFsVmFsdWU6IFwiMFwiIH0sXG4gICAgeyBuYW1lOiBcIi0tY2VsbC15XCIsIHN5bnRheDogXCI8bnVtYmVyPlwiLCBpbmhlcml0czogZmFsc2UsIGluaXRpYWxWYWx1ZTogXCIwXCIgfSxcbl0uZm9yRWFjaCgob3B0aW9uczogYW55KSA9PiB7XG4gICAgaWYgKHR5cGVvZiBDU1MgIT0gXCJ1bmRlZmluZWRcIiAmJiAhcmVnaXN0ZXJlZENTU1Byb3BlcnRpZXMuaGFzKG9wdGlvbnMubmFtZSkpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIENTUz8ucmVnaXN0ZXJQcm9wZXJ0eT8uKG9wdGlvbnMpO1xuICAgICAgICAgICAgcmVnaXN0ZXJlZENTU1Byb3BlcnRpZXMuYWRkKG9wdGlvbnMubmFtZSk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIC8vIFNpbGVudGx5IGlnbm9yZSBkdXBsaWNhdGUgcmVnaXN0cmF0aW9uIGVycm9ycyAoY29tbW9uIGR1cmluZyBITVIpXG4gICAgICAgIH1cbiAgICB9XG59KTtcblxuLy9cbi8vY29uc3Qgc2V0U3R5bGVQcm9wZXJ0eSA9IChpdGVtLCBwcm9wLCB2YWx1ZSkgPT4ge1xuICAgIC8qaWYgKHZhbHVlID09IG51bGwgfHwgaXRlbT8uc3R5bGU/LmdldFByb3BlcnR5VmFsdWU/Lihwcm9wKSA9PT0gU3RyaW5nKHZhbHVlKSkgeyByZXR1cm47IH1cbiAgICByZXR1cm4gaXRlbT8uc3R5bGU/LnNldFByb3BlcnR5Py4ocHJvcCwgdmFsdWUpOyovXG4vL31cblxuLy9cbi8vY29uc3QgY29tcHV0ZWQgPSBTeW1ib2woXCJAY29tcHV0ZWRcIik7XG5jb25zdCBkZXBBeGlzICA9IChheGlzOiBzdHJpbmcgPSBcInhcIik9PnsgY29uc3QgbSA9IC8qbWF0Y2hNZWRpYShcIihvcmllbnRhdGlvbjogcG9ydHJhaXQpXCIpLm1hdGNoZXMqL3RydWU7IHJldHVybiB7W1wieFwiXTogbT9cImNcIjpcInJcIiwgW1wieVwiXTogbT9cInJcIjpcImNcIn1bYXhpc107IH1cbmNvbnN0IHN3YXBwZWQgID0gKGF4aXM6IHN0cmluZyA9IFwieFwiKT0+eyBjb25zdCBtID0gbWF0Y2hNZWRpYShcIihvcmllbnRhdGlvbjogcG9ydHJhaXQpXCIpLm1hdGNoZXM7IHJldHVybiB7W1wieFwiXTogbT9cInhcIjpcInlcIiwgW1wieVwiXTogbT9cInlcIjpcInhcIn1bYXhpc107IH1cblxuLy8gRHJhZ0Nvb3JkXG5leHBvcnQgY29uc3QgYW5pbWF0aW9uU2VxdWVuY2UgPSAoRHJhZ0Nvb3JkID0gMCwgYXhpcyA9IFwieFwiKSA9PiB7XG4gICAgY29uc3QgZHJhZyA9IFwiLS1kcmFnLVwiICsgYXhpcztcbiAgICBjb25zdCBheGlzS2V5ID0gZGVwQXhpcyhheGlzKTtcbiAgICBjb25zdCBydlByb3AgPSBgLS1ydi1ncmlkLSR7YXhpc0tleX1gO1xuICAgIGNvbnN0IGdyaWRQcm9wID0gYC0tY3MtZ3JpZC0ke2F4aXNLZXl9YDtcbiAgICBjb25zdCBwcmV2R3JpZFByb3AgPSBgLS1jcy1wLWdyaWQtJHtheGlzS2V5fWA7XG4gICAgcmV0dXJuIFtcbiAgICAgICAgeyBbcnZQcm9wXTogYHZhcigke3ByZXZHcmlkUHJvcH0pYCwgW2RyYWddOiBEcmFnQ29vcmQgfSwgLy8gc3RhcnRpbmcuLi5cbiAgICAgICAgeyBbcnZQcm9wXTogYHZhcigke2dyaWRQcm9wfSlgLCBbZHJhZ106IDAgfVxuICAgIF07XG59O1xuXG4vL1xuZXhwb3J0IGNvbnN0IGRvQW5pbWF0ZSA9IGFzeW5jIChuZXdJdGVtLCBheGlzOiBhbnkgPSBcInhcIiwgYW5pbWF0ZSA9IGZhbHNlLCBzaWduYWw/OiBBYm9ydFNpZ25hbCk9PntcblxuICAgIC8vXG4gICAgLy9zZXRQcm9wZXJ0eShuZXdJdGVtLCBcIi0tY3MtcC1vZmZzZXQtXCIgKyBzd3AsIGAke25ld0l0ZW0/Llt7XCJ4XCI6IFwib2Zmc2V0TGVmdFwiLCBcInlcIjogXCJvZmZzZXRUb3BcIn1bc3dwIGFzIGFueV1dIHx8IDB9cHhgKTtcbiAgICAvL2NvbnN0IG9sZE9mZnNldCA9IGAke25ld0l0ZW0/Llt7XCJ4XCI6IFwib2Zmc2V0TGVmdFwiLCBcInlcIjogXCJvZmZzZXRUb3BcIn1bc3dwIGFzIGFueV1dIHx8IDB9cHhgO1xuICAgIC8vc2V0UHJvcGVydHkobmV3SXRlbSwgXCItLWNzLXAtZ3JpZC1cIiArIGRlcEF4aXMoYXhpcyksIG9sZFZhbHVlKTtcbiAgICBjb25zdCBkcmFnQ29vcmQgPSBwYXJzZUZsb2F0KG5ld0l0ZW0/LnN0eWxlPy5nZXRQcm9wZXJ0eVZhbHVlPy4oXCItLWRyYWctXCIgKyBheGlzKSB8fCBcIjBcIikgfHwgMDtcblxuICAgIC8vXG4gICAgaWYgKCFhbmltYXRlKSB7IGF3YWl0IG5ldyBQcm9taXNlKChyKT0+cmVxdWVzdEFuaW1hdGlvbkZyYW1lKHIpKTsgfTtcblxuICAgIC8vXG4gICAgY29uc3QgYW5pbWF0aW9uID0gYW5pbWF0ZSAmJiAhbWF0Y2hNZWRpYShcIihwcmVmZXJzLXJlZHVjZWQtbW90aW9uOiByZWR1Y2UpXCIpPy5tYXRjaGVzID8gbmV3SXRlbS5hbmltYXRlKGFuaW1hdGlvblNlcXVlbmNlKGRyYWdDb29yZCwgYXhpcyksIHtcbiAgICAgICAgZmlsbDogXCJub25lXCIsXG4gICAgICAgIGR1cmF0aW9uOiAyMDAsXG4gICAgICAgIC8vZHVyYXRpb246IDE1MCxcbiAgICAgICAgZWFzaW5nOiBcImxpbmVhclwiXG4gICAgfSkgOiBudWxsO1xuXG4gICAgLy9cbiAgICBsZXQgc2hpZnRlZCA9IGZhbHNlO1xuICAgIGNvbnN0IG9uU2hpZnQ6IFthbnksIGFueV0gPSBbKGV2KT0+e1xuICAgICAgICBpZiAoIXNoaWZ0ZWQpIHtcbiAgICAgICAgICAgIHNoaWZ0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgYW5pbWF0aW9uPy5maW5pc2g/LigpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy9cbiAgICAgICAgbmV3SXRlbT8ucmVtb3ZlRXZlbnRMaXN0ZW5lcj8uKFwibS1kcmFnc3RhcnRcIiwgLi4ub25TaGlmdCk7XG4gICAgICAgIHNpZ25hbD8ucmVtb3ZlRXZlbnRMaXN0ZW5lcj8uKFwiYWJvcnRcIiwgLi4ub25TaGlmdCk7XG4gICAgfSwge29uY2U6IHRydWV9XTtcblxuICAgIC8vIG5vdCBmYWN0LCBidXQgZm9yIGFuaW1hdGlvblxuICAgIHNpZ25hbD8uYWRkRXZlbnRMaXN0ZW5lcj8uKFwiYWJvcnRcIiwgLi4ub25TaGlmdCk7XG4gICAgbmV3SXRlbT8uYWRkRXZlbnRMaXN0ZW5lcj8uKFwibS1kcmFnc3RhcnRcIiwgLi4ub25TaGlmdCk7XG4gICAgLy9hd2FpdCBuZXcgUHJvbWlzZSgocik9PnJlcXVlc3RBbmltYXRpb25GcmFtZShyKSk7XG4gICAgcmV0dXJuIGFuaW1hdGlvbj8uZmluaXNoZWQ/LmNhdGNoPy4oY29uc29sZS53YXJuLmJpbmQoY29uc29sZSkpO1xuICAgIC8vaWYgKCFzaGlmdGVkKSB7IG9uU2hpZnQ/LlswXT8uKCk7IH0gLy8gY29tbWl0IGRyYWdnaW5nIHJlc3VsdFxufVxuXG4vL1xuZXhwb3J0IGNvbnN0IHJlZmxlY3RDZWxsID0gYXN5bmMgKG5ld0l0ZW06IEhUTUxFbGVtZW50LCBwQXJnczogR3JpZEFyZ3NUeXBlLCB3aXRoQW5pbWF0ZSA9IGZhbHNlKTogUHJvbWlzZTx2b2lkPiA9PiB7XG4gICAgY29uc3QgbGF5b3V0OiBbbnVtYmVyLCBudW1iZXJdID0gWyhwQXJncz8ubGF5b3V0IGFzIGFueSk/LmNvbHVtbnMgfHwgcEFyZ3M/LmxheW91dD8uWzBdIHx8IDQsIChwQXJncz8ubGF5b3V0IGFzIGFueSk/LnJvd3MgfHwgcEFyZ3M/LmxheW91dD8uWzFdIHx8IDhdO1xuICAgIGNvbnN0IHtpdGVtLCBsaXN0LCBpdGVtc30gPSBwQXJncztcbiAgICBhd2FpdCBuZXcgUHJvbWlzZSgocik9PnF1ZXVlTWljcm90YXNrKCgpPT5yKHRydWUpKSk7XG4gICAgcmV0dXJuIGFmZmVjdGVkPy4oaXRlbSwgKHN0YXRlLCBwcm9wZXJ0eSk9PntcbiAgICAgICAgY29uc3QgZ3JpZFN5c3RlbSA9IG5ld0l0ZW0/LnBhcmVudEVsZW1lbnQ7XG4gICAgICAgIGxheW91dFswXSA9IHBhcnNlSW50KGdyaWRTeXN0ZW0/LmdldEF0dHJpYnV0ZT8uKFwiZGF0YS1ncmlkLWNvbHVtbnNcIikgfHwgXCI0XCIpIHx8IGxheW91dFswXTtcbiAgICAgICAgbGF5b3V0WzFdID0gcGFyc2VJbnQoZ3JpZFN5c3RlbT8uZ2V0QXR0cmlidXRlPy4oXCJkYXRhLWdyaWQtcm93c1wiKSB8fCBcIjhcIikgfHwgbGF5b3V0WzFdO1xuICAgICAgICBjb25zdCBhcmdzID0ge2l0ZW0sIGxpc3QsIGl0ZW1zLCBsYXlvdXQsIHNpemU6IFtncmlkU3lzdGVtPy5jbGllbnRXaWR0aCwgZ3JpZFN5c3RlbT8uY2xpZW50SGVpZ2h0XX07XG4gICAgICAgIGlmIChpdGVtICYmICFpdGVtPy5jZWxsKSB7IGl0ZW0uY2VsbCA9IG1ha2VPYmplY3RBc3NpZ25hYmxlKG9ic2VydmUoWzAsIDBdKSk7IH07IC8vIEB0cy1pZ25vcmVcbiAgICAgICAgaWYgKHByb3BlcnR5ID09IFwiY2VsbFwiKSB7XG4gICAgICAgICAgICBjb25zdCBuYyA9IHJlZGlyZWN0Q2VsbChpdGVtPy5jZWxsIHx8IFswLCAwXSwgYXJncyBhcyBHcmlkQXJnc1R5cGUpO1xuICAgICAgICAgICAgaWYgKG5jWzBdICE9IGl0ZW0/LmNlbGw/LlswXSAmJiBpdGVtPy5jZWxsKSB7IGl0ZW0uY2VsbFswXSA9IG5jPy5bMF07IH1cbiAgICAgICAgICAgIGlmIChuY1sxXSAhPSBpdGVtPy5jZWxsPy5bMV0gJiYgaXRlbT8uY2VsbCkgeyBpdGVtLmNlbGxbMV0gPSBuYz8uWzFdOyB9XG4gICAgICAgICAgICBzZXRTdHlsZVByb3BlcnR5KG5ld0l0ZW0sIFwiLS1wLWNlbGwteFwiLCBuYz8uWzBdKTtcbiAgICAgICAgICAgIHNldFN0eWxlUHJvcGVydHkobmV3SXRlbSwgXCItLXAtY2VsbC15XCIsIG5jPy5bMV0pO1xuICAgICAgICAgICAgc2V0U3R5bGVQcm9wZXJ0eShuZXdJdGVtLCBcIi0tY2VsbC14XCIsIG5jPy5bMF0pO1xuICAgICAgICAgICAgc2V0U3R5bGVQcm9wZXJ0eShuZXdJdGVtLCBcIi0tY2VsbC15XCIsIG5jPy5bMV0pO1xuICAgICAgICB9XG4gICAgfSk7XG59XG5cbi8vXG5leHBvcnQgY29uc3QgbWFrZURyYWdFdmVudHMgPSBhc3luYyAoXG4gICAgbmV3SXRlbTogSFRNTEVsZW1lbnQsXG4gICAgeyBsYXlvdXQsIGRyYWdnaW5nLCBjdXJyZW50Q2VsbCwgc3luY0RyYWdTdHlsZXMgfToge1xuICAgICAgICBsYXlvdXQ6IFtudW1iZXIsIG51bWJlcl0sXG4gICAgICAgIGRyYWdnaW5nOiBbYW55LCBhbnldLFxuICAgICAgICBjdXJyZW50Q2VsbDogW2FueSwgYW55XSxcbiAgICAgICAgc3luY0RyYWdTdHlsZXM6IChmbHVzaDogYm9vbGVhbikgPT4gdm9pZFxuICAgIH0sXG4gICAgeyBpdGVtLCBpdGVtcywgbGlzdCB9OiB7XG4gICAgICAgIGl0ZW06IEdyaWRJdGVtVHlwZSxcbiAgICAgICAgaXRlbXM6IE1hcDxzdHJpbmcsIEdyaWRJdGVtVHlwZT4gfCBTZXQ8R3JpZEl0ZW1UeXBlPiB8IEdyaWRJdGVtVHlwZVtdLFxuICAgICAgICBsaXN0OiBTZXQ8c3RyaW5nPiB8IHN0cmluZ1tdXG4gICAgfSk6IFByb21pc2U8eyBkaXNwb3NlOiAoKSA9PiB2b2lkLCBkcmFnZ2FibGU6IGFueSwgcHJvY2VzczogKGV2OiBNb3VzZUV2ZW50LCBlbDogSFRNTEVsZW1lbnQpID0+IFByb21pc2U8dW5rbm93bj4gfSB8IHVuZGVmaW5lZD4gPT4ge1xuXG4gICAgLy9cbiAgICBjb25zdCAkdXBkYXRlTGF5b3V0ID0gKG5ld0l0ZW06IEhUTUxFbGVtZW50KTogW251bWJlciwgbnVtYmVyXSA9PiB7XG4gICAgICAgIGNvbnN0IGdyaWRTeXN0ZW0gPSBuZXdJdGVtPy5wYXJlbnRFbGVtZW50IGFzIEhUTUxFbGVtZW50IHwgbnVsbDtcbiAgICAgICAgaWYgKCFncmlkU3lzdGVtKSB7IHJldHVybiBsYXlvdXQ7IH1cbiAgICAgICAgbGF5b3V0WzBdID0gcGFyc2VJbnQoZ3JpZFN5c3RlbS5nZXRBdHRyaWJ1dGU/LihcImRhdGEtZ3JpZC1jb2x1bW5zXCIpIGFzIHN0cmluZyB8fCBcIjRcIikgfHwgbGF5b3V0WzBdO1xuICAgICAgICBsYXlvdXRbMV0gPSBwYXJzZUludChncmlkU3lzdGVtLmdldEF0dHJpYnV0ZT8uKFwiZGF0YS1ncmlkLXJvd3NcIikgYXMgc3RyaW5nIHx8IFwiOFwiKSB8fCBsYXlvdXRbMV07XG4gICAgICAgIHJldHVybiBsYXlvdXQ7XG4gICAgfTtcblxuICAgIC8vXG4gICAgY29uc3QgZ2V0U3Bhbk9mZnNldCA9IChib3VuZHM6IERPTVJlY3QgfCBudWxsLCBsYXlvdXRTbmFwc2hvdDogW251bWJlciwgbnVtYmVyXSB8IG51bGwsIHNpemU6IFtudW1iZXIsIG51bWJlcl0gfCBudWxsLCBvcmllbnQ6IG51bWJlciB8IG51bGwpOiBbbnVtYmVyLCBudW1iZXJdID0+IHtcbiAgICAgICAgaWYgKCFib3VuZHMgfHwgIWxheW91dFNuYXBzaG90IHx8ICFzaXplIHx8IG9yaWVudCA9PSBudWxsKSB7IHJldHVybiBbMCwgMF07IH1cbiAgICAgICAgY29uc3Qgc2FmZUxheW91dDogW251bWJlciwgbnVtYmVyXSA9IFtcbiAgICAgICAgICAgIE1hdGgubWF4KGxheW91dFNuYXBzaG90Py5bMF0gfHwgMCwgMSksXG4gICAgICAgICAgICBNYXRoLm1heChsYXlvdXRTbmFwc2hvdD8uWzFdIHx8IDAsIDEpXG4gICAgICAgIF07XG4gICAgICAgIGNvbnN0IG9yaWVudGVkU2l6ZTogW251bWJlciwgbnVtYmVyXSA9IG9yaWVudCAlIDIgPyBbc2l6ZT8uWzFdIHx8IDEsIHNpemU/LlswXSB8fCAxXSA6IFtzaXplPy5bMF0gfHwgMSwgc2l6ZT8uWzFdIHx8IDFdO1xuICAgICAgICBjb25zdCBjZWxsU2l6ZTogW251bWJlciwgbnVtYmVyXSA9IFtcbiAgICAgICAgICAgIChvcmllbnRlZFNpemVbMF0gfHwgMSkgLyBzYWZlTGF5b3V0WzBdLFxuICAgICAgICAgICAgKG9yaWVudGVkU2l6ZVsxXSB8fCAxKSAvIHNhZmVMYXlvdXRbMV1cbiAgICAgICAgXTtcbiAgICAgICAgY29uc3Qgc3BhblggPSBNYXRoLm1heCgoYm91bmRzPy53aWR0aCB8fCBjZWxsU2l6ZVswXSkgLyAoY2VsbFNpemVbMF0gfHwgMSksIDEpO1xuICAgICAgICBjb25zdCBzcGFuWSA9IE1hdGgubWF4KChib3VuZHM/LmhlaWdodCB8fCBjZWxsU2l6ZVsxXSkgLyAoY2VsbFNpemVbMV0gfHwgMSksIDEpO1xuICAgICAgICByZXR1cm4gWyhzcGFuWCAtIDEpIC8gMiwgKHNwYW5ZIC0gMSkgLyAyXTtcbiAgICB9O1xuXG4gICAgLy9cbiAgICBjb25zdCBjb21wdXRlQ2VsbEZyb21Cb3VuZHMgPSAoKTogeyBpbnNldD86IFtudW1iZXIsIG51bWJlcl0sIGNlbGw/OiBbbnVtYmVyLCBudW1iZXJdIH0gfCBudWxsID0+IHtcbiAgICAgICAgY29uc3QgZ3JpZFN5c3RlbSA9IG5ld0l0ZW0/LnBhcmVudEVsZW1lbnQgYXMgSFRNTEVsZW1lbnQgfCBudWxsO1xuICAgICAgICBpZiAoIWdyaWRTeXN0ZW0pIHsgcmV0dXJuIG51bGw7IH1cblxuICAgICAgICAvL1xuICAgICAgICBjb25zdCBvcmllbnQgPSBvcmllbnRPZihncmlkU3lzdGVtKTtcbiAgICAgICAgY29uc3QgY2JveCA9IGdldEJvdW5kaW5nT3JpZW50UmVjdChuZXdJdGVtLCBvcmllbnQpID8/IG5ld0l0ZW0/LmdldEJvdW5kaW5nQ2xpZW50UmVjdD8uKCk7XG4gICAgICAgIGNvbnN0IHBib3ggPSBnZXRCb3VuZGluZ09yaWVudFJlY3QoZ3JpZFN5c3RlbSwgb3JpZW50KSA/PyBncmlkU3lzdGVtPy5nZXRCb3VuZGluZ0NsaWVudFJlY3Q/LigpO1xuICAgICAgICBpZiAoIWNib3ggfHwgIXBib3gpIHsgcmV0dXJuIG51bGw7IH1cblxuICAgICAgICAvL1xuICAgICAgICBjb25zdCBsYXlvdXRTbmFwc2hvdCA9IFsuLi4kdXBkYXRlTGF5b3V0KG5ld0l0ZW0pXSBhcyBbbnVtYmVyLCBudW1iZXJdO1xuICAgICAgICBjb25zdCBwYXJlbnRSZWN0ID0gZ3JpZFN5c3RlbS5nZXRCb3VuZGluZ0NsaWVudFJlY3Q/LigpO1xuICAgICAgICBjb25zdCBncmlkU2l6ZTogW251bWJlciwgbnVtYmVyXSA9IFtcbiAgICAgICAgICAgIGdyaWRTeXN0ZW0/LmNsaWVudFdpZHRoIHx8IGdyaWRTeXN0ZW0/Lm9mZnNldFdpZHRoIHx8IHBhcmVudFJlY3Q/LndpZHRoIHx8IDEsXG4gICAgICAgICAgICBncmlkU3lzdGVtPy5jbGllbnRIZWlnaHQgfHwgZ3JpZFN5c3RlbT8ub2Zmc2V0SGVpZ2h0IHx8IHBhcmVudFJlY3Q/LmhlaWdodCB8fCAxXG4gICAgICAgIF07XG4gICAgICAgIGNvbnN0IGluc2V0OiBbbnVtYmVyLCBudW1iZXJdID0gW1xuICAgICAgICAgICAgLy8oY2JveC5sZWZ0IC0gcGJveC5sZWZ0KSxcbiAgICAgICAgICAgIC8vKGNib3gudG9wIC0gcGJveC50b3ApXG4gICAgICAgICAgICAoKChjYm94LmxlZnQgKyBjYm94LnJpZ2h0KSAvIDIpIC0gcGJveC5sZWZ0KSxcbiAgICAgICAgICAgICgoKGNib3gudG9wICsgY2JveC5ib3R0b20pIC8gMikgLSBwYm94LnRvcClcbiAgICAgICAgXTtcbiAgICAgICAgY29uc3QgYXJncyA9IHsgaXRlbSwgaXRlbXMsIGxpc3QsIGxheW91dDogbGF5b3V0U25hcHNob3QgYXMgW251bWJlciwgbnVtYmVyXSwgc2l6ZTogZ3JpZFNpemUgfTtcbiAgICAgICAgY29uc3Qgc3Bhbk9mZnNldCA9IGdldFNwYW5PZmZzZXQoY2JveCBhcyB1bmtub3duIGFzIERPTVJlY3QsIGxheW91dFNuYXBzaG90IGFzIFtudW1iZXIsIG51bWJlcl0sIGdyaWRTaXplLCBvcmllbnQpO1xuICAgICAgICBjb25zdCBwcm9qZWN0ZWQgPSBjb252ZXJ0T3JpZW50UHhUb0NYKGluc2V0LCBhcmdzLCBvcmllbnQpO1xuICAgICAgICBwcm9qZWN0ZWRbMF0gLT0gc3Bhbk9mZnNldFswXTtcbiAgICAgICAgcHJvamVjdGVkWzFdIC09IHNwYW5PZmZzZXRbMV07XG4gICAgICAgIGNvbnN0IGZsb29yZWRDZWxsID0gZmxvb3JDZWxsKHByb2plY3RlZCBhcyBbbnVtYmVyLCBudW1iZXJdKTtcbiAgICAgICAgY29uc3QgcmVkaXJlY3RlZENlbGwgPSByZWRpcmVjdENlbGwoW2Zsb29yZWRDZWxsLngudmFsdWUsIGZsb29yZWRDZWxsLnkudmFsdWVdLCBhcmdzKTtcbiAgICAgICAgY29uc3QgY2xhbXBlZENlbGwgPSBjbGFtcENlbGwocmVkaXJlY3RlZENlbGwsIGxheW91dFNuYXBzaG90IGFzIFtudW1iZXIsIG51bWJlcl0pO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgaW5zZXQ6IFtpbnNldFswXSAtIGRyYWdnaW5nPy5bMF0/LnZhbHVlLCBpbnNldFsxXSAtIGRyYWdnaW5nPy5bMV0/LnZhbHVlXSxcbiAgICAgICAgICAgIGNlbGw6IFtjbGFtcGVkQ2VsbC54LnZhbHVlLCBjbGFtcGVkQ2VsbC55LnZhbHVlXSAvLyBDb252ZXJ0IFZlY3RvcjJEIGJhY2sgdG8gYXJyYXlcbiAgICAgICAgfSBhcyB7IGluc2V0PzogW251bWJlciwgbnVtYmVyXSwgY2VsbD86IFtudW1iZXIsIG51bWJlcl0gfTtcbiAgICB9O1xuXG4gICAgLy9cbiAgICBjb25zdCBzZXRDZWxsQXhpcyA9IChjZWxsOiBbbnVtYmVyLCBudW1iZXJdIHwgbnVsbCwgYXhpcyA9IDApOiB2b2lkID0+IHtcbiAgICAgICAgaWYgKCFjZWxsKSB7IHJldHVybjsgfVxuICAgICAgICBpZiAoY3VycmVudENlbGw/LltheGlzXT8udmFsdWUgIT0gY2VsbD8uW2F4aXNdKSB7XG4gICAgICAgICAgICB0cnkgeyBjdXJyZW50Q2VsbFtheGlzXS52YWx1ZSA9IGNlbGxbYXhpc107IH0gY2F0Y2goZSl7fTtcbiAgICAgICAgfTtcbiAgICB9O1xuXG4gICAgLy9cbiAgICBjb25zdCBzZXRDZWxsID0gKGNlbGw6IFtudW1iZXIsIG51bWJlcl0pOiB2b2lkID0+IHtcbiAgICAgICAgY29uc3QgYXJncyA9IHtpdGVtLCBpdGVtcywgbGlzdCwgbGF5b3V0LCBzaXplOiBbbmV3SXRlbT8uY2xpZW50V2lkdGggfHwgMCwgbmV3SXRlbT8uY2xpZW50SGVpZ2h0IHx8IDBdIGFzIFtudW1iZXIsIG51bWJlcl19O1xuICAgICAgICBjb25zdCByZWRpcmVjdGVkQ2VsbCA9IHJlZGlyZWN0Q2VsbChjZWxsLCBhcmdzIGFzIEdyaWRBcmdzVHlwZSk7XG4gICAgICAgIGNvbnN0IGNsYW1wZWRDZWxsID0gY2xhbXBDZWxsKHJlZGlyZWN0ZWRDZWxsLCBsYXlvdXQgYXMgW251bWJlciwgbnVtYmVyXSk7XG4gICAgICAgIGNlbGwgPSBbY2xhbXBlZENlbGwueC52YWx1ZSwgY2xhbXBlZENlbGwueS52YWx1ZV07IC8vIENvbnZlcnQgVmVjdG9yMkQgYmFjayB0byBhcnJheVxuICAgICAgICBzZXRDZWxsQXhpcyhjZWxsLCAwKTsgc2V0Q2VsbEF4aXMoY2VsbCwgMSk7XG4gICAgfTtcblxuICAgIC8vXG4gICAgY29uc3Qgc3luY0luc2V0VmFycyA9IChpbnNldD86IFtudW1iZXIsIG51bWJlcl0pOiB2b2lkID0+IHtcbiAgICAgICAgaWYgKCFpbnNldCkgeyByZXR1cm47IH1cbiAgICAgICAgc2V0U3R5bGVQcm9wZXJ0eShuZXdJdGVtLCBcIi0tY3MtaW5zZXQteFwiLCBgJHtpbnNldFswXSB8fCAwfXB4YCk7XG4gICAgICAgIHNldFN0eWxlUHJvcGVydHkobmV3SXRlbSwgXCItLWNzLWluc2V0LXlcIiwgYCR7aW5zZXRbMV0gfHwgMH1weGApO1xuICAgIH07XG5cbiAgICAvL1xuICAgIGNvbnN0IGNvcnJlY3RPZmZzZXQgPSAoZHJhZ2dpbmc6IFthbnksIGFueV0pOiBbbnVtYmVyLCBudW1iZXJdID0+IHtcbiAgICAgICAgLy8gY29tcHV0ZSBjb3JyZWN0IGNlbGwgd2l0aCBzcGFuIGF3YXJlbmVzc1xuICAgICAgICBjb25zdCBjdHggPSBjb21wdXRlQ2VsbEZyb21Cb3VuZHMoKSBhcyB7IGluc2V0OiBbbnVtYmVyLCBudW1iZXJdLCBjZWxsOiBbbnVtYmVyLCBudW1iZXJdIH0gfCBudWxsO1xuICAgICAgICBjb25zdCBjZWxsID0gY3R4Py5jZWxsO1xuXG4gICAgICAgIC8vXG4gICAgICAgIGlmIChjZWxsKSB7XG4gICAgICAgICAgICBzeW5jSW5zZXRWYXJzKChjdHg/Lmluc2V0IHx8IFswLCAwXSkgYXMgW251bWJlciwgbnVtYmVyXSk7IHNldENlbGwoY2VsbCk7XG4gICAgICAgICAgICBzZXRTdHlsZVByb3BlcnR5KG5ld0l0ZW0sIFwiLS1wLWNlbGwteFwiLCBjZWxsPy5bMF0gPz8gY3VycmVudENlbGw/LlswXT8udmFsdWUgPz8gaXRlbT8uY2VsbD8uWzBdID8/IDApO1xuICAgICAgICAgICAgc2V0U3R5bGVQcm9wZXJ0eShuZXdJdGVtLCBcIi0tcC1jZWxsLXlcIiwgY2VsbD8uWzFdID8/IGN1cnJlbnRDZWxsPy5bMV0/LnZhbHVlID8/IGl0ZW0/LmNlbGw/LlsxXSA/PyAwKTtcbiAgICAgICAgICAgIHNldFN0eWxlUHJvcGVydHkobmV3SXRlbSwgXCItLWNlbGwteFwiLCBjZWxsPy5bMF0gPz8gY3VycmVudENlbGw/LlswXT8udmFsdWUgPz8gaXRlbT8uY2VsbD8uWzBdID8/IDApO1xuICAgICAgICAgICAgc2V0U3R5bGVQcm9wZXJ0eShuZXdJdGVtLCBcIi0tY2VsbC15XCIsIGNlbGw/LlsxXSA/PyBjdXJyZW50Q2VsbD8uWzFdPy52YWx1ZSA/PyBpdGVtPy5jZWxsPy5bMV0gPz8gMCk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyByZXNldCBkcmFnZ2luZyBvZmZzZXRcbiAgICAgICAgaWYgKGRyYWdnaW5nICYmIEFycmF5LmlzQXJyYXkoZHJhZ2dpbmcpKSB7XG4gICAgICAgICAgICB0cnkgeyBkcmFnZ2luZ1swXS52YWx1ZSA9IDAsIGRyYWdnaW5nWzFdLnZhbHVlID0gMDsgfSBjYXRjaCAoZSkgeyB9O1xuICAgICAgICB9XG4gICAgICAgIHN5bmNEcmFnU3R5bGVzPy4odHJ1ZSk7IG5ld0l0ZW0/LnNldEF0dHJpYnV0ZT8uKFwiZGF0YS1kcmFnZ2luZ1wiLCBcIlwiKTtcbiAgICAgICAgcmV0dXJuIFswLCAwXTtcbiAgICB9O1xuXG4gICAgLy9cbiAgICBjb25zdCByZXNvbHZlRHJhZ2dpbmcgPSAoZHJhZ2dpbmc6IFthbnksIGFueV0pOiBbbnVtYmVyLCBudW1iZXJdID0+IHtcbiAgICAgICAgLy8gY29tcHV0ZSBjb3JyZWN0IGNlbGxcbiAgICAgICAgY29uc3QgY3R4ID0gY29tcHV0ZUNlbGxGcm9tQm91bmRzKCkgYXMgeyBpbnNldDogW251bWJlciwgbnVtYmVyXSwgY2VsbDogW251bWJlciwgbnVtYmVyXSB9IHwgbnVsbDtcbiAgICAgICAgY29uc3QgY2VsbCA9IGN0eD8uY2VsbDtcblxuICAgICAgICAvL1xuICAgICAgICBzZXRTdHlsZVByb3BlcnR5KG5ld0l0ZW0sIFwiLS1wLWNlbGwteFwiLCBjdXJyZW50Q2VsbD8uWzBdPy52YWx1ZSA/PyBpdGVtPy5jZWxsPy5bMF0gPz8gY2VsbD8uWzBdKTtcbiAgICAgICAgc2V0U3R5bGVQcm9wZXJ0eShuZXdJdGVtLCBcIi0tcC1jZWxsLXlcIiwgY3VycmVudENlbGw/LlsxXT8udmFsdWUgPz8gaXRlbT8uY2VsbD8uWzFdID8/IGNlbGw/LlsxXSk7XG4gICAgICAgIHN5bmNEcmFnU3R5bGVzPy4odHJ1ZSk7XG5cbiAgICAgICAgLy9cbiAgICAgICAgaWYgKGNlbGwpIHtcbiAgICAgICAgICAgIHNldENlbGwoY2VsbCk7XG4gICAgICAgICAgICBzZXRTdHlsZVByb3BlcnR5KG5ld0l0ZW0sIFwiLS1jZWxsLXhcIiwgY2VsbD8uWzBdID8/IGN1cnJlbnRDZWxsPy5bMF0/LnZhbHVlID8/IGl0ZW0/LmNlbGw/LlswXSA/PyAwKTtcbiAgICAgICAgICAgIHNldFN0eWxlUHJvcGVydHkobmV3SXRlbSwgXCItLWNlbGwteVwiLCBjZWxsPy5bMV0gPz8gY3VycmVudENlbGw/LlsxXT8udmFsdWUgPz8gaXRlbT8uY2VsbD8uWzFdID8/IDApO1xuICAgICAgICB9XG5cbiAgICAgICAgLy9cbiAgICAgICAgY29uc3QgYW5pbWF0aW9ucyA9IFtcbiAgICAgICAgICAgIGRvQW5pbWF0ZShuZXdJdGVtLCBcInhcIiwgdHJ1ZSksXG4gICAgICAgICAgICBkb0FuaW1hdGUobmV3SXRlbSwgXCJ5XCIsIHRydWUpXG4gICAgICAgIF07XG5cbiAgICAgICAgLy9cbiAgICAgICAgUHJvbWlzZS5hbGxTZXR0bGVkKGFuaW1hdGlvbnMpLmZpbmFsbHkoKCk9PntcbiAgICAgICAgICAgIGlmIChkcmFnZ2luZyAmJiBBcnJheS5pc0FycmF5KGRyYWdnaW5nKSkge1xuICAgICAgICAgICAgICAgIHRyeSB7IGRyYWdnaW5nWzBdLnZhbHVlID0gMCwgZHJhZ2dpbmdbMV0udmFsdWUgPSAwOyB9IGNhdGNoIChlKSB7IH07XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vXG4gICAgICAgICAgICBzeW5jRHJhZ1N0eWxlcz8uKHRydWUpO1xuXG4gICAgICAgICAgICAvL1xuICAgICAgICAgICAgaWYgKGNlbGwpIHtcbiAgICAgICAgICAgICAgICBzZXRTdHlsZVByb3BlcnR5KG5ld0l0ZW0sIFwiLS1wLWNlbGwteFwiLCBjZWxsPy5bMF0gPz8gY3VycmVudENlbGw/LlswXT8udmFsdWUgPz8gaXRlbT8uY2VsbD8uWzBdID8/IDApO1xuICAgICAgICAgICAgICAgIHNldFN0eWxlUHJvcGVydHkobmV3SXRlbSwgXCItLXAtY2VsbC15XCIsIGNlbGw/LlsxXSA/PyBjdXJyZW50Q2VsbD8uWzFdPy52YWx1ZSA/PyBpdGVtPy5jZWxsPy5bMV0gPz8gMCk7XG4gICAgICAgICAgICAgICAgc2V0U3R5bGVQcm9wZXJ0eShuZXdJdGVtLCBcIi0tY2VsbC14XCIsIGNlbGw/LlswXSA/PyBjdXJyZW50Q2VsbD8uWzBdPy52YWx1ZSA/PyBpdGVtPy5jZWxsPy5bMF0gPz8gMCk7XG4gICAgICAgICAgICAgICAgc2V0U3R5bGVQcm9wZXJ0eShuZXdJdGVtLCBcIi0tY2VsbC15XCIsIGNlbGw/LlsxXSA/PyBjdXJyZW50Q2VsbD8uWzFdPy52YWx1ZSA/PyBpdGVtPy5jZWxsPy5bMV0gPz8gMCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vXG4gICAgICAgICAgICBuZXdJdGVtPy5yZW1vdmVBdHRyaWJ1dGU/LihcImRhdGEtZHJhZ2dpbmdcIik7XG4gICAgICAgICAgICBkZWxldGUgbmV3SXRlbT8uZGF0YXNldD8uZHJhZ2dpbmc7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vXG4gICAgICAgIHJldHVybiBbMCwgMF07XG4gICAgfTtcblxuICAgIC8vXG4gICAgY29uc3QgY3VzdG9tVHJpZ2dlciA9IChkb0dyYWI6IChldjogTW91c2VFdmVudCwgbmV3SXRlbTogSFRNTEVsZW1lbnQpID0+IHZvaWQpOiBMb25nUHJlc3NIYW5kbGVyID0+IG5ldyBMb25nUHJlc3NIYW5kbGVyKG5ld0l0ZW0sIHtcbiAgICAgICAgaGFuZGxlcjogXCIqXCIsXG4gICAgICAgIGFueVBvaW50ZXI6IHRydWUsXG4gICAgICAgIG1vdXNlSW1tZWRpYXRlOiB0cnVlLFxuICAgICAgICBtaW5Ib2xkVGltZTogNjAgKiAzNjAwLFxuICAgICAgICBtYXhIb2xkVGltZTogMTAwXG4gICAgfSwgbWFrZVNoaWZ0VHJpZ2dlcigoZXYpPT57Y29ycmVjdE9mZnNldChkcmFnZ2luZyk7IGRvR3JhYj8uKGV2LCBuZXdJdGVtKX0pKTtcblxuICAgIC8vXG4gICAgcmV0dXJuIGJpbmREcmFnZ2FibGUoY3VzdG9tVHJpZ2dlciwgcmVzb2x2ZURyYWdnaW5nLCBkcmFnZ2luZyk7XG59O1xuXG4vLyBzaGlmdGluZyAtIHJlYWN0aXZlIGJhc2lzXG5leHBvcnQgY29uc3QgUk9PVCA9IHR5cGVvZiBkb2N1bWVudCAhPSBcInVuZGVmaW5lZFwiID8gZG9jdW1lbnQ/LmRvY3VtZW50RWxlbWVudCA6IG51bGw7XG5leHBvcnQgY29uc3QgYmluZEludGVyYWN0aW9uID0gKG5ld0l0ZW06IEhUTUxFbGVtZW50LCBwQXJnczogYW55KTogW2FueSwgYW55XSA9PiB7XG4gICAgcmVmbGVjdENlbGwobmV3SXRlbSwgcEFyZ3MsIHRydWUpO1xuXG4gICAgLy9cbiAgICBjb25zdCB7IGl0ZW0sIGl0ZW1zLCBsaXN0IH0gPSBwQXJncywgbGF5b3V0ID0gW3BBcmdzPy5sYXlvdXQ/LmNvbHVtbnMgfHwgcEFyZ3M/LmxheW91dD8uWzBdIHx8IDQsIHBBcmdzPy5sYXlvdXQ/LnJvd3MgfHwgcEFyZ3M/LmxheW91dD8uWzFdIHx8IDhdO1xuICAgIGNvbnN0IGRyYWdnaW5nOiBbYW55LCBhbnldID0gWyBudW1iZXJSZWYoMCwgUkFGQmVoYXZpb3IoKSksIG51bWJlclJlZigwLCBSQUZCZWhhdmlvcigpKSBdLCBjdXJyZW50Q2VsbDogW2FueSwgYW55XSA9IFsgbnVtYmVyUmVmKGl0ZW0/LmNlbGw/LlswXSB8fCAwKSwgbnVtYmVyUmVmKGl0ZW0/LmNlbGw/LlsxXSB8fCAwKSBdO1xuXG4gICAgLy9cbiAgICBzZXRTdHlsZVByb3BlcnR5KG5ld0l0ZW0sIFwiLS1jZWxsLXhcIiwgY3VycmVudENlbGw/LlswXT8udmFsdWUgfHwgMCk7XG4gICAgc2V0U3R5bGVQcm9wZXJ0eShuZXdJdGVtLCBcIi0tY2VsbC15XCIsIGN1cnJlbnRDZWxsPy5bMV0/LnZhbHVlIHx8IDApO1xuXG4gICAgLy9cbiAgICBjb25zdCBhcHBseURyYWdTdHlsZXMgPSAoKTogdm9pZCA9PiB7XG4gICAgICAgIGlmIChkcmFnZ2luZz8uWzBdPy52YWx1ZSAhPSBudWxsKSBzZXRTdHlsZVByb3BlcnR5KG5ld0l0ZW0sIFwiLS1kcmFnLXhcIiwgZHJhZ2dpbmc/LlswXT8udmFsdWUgfHwgMCk7XG4gICAgICAgIGlmIChkcmFnZ2luZz8uWzFdPy52YWx1ZSAhPSBudWxsKSBzZXRTdHlsZVByb3BlcnR5KG5ld0l0ZW0sIFwiLS1kcmFnLXlcIiwgZHJhZ2dpbmc/LlsxXT8udmFsdWUgfHwgMCk7XG4gICAgfTtcblxuICAgIC8vXG4gICAgbGV0IGRyYWdTdHlsZVJhZiA9IDAsIGxhc3RSYWY6IGFueSA9IG51bGw7XG4gICAgY29uc3Qgc3luY0RyYWdTdHlsZXMgPSAoZmx1c2ggPSBmYWxzZSk6IHZvaWQgPT4ge1xuICAgICAgICBpZiAoZmx1c2gpIHtcbiAgICAgICAgICAgIGFwcGx5RHJhZ1N0eWxlcygpO1xuICAgICAgICAgICAgZHJhZ1N0eWxlUmFmID0gMDtcbiAgICAgICAgICAgIGlmIChsYXN0UmFmKSB7IGNhbmNlbEFuaW1hdGlvbkZyYW1lKGxhc3RSYWYpOyB9XG4gICAgICAgICAgICBsYXN0UmFmID0gbnVsbDtcbiAgICAgICAgfSBlbHNlXG4gICAgICAgIGlmICghZHJhZ1N0eWxlUmFmKSB7XG4gICAgICAgICAgICBkcmFnU3R5bGVSYWYgPSAxO1xuICAgICAgICAgICAgbGFzdFJhZiA9IHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB7XG4gICAgICAgICAgICAgICAgYXBwbHlEcmFnU3R5bGVzKCk7XG4gICAgICAgICAgICAgICAgZHJhZ1N0eWxlUmFmID0gMDtcbiAgICAgICAgICAgICAgICBsYXN0UmFmID0gbnVsbDtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIC8vXG4gICAgYWZmZWN0ZWQoW2RyYWdnaW5nPy5bMF0sIFwidmFsdWVcIl0sICh2YWwsIHByb3ApID0+IHsgaWYgKHByb3AgPT0gXCJ2YWx1ZVwiKSB7IHN5bmNEcmFnU3R5bGVzKCk7IH0gfSk7XG4gICAgYWZmZWN0ZWQoW2RyYWdnaW5nPy5bMV0sIFwidmFsdWVcIl0sICh2YWwsIHByb3ApID0+IHsgaWYgKHByb3AgPT0gXCJ2YWx1ZVwiKSB7IHN5bmNEcmFnU3R5bGVzKCk7IH0gfSk7XG4gICAgc3luY0RyYWdTdHlsZXModHJ1ZSk7XG5cbiAgICAvL1xuICAgIGFmZmVjdGVkKFtjdXJyZW50Q2VsbD8uWzBdLCBcInZhbHVlXCJdLCAodmFsLCBwcm9wKSA9PiB7XG4gICAgICAgIGlmIChwcm9wID09IFwidmFsdWVcIiAmJiBpdGVtLmNlbGwgIT0gbnVsbCAmJiB2YWwgIT0gbnVsbCkge1xuICAgICAgICAgICAgc2V0U3R5bGVQcm9wZXJ0eShuZXdJdGVtLCBcIi0tY2VsbC14XCIsIChpdGVtLmNlbGxbMF0gPSB2YWwpIHx8IDApO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICAvL1xuICAgIGFmZmVjdGVkKFtjdXJyZW50Q2VsbD8uWzFdLCBcInZhbHVlXCJdLCAodmFsLCBwcm9wKSA9PiB7XG4gICAgICAgIGlmIChwcm9wID09IFwidmFsdWVcIiAmJiBpdGVtLmNlbGwgIT0gbnVsbCAmJiB2YWwgIT0gbnVsbCkge1xuICAgICAgICAgICAgc2V0U3R5bGVQcm9wZXJ0eShuZXdJdGVtLCBcIi0tY2VsbC15XCIsIChpdGVtLmNlbGxbMV0gPSB2YWwpIHx8IDApO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICAvL1xuICAgIG1ha2VEcmFnRXZlbnRzKG5ld0l0ZW0sIHtsYXlvdXQ6IGxheW91dCBhcyBbbnVtYmVyLCBudW1iZXJdLCBjdXJyZW50Q2VsbCwgZHJhZ2dpbmcsIHN5bmNEcmFnU3R5bGVzfSwge2l0ZW0sIGl0ZW1zLCBsaXN0fSk7XG4gICAgcmV0dXJuIGN1cnJlbnRDZWxsIGFzIFthbnksIGFueV07XG59XG4iXX0=