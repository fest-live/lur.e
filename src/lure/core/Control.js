import { deref, isNotEqual, toRef, unref } from "fest/core";
import { Q } from "../node/Queried";
import { makeRAFCycle, setProperty } from "fest/dom";
import { affected } from "fest/object";
//
export const checkboxCtrl = (ref) => { ref = toRef(ref); return (ev) => { const $ref = unref(ref); if ($ref != null) {
    $ref.value = Q(`input[type="radio"], input[type="checkbox"], input:checked`, ev?.target)?.checked ?? $ref?.value;
} }; };
export const numberCtrl = (ref) => { ref = toRef(ref); return (ev) => { const $ref = unref(ref); if ($ref != null && isNotEqual($ref?.value, ev?.target?.valueAsNumber)) {
    $ref.value = Number(Q("input", ev?.target)?.valueAsNumber || 0) ?? 0;
} }; };
export const valueCtrl = (ref) => { ref = toRef(ref); return (ev) => { const $ref = unref(ref); if ($ref != null && isNotEqual(ev?.target?.value, $ref?.value)) {
    $ref.value = (Q("input", ev?.target)?.value ?? $ref?.value) || "";
} }; };
//
export const radioCtrl = (ref, name) => {
    ref = toRef(ref);
    return (ev) => {
        let $ref = unref(ref);
        const selector = `input[name="${name}"]:checked`;
        if ($ref) {
            $ref.value = (ev?.target?.matches?.(selector) ? ev?.target : ev?.target?.querySelector?.(selector))?.value ?? $ref.value;
        }
    };
};
//
export const controlVisible = (source, coef = null) => {
    if (!source)
        return;
    const target = toRef(source), wk = toRef(coef);
    const renderCb = () => {
        const tg = deref(target);
        if (tg) {
            const val = deref(wk)?.value || 0, hidden = val < 0.001 || val > 0.999;
            setProperty(tg, "visibility", hidden ? "collapse" : "visible");
            setProperty(tg?.querySelector?.("*"), "pointer-events", hidden ? "none" : "auto");
        }
    };
    return affected(coef, (val) => makeRAFCycle()?.schedule(renderCb));
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQ29udHJvbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIkNvbnRyb2wudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLEtBQUssRUFBRSxVQUFVLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxNQUFNLFdBQVcsQ0FBQztBQUM1RCxPQUFPLEVBQUUsQ0FBQyxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDcEMsT0FBTyxFQUFFLFlBQVksRUFBRSxXQUFXLEVBQUUsTUFBTSxVQUFVLENBQUM7QUFDckQsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLGFBQWEsQ0FBQztBQUV2QyxFQUFFO0FBQ0YsTUFBTSxDQUFDLE1BQU0sWUFBWSxHQUFHLENBQUMsR0FBRyxFQUFFLEVBQUUsR0FBRyxHQUFHLEdBQUcsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLEVBQUUsRUFBRSxFQUFFLEdBQUcsTUFBTSxJQUFJLEdBQUcsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsSUFBSSxJQUFJLElBQUksSUFBSSxFQUFFLENBQUM7SUFBQyxJQUFJLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQyw0REFBNEQsRUFBRSxFQUFFLEVBQUUsTUFBTSxDQUFDLEVBQUUsT0FBTyxJQUFJLElBQUksRUFBRSxLQUFLLENBQUM7QUFBQyxDQUFDLENBQUMsQ0FBQyxDQUFBLENBQUMsQ0FBQyxDQUFBO0FBQzlPLE1BQU0sQ0FBQyxNQUFNLFVBQVUsR0FBRyxDQUFDLEdBQUcsRUFBRSxFQUFFLEdBQUcsR0FBRyxHQUFHLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxFQUFFLEVBQUUsRUFBRSxHQUFHLE1BQU0sSUFBSSxHQUFHLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLElBQUksSUFBSSxJQUFJLElBQUksSUFBSSxVQUFVLENBQUMsSUFBSSxFQUFFLEtBQUssRUFBRSxFQUFFLEVBQUUsTUFBTSxFQUFF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QUEsWUFBWSxFQUFFLEVBQUUsUUFBUSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUE7QUFDekUsQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZGVyZWYsIGlzTm90RXF1YWwsIHRvUmVmLCB1bnJlZiB9IGZyb20gXCJmZXN0L2NvcmVcIjtcbmltcG9ydCB7IFEgfSBmcm9tIFwiLi4vbm9kZS9RdWVyaWVkXCI7XG5pbXBvcnQgeyBtYWtlUkFGQ3ljbGUsIHNldFByb3BlcnR5IH0gZnJvbSBcImZlc3QvZG9tXCI7XG5pbXBvcnQgeyBhZmZlY3RlZCB9IGZyb20gXCJmZXN0L29iamVjdFwiO1xuXG4vL1xuZXhwb3J0IGNvbnN0IGNoZWNrYm94Q3RybCA9IChyZWYpID0+IHsgcmVmID0gdG9SZWYocmVmKTsgcmV0dXJuIChldikgPT4geyBjb25zdCAkcmVmID0gdW5yZWYocmVmKTsgaWYgKCRyZWYgIT0gbnVsbCkgeyAkcmVmLnZhbHVlID0gUShgaW5wdXRbdHlwZT1cInJhZGlvXCJdLCBpbnB1dFt0eXBlPVwiY2hlY2tib3hcIl0sIGlucHV0OmNoZWNrZWRgLCBldj8udGFyZ2V0KT8uY2hlY2tlZCA/PyAkcmVmPy52YWx1ZTsgfSB9IH1cbmV4cG9ydCBjb25zdCBudW1iZXJDdHJsID0gKHJlZikgPT4geyByZWYgPSB0b1JlZihyZWYpOyByZXR1cm4gKGV2KSA9PiB7IGNvbnN0ICRyZWYgPSB1bnJlZihyZWYpOyBpZiAoJHJlZiAhPSBudWxsICYmIGlzTm90RXF1YWwoJHJlZj8udmFsdWUsIGV2Py50YXJnZXQ/LnZhbHVlQXNOdW1iZXIpKSB7ICRyZWYudmFsdWUgPSBOdW1iZXIoUShcImlucHV0XCIsIGV2Py50YXJnZXQpPy52YWx1ZUFzTnVtYmVyIHx8IDApID8/IDA7IH0gfSB9XG5leHBvcnQgY29uc3QgdmFsdWVDdHJsID0gKHJlZikgPT4geyByZWYgPSB0b1JlZihyZWYpOyByZXR1cm4gKGV2KSA9PiB7IGNvbnN0ICRyZWYgPSB1bnJlZihyZWYpOyBpZiAoJHJlZiAhPSBudWxsICYmIGlzTm90RXF1YWwoZXY/LnRhcmdldD8udmFsdWUsICRyZWY/LnZhbHVlKSkgeyAkcmVmLnZhbHVlID0gKFEoXCJpbnB1dFwiLCBldj8udGFyZ2V0KT8udmFsdWUgPz8gJHJlZj8udmFsdWUpIHx8IFwiXCI7IH0gfSB9XG5cbi8vXG5leHBvcnQgY29uc3QgcmFkaW9DdHJsID0gKHJlZiwgbmFtZSkgPT4ge1xuICAgIHJlZiA9IHRvUmVmKHJlZik7XG4gICAgcmV0dXJuIChldikgPT4ge1xuICAgICAgICBsZXQgJHJlZiA9IHVucmVmKHJlZik7XG4gICAgICAgIGNvbnN0IHNlbGVjdG9yID0gYGlucHV0W25hbWU9XCIke25hbWV9XCJdOmNoZWNrZWRgO1xuICAgICAgICBpZiAoJHJlZikgeyAkcmVmLnZhbHVlID0gKGV2Py50YXJnZXQ/Lm1hdGNoZXM/LihzZWxlY3RvcikgPyBldj8udGFyZ2V0IDogZXY/LnRhcmdldD8ucXVlcnlTZWxlY3Rvcj8uKHNlbGVjdG9yKSk/LnZhbHVlID8/ICRyZWYudmFsdWU7IH1cbiAgICB9XG59XG5cbi8vXG5leHBvcnQgY29uc3QgY29udHJvbFZpc2libGUgPSAoc291cmNlOiBIVE1MRWxlbWVudCwgY29lZjogYW55ID0gbnVsbCk9PntcbiAgICBpZiAoIXNvdXJjZSkgcmV0dXJuOyBjb25zdCB0YXJnZXQgPSB0b1JlZihzb3VyY2UpLCB3ayA9IHRvUmVmKGNvZWYpO1xuICAgIGNvbnN0IHJlbmRlckNiID0gKCk9PntcbiAgICAgICAgY29uc3QgdGcgPSBkZXJlZih0YXJnZXQpOyBpZiAodGcpIHtcbiAgICAgICAgICAgIGNvbnN0IHZhbCA9IGRlcmVmKHdrKT8udmFsdWUgfHwgMCwgaGlkZGVuID0gdmFsIDwgMC4wMDEgfHwgdmFsID4gMC45OTk7XG4gICAgICAgICAgICBzZXRQcm9wZXJ0eSh0ZywgXCJ2aXNpYmlsaXR5XCIsIGhpZGRlbiA/IFwiY29sbGFwc2VcIiA6IFwidmlzaWJsZVwiKTtcbiAgICAgICAgICAgIHNldFByb3BlcnR5KHRnPy5xdWVyeVNlbGVjdG9yPy4oXCIqXCIpLCBcInBvaW50ZXItZXZlbnRzXCIsIGhpZGRlbiA/IFwibm9uZVwiIDogXCJhdXRvXCIpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICByZXR1cm4gYWZmZWN0ZWQoY29lZiwgKHZhbDogYW55KT0+bWFrZVJBRkN5Y2xlKCk/LnNjaGVkdWxlKHJlbmRlckNiKSlcbn1cbiJdfQ==