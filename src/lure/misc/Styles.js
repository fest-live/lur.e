import { bindWith } from "../../lure/core/Binding";
import { handleStyleChange } from "fest/dom";
//
// NEWER, INLINE STYLES ONLY!!!
// string template for CSS values
export const S = (strings, ...values) => {
    // extract possible reactive values
    let props = [], vars = new Map();
    let index = 0, counter = 0;
    const parts = [];
    for (const string of strings) {
        parts.push(string);
        const $value = values?.[index], $isValid = strings[index + 1]?.trim?.()?.includes?.(";");
        if ($isValid) {
            if (typeof $value == "object" && ($value?.value != null || "value" in $value)) {
                const varName = `--ref-${counter}`;
                parts.push(`var(${varName})`);
                props.push(`@property ${varName} { syntax: "<number>"; initial-value: ${$value?.value ?? 0}; inherits: true; };`);
                vars.set(varName, $value);
                counter++;
            }
            else if (typeof $value != "object" && typeof $value != "function") {
                parts.push(`${$value}`);
            }
        }
        index++;
    }
    // return a function that applies the style to an element
    return [(element) => {
            element.style.cssText = parts?.join?.(";") ?? element.style.cssText;
            // apply reactive values
            const subs = [];
            for (const [name, value] of vars) {
                subs.push(bindWith(element, name, value, handleStyleChange));
            }
            // return a function that unsubscribes the reactive values
            return () => {
                for (const sub of subs) {
                    sub?.();
                }
            };
        }, props, vars];
};
//
export const css = (strings, ...values) => { return S(strings, ...values); };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU3R5bGVzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiU3R5bGVzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSx5QkFBeUIsQ0FBQztBQUNuRCxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxVQUFVLENBQUM7QUFFN0MsRUFBRTtBQUNGLCtCQUErQjtBQUMvQixpQ0FBaUM7QUFDakMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsT0FBTyxFQUFFLEdBQUcsTUFBYSxFQUFDLEVBQUU7SUFDMUMsbUNBQW1DO0lBQ25DLElBQUksS0FBSyxHQUFhLEVBQUUsRUFBRSxJQUFJLEdBQXFCLElBQUksR0FBRyxFQUFFLENBQUM7SUFDN0QsSUFBSSxLQUFLLEdBQUcsQ0FBQyxFQUFFLE9BQU8sR0FBRyxDQUFDLENBQUM7SUFDM0IsTUFBTSxLQUFLLEdBQWEsRUFBRSxDQUFDO0lBQzNCLEtBQUssTUFBTSxNQUFNLElBQUksT0FBTyxFQUFFLENBQUM7UUFDM0IsS0FBSyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUNuQixNQUFNLE1BQU0sR0FBRyxNQUFNLEVBQUUsQ0FBQyxLQUFLLENBQUMsRUFBRSxRQUFRLEdBQUcsT0FBTyxDQUFDLEtBQUssR0FBQyxDQUFDLENBQUMsRUFBRSxJQUFJLEVBQUUsRUFBRSxFQUFFLFFBQVEsRUFBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ3ZGLElBQUksUUFBUSxFQUFFLENBQUM7WUFDWCxJQUFJLE9BQU8sTUFBTSxJQUFJLFFBQVEsSUFBSSxDQUFDLE1BQU0sRUFBRSxLQUFLLElBQUksSUFBSSxJQUFJLE9BQU8sSUFBSSxNQUFNLENBQUMsRUFBRSxDQUFDO2dCQUM1RSxNQUFNLE9BQU8sR0FBRyxTQUFTLE9BQU8sRUFBRSxDQUFDO2dCQUNuQyxLQUFLLENBQUMsSUFBSSxDQUFDLE9BQU8sT0FBTyxHQUFHLENBQUMsQ0FBQztnQkFDOUIsS0FBSyxDQUFDLElBQUksQ0FBQyxhQUFhLE9BQU8seUNBQXlDLE1BQU0sRUFBRSxLQUFLLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDO2dCQUNsSCxJQUFJLENBQUMsR0FBRyxDQUFDLE9BQU8sRUFBRSxNQUFNLENBQUMsQ0FBQztnQkFDMUIsT0FBTyxFQUFFLENBQUM7WUFDZCxDQUFDO2lCQUNELElBQUksT0FBTyxNQUFNLElBQUksUUFBUSxJQUFJLE9BQU8sTUFBTSxJQUFJLFVBQVUsRUFBRSxDQUFDO2dCQUMzRCxLQUFLLENBQUMsSUFBSSxDQUFDLEdBQUcsTUFBTSxFQUFFLENBQUMsQ0FBQztZQUM1QixDQUFDO1FBQ0wsQ0FBQztRQUNELEtBQUssRUFBRSxDQUFDO0lBQ1osQ0FBQztJQUVELHlEQUF5RDtJQUN6RCxPQUFPLENBQUMsQ0FBQyxPQUFZLEVBQUMsRUFBRTtZQUNwQixPQUFPLENBQUMsS0FBSyxDQUFDLE9BQU8sR0FBRyxLQUFLLEVBQUUsSUFBSSxFQUFFLENBQUMsR0FBRyxDQUFDLElBQUksT0FBTyxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUM7WUFFcEUsd0JBQXdCO1lBQ3hCLE1BQU0sSUFBSSxHQUFVLEVBQUUsQ0FBQztZQUN2QixLQUFLLE1BQU0sQ0FBQyxJQUFJLEVBQUUsS0FBSyxDQUFDLElBQUksSUFBSSxFQUFFLENBQUM7Z0JBQy9CLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLE9BQU8sRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLGlCQUFpQixDQUFDLENBQUMsQ0FBQztZQUNqRSxDQUFDO1lBRUQsMERBQTBEO1lBQzFELE9BQU8sR0FBRSxFQUFFO2dCQUNQLEtBQUssTUFBTSxHQUFHLElBQUksSUFBSSxFQUFFLENBQUM7b0JBQ3JCLEdBQUcsRUFBRSxFQUFFLENBQUM7Z0JBQ1osQ0FBQztZQUNMLENBQUMsQ0FBQTtRQUNMLENBQUMsRUFBRSxLQUFLLEVBQUUsSUFBSSxDQUFDLENBQUM7QUFDcEIsQ0FBQyxDQUFDO0FBRUYsRUFBRTtBQUNGLE1BQU0sQ0FBQyxNQUFNLEdBQUcsR0FBRyxDQUFDLE9BQU8sRUFBRSxHQUFHLE1BQWEsRUFBQyxFQUFFLEdBQUUsT0FBTyxDQUFDLENBQUMsT0FBTyxFQUFFLEdBQUcsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBiaW5kV2l0aCB9IGZyb20gXCIuLi8uLi9sdXJlL2NvcmUvQmluZGluZ1wiO1xuaW1wb3J0IHsgaGFuZGxlU3R5bGVDaGFuZ2UgfSBmcm9tIFwiZmVzdC9kb21cIjtcblxuLy9cbi8vIE5FV0VSLCBJTkxJTkUgU1RZTEVTIE9OTFkhISFcbi8vIHN0cmluZyB0ZW1wbGF0ZSBmb3IgQ1NTIHZhbHVlc1xuZXhwb3J0IGNvbnN0IFMgPSAoc3RyaW5ncywgLi4udmFsdWVzOiBhbnlbXSk9PntcbiAgICAvLyBleHRyYWN0IHBvc3NpYmxlIHJlYWN0aXZlIHZhbHVlc1xuICAgIGxldCBwcm9wczogc3RyaW5nW10gPSBbXSwgdmFyczogTWFwPHN0cmluZywgYW55PiA9IG5ldyBNYXAoKTtcbiAgICBsZXQgaW5kZXggPSAwLCBjb3VudGVyID0gMDtcbiAgICBjb25zdCBwYXJ0czogc3RyaW5nW10gPSBbXTtcbiAgICBmb3IgKGNvbnN0IHN0cmluZyBvZiBzdHJpbmdzKSB7XG4gICAgICAgIHBhcnRzLnB1c2goc3RyaW5nKTtcbiAgICAgICAgY29uc3QgJHZhbHVlID0gdmFsdWVzPy5baW5kZXhdLCAkaXNWYWxpZCA9IHN0cmluZ3NbaW5kZXgrMV0/LnRyaW0/LigpPy5pbmNsdWRlcz8uKFwiO1wiKTtcbiAgICAgICAgaWYgKCRpc1ZhbGlkKSB7XG4gICAgICAgICAgICBpZiAodHlwZW9mICR2YWx1ZSA9PSBcIm9iamVjdFwiICYmICgkdmFsdWU/LnZhbHVlICE9IG51bGwgfHwgXCJ2YWx1ZVwiIGluICR2YWx1ZSkpIHtcbiAgICAgICAgICAgICAgICBjb25zdCB2YXJOYW1lID0gYC0tcmVmLSR7Y291bnRlcn1gO1xuICAgICAgICAgICAgICAgIHBhcnRzLnB1c2goYHZhcigke3Zhck5hbWV9KWApO1xuICAgICAgICAgICAgICAgIHByb3BzLnB1c2goYEBwcm9wZXJ0eSAke3Zhck5hbWV9IHsgc3ludGF4OiBcIjxudW1iZXI+XCI7IGluaXRpYWwtdmFsdWU6ICR7JHZhbHVlPy52YWx1ZSA/PyAwfTsgaW5oZXJpdHM6IHRydWU7IH07YCk7XG4gICAgICAgICAgICAgICAgdmFycy5zZXQodmFyTmFtZSwgJHZhbHVlKTtcbiAgICAgICAgICAgICAgICBjb3VudGVyKys7XG4gICAgICAgICAgICB9IGVsc2VcbiAgICAgICAgICAgIGlmICh0eXBlb2YgJHZhbHVlICE9IFwib2JqZWN0XCIgJiYgdHlwZW9mICR2YWx1ZSAhPSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgICAgICAgICBwYXJ0cy5wdXNoKGAkeyR2YWx1ZX1gKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpbmRleCsrO1xuICAgIH1cblxuICAgIC8vIHJldHVybiBhIGZ1bmN0aW9uIHRoYXQgYXBwbGllcyB0aGUgc3R5bGUgdG8gYW4gZWxlbWVudFxuICAgIHJldHVybiBbKGVsZW1lbnQ6IGFueSk9PntcbiAgICAgICAgZWxlbWVudC5zdHlsZS5jc3NUZXh0ID0gcGFydHM/LmpvaW4/LihcIjtcIikgPz8gZWxlbWVudC5zdHlsZS5jc3NUZXh0O1xuXG4gICAgICAgIC8vIGFwcGx5IHJlYWN0aXZlIHZhbHVlc1xuICAgICAgICBjb25zdCBzdWJzOiBhbnlbXSA9IFtdO1xuICAgICAgICBmb3IgKGNvbnN0IFtuYW1lLCB2YWx1ZV0gb2YgdmFycykge1xuICAgICAgICAgICAgc3Vicy5wdXNoKGJpbmRXaXRoKGVsZW1lbnQsIG5hbWUsIHZhbHVlLCBoYW5kbGVTdHlsZUNoYW5nZSkpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gcmV0dXJuIGEgZnVuY3Rpb24gdGhhdCB1bnN1YnNjcmliZXMgdGhlIHJlYWN0aXZlIHZhbHVlc1xuICAgICAgICByZXR1cm4gKCk9PntcbiAgICAgICAgICAgIGZvciAoY29uc3Qgc3ViIG9mIHN1YnMpIHtcbiAgICAgICAgICAgICAgICBzdWI/LigpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSwgcHJvcHMsIHZhcnNdO1xufTtcblxuLy9cbmV4cG9ydCBjb25zdCBjc3MgPSAoc3RyaW5ncywgLi4udmFsdWVzOiBhbnlbXSk9PnsgcmV0dXJuIFMoc3RyaW5ncywgLi4udmFsdWVzKTsgfVxuIl19