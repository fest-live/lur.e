import { reflectBehaviors, reflectStores, reflectMixins, handleProperty, handleAttribute, handleHidden, addEventsList, createElementVanilla } from "fest/dom";
import { reflectClassList, reflectStyles, reflectDataset, reflectAttributes, reflectProperties, reflectWithStyleRules, reflectARIA } from '../context/Reflect';
import { reflectControllers, bindWith } from '../core/Binding';
//
import { affected } from "fest/object";
import { Q } from "./Queried";
import { M } from "./Mapped";
import { getNode } from "../context/Utils";
;
// WILL not be released!
export const Qp = (ref, host = document.documentElement) => {
    if (ref?.value == null) {
        return Q(ref, host);
    }
    const actual = Q(ref?.value, host);
    affected(ref, (value, prop) => actual?._updateSelector(value));
    return actual;
};
//
export const $createElement = (selector) => {
    if (typeof selector == "string") {
        const nl = Qp(createElementVanilla(selector));
        return nl?.element ?? nl;
    }
    else if (selector instanceof HTMLElement || selector instanceof Element || selector instanceof DocumentFragment || selector instanceof Document || selector instanceof Node) {
        return selector;
    }
    else {
        return null;
    }
};
//
export const E = (selector, params = {}, children) => {
    const element = getNode(typeof selector == "string" ? $createElement(selector) : selector, null, -1);
    if (element && children) {
        M(children, (el) => el, element); /*reflectChildren(element, children);*/
    }
    if (element && params) {
        if (params.ctrls != null)
            reflectControllers(element, params.ctrls);
        if (params.attributes != null)
            reflectAttributes(element, params.attributes);
        if (params.properties != null)
            reflectProperties(element, params.properties);
        if (params.classList != null)
            reflectClassList(element, params.classList);
        if (params.behaviors != null)
            reflectBehaviors(element, params.behaviors);
        if (params.dataset != null)
            reflectDataset(element, params.dataset);
        if (params.stores != null)
            reflectStores(element, params.stores);
        if (params.mixins != null)
            reflectMixins(element, params.mixins);
        if (params.style != null)
            reflectStyles(element, params.style);
        if (params.aria != null)
            reflectARIA(element, params.aria);
        //
        if (params.is != null)
            bindWith(element, "is", params.is, handleAttribute, params, true);
        if (params.role != null)
            bindWith(element, "role", params.role, handleProperty, params);
        if (params.slot != null)
            bindWith(element, "slot", params.slot, handleProperty, params);
        if (params.part != null)
            bindWith(element, "part", params.part, handleAttribute, params, true);
        if (params.name != null)
            bindWith(element, "name", params.name, handleAttribute, params, true);
        if (params.type != null)
            bindWith(element, "type", params.type, handleAttribute, params, true);
        if (params.icon != null)
            bindWith(element, "icon", params.icon, handleAttribute, params, true);
        if (params.inert != null)
            bindWith(element, "inert", params.inert, handleAttribute, params, true);
        if (params.hidden != null)
            bindWith(element, "hidden", params.visible ?? params.hidden, handleHidden, params);
        if (params.on != null)
            addEventsList(element, params.on);
        //
        if (params.rules != null)
            params.rules.forEach?.((rule) => reflectWithStyleRules(element, rule));
    }
    ;
    return Q(element);
};
//
export default E;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQmluZGluZ3MuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJCaW5kaW5ncy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsYUFBYSxFQUFFLGFBQWEsRUFBRSxjQUFjLEVBQUUsZUFBZSxFQUFFLFlBQVksRUFBRSxhQUFhLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSxVQUFVLENBQUM7QUFDOUosT0FBTyxFQUFFLGdCQUFnQixFQUFFLGFBQWEsRUFBRSxjQUFjLEVBQUUsaUJBQWlCLEVBQUUsaUJBQWlCLEVBQUUscUJBQXFCLEVBQUUsV0FBVyxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFDL0osT0FBTyxFQUFFLGtCQUFrQixFQUFFLFFBQVEsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBRS9ELEVBQUU7QUFDRixPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sYUFBYSxDQUFDO0FBQ3ZDLE9BQU8sRUFBRSxDQUFDLEVBQUUsTUFBTSxXQUFXLENBQUM7QUFDOUIsT0FBTyxFQUFFLENBQUMsRUFBRSxNQUFNLFVBQVUsQ0FBQztBQUM3QixPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUEwQjFDLENBQUM7QUFFRix3QkFBd0I7QUFDeEIsTUFBTSxDQUFDLE1BQU0sRUFBRSxHQUFHLENBQUMsR0FBRyxFQUFFLElBQUksR0FBRyxRQUFRLENBQUMsZUFBZSxFQUFDLEVBQUU7SUFDdEQsSUFBSSxHQUFHLEVBQUUsS0FBSyxJQUFJLElBQUksRUFBRSxDQUFDO1FBQUMsT0FBTyxDQUFDLENBQUMsR0FBRyxFQUFFLElBQUksQ0FBQyxDQUFDO0lBQUMsQ0FBQztJQUNoRCxNQUFNLE1BQU0sR0FBRyxDQUFDLENBQUMsR0FBRyxFQUFFLEtBQUssRUFBRSxJQUFJLENBQUMsQ0FBQztJQUNuQyxRQUFRLENBQUMsR0FBRyxFQUFFLENBQUMsS0FBSyxFQUFFLElBQUksRUFBQyxFQUFFLENBQUEsTUFBTSxFQUFFLGVB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O1lBQUUsUUFBUSxDQUFDLE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSxDQUFDLEVBQUUsRUFBRSxlQUFlLEVBQUUsTUFBTSxFQUFFLElBQUksQ0FBQyxDQUFDO1FBQ3pGLElBQUksTUFBTSxDQUFDLElBQUksSUFBSSxJQUFJO1lBQUUsUUFBUSxDQUFDLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxDQUFDLElBQUksRUFBRSxjQUFjLEVBQUUsTUFBTSxDQUFDLENBQUM7UUFDeEYsSUFBSSxNQUFNLENBQUMsSUFBSSxJQUFJLElBQUk7WUFBRSxRQUFRLENBQUMsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLENBQUMsSUFBSSxFQUFFLGNBQWMsRUFBRSxNQUFNLENBQUMsQ0FBQztRQUN4RixJQUFJLE1BQU0sQ0FBQyxJQUFJLElBQUksSUFBSTtZQUFFLFFBQVEsQ0FBQyxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sQ0FBQyxJQUFJLEVBQUUsZUFBZSxFQUFFLE1BQU0sRUFBRSxJQUFJLENBQUMsQ0FBQztRQUMvRixJQUFJLE1BQU0sQ0FBQyxJQUFJLElBQUksSUFBSTtZQUFFLFFBQVEsQ0FBQyxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sQ0FBQyxJQUFJLEVBQUUsZUFBZSxFQUFFLE1BQU0sRUFBRSxJQUFJLENBQUMsQ0FBQztRQUMvRixJQUFJLE1BQU0sQ0FBQyxJQUFJLElBQUksSUFBSTtZQUFFLFFBQVEsQ0FBQyxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sQ0FBQyxJQUFJLEVBQUUsZUFBZSxFQUFFLE1BQU0sRUFBRSxJQUFJLENBQUMsQ0FBQztRQUMvRixJQUFJLE1BQU0sQ0FBQyxJQUFJLElBQUksSUFBSTtZQUFFLFFBQVEsQ0FBQyxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sQ0FBQyxJQUFJLEVBQUUsZUFBZSxFQUFFLE1BQU0sRUFBRSxJQUFJLENBQUMsQ0FBQztRQUMvRixJQUFJLE1BQU0sQ0FBQyxLQUFLLElBQUksSUFBSTtZQUFFLFFBQVEsQ0FBQyxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sQ0FBQyxLQUFLLEVBQUUsZUFBZSxFQUFFLE1BQU0sRUFBRSxJQUFJLENBQUMsQ0FBQztRQUNsRyxJQUFJLE1BQU0sQ0FBQyxNQUFNLElBQUksSUFBSTtZQUFFLFFBQVEsQ0FBQyxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sQ0FBQyxPQUFPLElBQUksTUFBTSxDQUFDLE1BQU0sRUFBRSxZQUFZLEVBQUUsTUFBTSxDQUFDLENBQUM7UUFDOUcsSUFBSSxNQUFNLENBQUMsRUFBRSxJQUFJLElBQUk7WUFBRSxhQUFhLENBQUMsT0FBTyxFQUFFLE1BQU0sQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUV6RCxFQUFFO1FBQ0YsSUFBSSxNQUFNLENBQUMsS0FBSyxJQUFJLElBQUk7WUFBRSxNQUFNLENBQUMsS0FBSyxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQyxxQkFBcUIsQ0FBQyxPQUFPLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQztJQUNyRyxDQUFDO0lBQUEsQ0FBQztJQUNGLE9BQU8sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDO0FBQ3RCLENBQUMsQ0FBQTtBQUVELEVBQUU7QUFDRixlQUFlLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHJlZmxlY3RCZWhhdmlvcnMsIHJlZmxlY3RTdG9yZXMsIHJlZmxlY3RNaXhpbnMsIGhhbmRsZVByb3BlcnR5LCBoYW5kbGVBdHRyaWJ1dGUsIGhhbmRsZUhpZGRlbiwgYWRkRXZlbnRzTGlzdCwgY3JlYXRlRWxlbWVudFZhbmlsbGEgfSBmcm9tIFwiZmVzdC9kb21cIjtcbmltcG9ydCB7IHJlZmxlY3RDbGFzc0xpc3QsIHJlZmxlY3RTdHlsZXMsIHJlZmxlY3REYXRhc2V0LCByZWZsZWN0QXR0cmlidXRlcywgcmVmbGVjdFByb3BlcnRpZXMsIHJlZmxlY3RXaXRoU3R5bGVSdWxlcywgcmVmbGVjdEFSSUEgfSBmcm9tICcuLi9jb250ZXh0L1JlZmxlY3QnO1xuaW1wb3J0IHsgcmVmbGVjdENvbnRyb2xsZXJzLCBiaW5kV2l0aCB9IGZyb20gJy4uL2NvcmUvQmluZGluZyc7XG5cbi8vXG5pbXBvcnQgeyBhZmZlY3RlZCB9IGZyb20gXCJmZXN0L29iamVjdFwiO1xuaW1wb3J0IHsgUSB9IGZyb20gXCIuL1F1ZXJpZWRcIjtcbmltcG9ydCB7IE0gfSBmcm9tIFwiLi9NYXBwZWRcIjtcbmltcG9ydCB7IGdldE5vZGUgfSBmcm9tIFwiLi4vY29udGV4dC9VdGlsc1wiO1xuXG4vL1xuaW50ZXJmYWNlIFBhcmFtcyB7XG4gICAgY2xhc3NMaXN0PzogU2V0PHN0cmluZz47XG4gICAgYXR0cmlidXRlcz86IGFueTtcbiAgICBkYXRhc2V0PzogYW55O1xuICAgIHByb3BlcnRpZXM/OiBhbnk7XG4gICAgYmVoYXZpb3JzPzogYW55O1xuICAgIHN0b3Jlcz86IGFueVtdIHwgU2V0PGFueT4gfCBNYXA8YW55LCBhbnk+O1xuICAgIHN0eWxlPzogYW55IHwgc3RyaW5nO1xuICAgIHNsb3Q/OiBhbnkgfCBzdHJpbmc7XG4gICAgbmFtZT86IGFueSB8IHN0cmluZztcbiAgICB0eXBlPzogYW55IHwgc3RyaW5nO1xuICAgIGljb24/OiBhbnkgfCBzdHJpbmc7XG4gICAgcm9sZT86IGFueSB8IHN0cmluZztcbiAgICBpbmVydD86IGJvb2xlYW4gfCBzdHJpbmc7XG4gICAgbWl4aW5zPzogYW55O1xuICAgIGN0cmxzPzogYW55O1xuICAgIGlzPzogYW55IHwgc3RyaW5nO1xuICAgIHBhcnQ/OiBhbnkgfCBzdHJpbmc7XG4gICAgb24/OiBhbnk7XG4gICAgdmlzaWJsZT86IGFueTtcbiAgICBoaWRkZW4/OiBhbnk7XG4gICAgYXJpYT86IGFueTtcbiAgICBydWxlcz86IGFueVtdO1xufTtcblxuLy8gV0lMTCBub3QgYmUgcmVsZWFzZWQhXG5leHBvcnQgY29uc3QgUXAgPSAocmVmLCBob3N0ID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50KT0+e1xuICAgIGlmIChyZWY/LnZhbHVlID09IG51bGwpIHsgcmV0dXJuIFEocmVmLCBob3N0KTsgfVxuICAgIGNvbnN0IGFjdHVhbCA9IFEocmVmPy52YWx1ZSwgaG9zdCk7XG4gICAgYWZmZWN0ZWQocmVmLCAodmFsdWUsIHByb3ApPT5hY3R1YWw/Ll91cGRhdGVTZWxlY3Rvcih2YWx1ZSkpO1xuICAgIHJldHVybiBhY3R1YWw7XG59XG5cbi8vXG5leHBvcnQgY29uc3QgJGNyZWF0ZUVsZW1lbnQgPSAoc2VsZWN0b3I6IHN0cmluZyB8IEhUTUxFbGVtZW50IHwgTm9kZSB8IERvY3VtZW50RnJhZ21lbnQgfCBEb2N1bWVudCB8IEVsZW1lbnQpPT57XG4gICAgaWYgKHR5cGVvZiBzZWxlY3RvciA9PSBcInN0cmluZ1wiKSB7XG4gICAgICAgIGNvbnN0IG5sID0gUXAoY3JlYXRlRWxlbWVudFZhbmlsbGEoc2VsZWN0b3IpKTtcbiAgICAgICAgcmV0dXJuIG5sPy5lbGVtZW50ID8/IG5sO1xuICAgIH0gZWxzZSBpZiAoc2VsZWN0b3IgaW5zdGFuY2VvZiBIVE1MRWxlbWVudCB8fCBzZWxlY3RvciBpbnN0YW5jZW9mIEVsZW1lbnQgfHwgc2VsZWN0b3IgaW5zdGFuY2VvZiBEb2N1bWVudEZyYWdtZW50IHx8IHNlbGVjdG9yIGluc3RhbmNlb2YgRG9jdW1lbnQgfHwgc2VsZWN0b3IgaW5zdGFuY2VvZiBOb2RlKSB7XG4gICAgICAgIHJldHVybiBzZWxlY3RvcjtcbiAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG59XG5cbi8vXG5leHBvcnQgY29uc3QgRSA9IChzZWxlY3Rvcjogc3RyaW5nIHwgSFRNTEVsZW1lbnQgfCBOb2RlIHwgRG9jdW1lbnRGcmFnbWVudCB8IERvY3VtZW50IHwgRWxlbWVudCwgcGFyYW1zOiBQYXJhbXMgPSB7fSwgY2hpbGRyZW4/OiBhbnlbXXxhbnl8bnVsbCkgPT4ge1xuICAgIGNvbnN0IGVsZW1lbnQgPSBnZXROb2RlKHR5cGVvZiBzZWxlY3RvciA9PSBcInN0cmluZ1wiID8gJGNyZWF0ZUVsZW1lbnQoc2VsZWN0b3IpIDogc2VsZWN0b3IsIG51bGwsIC0xKTtcbiAgICBpZiAoZWxlbWVudCAmJiBjaGlsZHJlbikgeyBNKGNoaWxkcmVuLCAoZWwpPT5lbCwgZWxlbWVudCk7IC8qcmVmbGVjdENoaWxkcmVuKGVsZW1lbnQsIGNoaWxkcmVuKTsqLyB9XG4gICAgaWYgKGVsZW1lbnQgJiYgcGFyYW1zKSB7XG4gICAgICAgIGlmIChwYXJhbXMuY3RybHMgIT0gbnVsbCkgcmVmbGVjdENvbnRyb2xsZXJzKGVsZW1lbnQsIHBhcmFtcy5jdHJscyk7XG4gICAgICAgIGlmIChwYXJhbXMuYXR0cmlidXRlcyAhPSBudWxsKSByZWZsZWN0QXR0cmlidXRlcyhlbGVtZW50LCBwYXJhbXMuYXR0cmlidXRlcyk7XG4gICAgICAgIGlmIChwYXJhbXMucHJvcGVydGllcyAhPSBudWxsKSByZWZsZWN0UHJvcGVydGllcyhlbGVtZW50LCBwYXJhbXMucHJvcGVydGllcyk7XG4gICAgICAgIGlmIChwYXJhbXMuY2xhc3NMaXN0ICE9IG51bGwpIHJlZmxlY3RDbGFzc0xpc3QoZWxlbWVudCwgcGFyYW1zLmNsYXNzTGlzdCk7XG4gICAgICAgIGlmIChwYXJhbXMuYmVoYXZpb3JzICE9IG51bGwpIHJlZmxlY3RCZWhhdmlvcnMoZWxlbWVudCwgcGFyYW1zLmJlaGF2aW9ycyk7XG4gICAgICAgIGlmIChwYXJhbXMuZGF0YXNldCAhPSBudWxsKSByZWZsZWN0RGF0YXNldChlbGVtZW50LCBwYXJhbXMuZGF0YXNldCk7XG4gICAgICAgIGlmIChwYXJhbXMuc3RvcmVzICE9IG51bGwpIHJlZmxlY3RTdG9yZXMoZWxlbWVudCwgcGFyYW1zLnN0b3Jlcyk7XG4gICAgICAgIGlmIChwYXJhbXMubWl4aW5zICE9IG51bGwpIHJlZmxlY3RNaXhpbnMoZWxlbWVudCwgcGFyYW1zLm1peGlucyk7XG4gICAgICAgIGlmIChwYXJhbXMuc3R5bGUgIT0gbnVsbCkgcmVmbGVjdFN0eWxlcyhlbGVtZW50LCBwYXJhbXMuc3R5bGUpO1xuICAgICAgICBpZiAocGFyYW1zLmFyaWEgIT0gbnVsbCkgcmVmbGVjdEFSSUEoZWxlbWVudCwgcGFyYW1zLmFyaWEpO1xuXG4gICAgICAgIC8vXG4gICAgICAgIGlmIChwYXJhbXMuaXMgIT0gbnVsbCkgYmluZFdpdGgoZWxlbWVudCwgXCJpc1wiLCBwYXJhbXMuaXMsIGhhbmRsZUF0dHJpYnV0ZSwgcGFyYW1zLCB0cnVlKTtcbiAgICAgICAgaWYgKHBhcmFtcy5yb2xlICE9IG51bGwpIGJpbmRXaXRoKGVsZW1lbnQsIFwicm9sZVwiLCBwYXJhbXMucm9sZSwgaGFuZGxlUHJvcGVydHksIHBhcmFtcyk7XG4gICAgICAgIGlmIChwYXJhbXMuc2xvdCAhPSBudWxsKSBiaW5kV2l0aChlbGVtZW50LCBcInNsb3RcIiwgcGFyYW1zLnNsb3QsIGhhbmRsZVByb3BlcnR5LCBwYXJhbXMpO1xuICAgICAgICBpZiAocGFyYW1zLnBhcnQgIT0gbnVsbCkgYmluZFdpdGgoZWxlbWVudCwgXCJwYXJ0XCIsIHBhcmFtcy5wYXJ0LCBoYW5kbGVBdHRyaWJ1dGUsIHBhcmFtcywgdHJ1ZSk7XG4gICAgICAgIGlmIChwYXJhbXMubmFtZSAhPSBudWxsKSBiaW5kV2l0aChlbGVtZW50LCBcIm5hbWVcIiwgcGFyYW1zLm5hbWUsIGhhbmRsZUF0dHJpYnV0ZSwgcGFyYW1zLCB0cnVlKTtcbiAgICAgICAgaWYgKHBhcmFtcy50eXBlICE9IG51bGwpIGJpbmRXaXRoKGVsZW1lbnQsIFwidHlwZVwiLCBwYXJhbXMudHlwZSwgaGFuZGxlQXR0cmlidXRlLCBwYXJhbXMsIHRydWUpO1xuICAgICAgICBpZiAocGFyYW1zLmljb24gIT0gbnVsbCkgYmluZFdpdGgoZWxlbWVudCwgXCJpY29uXCIsIHBhcmFtcy5pY29uLCBoYW5kbGVBdHRyaWJ1dGUsIHBhcmFtcywgdHJ1ZSk7XG4gICAgICAgIGlmIChwYXJhbXMuaW5lcnQgIT0gbnVsbCkgYmluZFdpdGgoZWxlbWVudCwgXCJpbmVydFwiLCBwYXJhbXMuaW5lcnQsIGhhbmRsZUF0dHJpYnV0ZSwgcGFyYW1zLCB0cnVlKTtcbiAgICAgICAgaWYgKHBhcmFtcy5oaWRkZW4gIT0gbnVsbCkgYmluZFdpdGgoZWxlbWVudCwgXCJoaWRkZW5cIiwgcGFyYW1zLnZpc2libGUgPz8gcGFyYW1zLmhpZGRlbiwgaGFuZGxlSGlkZGVuLCBwYXJhbXMpO1xuICAgICAgICBpZiAocGFyYW1zLm9uICE9IG51bGwpIGFkZEV2ZW50c0xpc3QoZWxlbWVudCwgcGFyYW1zLm9uKTtcblxuICAgICAgICAvL1xuICAgICAgICBpZiAocGFyYW1zLnJ1bGVzICE9IG51bGwpIHBhcmFtcy5ydWxlcy5mb3JFYWNoPy4oKHJ1bGUpID0+IHJlZmxlY3RXaXRoU3R5bGVSdWxlcyhlbGVtZW50LCBydWxlKSk7XG4gICAgfTtcbiAgICByZXR1cm4gUShlbGVtZW50KTtcbn1cblxuLy9cbmV4cG9ydCBkZWZhdWx0IEU7XG4iXX0=