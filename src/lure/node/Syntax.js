import { hasValue, isPrimitive } from "fest/core";
import { getNode } from "../context/Utils";
import { E } from "./Bindings";
import { M } from "./Mapped";
import { isElement } from "fest/dom";
import { checkInsideTagBlock, cleanupInterTagWhitespaceAndIndent } from "./Normalizer";
//
const EMap = new WeakMap(), parseTag = (str) => { const match = str.match(/^([a-zA-Z0-9\-]+)?(?:#([a-zA-Z0-9\-_]+))?((?:\.[a-zA-Z0-9\-_]+)*)$/); if (!match)
    return { tag: str, id: null, className: null }; const [, tag = 'div', id, classStr] = match; const className = classStr ? classStr.replace(/\./g, ' ').trim() : null; return { tag, id, className }; };
const preserveWhitespaceTags = new Set(["PRE", "TEXTAREA", "SCRIPT", "STYLE"]);
//
const parseIndex = (value) => {
    if (typeof value != "string" || !value?.trim?.())
        return -1;
    const match = value.match(/^#{(\d+)}$/);
    return match ? parseInt(match?.[1] ?? "-1") : -1;
};
//
const connectElement = (el, atb, psh, mapped) => {
    if (!el)
        return el;
    if (el != null) {
        const entriesIdc = [];
        const addEntryIfExists = (name) => {
            const attr = Array.from(el?.attributes || []).find((attr) => (attr.name == name && attr.value?.includes?.("#{")));
            if (attr) {
                const pair = [name, parseIndex(attr?.value) ?? -1];
                entriesIdc.push(pair);
                return pair;
            }
            return [name, -1];
        };
        //
        const specialEntryNames = ["dataset", "style", "classList", "visible", "aria", "value", "ref"];
        specialEntryNames.forEach((name) => addEntryIfExists(name));
        //
        const makeEntries = (startsWith, except) => {
            const entries = [];
            for (const attr of Array.from(el?.attributes || [])) {
                // needs review startsWith with "" i.e. attributes itself, just #{}
                const allowedNoPrefix = (Array.isArray(startsWith) ? startsWith?.some?.((str) => str == "") : (startsWith == ""));
                const prefix = (Array.isArray(startsWith) ? startsWith.find((start) => attr.name?.startsWith?.(start)) : (startsWith = attr.name?.startsWith?.(startsWith) ? startsWith : "")) ?? "";
                const trueAttributeName = attr.name.trim()?.replace?.(prefix, "");
                const isPlaceholder = attr.value?.includes?.("#{") && attr.value?.includes?.("}");
                const atbIndex = parseIndex(attr?.value);
                const excepted = (Array.isArray(except) ? except?.some?.((str) => trueAttributeName?.startsWith?.(str)) : (except == trueAttributeName));
                if (isPlaceholder && ((prefix == "" && allowedNoPrefix) || prefix != "") && atbIndex >= 0 && !excepted) {
                    entries.push([trueAttributeName, atbIndex]);
                }
            }
            return entries;
        };
        //
        const makeCumulativeEntries = (startsWith, except, specific = "") => {
            const entriesMap = new Map();
            for (const attr of Array.from(el?.attributes || [])) {
                const allowedNoPrefix = (Array.isArray(startsWith) ? startsWith?.some?.((str) => str == "") : (startsWith == ""));
                const prefix = (Array.isArray(startsWith) ? startsWith.find((start) => attr.name?.startsWith?.(start)) : (startsWith = attr.name?.startsWith?.(startsWith) ? startsWith : "")) ?? "";
                const trueAttributeName = attr.name.trim()?.replace?.(prefix, "");
                const isPlaceholder = attr.value?.includes?.("#{") && attr.value?.includes?.("}");
                const atbIndex = parseIndex(attr?.value) ?? -1;
                const excepted = (Array.isArray(except) ? except?.some?.((str) => trueAttributeName?.startsWith?.(str)) : (except == trueAttributeName));
                const isSpecific = (Array.isArray(specific) ? specific?.some?.((str) => attr.name === str) : (attr.name === specific)) && specific !== "";
                if (isPlaceholder && (((prefix == "" && allowedNoPrefix) || prefix != "") || isSpecific) && atbIndex >= 0 && !excepted) {
                    const key = isSpecific ? attr.name : trueAttributeName;
                    if (!entriesMap.has(key)) {
                        entriesMap.set(key, []);
                    }
                    entriesMap.get(key)?.push(atbIndex);
                }
            }
            return Array.from(entriesMap.entries());
        };
        //
        let attributesEntries = makeEntries(["attr:", ""], ["ref"]);
        let propertiesEntries = makeEntries(["prop:"], []);
        let onEntries = makeCumulativeEntries(["on:", "@"], [], "");
        let refEntries = makeCumulativeEntries(["ref:"], [], ["ref"]);
        // remove entries that are already in properties or on
        //attributesEntries = attributesEntries?.filter?.((pair) => !(propertiesEntries?.some?.((p) => p[0] == pair[0]) || onEntries?.some?.((p) => p[0] == pair[0]) || refEntries?.some?.((p) => p[0] == pair[0]))) ?? [];
        //
        const bindings = Object.fromEntries(entriesIdc?.filter?.((pair) => pair[1] >= 0)?.map?.((pair) => [pair[0], atb?.[pair[1]] ?? null]) ?? []);
        bindings.attributes = Object.fromEntries(attributesEntries?.filter?.((pair) => pair[1] >= 0)?.map?.((pair) => [pair[0], atb?.[pair[1]] ?? null]) ?? []);
        bindings.properties = Object.fromEntries(propertiesEntries?.filter?.((pair) => pair[1] >= 0)?.map?.((pair) => [pair[0], atb?.[pair[1]] ?? null]) ?? []);
        bindings.on = Object.fromEntries(onEntries?.filter?.((pair) => pair[1]?.some?.((idx) => idx >= 0))?.map?.((pair) => [pair[0], pair[1]?.map?.((idx) => atb?.[idx]).filter((v) => v != null)]) ?? []);
        //
        const refIndex = entriesIdc?.find?.((pair) => (pair[0] == "ref" && pair[1] >= 0))?.[1];
        if (refIndex != null && refIndex >= 0) {
            const ref = atb?.[refIndex];
            if (typeof ref == "function") {
                ref?.(el);
            }
            else if (ref != null && typeof ref == "object") {
                ref.value = el;
            }
        }
        //
        refEntries?.forEach?.((pair) => {
            const handlers = pair?.[1]
                ?.filter?.((idx) => idx != null && idx >= 0)
                ?.map?.((idx) => atb?.[idx])
                ?.filter?.((v) => v != null);
            //
            handlers?.forEach?.((ref) => {
                if (typeof ref == "function") {
                    ref?.(el);
                }
                else if (ref != null && typeof ref == "object") {
                    ref.value = el;
                }
            });
        });
        //
        const clearPlaceholdersFromAttributesOfElement = (el) => {
            if (el == null)
                return;
            //
            const attributeIsInRegistry = (name) => {
                return attributesEntries?.some?.((pair) => pair[0] == name) || name?.startsWith?.("ref:") || name == "ref";
            };
            // needs by splice or remove, DOM element.attributes is a live collection
            for (const attr of Array.from(el?.attributes || [])) {
                if ( // relaxed syntax for placeholder, if in registry
                (attr.value?.includes?.("#{") && attr.value?.includes?.("}") && attributeIsInRegistry(attr.name)) ||
                    // stricter check of placeholder, if none in registry
                    attr.value?.startsWith?.("#{") && attr.value?.endsWith?.("}") ||
                    // if attribute name contains colon, it is a property
                    attr.name?.includes?.(":") || attr.name?.includes?.("ref:") || attr.name == "ref") {
                    el?.removeAttribute?.(attr.name);
                }
            }
            ;
        };
        //
        clearPlaceholdersFromAttributesOfElement(el);
        if (!EMap?.has?.(el)) {
            EMap?.set?.(el, E(el, bindings));
        }
        ;
    }
    ;
    return EMap?.get?.(el) ?? el;
};
//
const linearBuilder = (strings, ...values) => {
    const nodes = [];
    for (let i = 0; i < strings?.length; i++) {
        const str = strings?.[i];
        const val = values?.[i];
        nodes.push(H(str));
        nodes.push(val);
    }
    if (nodes?.length <= 1)
        return getNode(nodes?.[0], null, 0);
    // TODO! fix parent node bound support
    const fragment = document.createDocumentFragment();
    fragment.append(...nodes?.filter?.((nd) => (nd != null))?.map?.((en, i) => getNode(en, null, i))?.filter?.((nd) => (nd != null)));
    return fragment;
};
//
export function html(strings, ...values) {
    if (strings?.at?.(0)?.trim?.()?.startsWith?.("<") && strings?.at?.(-1)?.trim?.()?.endsWith?.(">")) {
        return htmlBuilder({ createElement: null })(strings, ...values);
    }
    return linearBuilder(strings, ...values);
}
;
//
const isValidParent = (parent) => {
    return (parent != null && parent instanceof HTMLElement && !(parent instanceof DocumentFragment || (parent instanceof HTMLBodyElement && parent != document.body)));
};
//
const replaceNode = (parent, node, el) => {
    if (el != null) {
        el.boundParent = parent;
    }
    //
    let newNode = getNode(el, null, -1, parent);
    if (isElement(newNode)) {
        if (newNode?.parentNode != parent && !newNode?.contains?.(parent) && newNode != null) {
            node?.replaceWith?.((hasValue(newNode) && (typeof newNode?.value == "object" || typeof newNode?.value == "function") && isElement(newNode?.value)) ? newNode?.value : newNode);
        }
    }
    else {
        node?.remove?.();
    }
};
//
export function htmlBuilder({ createElement = null } = {}) {
    return function (strings, ...values) {
        let parts = [];
        const psh = [], atb = [];
        for (let i = 0; i < strings.length; i++) {
            parts.push(strings?.[i] || "");
            if (i < values.length) {
                if (strings[i]?.trim()?.endsWith?.("<")) {
                    const dat = parseTag(values?.[i]);
                    parts.push((dat.tag || "div"));
                    if (dat.id)
                        parts.push(` id="${dat.id}"`);
                    if (dat.className)
                        parts.push(` class="${dat.className}"`);
                }
                else {
                    // sequences such as inside of `<...>`
                    const $inTagOpen = checkInsideTagBlock(strings, strings?.[i] || "", strings?.[i + 1] || "");
                    const $afterEquals = /[\w:\-\.\]]\s*=\s*$/.test(strings[i]?.trim?.() ?? "") || strings[i]?.trim?.()?.endsWith?.("=");
                    //
                    const $isQuoteBegin = strings[i]?.trim?.()?.match?.(/['"]$/);
                    const $isQuoteEnd = strings[i + 1]?.trim?.()?.match?.(/^['"]/) ?? $isQuoteBegin;
                    //
                    const $betweenQuotes = ($isQuoteBegin && $isQuoteEnd);
                    const $attributePattern = $afterEquals;
                    //
                    const isAttr = ($attributePattern || $betweenQuotes) && $inTagOpen;
                    if (isAttr) {
                        const $needsToQuoteWrap = ($attributePattern && !($betweenQuotes));
                        const ati = atb.length;
                        parts.push((typeof values?.[i] == "string" ? values?.[i]?.trim?.() != "" : values?.[i] != null) ? (($needsToQuoteWrap ? `"#{${ati}}"` : `#{${ati}}`)) : "");
                        atb.push(values?.[i]);
                    }
                    else if (!$inTagOpen) {
                        const psi = psh.length;
                        parts.push((typeof values?.[i] == "string" ? values?.[i]?.trim?.() != "" : values?.[i] != null) ? (isPrimitive(values?.[i]) ? String(values?.[i])?.trim?.() : `<!--o:${psi}-->`) : "");
                        psh.push(values?.[i]);
                    }
                }
            }
        }
        //
        const sourceCode = cleanupInterTagWhitespaceAndIndent(parts.join("").trim());
        const mapped = new WeakMap(), parser = new DOMParser(), doc = parser.parseFromString(sourceCode, "text/html");
        //
        const isTemplate = doc instanceof HTMLTemplateElement || doc?.matches?.("template");
        const sources = (isTemplate ? doc : doc.querySelector("template"))?.content ?? (doc.body ?? doc);
        //
        const frag = document.createDocumentFragment();
        const bucket = Array.from(sources.childNodes)?.filter((e) => { return e instanceof Node; }).map((node) => {
            if (!isValidParent(node?.parentNode) && node?.parentNode != frag) {
                node?.remove?.();
                if (node != null) {
                    frag?.append?.(node);
                }
                ;
            }
            return node;
        });
        //
        let walkedNodes = [];
        //
        bucket.forEach((nodeSet) => {
            const walker = nodeSet ? document.createTreeWalker(nodeSet, NodeFilter.SHOW_ALL, null) : null;
            do {
                const node = walker?.currentNode;
                walkedNodes.push(node);
            } while (walker?.nextNode?.());
        });
        //
        walkedNodes?.filter?.((node) => node?.nodeType == Node.COMMENT_NODE)?.forEach?.((node) => {
            if (node?.nodeValue?.trim?.()?.includes?.("o:") && Number.isInteger(parseInt(node?.nodeValue?.trim?.()?.slice?.(2) ?? "-1"))) {
                let el = psh?.[parseInt(node?.nodeValue?.trim?.()?.slice?.(2) ?? "-1") ?? -1];
                // make iteratable array and set
                if (el == null || el === undefined || (typeof el == "string" ? el : null)?.trim?.() == "") {
                    node?.remove?.();
                }
                else {
                    const $parent = node?.parentNode;
                    if (Array.isArray(el) || el instanceof Map || el instanceof Set) {
                        replaceNode?.($parent, node, el = M(el, null, $parent));
                    }
                    else if (el != null) {
                        replaceNode?.($parent, node, el);
                    }
                }
            }
            // remove comment node if it is connected
            if (node?.isConnected) {
                node?.remove?.();
            }
        });
        //
        walkedNodes?.filter((node) => node.nodeType == Node.ELEMENT_NODE)?.map?.((node) => {
            connectElement(node, atb, psh, mapped);
        });
        // Final whitespace cleanup to ensure :empty works even after dynamic insertions
        return Array.from(frag?.childNodes)?.length > 1 ? frag : frag?.childNodes?.[0];
    };
}
//
export const H = (str, ...values) => {
    //if (typeof str == "object" && hasValue(str)) return C(str);
    if (typeof str == "string") {
        if (str?.trim?.()?.startsWith?.("<") && str?.trim?.()?.endsWith?.(">")) {
            const parser = new DOMParser(), doc = parser.parseFromString(cleanupInterTagWhitespaceAndIndent(str?.trim?.()), "text/html");
            const basis = doc.querySelector("template")?.content ?? doc.body;
            // Normalize and clean whitespace-only text nodes between tags
            if (basis instanceof HTMLBodyElement) {
                const frag = document.createDocumentFragment();
                frag.append(...Array.from(basis.childNodes ?? []));
                return (Array.from(frag.childNodes)?.length > 1 ? frag : frag?.childNodes?.[0]);
            }
            if (basis instanceof DocumentFragment) {
                return basis;
            }
            if (basis?.childNodes?.length > 1) {
                const frag = document.createDocumentFragment();
                frag.append(...Array.from(basis?.childNodes ?? []));
                return frag;
            }
            return basis?.childNodes?.[0] ?? (new Text(str));
        }
        return new Text(str);
    }
    else if (typeof str == "function") {
        return H(str?.());
    }
    else if (Array.isArray(str) && values) {
        return html(str, ...values);
    }
    else if (str instanceof Node) {
        return str;
    }
    ;
    return getNode(str);
};
//
export default H;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU3ludGF4LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiU3ludGF4LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBYSxRQUFRLEVBQUUsV0FBVyxFQUFFLE1BQU0sV0FBVyxDQUFDO0FBQzdELE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUMzQyxPQUFPLEVBQUUsQ0FBQyxFQUFFLE1BQU0sWUFBWSxDQUFDO0FBQy9CLE9BQU8sRUFBRSxDQUFDLEVBQUUsTUFBTSxVQUFVLENBQUM7QUFDN0IsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLFVBQVUsQ0FBQztBQUNyQyxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsa0NBQWtDLEVBQUUsTUFBTSxjQUFjLENBQUM7QUFFdkYsRUFBRTtBQUNGLE1BQU0sSUFBSSxHQUFHLElBQUksT0FBTyxFQUFFLEVBQUUsUUFBUSxHQUFHLENBQUMsR0FBRyxFQUFFLEVBQUUsR0FBRyxNQUFNLEtBQUssR0FBRyxHQUFHLENBQUMsS0FBSyxDQUFDLG9FQUFvRSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSztJQUFFLE9BQU8sRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEVBQUUsRUFBRSxJQUFJLEVBQUUsU0FBUyxFQUFFLElBQUksRUFBRSxDQUFDLENBQUMsTUFBTSxDQUFDLEVBQUUsR0FBRyxHQUFHLEtBQUssRUFBRSxFQUFFLEVBQUUsUUFBUSxDQUFDLEdBQUcsS0FBSyxDQUFDLENBQUMsTUFBTSxTQUFTLEdBQUcsUUFBUSxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxHQUFHLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsT0FBTyxFQUFFLEdBQUcsRUFBRSxFQUFFLEVBQUUsU0FBUyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUE7QUFDblcsTUFBTSxzQkFBc0IsR0FBRyxJQUFJLEdBQUcsQ0FB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RUFBRSxNQUFNLEVBQUUsQ0FBQyxDQUFDLElBQUksRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxHQUFHLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxJQUFJLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDO1FBQ3hKLFFBQVEsQ0FBQyxVQUFVLEdBQUcsTUFBTSxDQUFDLFdBQVcsQ0FBQyxpQkFBaUIsRUFBRSxNQUFNLEVBQUUsQ0FBQyxDQUFDLElBQUksRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxHQUFHLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxJQUFJLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDO1FBQ3hKLFFBQVEsQ0FBQyxFQUFFLEdBQUcsTUFBTSxDQUFDLFdBQVcsQ0FBQyxTQUFTLEVBQUUsTUFBTSxFQUFFLENBQUMsQ0FBQyxJQUFJLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDLEdBQVcsRUFBRSxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQyxJQUFJLEVBQUUsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDLEdBQVcsRUFBRSxFQUFFLENBQUMsR0FBRyxFQUFFLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxD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QUM7SUFDekIsQ0FBQztTQUNELElBQUksT0FBTyxHQUFHLElBQUksVUFBVSxFQUFFLENBQUM7UUFBQyxPQUFPLENBQUMsQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDLENBQUM7SUFBQyxDQUFDO1NBQ3BELElBQUksS0FBSyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBSSxNQUFNLEVBQUUsQ0FBQztRQUFDLE9BQU8sSUFBSSxDQUFDLEdBQUcsRUFBRSxHQUFHLE1BQU0sQ0FBQyxDQUFDO0lBQUMsQ0FBQztTQUNsRSxJQUFJLEdBQUcsWUFBWSxJQUFJLEVBQUUsQ0FBQztRQUFDLE9BQU8sR0FBRyxDQUFDO0lBQUMsQ0FBQztJQUFBLENBQUM7SUFDekMsT0FBTyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUM7QUFDeEIsQ0FBQyxDQUFBO0FBRUQsRUFBRTtBQUNGLGVBQWUsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgYmluZEV2ZW50LCBoYXNWYWx1ZSwgaXNQcmltaXRpdmUgfSBmcm9tIFwiZmVzdC9jb3JlXCI7XG5pbXBvcnQgeyBnZXROb2RlIH0gZnJvbSBcIi4uL2NvbnRleHQvVXRpbHNcIjtcbmltcG9ydCB7IEUgfSBmcm9tIFwiLi9CaW5kaW5nc1wiO1xuaW1wb3J0IHsgTSB9IGZyb20gXCIuL01hcHBlZFwiO1xuaW1wb3J0IHsgaXNFbGVtZW50IH0gZnJvbSBcImZlc3QvZG9tXCI7XG5pbXBvcnQgeyBjaGVja0luc2lkZVRhZ0Jsb2NrLCBjbGVhbnVwSW50ZXJUYWdXaGl0ZXNwYWNlQW5kSW5kZW50IH0gZnJvbSBcIi4vTm9ybWFsaXplclwiO1xuXG4vL1xuY29uc3QgRU1hcCA9IG5ldyBXZWFrTWFwKCksIHBhcnNlVGFnID0gKHN0cikgPT4geyBjb25zdCBtYXRjaCA9IHN0ci5tYXRjaCgvXihbYS16QS1aMC05XFwtXSspPyg/OiMoW2EtekEtWjAtOVxcLV9dKykpPygoPzpcXC5bYS16QS1aMC05XFwtX10rKSopJC8pOyBpZiAoIW1hdGNoKSByZXR1cm4geyB0YWc6IHN0ciwgaWQ6IG51bGwsIGNsYXNzTmFtZTogbnVsbCB9OyBjb25zdCBbLCB0YWcgPSAnZGl2JywgaWQsIGNsYXNzU3RyXSA9IG1hdGNoOyBjb25zdCBjbGFzc05hbWUgPSBjbGFzc1N0ciA/IGNsYXNzU3RyLnJlcGxhY2UoL1xcLi9nLCAnICcpLnRyaW0oKSA6IG51bGw7IHJldHVybiB7IHRhZywgaWQsIGNsYXNzTmFtZSB9OyB9XG5jb25zdCBwcmVzZXJ2ZVdoaXRlc3BhY2VUYWdzID0gbmV3IFNldChbXCJQUkVcIiwgXCJURVhUQVJFQVwiLCBcIlNDUklQVFwiLCBcIlNUWUxFXCJdKTtcblxuLy9cbmNvbnN0IHBhcnNlSW5kZXggPSAodmFsdWU6IHN0cmluZyB8IGFueSB8IG51bGwpOiBudW1iZXIgPT4ge1xuICAgIGlmICh0eXBlb2YgdmFsdWUgIT0gXCJzdHJpbmdcIiB8fCAhdmFsdWU/LnRyaW0/LigpKSByZXR1cm4gLTE7XG4gICAgY29uc3QgbWF0Y2ggPSB2YWx1ZS5tYXRjaCgvXiN7KFxcZCspfSQvKTtcbiAgICByZXR1cm4gbWF0Y2ggPyBwYXJzZUludChtYXRjaD8uWzFdID8/IFwiLTFcIikgOiAtMTtcbn1cblxuLy9cbmNvbnN0IGNvbm5lY3RFbGVtZW50ID0gKGVsOiBIVE1MRWxlbWVudCB8IG51bGwsIGF0YjogYW55W10sIHBzaDogYW55W10sIG1hcHBlZDogV2Vha01hcDxIVE1MRWxlbWVudCwgYW55PikgPT4ge1xuICAgIGlmICghZWwpIHJldHVybiBlbDtcbiAgICBpZiAoZWwgIT0gbnVsbCkge1xuICAgICAgICBjb25zdCBlbnRyaWVzSWRjOiBbc3RyaW5nLCBudW1iZXJdW10gPSBbXTtcbiAgICAgICAgY29uc3QgYWRkRW50cnlJZkV4aXN0cyA9IChuYW1lOiBzdHJpbmcpOiBbc3RyaW5nLCBhbnldID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGF0dHIgPSBBcnJheS5mcm9tKGVsPy5hdHRyaWJ1dGVzIHx8IFtdKS5maW5kKChhdHRyKSA9PiAoYXR0ci5uYW1lID09IG5hbWUgJiYgYXR0ci52YWx1ZT8uaW5jbHVkZXM/LihcIiN7XCIpKSk7XG4gICAgICAgICAgICBpZiAoYXR0cikge1xuICAgICAgICAgICAgICAgIGNvbnN0IHBhaXI6IFtzdHJpbmcsIGFueV0gPSBbbmFtZSwgcGFyc2VJbmRleChhdHRyPy52YWx1ZSkgPz8gLTFdO1xuICAgICAgICAgICAgICAgIGVudHJpZXNJZGMucHVzaChwYWlyKTsgcmV0dXJuIHBhaXI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gW25hbWUsIC0xXTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vXG4gICAgICAgIGNvbnN0IHNwZWNpYWxFbnRyeU5hbWVzID0gW1wiZGF0YXNldFwiLCBcInN0eWxlXCIsIFwiY2xhc3NMaXN0XCIsIFwidmlzaWJsZVwiLCBcImFyaWFcIiwgXCJ2YWx1ZVwiLCBcInJlZlwiXTtcbiAgICAgICAgc3BlY2lhbEVudHJ5TmFtZXMuZm9yRWFjaCgobmFtZSkgPT4gYWRkRW50cnlJZkV4aXN0cyhuYW1lKSk7XG5cbiAgICAgICAgLy9cbiAgICAgICAgY29uc3QgbWFrZUVudHJpZXMgPSAoc3RhcnRzV2l0aDogc3RyaW5nW10gfCBzdHJpbmcsIGV4Y2VwdDogc3RyaW5nW10gfCBzdHJpbmcpOiBbc3RyaW5nLCBhbnldW10gPT4ge1xuICAgICAgICAgICAgY29uc3QgZW50cmllczogW3N0cmluZywgYW55XVtdID0gW107XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGF0dHIgb2YgQXJyYXkuZnJvbShlbD8uYXR0cmlidXRlcyB8fCBbXSkpIHtcbiAgICAgICAgICAgICAgICAvLyBuZWVkcyByZXZpZXcgc3RhcnRzV2l0aCB3aXRoIFwiXCIgaS5lLiBhdHRyaWJ1dGVzIGl0c2VsZiwganVzdCAje31cbiAgICAgICAgICAgICAgICBjb25zdCBhbGxvd2VkTm9QcmVmaXg6IGJvb2xlYW4gPSAoQXJyYXkuaXNBcnJheShzdGFydHNXaXRoKSA/IHN0YXJ0c1dpdGg/LnNvbWU/Ligoc3RyOiBzdHJpbmcpPT5zdHI9PVwiXCIpIDogKHN0YXJ0c1dpdGggPT0gXCJcIikpO1xuICAgICAgICAgICAgICAgIGNvbnN0IHByZWZpeDogc3RyaW5nID0gKEFycmF5LmlzQXJyYXkoc3RhcnRzV2l0aCkgPyBzdGFydHNXaXRoLmZpbmQoKHN0YXJ0KSA9PiBhdHRyLm5hbWU/LnN0YXJ0c1dpdGg/LihzdGFydCkpIDogKHN0YXJ0c1dpdGggPSBhdHRyLm5hbWU/LnN0YXJ0c1dpdGg/LihzdGFydHNXaXRoKSA/IHN0YXJ0c1dpdGggOiBcIlwiKSBhcyBzdHJpbmcpID8/IFwiXCI7XG4gICAgICAgICAgICAgICAgY29uc3QgdHJ1ZUF0dHJpYnV0ZU5hbWUgPSBhdHRyLm5hbWUudHJpbSgpPy5yZXBsYWNlPy4ocHJlZml4LCBcIlwiKTtcbiAgICAgICAgICAgICAgICBjb25zdCBpc1BsYWNlaG9sZGVyID0gYXR0ci52YWx1ZT8uaW5jbHVkZXM/LihcIiN7XCIpICYmIGF0dHIudmFsdWU/LmluY2x1ZGVzPy4oXCJ9XCIpO1xuICAgICAgICAgICAgICAgIGNvbnN0IGF0YkluZGV4ID0gcGFyc2VJbmRleChhdHRyPy52YWx1ZSk7XG4gICAgICAgICAgICAgICAgY29uc3QgZXhjZXB0ZWQ6IGJvb2xlYW4gPSAoQXJyYXkuaXNBcnJheShleGNlcHQpID8gZXhjZXB0Py5zb21lPy4oKHN0cjogc3RyaW5nKT0+dHJ1ZUF0dHJpYnV0ZU5hbWU/LnN0YXJ0c1dpdGg/LihzdHIpKSA6IChleGNlcHQgPT0gdHJ1ZUF0dHJpYnV0ZU5hbWUpKTtcblxuICAgICAgICAgICAgICAgIGlmIChpc1BsYWNlaG9sZGVyICYmICgocHJlZml4ID09IFwiXCIgJiYgYWxsb3dlZE5vUHJlZml4KSB8fCBwcmVmaXggIT0gXCJcIikgJiYgYXRiSW5kZXggPj0gMCAmJiAhZXhjZXB0ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgZW50cmllcy5wdXNoKFt0cnVlQXR0cmlidXRlTmFtZSwgYXRiSW5kZXhdKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gZW50cmllcztcbiAgICAgICAgfVxuXG4gICAgICAgIC8vXG4gICAgICAgIGNvbnN0IG1ha2VDdW11bGF0aXZlRW50cmllcyA9IChzdGFydHNXaXRoOiBzdHJpbmdbXSB8IHN0cmluZywgZXhjZXB0OiBzdHJpbmdbXSB8IHN0cmluZywgc3BlY2lmaWM6IHN0cmluZ1tdIHwgc3RyaW5nID0gXCJcIikgPT4ge1xuICAgICAgICAgICAgY29uc3QgZW50cmllc01hcCA9IG5ldyBNYXA8c3RyaW5nLCBhbnlbXT4oKTtcbiAgICAgICAgICAgIGZvciAoY29uc3QgYXR0ciBvZiBBcnJheS5mcm9tKGVsPy5hdHRyaWJ1dGVzIHx8IFtdKSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGFsbG93ZWROb1ByZWZpeDogYm9vbGVhbiA9IChBcnJheS5pc0FycmF5KHN0YXJ0c1dpdGgpID8gc3RhcnRzV2l0aD8uc29tZT8uKChzdHI6IHN0cmluZyk9PnN0cj09XCJcIikgOiAoc3RhcnRzV2l0aCA9PSBcIlwiKSk7XG4gICAgICAgICAgICAgICAgY29uc3QgcHJlZml4OiBzdHJpbmcgPSAoQXJyYXkuaXNBcnJheShzdGFydHNXaXRoKSA/IHN0YXJ0c1dpdGguZmluZCgoc3RhcnQpID0+IGF0dHIubmFtZT8uc3RhcnRzV2l0aD8uKHN0YXJ0KSkgOiAoc3RhcnRzV2l0aCA9IGF0dHIubmFtZT8uc3RhcnRzV2l0aD8uKHN0YXJ0c1dpdGgpID8gc3RhcnRzV2l0aCA6IFwiXCIpIGFzIHN0cmluZykgPz8gXCJcIjtcbiAgICAgICAgICAgICAgICBjb25zdCB0cnVlQXR0cmlidXRlTmFtZSA9IGF0dHIubmFtZS50cmltKCk/LnJlcGxhY2U/LihwcmVmaXgsIFwiXCIpO1xuICAgICAgICAgICAgICAgIGNvbnN0IGlzUGxhY2Vob2xkZXIgPSBhdHRyLnZhbHVlPy5pbmNsdWRlcz8uKFwiI3tcIikgJiYgYXR0ci52YWx1ZT8uaW5jbHVkZXM/LihcIn1cIik7XG4gICAgICAgICAgICAgICAgY29uc3QgYXRiSW5kZXggPSBwYXJzZUluZGV4KGF0dHI/LnZhbHVlKSA/PyAtMTtcblxuICAgICAgICAgICAgICAgIGNvbnN0IGV4Y2VwdGVkOiBib29sZWFuID0gKEFycmF5LmlzQXJyYXkoZXhjZXB0KSA/IGV4Y2VwdD8uc29tZT8uKChzdHI6IHN0cmluZyk9PnRydWVBdHRyaWJ1dGVOYW1lPy5zdGFydHNXaXRoPy4oc3RyKSkgOiAoZXhjZXB0ID09IHRydWVBdHRyaWJ1dGVOYW1lKSk7XG4gICAgICAgICAgICAgICAgY29uc3QgaXNTcGVjaWZpYzogYm9vbGVhbiA9IChBcnJheS5pc0FycmF5KHNwZWNpZmljKSA/IHNwZWNpZmljPy5zb21lPy4oKHN0cjogc3RyaW5nKT0+YXR0ci5uYW1lID09PSBzdHIpIDogKGF0dHIubmFtZSA9PT0gc3BlY2lmaWMpKSAmJiBzcGVjaWZpYyAhPT0gXCJcIjtcblxuICAgICAgICAgICAgICAgIGlmIChpc1BsYWNlaG9sZGVyICYmICgoKHByZWZpeCA9PSBcIlwiICYmIGFsbG93ZWROb1ByZWZpeCkgfHwgcHJlZml4ICE9IFwiXCIpIHx8IGlzU3BlY2lmaWMpICYmIGF0YkluZGV4ID49IDAgJiYgIWV4Y2VwdGVkKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGtleSA9IGlzU3BlY2lmaWMgPyBhdHRyLm5hbWUgOiB0cnVlQXR0cmlidXRlTmFtZTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFlbnRyaWVzTWFwLmhhcyhrZXkpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBlbnRyaWVzTWFwLnNldChrZXksIFtdKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbnRyaWVzTWFwLmdldChrZXkpPy5wdXNoKGF0YkluZGV4KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gQXJyYXkuZnJvbShlbnRyaWVzTWFwLmVudHJpZXMoKSk7XG4gICAgICAgIH1cblxuICAgICAgICAvL1xuICAgICAgICBsZXQgYXR0cmlidXRlc0VudHJpZXM6IFtzdHJpbmcsIGFueV1bXSA9IG1ha2VFbnRyaWVzKFtcImF0dHI6XCIsIFwiXCJdLCBbXCJyZWZcIl0pO1xuICAgICAgICBsZXQgcHJvcGVydGllc0VudHJpZXM6IFtzdHJpbmcsIGFueV1bXSA9IG1ha2VFbnRyaWVzKFtcInByb3A6XCJdLCBbXSk7XG4gICAgICAgIGxldCBvbkVudHJpZXM6IFtzdHJpbmcsIGFueVtdXVtdID0gbWFrZUN1bXVsYXRpdmVFbnRyaWVzKFtcIm9uOlwiLCBcIkBcIl0sIFtdLCBcIlwiKTtcbiAgICAgICAgbGV0IHJlZkVudHJpZXM6IFtzdHJpbmcsIGFueVtdXVtdID0gbWFrZUN1bXVsYXRpdmVFbnRyaWVzKFtcInJlZjpcIl0sIFtdLCBbXCJyZWZcIl0pO1xuXG4gICAgICAgIC8vIHJlbW92ZSBlbnRyaWVzIHRoYXQgYXJlIGFscmVhZHkgaW4gcHJvcGVydGllcyBvciBvblxuICAgICAgICAvL2F0dHJpYnV0ZXNFbnRyaWVzID0gYXR0cmlidXRlc0VudHJpZXM/LmZpbHRlcj8uKChwYWlyKSA9PiAhKHByb3BlcnRpZXNFbnRyaWVzPy5zb21lPy4oKHApID0+IHBbMF0gPT0gcGFpclswXSkgfHwgb25FbnRyaWVzPy5zb21lPy4oKHApID0+IHBbMF0gPT0gcGFpclswXSkgfHwgcmVmRW50cmllcz8uc29tZT8uKChwKSA9PiBwWzBdID09IHBhaXJbMF0pKSkgPz8gW107XG5cbiAgICAgICAgLy9cbiAgICAgICAgY29uc3QgYmluZGluZ3M6IGFueSA9IE9iamVjdC5mcm9tRW50cmllcyhlbnRyaWVzSWRjPy5maWx0ZXI/LigocGFpcikgPT4gcGFpclsxXSA+PSAwKT8ubWFwPy4oKHBhaXIpID0+IFtwYWlyWzBdLCBhdGI/LltwYWlyWzFdXSA/PyBudWxsXSkgPz8gW10pO1xuICAgICAgICBiaW5kaW5ncy5hdHRyaWJ1dGVzID0gT2JqZWN0LmZyb21FbnRyaWVzKGF0dHJpYnV0ZXNFbnRyaWVzPy5maWx0ZXI/LigocGFpcikgPT4gcGFpclsxXSA+PSAwKT8ubWFwPy4oKHBhaXIpID0+IFtwYWlyWzBdLCBhdGI/LltwYWlyWzFdXSA/PyBudWxsXSkgPz8gW10pO1xuICAgICAgICBiaW5kaW5ncy5wcm9wZXJ0aWVzID0gT2JqZWN0LmZyb21FbnRyaWVzKHByb3BlcnRpZXNFbnRyaWVzPy5maWx0ZXI/LigocGFpcikgPT4gcGFpclsxXSA+PSAwKT8ubWFwPy4oKHBhaXIpID0+IFtwYWlyWzBdLCBhdGI/LltwYWlyWzFdXSA/PyBudWxsXSkgPz8gW10pO1xuICAgICAgICBiaW5kaW5ncy5vbiA9IE9iamVjdC5mcm9tRW50cmllcyhvbkVudHJpZXM/LmZpbHRlcj8uKChwYWlyKSA9PiBwYWlyWzFdPy5zb21lPy4oKGlkeDogbnVtYmVyKSA9PiBpZHggPj0gMCkpPy5tYXA/LigocGFpcikgPT4gW3BhaXJbMF0sIHBhaXJbMV0/Lm1hcD8uKChpZHg6IG51bWJlcikgPT4gYXRiPy5baWR4XSkuZmlsdGVyKCh2OiBhbnkpID0+IHYgIT0gbnVsbCldKSA/PyBbXSk7XG5cbiAgICAgICAgLy9cbiAgICAgICAgY29uc3QgcmVmSW5kZXggPSBlbnRyaWVzSWRjPy5maW5kPy4oKHBhaXIpID0+IChwYWlyWzBdID09IFwicmVmXCIgJiYgcGFpclsxXSA+PSAwKSk/LlsxXTtcbiAgICAgICAgaWYgKHJlZkluZGV4ICE9IG51bGwgJiYgcmVmSW5kZXggPj0gMCkge1xuICAgICAgICAgICAgY29uc3QgcmVmID0gYXRiPy5bcmVmSW5kZXhdO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiByZWYgPT0gXCJmdW5jdGlvblwiKSB7IHJlZj8uKGVsKTsgfSBlbHNlIGlmIChyZWYgIT0gbnVsbCAmJiB0eXBlb2YgcmVmID09IFwib2JqZWN0XCIpIHsgcmVmLnZhbHVlID0gZWw7IH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vXG4gICAgICAgIHJlZkVudHJpZXM/LmZvckVhY2g/LigocGFpcjogW3N0cmluZywgbnVtYmVyW11dKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBoYW5kbGVyczogYW55W10gPSBwYWlyPy5bMV1cbiAgICAgICAgICAgICAgICA/LmZpbHRlcj8uKChpZHg6IG51bWJlcikgPT4gaWR4ICE9IG51bGwgJiYgaWR4ID49IDApXG4gICAgICAgICAgICAgICAgPy5tYXA/LigoaWR4OiBudW1iZXIpID0+IGF0Yj8uW2lkeF0pXG4gICAgICAgICAgICAgICAgPy5maWx0ZXI/LigodjogYW55KSA9PiB2ICE9IG51bGwpO1xuXG4gICAgICAgICAgICAvL1xuICAgICAgICAgICAgaGFuZGxlcnM/LmZvckVhY2g/LigocmVmOiBhbnkpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHJlZiA9PSBcImZ1bmN0aW9uXCIpIHsgcmVmPy4oZWwpOyB9IGVsc2UgaWYgKHJlZiAhPSBudWxsICYmIHR5cGVvZiByZWYgPT0gXCJvYmplY3RcIikgeyByZWYudmFsdWUgPSBlbDsgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vXG4gICAgICAgIGNvbnN0IGNsZWFyUGxhY2Vob2xkZXJzRnJvbUF0dHJpYnV0ZXNPZkVsZW1lbnQgPSAoZWw6IEhUTUxFbGVtZW50IHwgbnVsbCk9PntcbiAgICAgICAgICAgIGlmIChlbCA9PSBudWxsKSByZXR1cm47XG5cbiAgICAgICAgICAgIC8vXG4gICAgICAgICAgICBjb25zdCBhdHRyaWJ1dGVJc0luUmVnaXN0cnkgPSAobmFtZTogc3RyaW5nKSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGF0dHJpYnV0ZXNFbnRyaWVzPy5zb21lPy4oKHBhaXIpID0+IHBhaXJbMF0gPT0gbmFtZSkgfHwgbmFtZT8uc3RhcnRzV2l0aD8uKFwicmVmOlwiKSB8fCBuYW1lID09IFwicmVmXCI7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIG5lZWRzIGJ5IHNwbGljZSBvciByZW1vdmUsIERPTSBlbGVtZW50LmF0dHJpYnV0ZXMgaXMgYSBsaXZlIGNvbGxlY3Rpb25cbiAgICAgICAgICAgIGZvciAoY29uc3QgYXR0ciBvZiBBcnJheS5mcm9tKGVsPy5hdHRyaWJ1dGVzIHx8IFtdKSkge1xuICAgICAgICAgICAgICAgIGlmICggLy8gcmVsYXhlZCBzeW50YXggZm9yIHBsYWNlaG9sZGVyLCBpZiBpbiByZWdpc3RyeVxuICAgICAgICAgICAgICAgICAgICAoYXR0ci52YWx1ZT8uaW5jbHVkZXM/LihcIiN7XCIpICYmIGF0dHIudmFsdWU/LmluY2x1ZGVzPy4oXCJ9XCIpICYmIGF0dHJpYnV0ZUlzSW5SZWdpc3RyeShhdHRyLm5hbWUgYXMgc3RyaW5nKSkgfHxcblxuICAgICAgICAgICAgICAgICAgICAvLyBzdHJpY3RlciBjaGVjayBvZiBwbGFjZWhvbGRlciwgaWYgbm9uZSBpbiByZWdpc3RyeVxuICAgICAgICAgICAgICAgICAgICBhdHRyLnZhbHVlPy5zdGFydHNXaXRoPy4oXCIje1wiKSAmJiBhdHRyLnZhbHVlPy5lbmRzV2l0aD8uKFwifVwiKSB8fFxuXG4gICAgICAgICAgICAgICAgICAgIC8vIGlmIGF0dHJpYnV0ZSBuYW1lIGNvbnRhaW5zIGNvbG9uLCBpdCBpcyBhIHByb3BlcnR5XG4gICAgICAgICAgICAgICAgICAgIGF0dHIubmFtZT8uaW5jbHVkZXM/LihcIjpcIikgfHwgYXR0ci5uYW1lPy5pbmNsdWRlcz8uKFwicmVmOlwiKSB8fCBhdHRyLm5hbWUgPT0gXCJyZWZcIlxuICAgICAgICAgICAgICAgICkgeyBlbD8ucmVtb3ZlQXR0cmlidXRlPy4oYXR0ci5uYW1lIGFzIHN0cmluZyk7IH1cbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cblxuICAgICAgICAvL1xuICAgICAgICBjbGVhclBsYWNlaG9sZGVyc0Zyb21BdHRyaWJ1dGVzT2ZFbGVtZW50KGVsKTtcbiAgICAgICAgaWYgKCFFTWFwPy5oYXM/LihlbCkpIHsgRU1hcD8uc2V0Py4oZWwsIEUoZWwsIGJpbmRpbmdzKSk7IH07XG4gICAgfTtcbiAgICByZXR1cm4gRU1hcD8uZ2V0Py4oZWwpID8/IGVsO1xufVxuXG4vL1xuY29uc3QgbGluZWFyQnVpbGRlciA9IChzdHJpbmdzLCAuLi52YWx1ZXMpID0+IHtcbiAgICBjb25zdCBub2RlczogYW55W10gPSBbXTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHN0cmluZ3M/Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGNvbnN0IHN0ciA9IHN0cmluZ3M/LltpXTtcbiAgICAgICAgY29uc3QgdmFsID0gdmFsdWVzPy5baV07XG4gICAgICAgIG5vZGVzLnB1c2goSChzdHIpKTtcbiAgICAgICAgbm9kZXMucHVzaCh2YWwpO1xuICAgIH1cbiAgICBpZiAobm9kZXM/Lmxlbmd0aCA8PSAxKSByZXR1cm4gZ2V0Tm9kZShub2Rlcz8uWzBdLCBudWxsLCAwKTtcblxuICAgIC8vIFRPRE8hIGZpeCBwYXJlbnQgbm9kZSBib3VuZCBzdXBwb3J0XG4gICAgY29uc3QgZnJhZ21lbnQgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7XG4gICAgZnJhZ21lbnQuYXBwZW5kKC4uLm5vZGVzPy5maWx0ZXI/LigobmQpID0+IChuZCAhPSBudWxsKSk/Lm1hcD8uKChlbiwgaTogbnVtYmVyKSA9PiBnZXROb2RlKGVuLCBudWxsLCBpKSk/LmZpbHRlcj8uKChuZCkgPT4gKG5kICE9IG51bGwpKSk7XG4gICAgcmV0dXJuIGZyYWdtZW50O1xufVxuXG4vL1xuZXhwb3J0IGZ1bmN0aW9uIGh0bWwoc3RyaW5ncywgLi4udmFsdWVzKSB7XG4gICAgaWYgKHN0cmluZ3M/LmF0Py4oMCk/LnRyaW0/LigpPy5zdGFydHNXaXRoPy4oXCI8XCIpICYmIHN0cmluZ3M/LmF0Py4oLTEpPy50cmltPy4oKT8uZW5kc1dpdGg/LihcIj5cIikpIHtcbiAgICAgICAgcmV0dXJuIGh0bWxCdWlsZGVyKHsgY3JlYXRlRWxlbWVudDogbnVsbCB9KShzdHJpbmdzLCAuLi52YWx1ZXMpO1xuICAgIH1cbiAgICByZXR1cm4gbGluZWFyQnVpbGRlcihzdHJpbmdzLCAuLi52YWx1ZXMpO1xufTtcblxuLy9cbmNvbnN0IGlzVmFsaWRQYXJlbnQgPSAocGFyZW50OiBOb2RlKSA9PiB7XG4gICAgcmV0dXJuIChwYXJlbnQgIT0gbnVsbCAmJiBwYXJlbnQgaW5zdGFuY2VvZiBIVE1MRWxlbWVudCAmJiAhKHBhcmVudCBpbnN0YW5jZW9mIERvY3VtZW50RnJhZ21lbnQgfHwgKHBhcmVudCBpbnN0YW5jZW9mIEhUTUxCb2R5RWxlbWVudCAmJiBwYXJlbnQgIT0gZG9jdW1lbnQuYm9keSkpKTtcbn1cblxuLy9cbmNvbnN0IHJlcGxhY2VOb2RlID0gKHBhcmVudDogTm9kZSwgbm9kZTogTm9kZSwgZWw6IGFueSkgPT4ge1xuICAgIGlmIChlbCAhPSBudWxsKSB7IGVsLmJvdW5kUGFyZW50ID0gcGFyZW50OyB9XG5cbiAgICAvL1xuICAgIGxldCBuZXdOb2RlID0gZ2V0Tm9kZShlbCwgbnVsbCwgLTEsIHBhcmVudCk7XG4gICAgaWYgKGlzRWxlbWVudChuZXdOb2RlKSkge1xuICAgICAgICBpZiAobmV3Tm9kZT8ucGFyZW50Tm9kZSAhPSBwYXJlbnQgJiYgIW5ld05vZGU/LmNvbnRhaW5zPy4ocGFyZW50KSAmJiBuZXdOb2RlICE9IG51bGwpIHtcbiAgICAgICAgICAgIChub2RlIGFzIGFueSk/LnJlcGxhY2VXaXRoPy4oKGhhc1ZhbHVlKG5ld05vZGUpICYmICh0eXBlb2YgbmV3Tm9kZT8udmFsdWUgPT0gXCJvYmplY3RcIiB8fCB0eXBlb2YgbmV3Tm9kZT8udmFsdWUgPT0gXCJmdW5jdGlvblwiKSAmJiBpc0VsZW1lbnQobmV3Tm9kZT8udmFsdWUpKSA/IG5ld05vZGU/LnZhbHVlIDogbmV3Tm9kZSk7XG4gICAgICAgIH1cbiAgICB9IGVsc2VcbiAgICB7IChub2RlIGFzIGFueSk/LnJlbW92ZT8uKCk7IH1cbn1cblxuLy9cbmV4cG9ydCBmdW5jdGlvbiBodG1sQnVpbGRlcih7IGNyZWF0ZUVsZW1lbnQgPSBudWxsIH0gPSB7fSkge1xuICAgIHJldHVybiBmdW5jdGlvbiAoc3RyaW5ncywgLi4udmFsdWVzKSB7XG4gICAgICAgIGxldCBwYXJ0czogc3RyaW5nW10gPSBbXTtcbiAgICAgICAgY29uc3QgcHNoOiBhbnlbXSA9IFtdLCBhdGI6IGFueVtdID0gW107XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc3RyaW5ncy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgcGFydHMucHVzaChzdHJpbmdzPy5baV0gfHwgXCJcIik7XG4gICAgICAgICAgICBpZiAoaSA8IHZhbHVlcy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICBpZiAoc3RyaW5nc1tpXT8udHJpbSgpPy5lbmRzV2l0aD8uKFwiPFwiKSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBkYXQgPSBwYXJzZVRhZyh2YWx1ZXM/LltpXSk7XG4gICAgICAgICAgICAgICAgICAgIHBhcnRzLnB1c2goKGRhdC50YWcgfHwgXCJkaXZcIikpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZGF0LmlkKSBwYXJ0cy5wdXNoKGAgaWQ9XCIke2RhdC5pZH1cImApO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZGF0LmNsYXNzTmFtZSkgcGFydHMucHVzaChgIGNsYXNzPVwiJHtkYXQuY2xhc3NOYW1lfVwiYCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gc2VxdWVuY2VzIHN1Y2ggYXMgaW5zaWRlIG9mIGA8Li4uPmBcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgJGluVGFnT3BlbiA9IGNoZWNrSW5zaWRlVGFnQmxvY2soc3RyaW5ncywgc3RyaW5ncz8uW2ldIHx8IFwiXCIsIHN0cmluZ3M/LltpICsgMV0gfHwgXCJcIik7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0ICRhZnRlckVxdWFscyA9IC9bXFx3OlxcLVxcLlxcXV1cXHMqPVxccyokLy50ZXN0KHN0cmluZ3NbaV0/LnRyaW0/LigpID8/IFwiXCIpIHx8IHN0cmluZ3NbaV0/LnRyaW0/LigpPy5lbmRzV2l0aD8uKFwiPVwiKTtcblxuICAgICAgICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICAgICAgICBjb25zdCAkaXNRdW90ZUJlZ2luID0gc3RyaW5nc1tpXT8udHJpbT8uKCk/Lm1hdGNoPy4oL1snXCJdJC8pO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCAkaXNRdW90ZUVuZCA9IHN0cmluZ3NbaSArIDFdPy50cmltPy4oKT8ubWF0Y2g/LigvXlsnXCJdLykgPz8gJGlzUXVvdGVCZWdpbjtcblxuICAgICAgICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICAgICAgICBjb25zdCAkYmV0d2VlblF1b3RlcyA9ICgkaXNRdW90ZUJlZ2luICYmICRpc1F1b3RlRW5kKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgJGF0dHJpYnV0ZVBhdHRlcm4gPSAkYWZ0ZXJFcXVhbHM7XG5cbiAgICAgICAgICAgICAgICAgICAgLy9cbiAgICAgICAgICAgICAgICAgICAgY29uc3QgaXNBdHRyID0gKCRhdHRyaWJ1dGVQYXR0ZXJuIHx8ICRiZXR3ZWVuUXVvdGVzKSAmJiAkaW5UYWdPcGVuO1xuICAgICAgICAgICAgICAgICAgICBpZiAoaXNBdHRyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCAkbmVlZHNUb1F1b3RlV3JhcCA9ICgkYXR0cmlidXRlUGF0dGVybiAmJiAhKCRiZXR3ZWVuUXVvdGVzKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBhdGkgPSBhdGIubGVuZ3RoO1xuICAgICAgICAgICAgICAgICAgICAgICAgcGFydHMucHVzaCgodHlwZW9mIHZhbHVlcz8uW2ldID09IFwic3RyaW5nXCIgPyB2YWx1ZXM/LltpXT8udHJpbT8uKCkgIT0gXCJcIiA6IHZhbHVlcz8uW2ldICE9IG51bGwpID8gKCgkbmVlZHNUb1F1b3RlV3JhcCA/IGBcIiN7JHthdGl9fVwiYCA6IGAjeyR7YXRpfX1gKSkgOiBcIlwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGF0Yi5wdXNoKHZhbHVlcz8uW2ldKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlXG4gICAgICAgICAgICAgICAgICAgIGlmICghJGluVGFnT3Blbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcHNpID0gcHNoLmxlbmd0aDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcnRzLnB1c2goKHR5cGVvZiB2YWx1ZXM/LltpXSA9PSBcInN0cmluZ1wiID8gdmFsdWVzPy5baV0/LnRyaW0/LigpICE9IFwiXCIgOiB2YWx1ZXM/LltpXSAhPSBudWxsKSA/IChpc1ByaW1pdGl2ZSh2YWx1ZXM/LltpXSkgPyBTdHJpbmcodmFsdWVzPy5baV0pPy50cmltPy4oKSA6IGA8IS0tbzoke3BzaX0tLT5gKSA6IFwiXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcHNoLnB1c2godmFsdWVzPy5baV0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy9cbiAgICAgICAgY29uc3Qgc291cmNlQ29kZSA9IGNsZWFudXBJbnRlclRhZ1doaXRlc3BhY2VBbmRJbmRlbnQocGFydHMuam9pbihcIlwiKS50cmltKCkpO1xuICAgICAgICBjb25zdCBtYXBwZWQgPSBuZXcgV2Vha01hcCgpLCBwYXJzZXIgPSBuZXcgRE9NUGFyc2VyKCksIGRvYzogYW55ID0gcGFyc2VyLnBhcnNlRnJvbVN0cmluZyhzb3VyY2VDb2RlLCBcInRleHQvaHRtbFwiKTtcblxuICAgICAgICAvL1xuICAgICAgICBjb25zdCBpc1RlbXBsYXRlID0gZG9jIGluc3RhbmNlb2YgSFRNTFRlbXBsYXRlRWxlbWVudCB8fCBkb2M/Lm1hdGNoZXM/LihcInRlbXBsYXRlXCIpO1xuICAgICAgICBjb25zdCBzb3VyY2VzOiBhbnkgPSAoaXNUZW1wbGF0ZSA/IGRvYyA6IGRvYy5xdWVyeVNlbGVjdG9yKFwidGVtcGxhdGVcIikpPy5jb250ZW50ID8/IChkb2MuYm9keSA/PyBkb2MpO1xuXG4gICAgICAgIC8vXG4gICAgICAgIGNvbnN0IGZyYWcgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7XG4gICAgICAgIGNvbnN0IGJ1Y2tldCA9IEFycmF5LmZyb20oc291cmNlcy5jaGlsZE5vZGVzKT8uZmlsdGVyKChlOiBhbnkpID0+IHsgcmV0dXJuIGUgaW5zdGFuY2VvZiBOb2RlOyB9KS5tYXAoKG5vZGU6IGFueSkgPT4ge1xuICAgICAgICAgICAgaWYgKCFpc1ZhbGlkUGFyZW50KG5vZGU/LnBhcmVudE5vZGUpICYmIG5vZGU/LnBhcmVudE5vZGUgIT0gZnJhZykge1xuICAgICAgICAgICAgICAgIG5vZGU/LnJlbW92ZT8uKCk7XG4gICAgICAgICAgICAgICAgaWYgKG5vZGUgIT0gbnVsbCkgeyBmcmFnPy5hcHBlbmQ/Lihub2RlKTsgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBub2RlO1xuICAgICAgICB9KTtcblxuICAgICAgICAvL1xuICAgICAgICBsZXQgd2Fsa2VkTm9kZXM6IGFueVtdID0gW107XG5cbiAgICAgICAgLy9cbiAgICAgICAgYnVja2V0LmZvckVhY2goKG5vZGVTZXQ6IGFueSkgPT4ge1xuICAgICAgICAgICAgY29uc3Qgd2Fsa2VyOiBhbnkgPSBub2RlU2V0ID8gZG9jdW1lbnQuY3JlYXRlVHJlZVdhbGtlcihub2RlU2V0LCBOb2RlRmlsdGVyLlNIT1dfQUxMLCBudWxsKSA6IG51bGw7XG4gICAgICAgICAgICBkbyB7XG4gICAgICAgICAgICAgICAgY29uc3Qgbm9kZTogYW55ID0gd2Fsa2VyPy5jdXJyZW50Tm9kZTtcbiAgICAgICAgICAgICAgICB3YWxrZWROb2Rlcy5wdXNoKG5vZGUpO1xuICAgICAgICAgICAgfSB3aGlsZSAod2Fsa2VyPy5uZXh0Tm9kZT8uKCkpO1xuICAgICAgICB9KTtcblxuICAgICAgICAvL1xuICAgICAgICB3YWxrZWROb2Rlcz8uZmlsdGVyPy4oKG5vZGU6IGFueSkgPT4gbm9kZT8ubm9kZVR5cGUgPT0gTm9kZS5DT01NRU5UX05PREUpPy5mb3JFYWNoPy4oKG5vZGU6IGFueSkgPT4ge1xuICAgICAgICAgICAgaWYgKG5vZGU/Lm5vZGVWYWx1ZT8udHJpbT8uKCk/LmluY2x1ZGVzPy4oXCJvOlwiKSAmJiBOdW1iZXIuaXNJbnRlZ2VyKHBhcnNlSW50KG5vZGU/Lm5vZGVWYWx1ZT8udHJpbT8uKCk/LnNsaWNlPy4oMikgPz8gXCItMVwiKSkpIHtcbiAgICAgICAgICAgICAgICBsZXQgZWw6IGFueSA9IHBzaD8uW3BhcnNlSW50KG5vZGU/Lm5vZGVWYWx1ZT8udHJpbT8uKCk/LnNsaWNlPy4oMikgPz8gXCItMVwiKSA/PyAtMV07XG5cbiAgICAgICAgICAgICAgICAvLyBtYWtlIGl0ZXJhdGFibGUgYXJyYXkgYW5kIHNldFxuICAgICAgICAgICAgICAgIGlmIChlbCA9PSBudWxsIHx8IGVsID09PSB1bmRlZmluZWQgfHwgKHR5cGVvZiBlbCA9PSBcInN0cmluZ1wiID8gZWwgOiBudWxsKT8udHJpbT8uKCkgPT0gXCJcIikge1xuICAgICAgICAgICAgICAgICAgICBub2RlPy5yZW1vdmU/LigpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0ICRwYXJlbnQgPSBub2RlPy5wYXJlbnROb2RlO1xuICAgICAgICAgICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShlbCkgfHwgZWwgaW5zdGFuY2VvZiBNYXAgfHwgZWwgaW5zdGFuY2VvZiBTZXQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlcGxhY2VOb2RlPy4oJHBhcmVudCwgbm9kZSwgZWwgPSBNKGVsLCBudWxsLCAkcGFyZW50KSk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZVxuICAgICAgICAgICAgICAgICAgICBpZiAoZWwgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVwbGFjZU5vZGU/LigkcGFyZW50LCBub2RlLCBlbCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIHJlbW92ZSBjb21tZW50IG5vZGUgaWYgaXQgaXMgY29ubmVjdGVkXG4gICAgICAgICAgICBpZiAobm9kZT8uaXNDb25uZWN0ZWQpIHtcbiAgICAgICAgICAgICAgICBub2RlPy5yZW1vdmU/LigpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAvL1xuICAgICAgICB3YWxrZWROb2Rlcz8uZmlsdGVyKChub2RlOiBhbnkpID0+IG5vZGUubm9kZVR5cGUgPT0gTm9kZS5FTEVNRU5UX05PREUpPy5tYXA/Ligobm9kZSkgPT4ge1xuICAgICAgICAgICAgY29ubmVjdEVsZW1lbnQobm9kZSBhcyBIVE1MRWxlbWVudCwgYXRiLCBwc2gsIG1hcHBlZCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIEZpbmFsIHdoaXRlc3BhY2UgY2xlYW51cCB0byBlbnN1cmUgOmVtcHR5IHdvcmtzIGV2ZW4gYWZ0ZXIgZHluYW1pYyBpbnNlcnRpb25zXG4gICAgICAgIHJldHVybiBBcnJheS5mcm9tKGZyYWc/LmNoaWxkTm9kZXMpPy5sZW5ndGggPiAxID8gZnJhZyA6IGZyYWc/LmNoaWxkTm9kZXM/LlswXTtcbiAgICB9O1xufVxuXG4vL1xuZXhwb3J0IGNvbnN0IEggPSAoc3RyOiBhbnksIC4uLnZhbHVlczogYW55W10pID0+IHtcbiAgICAvL2lmICh0eXBlb2Ygc3RyID09IFwib2JqZWN0XCIgJiYgaGFzVmFsdWUoc3RyKSkgcmV0dXJuIEMoc3RyKTtcbiAgICBpZiAodHlwZW9mIHN0ciA9PSBcInN0cmluZ1wiKSB7XG4gICAgICAgIGlmIChzdHI/LnRyaW0/LigpPy5zdGFydHNXaXRoPy4oXCI8XCIpICYmIHN0cj8udHJpbT8uKCk/LmVuZHNXaXRoPy4oXCI+XCIpKSB7XG4gICAgICAgICAgICBjb25zdCBwYXJzZXIgPSBuZXcgRE9NUGFyc2VyKCksIGRvYyA9IHBhcnNlci5wYXJzZUZyb21TdHJpbmcoY2xlYW51cEludGVyVGFnV2hpdGVzcGFjZUFuZEluZGVudChzdHI/LnRyaW0/LigpKSwgXCJ0ZXh0L2h0bWxcIik7XG4gICAgICAgICAgICBjb25zdCBiYXNpcyA9IGRvYy5xdWVyeVNlbGVjdG9yKFwidGVtcGxhdGVcIik/LmNvbnRlbnQgPz8gZG9jLmJvZHk7XG4gICAgICAgICAgICAvLyBOb3JtYWxpemUgYW5kIGNsZWFuIHdoaXRlc3BhY2Utb25seSB0ZXh0IG5vZGVzIGJldHdlZW4gdGFnc1xuICAgICAgICAgICAgaWYgKGJhc2lzIGluc3RhbmNlb2YgSFRNTEJvZHlFbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgY29uc3QgZnJhZyA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTtcbiAgICAgICAgICAgICAgICBmcmFnLmFwcGVuZCguLi5BcnJheS5mcm9tKGJhc2lzLmNoaWxkTm9kZXMgPz8gW10pKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gKEFycmF5LmZyb20oZnJhZy5jaGlsZE5vZGVzKT8ubGVuZ3RoID4gMSA/IGZyYWcgOiBmcmFnPy5jaGlsZE5vZGVzPy5bMF0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGJhc2lzIGluc3RhbmNlb2YgRG9jdW1lbnRGcmFnbWVudCkgeyByZXR1cm4gYmFzaXM7IH1cbiAgICAgICAgICAgIGlmIChiYXNpcz8uY2hpbGROb2Rlcz8ubGVuZ3RoID4gMSkgeyBjb25zdCBmcmFnID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpOyBmcmFnLmFwcGVuZCguLi5BcnJheS5mcm9tKGJhc2lzPy5jaGlsZE5vZGVzID8/IFtdKSk7IHJldHVybiBmcmFnOyB9XG4gICAgICAgICAgICByZXR1cm4gYmFzaXM/LmNoaWxkTm9kZXM/LlswXSA/PyAobmV3IFRleHQoc3RyKSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5ldyBUZXh0KHN0cik7XG4gICAgfSBlbHNlXG4gICAgaWYgKHR5cGVvZiBzdHIgPT0gXCJmdW5jdGlvblwiKSB7IHJldHVybiBIKHN0cj8uKCkpOyB9IGVsc2VcbiAgICBpZiAoQXJyYXkuaXNBcnJheShzdHIpICYmIHZhbHVlcykgeyByZXR1cm4gaHRtbChzdHIsIC4uLnZhbHVlcyk7IH0gZWxzZVxuICAgIGlmIChzdHIgaW5zdGFuY2VvZiBOb2RlKSB7IHJldHVybiBzdHI7IH07XG4gICAgcmV0dXJuIGdldE5vZGUoc3RyKTtcbn1cblxuLy9cbmV4cG9ydCBkZWZhdWx0IEg7XG4iXX0=