import { E } from "./Bindings";
import { M } from "./Mapped";
import { I } from "./Switched";
import { Q } from "./Queried";
import { bindEvent } from "fest/core";
//
export const createElement = (type, props = {}, children, ...others) => {
    let normalized = {}, ref;
    let attributes = {}, properties = {}, classList = {}, style = {}, ctrls = {}, on = {};
    //
    for (const i in props) {
        if (i == 'ref') {
            if (typeof type != 'function') {
                ref = typeof props[i] != 'function' ? props[i] : Q(props[i]);
            }
        }
        else if (i == 'classList') {
            classList = props[i];
        }
        else if (i == 'style') {
            style = props[i];
        }
        else 
        //
        if (i?.startsWith?.("@")) {
            const name = i.replace("@", "").trim();
            if (name) {
                bindEvent(on, name, props[i]);
            }
            else {
                on = props[i];
            }
        }
        else if (i?.startsWith?.("on:")) {
            const name = i.replace("on:", "").trim();
            if (name) {
                bindEvent(on, name, props[i]);
            }
            else {
                on = props[i];
            }
        }
        else if (i?.startsWith?.("prop:")) {
            const name = i.replace("prop:", "").trim();
            if (name) {
                properties[name] = props[i];
            }
            else {
                properties = props[i];
            }
        }
        else if (i?.startsWith?.("attr:")) {
            const name = i.replace("attr:", "").trim();
            if (name) {
                attributes[name] = props[i];
            }
            else {
                attributes = props[i];
            }
        }
        else if (i?.startsWith?.("ctrl:")) {
            const name = i.replace("ctrl:", "").trim();
            if (name) {
                ctrls.set(name, props[i]);
            }
            else {
                ctrls = props[i];
            }
        }
        else {
            attributes[i.trim()] = props[i];
        }
    }
    ;
    //
    Object.assign(normalized, {
        attributes,
        properties,
        classList,
        style,
        on,
    });
    //
    const $children = Array.isArray(children) ? children :
        (others?.length > 0 ? [children, ...others] :
            (((typeof children == "object" || typeof children == "function") && !(children instanceof Node) || children instanceof DocumentFragment) ? children : [children]));
    //
    if (typeof type == "function") {
        return type(props, $children);
    }
    if (type == "For") {
        return M(props, $children);
    }
    if (type == "Switch") {
        return I(props, $children);
    }
    //
    const element = E(type, normalized, $children);
    if (!element)
        return element;
    Promise.try(() => { if (ref) {
        if (typeof ref == "function") {
            ref?.(element);
        }
        else {
            ref.value = element;
        }
    } })?.catch?.(console.warn.bind(console));
    return element;
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiSlNYLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiSlNYLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxDQUFDLEVBQUUsTUFBTSxZQUFZLENBQUM7QUFDL0IsT0FBTyxFQUFFLENBQUMsRUFBRSxNQUFNLFVBQVUsQ0FBQztBQUM3QixPQUFPLEVBQUUsQ0FBQyxFQUFFLE1BQU0sWUFBWSxDQUFDO0FBQy9CLE9BQU8sRUFBRSxDQUFDLEVBQUUsTUFBTSxXQUFXLENBQUM7QUFDOUIsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLFdBQVcsQ0FBQztBQUV0QyxFQUFFO0FBQ0YsTUFBTSxDQUFDLE1BQU0sYUFBYSxHQUFHLENBQUMsSUFBb0YsRUFBRSxRQUFhLEVBQUUsRUFBRSxRQUF5QixFQUFFLEdBQUcsTUFBc0IsRUFBQyxFQUFFO0lBQ3hMLElBQUksVUFBVSxHQUFRLEVBQUUsRUFBRSxHQUFHLENBQUM7SUFDOUIsSUFBSSxVQUFVLEdBQVEsRUFBRSxFQUFFLFVBQVUsR0FBUSxFQUFFLEVBQUUsU0FBUyxHQUFRLEVBQUUsRUFBRSxLQUFLLEdBQVEsRUFBRSxFQUFFLEtBQUssR0FBUSxFQUFFLEVBQUUsRUFBRSxHQUFRLEVBQUUsQ0FBQztJQUVwSCxFQUFFO0lBQ0YsS0FBSyxNQUFNLENBQUMsSUFBSSxLQUFLLEVBQUUsQ0FBQztRQUNwQixJQUFJLENBQUMsSUFBSSxLQUFLLEVBQUUsQ0FBQztZQUNiLElBQUksT0FBTyxJQUFJLElBQUksVUFBVSxFQUFFLENBQUM7Z0JBQzVCLEdBQUcsR0FBRyxPQUFPLEtBQUssQ0FBQyxDQUFDLENBQUMsSUFBSSxVQUFVLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ2pFLENBQUM7UUFDTCxDQUFDO2FBQ0QsSUFBSSxDQUFDLElBQUksV0FBVyxFQUFFLENBQUM7WUFBQyxTQUFTLEdBQUcsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQUMsQ0FBQzthQUMvQyxJQUFJLENBQUMsSUFBSSxPQUFPLEVBQUUsQ0FBQztZQUFDLEtBQUssR0FBRyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFBQyxDQUFDOztRQUV2QyxFQUFFO1FBQ0YsSUFBSSxDQUFDLEVBQUUsVUFBVSxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQU0sQ0FBQztZQUFDLE1BQU0sSUFBSSxHQUFHLENBQUMsQ0FBQyxPQUFPLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDO1lBQUcsSUFBSSxJQUFJLEVBQUUsQ0FBQztnQkFBQyxTQUFTLENBQUMsRUFBRSxFQUFFLElBQUksRUFBRSxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUFDLENBQUM7aUJBQU0sQ0FBQztnQkFBQyxFQUFFLEdBQUcsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQUMsQ0FBQztRQUFDLENBQUM7YUFDaEosSUFBSSxDQUFDLEVBQUUsVUFBVSxFQUFFLENBQUMsS0FBSyxDQUFDLEVBQUksQ0FBQztZQUFDLE1BQU0sSUFBSSxHQUFHLENBQUMsQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDO1lBQUMsSUFBSSxJQUFJLEVBQUUsQ0FBQztnQkFBQyxTQUFTLENBQUMsRUFBRSxFQUFFLElBQUksRUFBRSxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUFDLENBQUM7aUJBQU0sQ0FBQztnQkFBQyxFQUFFLEdBQUcsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQUMsQ0FBQztRQUFDLENBQUM7YUFDaEosSUFBSSxDQUFDLEVBQUUsVUFBVSxFQUFFLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQztZQUFDLE1BQU0sSUFBSSxHQUFHLENBQUMsQ0FBQyxPQUFPLENBQUMsT0FBTyxFQUFFLEVBQUUsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDO1lBQUMs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QUUsRUFBRSxHQUFFLElBQUksR0FBRyxFQUFFLENBQUM7UUFBQyxJQUFJLE9BQU8sR0FBRyxJQUFJLFVBQVUsRUFBRSxDQUFDO1lBQUMsR0FBRyxFQUFFLENBQUMsT0FBTyxDQUFDLENBQUM7UUFBQyxDQUFDO2FBQU0sQ0FBQztZQUFDLEdBQUcsQ0FBQyxLQUFLLEdBQUcsT0FBTyxDQUFDO1FBQUMsQ0FBQztJQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxLQUFLLEVBQUUsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO0lBQ3ZKLE9BQU8sT0FBTyxDQUFDO0FBQ25CLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEUgfSBmcm9tIFwiLi9CaW5kaW5nc1wiO1xuaW1wb3J0IHsgTSB9IGZyb20gXCIuL01hcHBlZFwiO1xuaW1wb3J0IHsgSSB9IGZyb20gXCIuL1N3aXRjaGVkXCI7XG5pbXBvcnQgeyBRIH0gZnJvbSBcIi4vUXVlcmllZFwiO1xuaW1wb3J0IHsgYmluZEV2ZW50IH0gZnJvbSBcImZlc3QvY29yZVwiO1xuXG4vL1xuZXhwb3J0IGNvbnN0IGNyZWF0ZUVsZW1lbnQgPSAodHlwZTogc3RyaW5nIHwgSFRNTEVsZW1lbnQgfCBOb2RlIHwgRG9jdW1lbnRGcmFnbWVudCB8IERvY3VtZW50IHwgRWxlbWVudCB8IEZ1bmN0aW9uLCBwcm9wczogYW55ID0ge30sIGNoaWxkcmVuPzogYW55W118YW55fG51bGwsIC4uLm90aGVyczogYW55W118YW55fG51bGwpPT57XG4gICAgbGV0IG5vcm1hbGl6ZWQ6IGFueSA9IHt9LCByZWY7XG4gICAgbGV0IGF0dHJpYnV0ZXM6IGFueSA9IHt9LCBwcm9wZXJ0aWVzOiBhbnkgPSB7fSwgY2xhc3NMaXN0OiBhbnkgPSB7fSwgc3R5bGU6IGFueSA9IHt9LCBjdHJsczogYW55ID0ge30sIG9uOiBhbnkgPSB7fTtcblxuICAgIC8vXG4gICAgZm9yIChjb25zdCBpIGluIHByb3BzKSB7XG4gICAgICAgIGlmIChpID09ICdyZWYnKSB7XG4gICAgICAgICAgICBpZiAodHlwZW9mIHR5cGUgIT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIHJlZiA9IHR5cGVvZiBwcm9wc1tpXSAhPSAnZnVuY3Rpb24nID8gcHJvcHNbaV0gOiBRKHByb3BzW2ldKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlXG4gICAgICAgIGlmIChpID09ICdjbGFzc0xpc3QnKSB7IGNsYXNzTGlzdCA9IHByb3BzW2ldOyB9IGVsc2VcbiAgICAgICAgaWYgKGkgPT0gJ3N0eWxlJykgeyBzdHlsZSA9IHByb3BzW2ldOyB9IGVsc2VcblxuICAgICAgICAvL1xuICAgICAgICBpZiAoaT8uc3RhcnRzV2l0aD8uKFwiQFwiKSkgICAgIHsgY29uc3QgbmFtZSA9IGkucmVwbGFjZShcIkBcIiwgXCJcIikudHJpbSgpOyAgIGlmIChuYW1lKSB7IGJpbmRFdmVudChvbiwgbmFtZSwgcHJvcHNbaV0pOyB9IGVsc2UgeyBvbiA9IHByb3BzW2ldOyB9IH0gZWxzZVxuICAgICAgICBpZiAoaT8uc3RhcnRzV2l0aD8uKFwib246XCIpKSAgIHsgY29uc3QgbmFtZSA9IGkucmVwbGFjZShcIm9uOlwiLCBcIlwiKS50cmltKCk7IGlmIChuYW1lKSB7IGJpbmRFdmVudChvbiwgbmFtZSwgcHJvcHNbaV0pOyB9IGVsc2UgeyBvbiA9IHByb3BzW2ldOyB9IH0gZWxzZVxuICAgICAgICBpZiAoaT8uc3RhcnRzV2l0aD8uKFwicHJvcDpcIikpIHsgY29uc3QgbmFtZSA9IGkucmVwbGFjZShcInByb3A6XCIsIFwiXCIpLnRyaW0oKTsgaWYgKG5hbWUpIHsgcHJvcGVydGllc1tuYW1lXSA9IHByb3BzW2ldOyB9IGVsc2UgeyBwcm9wZXJ0aWVzID0gcHJvcHNbaV07IH0gfSBlbHNlXG4gICAgICAgIGlmIChpPy5zdGFydHNXaXRoPy4oXCJhdHRyOlwiKSkgeyBjb25zdCBuYW1lID0gaS5yZXBsYWNlKFwiYXR0cjpcIiwgXCJcIikudHJpbSgpOyBpZiAobmFtZSkgeyBhdHRyaWJ1dGVzW25hbWVdID0gcHJvcHNbaV07IH0gZWxzZSB7IGF0dHJpYnV0ZXMgPSBwcm9wc1tpXTsgfSB9IGVsc2VcbiAgICAgICAgaWYgKGk/LnN0YXJ0c1dpdGg/LihcImN0cmw6XCIpKSB7IGNvbnN0IG5hbWUgPSBpLnJlcGxhY2UoXCJjdHJsOlwiLCBcIlwiKS50cmltKCk7IGlmIChuYW1lKSB7IGN0cmxzLnNldChuYW1lLCBwcm9wc1tpXSk7IH0gZWxzZSB7IGN0cmxzID0gcHJvcHNbaV07IH0gfSBlbHNlXG4gICAgICAgICAgICB7IGF0dHJpYnV0ZXNbaS50cmltKCldID0gcHJvcHNbaV07IH1cbiAgICB9O1xuXG4gICAgLy9cbiAgICBPYmplY3QuYXNzaWduKG5vcm1hbGl6ZWQsIHtcbiAgICAgICAgYXR0cmlidXRlcyxcbiAgICAgICAgcHJvcGVydGllcyxcbiAgICAgICAgY2xhc3NMaXN0LFxuICAgICAgICBzdHlsZSxcbiAgICAgICAgb24sXG4gICAgfSk7XG5cbiAgICAvL1xuICAgIGNvbnN0ICRjaGlsZHJlbiA9IEFycmF5LmlzQXJyYXkoY2hpbGRyZW4pID8gY2hpbGRyZW4gOlxuICAgICAgICAob3RoZXJzPy5sZW5ndGggPiAwID8gW2NoaWxkcmVuLCAuLi5vdGhlcnNdIDpcbiAgICAgICAgICAgICgoKHR5cGVvZiBjaGlsZHJlbiA9PSBcIm9iamVjdFwiIHx8IHR5cGVvZiBjaGlsZHJlbiA9PSBcImZ1bmN0aW9uXCIpICYmICEoY2hpbGRyZW4gaW5zdGFuY2VvZiBOb2RlKSB8fCBjaGlsZHJlbiBpbnN0YW5jZW9mIERvY3VtZW50RnJhZ21lbnQpID8gY2hpbGRyZW4gOiBbY2hpbGRyZW5dKSk7XG5cbiAgICAvL1xuICAgIGlmICh0eXBlb2YgdHlwZSA9PSBcImZ1bmN0aW9uXCIpIHsgcmV0dXJuIHR5cGUocHJvcHMsICRjaGlsZHJlbik7IH1cbiAgICBpZiAodHlwZSA9PSBcIkZvclwiKSB7IHJldHVybiBNKHByb3BzLCAkY2hpbGRyZW4pOyB9XG4gICAgaWYgKHR5cGUgPT0gXCJTd2l0Y2hcIikgeyByZXR1cm4gSShwcm9wcywgJGNoaWxkcmVuKTsgfVxuXG4gICAgLy9cbiAgICBjb25zdCBlbGVtZW50ID0gRSh0eXBlLCBub3JtYWxpemVkLCAkY2hpbGRyZW4pOyBpZiAoIWVsZW1lbnQpIHJldHVybiBlbGVtZW50O1xuICAgIFByb21pc2UudHJ5KCgpPT57IGlmIChyZWYpIHsgaWYgKHR5cGVvZiByZWYgPT0gXCJmdW5jdGlvblwiKSB7IHJlZj8uKGVsZW1lbnQpOyB9IGVsc2UgeyByZWYudmFsdWUgPSBlbGVtZW50OyB9IH0gfSk/LmNhdGNoPy4oY29uc29sZS53YXJuLmJpbmQoY29uc29sZSkpO1xuICAgIHJldHVybiBlbGVtZW50O1xufVxuIl19