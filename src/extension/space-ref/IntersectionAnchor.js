import { numberRef, addToCallChain } from "fest/object";
import { addEvent, getBoundingOrientRect } from "fest/dom";
//
const computeIntersectionRect = (anchor, root = document.documentElement, includeExtendedInfo = false) => {
    // Get root rectangle (viewport or container)
    const rootRect = getBoundingOrientRect(root) ?? root?.getBoundingClientRect?.();
    // Get anchor element rectangle
    const anchorRect = getBoundingOrientRect(anchor) ?? anchor?.getBoundingClientRect?.();
    if (!anchorRect) {
        return includeExtendedInfo ? {
            intersection: { left: 0, top: 0, right: 0, bottom: 0, width: 0, height: 0 },
            anchor: { left: 0, top: 0, width: 0, height: 0 },
            root: rootRect
        } : { left: 0, top: 0, right: 0, bottom: 0, width: 0, height: 0 };
    }
    // Calculate intersection rectangle
    const intersectionLeft = Math.max(rootRect.left, anchorRect.left);
    const intersectionTop = Math.max(rootRect.top, anchorRect.top);
    const intersectionRight = Math.min(rootRect.right, anchorRect.right);
    const intersectionBottom = Math.min(rootRect.bottom, anchorRect.bottom);
    // Check if there's actually an intersection
    const hasIntersection = intersectionRight > intersectionLeft && intersectionBottom > intersectionTop;
    const intersection = hasIntersection ? {
        left: intersectionLeft,
        top: intersectionTop,
        right: intersectionRight,
        bottom: intersectionBottom,
        width: intersectionRight - intersectionLeft,
        height: intersectionBottom - intersectionTop
    } : { left: 0, top: 0, right: 0, bottom: 0, width: 0, height: 0 };
    if (includeExtendedInfo) {
        return {
            intersection,
            anchor: anchorRect,
            root: rootRect,
            // Additional properties for shadow/filter calculations
            anchorLeft: anchorRect.left,
            anchorTop: anchorRect.top,
            anchorRight: anchorRect.right,
            anchorBottom: anchorRect.bottom,
            anchorWidth: anchorRect.width,
            anchorHeight: anchorRect.height,
            rootLeft: rootRect.left,
            rootTop: rootRect.top,
            rootWidth: rootRect.width,
            rootHeight: rootRect.height
        };
    }
    return intersection;
};
// may be used for underlying dynamic shadows and clipping masks
export function intersectionBoxAnchorRef(anchor, options) {
    if (!anchor)
        return () => { };
    const area = [
        numberRef(0), numberRef(0), numberRef(0), numberRef(0), numberRef(0), numberRef(0)
    ];
    const { root = anchor?.offsetParent ?? document.documentElement, iterateResize = true, iterateMutations = true, iterateIntersection = true } = options || {};
    //
    function updateArea(intersectionRect) {
        const rect = intersectionRect ? {
            left: intersectionRect.left,
            top: intersectionRect.top,
            width: intersectionRect.width,
            height: intersectionRect.height,
            right: intersectionRect.right,
            bottom: intersectionRect.bottom
        } : computeIntersectionRect(anchor, root, false);
        area[0].value = rect?.left ?? 0; // intersection x
        area[1].value = rect?.top ?? 0; // intersection y
        area[2].value = rect?.width ?? 0; // intersection width
        area[3].value = rect?.height ?? 0; // intersection height
        area[4].value = rect?.right ?? 0; // intersection right
        area[5].value = rect?.bottom ?? 0; // intersection bottom
    }
    //
    let resizeObs;
    if (observeResize && "ResizeObserver" in window && typeof ResizeObserver != "undefined") {
        resizeObs = typeof ResizeObserver != "undefined" ? new ResizeObserver((entries) => {
            for (const entry of entries) {
                updateArea(entry.contentRect);
            }
        }) : undefined;
        resizeObs?.observe(anchor);
    }
    //
    let mutationObs;
    if (observeMutations) {
        mutationObs = typeof MutationObserver != "undefined" ? new MutationObserver((mutations) => {
            for (const mutation of mutations) {
                updateArea(computeIntersectionRect(anchor, root, false));
            }
        }) : undefined;
        mutationObs?.observe(anchor, { attributes: true, childList: true, subtree: true });
    }
    //
    let intersectionObs;
    if (observeIntersection) {
        intersectionObs = typeof IntersectionObserver != "undefined" ? new IntersectionObserver((entries) => {
            for (const entry of entries) {
                updateArea(entry.intersectionRect);
            }
        }, {
            root: root instanceof HTMLElement ? root : null,
            threshold: [0],
            rootMargin: "0px"
        }) : undefined;
        intersectionObs?.observe(anchor);
    }
    //
    const listening = [
        addEvent(root, "scroll", () => updateArea(computeIntersectionRect(anchor, root, false)), { capture: true }),
        addEvent(window, "resize", () => updateArea(computeIntersectionRect(anchor, root, false))),
        addEvent(window, "scroll", () => updateArea(computeIntersectionRect(anchor, root, false)), { capture: true })
    ];
    //
    updateArea(computeIntersectionRect(anchor, root, false));
    //
    function destroy() {
        listening.forEach(ub => ub?.());
        resizeObs?.disconnect?.();
        mutationObs?.disconnect?.();
        intersectionObs?.disconnect?.();
    }
    //
    if (destroy) {
        area.forEach(ub => addToCallChain(ub, Symbol.dispose, destroy));
    }
    return area;
}
// Enhanced intersection box anchor with detailed geometry information
export function enhancedIntersectionBoxAnchorRef(anchor, options) {
    if (!anchor)
        return () => { };
    // Extended area array: [ix, iy, iwidth, iheight, iright, ibottom, ax, ay, awidth, aheight, rx, ry, rwidth, rheight]
    const area = [
        numberRef(0), numberRef(0), numberRef(0), numberRef(0), numberRef(0), numberRef(0), // intersection: x, y, width, height, right, bottom
        numberRef(0), numberRef(0), numberRef(0), numberRef(0), // anchor: x, y, width, height
        numberRef(0), numberRef(0), numberRef(0), numberRef(0) // root: x, y, width, height
    ];
    //
    const { root = anchor?.offsetParent ?? document.documentElement, iterateResize = true, iterateMutations = true, iterateIntersection = true } = options || {};
    //
    function updateArea(intersectionRect) {
        const data = intersectionRect ? {
            intersection: {
                left: intersectionRect.left,
                top: intersectionRect.top,
                right: intersectionRect.right,
                bottom: intersectionRect.bottom,
                width: intersectionRect.width,
                height: intersectionRect.height
            },
            anchor: getBoundingOrientRect(anchor) ?? anchor?.getBoundingClientRect?.(),
            root: (root instanceof HTMLElement ? (getBoundingOrientRect(root) ?? root?.getBoundingClientRect?.()) : null) ?? {
                left: 0, top: 0, right: globalThis.innerWidth, bottom: globalThis.innerHeight,
                width: globalThis.innerWidth, height: globalThis.innerHeight
            }
        } : computeIntersectionRect(anchor, root, true);
        if (!data.anchor)
            return;
        // Intersection properties
        area[0].value = data.intersection.left ?? 0; // intersection x
        area[1].value = data.intersection.top ?? 0; // intersection y
        area[2].value = data.intersection.width ?? 0; // intersection width
        area[3].value = data.intersection.height ?? 0; // intersection height
        area[4].value = data.intersection.right ?? 0; // intersection right
        area[5].value = data.intersection.bottom ?? 0; // intersection bottom
        // Anchor properties
        area[6].value = data.anchor.left ?? 0; // anchor x
        area[7].value = data.anchor.top ?? 0; // anchor y
        area[8].value = data.anchor.width ?? 0; // anchor width
        area[9].value = data.anchor.height ?? 0; // anchor height
        // Root properties
        area[10].value = data.root.left ?? 0; // root x
        area[11].value = data.root.top ?? 0; // root y
        area[12].value = data.root.width ?? 0; // root width
        area[13].value = data.root.height ?? 0; // root height
    }
    //
    let resizeObs;
    if (observeResize && "ResizeObserver" in window && typeof ResizeObserver != "undefined") {
        resizeObs = typeof ResizeObserver != "undefined" ? new ResizeObserver((entries) => {
            for (const entry of entries) {
                updateArea(entry.contentRect);
            }
        }) : undefined;
        resizeObs?.observe(anchor);
    }
    //
    let mutationObs;
    if (observeMutations) {
        mutationObs = typeof MutationObserver != "undefined" ? new MutationObserver((mutations) => {
            for (const mutation of mutations) {
                updateArea(computeIntersectionRect(anchor, root, true).intersection);
            }
        }) : undefined;
        mutationObs?.observe(anchor, { attributes: true, childList: true, subtree: true });
    }
    //
    let intersectionObs;
    if (observeIntersection) {
        intersectionObs = typeof IntersectionObserver != "undefined" ? new IntersectionObserver((entries) => {
            for (const entry of entries) {
                updateArea(entry.intersectionRect);
            }
        }, {
            root: root instanceof HTMLElement ? root : null,
            threshold: [0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1.0],
            rootMargin: "0px"
        }) : undefined;
        intersectionObs?.observe(anchor);
    }
    //
    const listening = [
        addEvent(root, "scroll", () => updateArea(computeIntersectionRect(anchor, root, true).intersection), { capture: true }),
        addEvent(window, "resize", () => updateArea(computeIntersectionRect(anchor, root, true).intersection)),
        addEvent(window, "scroll", () => updateArea(computeIntersectionRect(anchor, root, true).intersection), { capture: true })
    ];
    //
    updateArea(computeIntersectionRect(anchor, root, true).intersection);
    //
    function destroy() {
        listening.forEach(ub => ub?.());
        resizeObs?.disconnect?.();
        mutationObs?.disconnect?.();
        intersectionObs?.disconnect?.();
    }
    //
    if (destroy) {
        area.forEach(ub => addToCallChain(ub, Symbol.dispose, destroy));
    }
    return area;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiSW50ZXJzZWN0aW9uQW5jaG9yLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiSW50ZXJzZWN0aW9uQW5jaG9yLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsY0FBYyxFQUFFLE1BQU0sYUFBYSxDQUFDO0FBQ3hELE9BQU8sRUFBRSxRQUFRLEVBQUUscUJBQXFCLEVBQUUsTUFBTSxVQUFVLENBQUM7QUFFM0QsRUFBRTtBQUNGLE1BQU0sdUJBQXVCLEdBQUcsQ0FBQyxNQUFtQixFQUFFLE9BQW9CLFFBQVEsQ0FBQyxlQUFlLEVBQUUsbUJBQW1CLEdBQUcsS0FBSyxFQUFFLEVBQUU7SUFDL0gsNkNBQTZDO0lBQzdDLE1BQU0sUUFBUSxHQUFHLHFCQUFxQixDQUFDLElBQUksQ0FBQyxJQUFJLElBQUksRUFBRSxxQkFBcUIsRUFBRSxFQUFFLENBQUM7SUFFaEYsK0JBQStCO0lBQy9CLE1BQU0sVUFBVSxHQUFHLHFCQUFxQixDQUFDLE1BQU0sQ0FBQyxJQUFJLE1BQU0sRUFBRSxxQkFBcUIsRUFBRSxFQUFFLENBQUM7SUFDdEYsSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFDO1FBQ2QsT0FBTyxtQkFBbUIsQ0FBQyxDQUFDLENBQUM7WUFDekIsWUFBWSxFQUFFLEVBQUUsSUFBSSxFQUFFLENBQUMsRUFBRSxHQUFHLEVBQUUsQ0FBQyxFQUFFLEtBQUssRUFBRSxDQUFDLEVBQUUsTUFBTSxFQUFFLENBQUMsRUFBRSxLQUFLLEVBQUUsQ0FBQyxFQUFFLE1BQU0sRUFBRSxDQUFDLEVBQUU7WUFDM0UsTUFBTSxFQUFFLEVBQUUsSUFBSSxFQUFFLENBQUMsRUFBRSxHQUFHLEVBQUUsQ0FBQyxFQUFFLEtBQUssRUFBRSxDQUFDLEVBQUUsTUFBTSxFQUFFLENBQUMsRUFBRTtZQUNoRCxJQUFJLEVBQUUsUUFBUTtTQUNqQixDQUFDLENBQUMsQ0FBQyxFQUFFLElBQUksRUFBRSxDQUFDLEVBQUUsR0FBRyxFQUFFLENBQUMsRUFB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RUFBRSxDQUFDO1FBQ1YsSUFBSSxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLGNBQWMsQ0FBQyxFQUFFLEVBQUUsTUFBTSxDQUFDLE9BQU8sRUFBRSxPQUFPLENBQUMsQ0FBQyxDQUFDO0lBQ3BFLENBQUM7SUFFRCxPQUFPLElBQUksQ0FBQztBQUNoQixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgbnVtYmVyUmVmLCBhZGRUb0NhbGxDaGFpbiB9IGZyb20gXCJmZXN0L29iamVjdFwiO1xuaW1wb3J0IHsgYWRkRXZlbnQsIGdldEJvdW5kaW5nT3JpZW50UmVjdCB9IGZyb20gXCJmZXN0L2RvbVwiO1xuXG4vL1xuY29uc3QgY29tcHV0ZUludGVyc2VjdGlvblJlY3QgPSAoYW5jaG9yOiBIVE1MRWxlbWVudCwgcm9vdDogSFRNTEVsZW1lbnQgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQsIGluY2x1ZGVFeHRlbmRlZEluZm8gPSBmYWxzZSkgPT4ge1xuICAgIC8vIEdldCByb290IHJlY3RhbmdsZSAodmlld3BvcnQgb3IgY29udGFpbmVyKVxuICAgIGNvbnN0IHJvb3RSZWN0ID0gZ2V0Qm91bmRpbmdPcmllbnRSZWN0KHJvb3QpID8/IHJvb3Q/LmdldEJvdW5kaW5nQ2xpZW50UmVjdD8uKCk7XG5cbiAgICAvLyBHZXQgYW5jaG9yIGVsZW1lbnQgcmVjdGFuZ2xlXG4gICAgY29uc3QgYW5jaG9yUmVjdCA9IGdldEJvdW5kaW5nT3JpZW50UmVjdChhbmNob3IpID8/IGFuY2hvcj8uZ2V0Qm91bmRpbmdDbGllbnRSZWN0Py4oKTtcbiAgICBpZiAoIWFuY2hvclJlY3QpIHtcbiAgICAgICAgcmV0dXJuIGluY2x1ZGVFeHRlbmRlZEluZm8gPyB7XG4gICAgICAgICAgICBpbnRlcnNlY3Rpb246IHsgbGVmdDogMCwgdG9wOiAwLCByaWdodDogMCwgYm90dG9tOiAwLCB3aWR0aDogMCwgaGVpZ2h0OiAwIH0sXG4gICAgICAgICAgICBhbmNob3I6IHsgbGVmdDogMCwgdG9wOiAwLCB3aWR0aDogMCwgaGVpZ2h0OiAwIH0sXG4gICAgICAgICAgICByb290OiByb290UmVjdFxuICAgICAgICB9IDogeyBsZWZ0OiAwLCB0b3A6IDAsIHJpZ2h0OiAwLCBib3R0b206IDAsIHdpZHRoOiAwLCBoZWlnaHQ6IDAgfTtcbiAgICB9XG5cbiAgICAvLyBDYWxjdWxhdGUgaW50ZXJzZWN0aW9uIHJlY3RhbmdsZVxuICAgIGNvbnN0IGludGVyc2VjdGlvbkxlZnQgPSBNYXRoLm1heChyb290UmVjdC5sZWZ0LCBhbmNob3JSZWN0LmxlZnQpO1xuICAgIGNvbnN0IGludGVyc2VjdGlvblRvcCA9IE1hdGgubWF4KHJvb3RSZWN0LnRvcCwgYW5jaG9yUmVjdC50b3ApO1xuICAgIGNvbnN0IGludGVyc2VjdGlvblJpZ2h0ID0gTWF0aC5taW4ocm9vdFJlY3QucmlnaHQsIGFuY2hvclJlY3QucmlnaHQpO1xuICAgIGNvbnN0IGludGVyc2VjdGlvbkJvdHRvbSA9IE1hdGgubWluKHJvb3RSZWN0LmJvdHRvbSwgYW5jaG9yUmVjdC5ib3R0b20pO1xuXG4gICAgLy8gQ2hlY2sgaWYgdGhlcmUncyBhY3R1YWxseSBhbiBpbnRlcnNlY3Rpb25cbiAgICBjb25zdCBoYXNJbnRlcnNlY3Rpb24gPSBpbnRlcnNlY3Rpb25SaWdodCA+IGludGVyc2VjdGlvbkxlZnQgJiYgaW50ZXJzZWN0aW9uQm90dG9tID4gaW50ZXJzZWN0aW9uVG9wO1xuXG4gICAgY29uc3QgaW50ZXJzZWN0aW9uID0gaGFzSW50ZXJzZWN0aW9uID8ge1xuICAgICAgICBsZWZ0OiBpbnRlcnNlY3Rpb25MZWZ0LFxuICAgICAgICB0b3A6IGludGVyc2VjdGlvblRvcCxcbiAgICAgICAgcmlnaHQ6IGludGVyc2VjdGlvblJpZ2h0LFxuICAgICAgICBib3R0b206IGludGVyc2VjdGlvbkJvdHRvbSxcbiAgICAgICAgd2lkdGg6IGludGVyc2VjdGlvblJpZ2h0IC0gaW50ZXJzZWN0aW9uTGVmdCxcbiAgICAgICAgaGVpZ2h0OiBpbnRlcnNlY3Rpb25Cb3R0b20gLSBpbnRlcnNlY3Rpb25Ub3BcbiAgICB9IDogeyBsZWZ0OiAwLCB0b3A6IDAsIHJpZ2h0OiAwLCBib3R0b206IDAsIHdpZHRoOiAwLCBoZWlnaHQ6IDAgfTtcblxuICAgIGlmIChpbmNsdWRlRXh0ZW5kZWRJbmZvKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBpbnRlcnNlY3Rpb24sXG4gICAgICAgICAgICBhbmNob3I6IGFuY2hvclJlY3QsXG4gICAgICAgICAgICByb290OiByb290UmVjdCxcbiAgICAgICAgICAgIC8vIEFkZGl0aW9uYWwgcHJvcGVydGllcyBmb3Igc2hhZG93L2ZpbHRlciBjYWxjdWxhdGlvbnNcbiAgICAgICAgICAgIGFuY2hvckxlZnQ6IGFuY2hvclJlY3QubGVmdCxcbiAgICAgICAgICAgIGFuY2hvclRvcDogYW5jaG9yUmVjdC50b3AsXG4gICAgICAgICAgICBhbmNob3JSaWdodDogYW5jaG9yUmVjdC5yaWdodCxcbiAgICAgICAgICAgIGFuY2hvckJvdHRvbTogYW5jaG9yUmVjdC5ib3R0b20sXG4gICAgICAgICAgICBhbmNob3JXaWR0aDogYW5jaG9yUmVjdC53aWR0aCxcbiAgICAgICAgICAgIGFuY2hvckhlaWdodDogYW5jaG9yUmVjdC5oZWlnaHQsXG4gICAgICAgICAgICByb290TGVmdDogcm9vdFJlY3QubGVmdCxcbiAgICAgICAgICAgIHJvb3RUb3A6IHJvb3RSZWN0LnRvcCxcbiAgICAgICAgICAgIHJvb3RXaWR0aDogcm9vdFJlY3Qud2lkdGgsXG4gICAgICAgICAgICByb290SGVpZ2h0OiByb290UmVjdC5oZWlnaHRcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICByZXR1cm4gaW50ZXJzZWN0aW9uO1xufTtcblxuXG5cbi8vIG1heSBiZSB1c2VkIGZvciB1bmRlcmx5aW5nIGR5bmFtaWMgc2hhZG93cyBhbmQgY2xpcHBpbmcgbWFza3NcbmV4cG9ydCBmdW5jdGlvbiBpbnRlcnNlY3Rpb25Cb3hBbmNob3JSZWYoYW5jaG9yOiBIVE1MRWxlbWVudCwgb3B0aW9ucz86IHtcbiAgICByb290PzogSFRNTEVsZW1lbnQsXG4gICAgb2JzZXJ2ZVJlc2l6ZT86IGJvb2xlYW4sXG4gICAgb2JzZXJ2ZU11dGF0aW9ucz86IGJvb2xlYW4sXG4gICAgb2JzZXJ2ZUludGVyc2VjdGlvbj86IGJvb2xlYW4sXG59KSB7XG4gICAgaWYgKCFhbmNob3IpIHJldHVybiAoKSA9PiB7IH07XG4gICAgY29uc3QgYXJlYSA9IFtcbiAgICAgICAgbnVtYmVyUmVmKDApLCBudW1iZXJSZWYoMCksIG51bWJlclJlZigwKSwgbnVtYmVyUmVmKDApLCBudW1iZXJSZWYoMCksIG51bWJlclJlZigwKVxuICAgIF1cbiAgICBjb25zdCB7IHJvb3QgPSBhbmNob3I/Lm9mZnNldFBhcmVudCA/PyBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQsIGl0ZXJhdGVSZXNpemUgPSB0cnVlLCBpdGVyYXRlTXV0YXRpb25zID0gdHJ1ZSwgaXRlcmF0ZUludGVyc2VjdGlvbiA9IHRydWUgfSA9IG9wdGlvbnMgfHwge307XG5cbiAgICAvL1xuICAgIGZ1bmN0aW9uIHVwZGF0ZUFyZWEoaW50ZXJzZWN0aW9uUmVjdD86IGFueSkge1xuICAgICAgICBjb25zdCByZWN0OiBhbnkgPSBpbnRlcnNlY3Rpb25SZWN0ID8ge1xuICAgICAgICAgICAgbGVmdDogaW50ZXJzZWN0aW9uUmVjdC5sZWZ0LFxuICAgICAgICAgICAgdG9wOiBpbnRlcnNlY3Rpb25SZWN0LnRvcCxcbiAgICAgICAgICAgIHdpZHRoOiBpbnRlcnNlY3Rpb25SZWN0LndpZHRoLFxuICAgICAgICAgICAgaGVpZ2h0OiBpbnRlcnNlY3Rpb25SZWN0LmhlaWdodCxcbiAgICAgICAgICAgIHJpZ2h0OiBpbnRlcnNlY3Rpb25SZWN0LnJpZ2h0LFxuICAgICAgICAgICAgYm90dG9tOiBpbnRlcnNlY3Rpb25SZWN0LmJvdHRvbVxuICAgICAgICB9IDogY29tcHV0ZUludGVyc2VjdGlvblJlY3QoYW5jaG9yIGFzIEhUTUxFbGVtZW50LCByb290IGFzIEhUTUxFbGVtZW50LCBmYWxzZSk7XG4gICAgICAgIGFyZWFbMF0udmFsdWUgPSByZWN0Py5sZWZ0ID8/IDA7IC8vIGludGVyc2VjdGlvbiB4XG4gICAgICAgIGFyZWFbMV0udmFsdWUgPSByZWN0Py50b3AgPz8gMDsgIC8vIGludGVyc2VjdGlvbiB5XG4gICAgICAgIGFyZWFbMl0udmFsdWUgPSByZWN0Py53aWR0aCA/PyAwOyAvLyBpbnRlcnNlY3Rpb24gd2lkdGhcbiAgICAgICAgYXJlYVszXS52YWx1ZSA9IHJlY3Q/LmhlaWdodCA/PyAwOyAvLyBpbnRlcnNlY3Rpb24gaGVpZ2h0XG4gICAgICAgIGFyZWFbNF0udmFsdWUgPSByZWN0Py5yaWdodCA/PyAwOyAgLy8gaW50ZXJzZWN0aW9uIHJpZ2h0XG4gICAgICAgIGFyZWFbNV0udmFsdWUgPSByZWN0Py5ib3R0b20gPz8gMDsgLy8gaW50ZXJzZWN0aW9uIGJvdHRvbVxuICAgIH1cblxuICAgIC8vXG4gICAgbGV0IHJlc2l6ZU9iczogUmVzaXplT2JzZXJ2ZXIgfCB1bmRlZmluZWQ7XG4gICAgaWYgKG9ic2VydmVSZXNpemUgJiYgXCJSZXNpemVPYnNlcnZlclwiIGluIHdpbmRvdyAmJiB0eXBlb2YgUmVzaXplT2JzZXJ2ZXIgIT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgICByZXNpemVPYnMgPSB0eXBlb2YgUmVzaXplT2JzZXJ2ZXIgIT0gXCJ1bmRlZmluZWRcIiA/IG5ldyBSZXNpemVPYnNlcnZlcigoZW50cmllcykgPT4ge1xuICAgICAgICAgICAgZm9yIChjb25zdCBlbnRyeSBvZiBlbnRyaWVzKSB7XG4gICAgICAgICAgICAgICAgdXBkYXRlQXJlYShlbnRyeS5jb250ZW50UmVjdCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pIDogdW5kZWZpbmVkO1xuICAgICAgICByZXNpemVPYnM/Lm9ic2VydmUoYW5jaG9yKTtcbiAgICB9XG5cbiAgICAvL1xuICAgIGxldCBtdXRhdGlvbk9iczogTXV0YXRpb25PYnNlcnZlciB8IHVuZGVmaW5lZDtcbiAgICBpZiAob2JzZXJ2ZU11dGF0aW9ucykge1xuICAgICAgICBtdXRhdGlvbk9icyA9IHR5cGVvZiBNdXRhdGlvbk9ic2VydmVyICE9IFwidW5kZWZpbmVkXCIgPyBuZXcgTXV0YXRpb25PYnNlcnZlcigobXV0YXRpb25zKSA9PiB7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IG11dGF0aW9uIG9mIG11dGF0aW9ucykge1xuICAgICAgICAgICAgICAgIHVwZGF0ZUFyZWEoY29tcHV0ZUludGVyc2VjdGlvblJlY3QoYW5jaG9yIGFzIEhUTUxFbGVtZW50LCByb290IGFzIEhUTUxFbGVtZW50LCBmYWxzZSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KSA6IHVuZGVmaW5lZDtcbiAgICAgICAgbXV0YXRpb25PYnM/Lm9ic2VydmUoYW5jaG9yLCB7IGF0dHJpYnV0ZXM6IHRydWUsIGNoaWxkTGlzdDogdHJ1ZSwgc3VidHJlZTogdHJ1ZSB9KTtcbiAgICB9XG5cbiAgICAvL1xuICAgIGxldCBpbnRlcnNlY3Rpb25PYnM6IEludGVyc2VjdGlvbk9ic2VydmVyIHwgdW5kZWZpbmVkO1xuICAgIGlmIChvYnNlcnZlSW50ZXJzZWN0aW9uKSB7XG4gICAgICAgIGludGVyc2VjdGlvbk9icyA9IHR5cGVvZiBJbnRlcnNlY3Rpb25PYnNlcnZlciAhPSBcInVuZGVmaW5lZFwiID8gbmV3IEludGVyc2VjdGlvbk9ic2VydmVyKChlbnRyaWVzKSA9PiB7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGVudHJ5IG9mIGVudHJpZXMpIHtcbiAgICAgICAgICAgICAgICB1cGRhdGVBcmVhKGVudHJ5LmludGVyc2VjdGlvblJlY3QgYXMgYW55KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwge1xuICAgICAgICAgICAgcm9vdDogcm9vdCBpbnN0YW5jZW9mIEhUTUxFbGVtZW50ID8gcm9vdCA6IG51bGwsXG4gICAgICAgICAgICB0aHJlc2hvbGQ6IFswXSxcbiAgICAgICAgICAgIHJvb3RNYXJnaW46IFwiMHB4XCJcbiAgICAgICAgfSkgOiB1bmRlZmluZWQ7XG4gICAgICAgIGludGVyc2VjdGlvbk9icz8ub2JzZXJ2ZShhbmNob3IpO1xuICAgIH1cblxuICAgIC8vXG4gICAgY29uc3QgbGlzdGVuaW5nID0gW1xuICAgICAgICBhZGRFdmVudChyb290LCBcInNjcm9sbFwiLCAoKSA9PiB1cGRhdGVBcmVhKGNvbXB1dGVJbnRlcnNlY3Rpb25SZWN0KGFuY2hvciBhcyBIVE1MRWxlbWVudCwgcm9vdCBhcyBIVE1MRWxlbWVudCwgZmFsc2UpKSwgeyBjYXB0dXJlOiB0cnVlIH0pLFxuICAgICAgICBhZGRFdmVudCh3aW5kb3csIFwicmVzaXplXCIsICgpID0+IHVwZGF0ZUFyZWEoY29tcHV0ZUludGVyc2VjdGlvblJlY3QoYW5jaG9yIGFzIEhUTUxFbGVtZW50LCByb290IGFzIEhUTUxFbGVtZW50LCBmYWxzZSkpKSxcbiAgICAgICAgYWRkRXZlbnQod2luZG93LCBcInNjcm9sbFwiLCAoKSA9PiB1cGRhdGVBcmVhKGNvbXB1dGVJbnRlcnNlY3Rpb25SZWN0KGFuY2hvciBhcyBIVE1MRWxlbWVudCwgcm9vdCBhcyBIVE1MRWxlbWVudCwgZmFsc2UpKSwgeyBjYXB0dXJlOiB0cnVlIH0pXG4gICAgXTtcblxuICAgIC8vXG4gICAgdXBkYXRlQXJlYShjb21wdXRlSW50ZXJzZWN0aW9uUmVjdChhbmNob3IgYXMgSFRNTEVsZW1lbnQsIHJvb3QgYXMgSFRNTEVsZW1lbnQsIGZhbHNlKSk7XG5cbiAgICAvL1xuICAgIGZ1bmN0aW9uIGRlc3Ryb3koKSB7XG4gICAgICAgIGxpc3RlbmluZy5mb3JFYWNoKHViPT51Yj8uKCkpO1xuICAgICAgICByZXNpemVPYnM/LmRpc2Nvbm5lY3Q/LigpO1xuICAgICAgICBtdXRhdGlvbk9icz8uZGlzY29ubmVjdD8uKCk7XG4gICAgICAgIGludGVyc2VjdGlvbk9icz8uZGlzY29ubmVjdD8uKCk7XG4gICAgfVxuXG4gICAgLy9cbiAgICBpZiAoZGVzdHJveSkge1xuICAgICAgICBhcmVhLmZvckVhY2godWI9PmFkZFRvQ2FsbENoYWluKHViLCBTeW1ib2wuZGlzcG9zZSwgZGVzdHJveSkpO1xuICAgIH1cbiAgICByZXR1cm4gYXJlYTtcbn1cblxuXG4vLyBFbmhhbmNlZCBpbnRlcnNlY3Rpb24gYm94IGFuY2hvciB3aXRoIGRldGFpbGVkIGdlb21ldHJ5IGluZm9ybWF0aW9uXG5leHBvcnQgZnVuY3Rpb24gZW5oYW5jZWRJbnRlcnNlY3Rpb25Cb3hBbmNob3JSZWYoYW5jaG9yOiBIVE1MRWxlbWVudCwgb3B0aW9ucz86IHtcbiAgICByb290PzogSFRNTEVsZW1lbnQsXG4gICAgb2JzZXJ2ZVJlc2l6ZT86IGJvb2xlYW4sXG4gICAgb2JzZXJ2ZU11dGF0aW9ucz86IGJvb2xlYW4sXG4gICAgb2JzZXJ2ZUludGVyc2VjdGlvbj86IGJvb2xlYW4sXG59KSB7XG4gICAgaWYgKCFhbmNob3IpIHJldHVybiAoKSA9PiB7IH07XG5cbiAgICAvLyBFeHRlbmRlZCBhcmVhIGFycmF5OiBbaXgsIGl5LCBpd2lkdGgsIGloZWlnaHQsIGlyaWdodCwgaWJvdHRvbSwgYXgsIGF5LCBhd2lkdGgsIGFoZWlnaHQsIHJ4LCByeSwgcndpZHRoLCByaGVpZ2h0XVxuICAgIGNvbnN0IGFyZWEgPSBbXG4gICAgICAgIG51bWJlclJlZigwKSwgbnVtYmVyUmVmKDApLCBudW1iZXJSZWYoMCksIG51bWJlclJlZigwKSwgbnVtYmVyUmVmKDApLCBudW1iZXJSZWYoMCksIC8vIGludGVyc2VjdGlvbjogeCwgeSwgd2lkdGgsIGhlaWdodCwgcmlnaHQsIGJvdHRvbVxuICAgICAgICBudW1iZXJSZWYoMCksIG51bWJlclJlZigwKSwgbnVtYmVyUmVmKDApLCBudW1iZXJSZWYoMCksIC8vIGFuY2hvcjogeCwgeSwgd2lkdGgsIGhlaWdodFxuICAgICAgICBudW1iZXJSZWYoMCksIG51bWJlclJlZigwKSwgbnVtYmVyUmVmKDApLCBudW1iZXJSZWYoMCkgIC8vIHJvb3Q6IHgsIHksIHdpZHRoLCBoZWlnaHRcbiAgICBdO1xuXG4gICAgLy9cbiAgICBjb25zdCB7IHJvb3QgPSBhbmNob3I/Lm9mZnNldFBhcmVudCA/PyBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQsIGl0ZXJhdGVSZXNpemUgPSB0cnVlLCBpdGVyYXRlTXV0YXRpb25zID0gdHJ1ZSwgaXRlcmF0ZUludGVyc2VjdGlvbiA9IHRydWUgfSA9IG9wdGlvbnMgfHwge307XG5cbiAgICAvL1xuICAgIGZ1bmN0aW9uIHVwZGF0ZUFyZWEoaW50ZXJzZWN0aW9uUmVjdD86IGFueSkge1xuICAgICAgICBjb25zdCBkYXRhID0gaW50ZXJzZWN0aW9uUmVjdCA/IHtcbiAgICAgICAgICAgIGludGVyc2VjdGlvbjoge1xuICAgICAgICAgICAgICAgIGxlZnQ6IGludGVyc2VjdGlvblJlY3QubGVmdCxcbiAgICAgICAgICAgICAgICB0b3A6IGludGVyc2VjdGlvblJlY3QudG9wLFxuICAgICAgICAgICAgICAgIHJpZ2h0OiBpbnRlcnNlY3Rpb25SZWN0LnJpZ2h0LFxuICAgICAgICAgICAgICAgIGJvdHRvbTogaW50ZXJzZWN0aW9uUmVjdC5ib3R0b20sXG4gICAgICAgICAgICAgICAgd2lkdGg6IGludGVyc2VjdGlvblJlY3Qud2lkdGgsXG4gICAgICAgICAgICAgICAgaGVpZ2h0OiBpbnRlcnNlY3Rpb25SZWN0LmhlaWdodFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGFuY2hvcjogZ2V0Qm91bmRpbmdPcmllbnRSZWN0KGFuY2hvcikgPz8gYW5jaG9yPy5nZXRCb3VuZGluZ0NsaWVudFJlY3Q/LigpLFxuICAgICAgICAgICAgcm9vdDogKHJvb3QgaW5zdGFuY2VvZiBIVE1MRWxlbWVudCA/IChnZXRCb3VuZGluZ09yaWVudFJlY3Qocm9vdCkgPz8gcm9vdD8uZ2V0Qm91bmRpbmdDbGllbnRSZWN0Py4oKSkgOiBudWxsKSA/PyB7XG4gICAgICAgICAgICAgICAgbGVmdDogMCwgdG9wOiAwLCByaWdodDogZ2xvYmFsVGhpcy5pbm5lcldpZHRoLCBib3R0b206IGdsb2JhbFRoaXMuaW5uZXJIZWlnaHQsXG4gICAgICAgICAgICAgICAgd2lkdGg6IGdsb2JhbFRoaXMuaW5uZXJXaWR0aCwgaGVpZ2h0OiBnbG9iYWxUaGlzLmlubmVySGVpZ2h0XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gOiBjb21wdXRlSW50ZXJzZWN0aW9uUmVjdChhbmNob3IgYXMgSFRNTEVsZW1lbnQsIHJvb3QgYXMgSFRNTEVsZW1lbnQsIHRydWUpO1xuXG4gICAgICAgIGlmICghZGF0YS5hbmNob3IpIHJldHVybjtcblxuICAgICAgICAvLyBJbnRlcnNlY3Rpb24gcHJvcGVydGllc1xuICAgICAgICBhcmVhWzBdLnZhbHVlID0gZGF0YS5pbnRlcnNlY3Rpb24ubGVmdCA/PyAwOyAgICAgLy8gaW50ZXJzZWN0aW9uIHhcbiAgICAgICAgYXJlYVsxXS52YWx1ZSA9IGRhdGEuaW50ZXJzZWN0aW9uLnRvcCA/PyAwOyAgICAgIC8vIGludGVyc2VjdGlvbiB5XG4gICAgICAgIGFyZWFbMl0udmFsdWUgPSBkYXRhLmludGVyc2VjdGlvbi53aWR0aCA/PyAwOyAgICAvLyBpbnRlcnNlY3Rpb24gd2lkdGhcbiAgICAgICAgYXJlYVszXS52YWx1ZSA9IGRhdGEuaW50ZXJzZWN0aW9uLmhlaWdodCA/PyAwOyAgIC8vIGludGVyc2VjdGlvbiBoZWlnaHRcbiAgICAgICAgYXJlYVs0XS52YWx1ZSA9IGRhdGEuaW50ZXJzZWN0aW9uLnJpZ2h0ID8/IDA7ICAgIC8vIGludGVyc2VjdGlvbiByaWdodFxuICAgICAgICBhcmVhWzVdLnZhbHVlID0gZGF0YS5pbnRlcnNlY3Rpb24uYm90dG9tID8/IDA7ICAgLy8gaW50ZXJzZWN0aW9uIGJvdHRvbVxuXG4gICAgICAgIC8vIEFuY2hvciBwcm9wZXJ0aWVzXG4gICAgICAgIGFyZWFbNl0udmFsdWUgPSBkYXRhLmFuY2hvci5sZWZ0ID8/IDA7ICAgICAgICAgICAvLyBhbmNob3IgeFxuICAgICAgICBhcmVhWzddLnZhbHVlID0gZGF0YS5hbmNob3IudG9wID8/IDA7ICAgICAgICAgICAgLy8gYW5jaG9yIHlcbiAgICAgICAgYXJlYVs4XS52YWx1ZSA9IGRhdGEuYW5jaG9yLndpZHRoID8/IDA7ICAgICAgICAgIC8vIGFuY2hvciB3aWR0aFxuICAgICAgICBhcmVhWzldLnZhbHVlID0gZGF0YS5hbmNob3IuaGVpZ2h0ID8/IDA7ICAgICAgICAgLy8gYW5jaG9yIGhlaWdodFxuXG4gICAgICAgIC8vIFJvb3QgcHJvcGVydGllc1xuICAgICAgICBhcmVhWzEwXS52YWx1ZSA9IGRhdGEucm9vdC5sZWZ0ID8/IDA7ICAgICAgICAgICAgLy8gcm9vdCB4XG4gICAgICAgIGFyZWFbMTFdLnZhbHVlID0gZGF0YS5yb290LnRvcCA/PyAwOyAgICAgICAgICAgICAvLyByb290IHlcbiAgICAgICAgYXJlYVsxMl0udmFsdWUgPSBkYXRhLnJvb3Qud2lkdGggPz8gMDsgICAgICAgICAgIC8vIHJvb3Qgd2lkdGhcbiAgICAgICAgYXJlYVsxM10udmFsdWUgPSBkYXRhLnJvb3QuaGVpZ2h0ID8/IDA7ICAgICAgICAgIC8vIHJvb3QgaGVpZ2h0XG4gICAgfVxuXG4gICAgLy9cbiAgICBsZXQgcmVzaXplT2JzOiBSZXNpemVPYnNlcnZlciB8IHVuZGVmaW5lZDtcbiAgICBpZiAob2JzZXJ2ZVJlc2l6ZSAmJiBcIlJlc2l6ZU9ic2VydmVyXCIgaW4gd2luZG93ICYmIHR5cGVvZiBSZXNpemVPYnNlcnZlciAhPSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgIHJlc2l6ZU9icyA9IHR5cGVvZiBSZXNpemVPYnNlcnZlciAhPSBcInVuZGVmaW5lZFwiID8gbmV3IFJlc2l6ZU9ic2VydmVyKChlbnRyaWVzKSA9PiB7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGVudHJ5IG9mIGVudHJpZXMpIHtcbiAgICAgICAgICAgICAgICB1cGRhdGVBcmVhKGVudHJ5LmNvbnRlbnRSZWN0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSkgOiB1bmRlZmluZWQ7XG4gICAgICAgIHJlc2l6ZU9icz8ub2JzZXJ2ZShhbmNob3IpO1xuICAgIH1cblxuICAgIC8vXG4gICAgbGV0IG11dGF0aW9uT2JzOiBNdXRhdGlvbk9ic2VydmVyIHwgdW5kZWZpbmVkO1xuICAgIGlmIChvYnNlcnZlTXV0YXRpb25zKSB7XG4gICAgICAgIG11dGF0aW9uT2JzID0gdHlwZW9mIE11dGF0aW9uT2JzZXJ2ZXIgIT0gXCJ1bmRlZmluZWRcIiA/IG5ldyBNdXRhdGlvbk9ic2VydmVyKChtdXRhdGlvbnMpID0+IHtcbiAgICAgICAgICAgIGZvciAoY29uc3QgbXV0YXRpb24gb2YgbXV0YXRpb25zKSB7XG4gICAgICAgICAgICAgICAgdXBkYXRlQXJlYShjb21wdXRlSW50ZXJzZWN0aW9uUmVjdChhbmNob3IgYXMgSFRNTEVsZW1lbnQsIHJvb3QgYXMgSFRNTEVsZW1lbnQsIHRydWUpLmludGVyc2VjdGlvbik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pIDogdW5kZWZpbmVkO1xuICAgICAgICBtdXRhdGlvbk9icz8ub2JzZXJ2ZShhbmNob3IsIHsgYXR0cmlidXRlczogdHJ1ZSwgY2hpbGRMaXN0OiB0cnVlLCBzdWJ0cmVlOiB0cnVlIH0pO1xuICAgIH1cblxuICAgIC8vXG4gICAgbGV0IGludGVyc2VjdGlvbk9iczogSW50ZXJzZWN0aW9uT2JzZXJ2ZXIgfCB1bmRlZmluZWQ7XG4gICAgaWYgKG9ic2VydmVJbnRlcnNlY3Rpb24pIHtcbiAgICAgICAgaW50ZXJzZWN0aW9uT2JzID0gdHlwZW9mIEludGVyc2VjdGlvbk9ic2VydmVyICE9IFwidW5kZWZpbmVkXCIgPyBuZXcgSW50ZXJzZWN0aW9uT2JzZXJ2ZXIoKGVudHJpZXMpID0+IHtcbiAgICAgICAgICAgIGZvciAoY29uc3QgZW50cnkgb2YgZW50cmllcykge1xuICAgICAgICAgICAgICAgIHVwZGF0ZUFyZWEoZW50cnkuaW50ZXJzZWN0aW9uUmVjdCBhcyBhbnkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LCB7XG4gICAgICAgICAgICByb290OiByb290IGluc3RhbmNlb2YgSFRNTEVsZW1lbnQgPyByb290IDogbnVsbCxcbiAgICAgICAgICAgIHRocmVzaG9sZDogWzAsIDAuMSwgMC4yLCAwLjMsIDAuNCwgMC41LCAwLjYsIDAuNywgMC44LCAwLjksIDEuMF0sXG4gICAgICAgICAgICByb290TWFyZ2luOiBcIjBweFwiXG4gICAgICAgIH0pIDogdW5kZWZpbmVkO1xuICAgICAgICBpbnRlcnNlY3Rpb25PYnM/Lm9ic2VydmUoYW5jaG9yKTtcbiAgICB9XG5cbiAgICAvL1xuICAgIGNvbnN0IGxpc3RlbmluZyA9IFtcbiAgICAgICAgYWRkRXZlbnQocm9vdCwgXCJzY3JvbGxcIiwgKCkgPT4gdXBkYXRlQXJlYShjb21wdXRlSW50ZXJzZWN0aW9uUmVjdChhbmNob3IgYXMgSFRNTEVsZW1lbnQsIHJvb3QgYXMgSFRNTEVsZW1lbnQsIHRydWUpLmludGVyc2VjdGlvbiksIHsgY2FwdHVyZTogdHJ1ZSB9KSxcbiAgICAgICAgYWRkRXZlbnQod2luZG93LCBcInJlc2l6ZVwiLCAoKSA9PiB1cGRhdGVBcmVhKGNvbXB1dGVJbnRlcnNlY3Rpb25SZWN0KGFuY2hvciBhcyBIVE1MRWxlbWVudCwgcm9vdCBhcyBIVE1MRWxlbWVudCwgdHJ1ZSkuaW50ZXJzZWN0aW9uKSksXG4gICAgICAgIGFkZEV2ZW50KHdpbmRvdywgXCJzY3JvbGxcIiwgKCkgPT4gdXBkYXRlQXJlYShjb21wdXRlSW50ZXJzZWN0aW9uUmVjdChhbmNob3IgYXMgSFRNTEVsZW1lbnQsIHJvb3QgYXMgSFRNTEVsZW1lbnQsIHRydWUpLmludGVyc2VjdGlvbiksIHsgY2FwdHVyZTogdHJ1ZSB9KVxuICAgIF07XG5cbiAgICAvL1xuICAgIHVwZGF0ZUFyZWEoY29tcHV0ZUludGVyc2VjdGlvblJlY3QoYW5jaG9yIGFzIEhUTUxFbGVtZW50LCByb290IGFzIEhUTUxFbGVtZW50LCB0cnVlKS5pbnRlcnNlY3Rpb24pO1xuXG4gICAgLy9cbiAgICBmdW5jdGlvbiBkZXN0cm95KCkge1xuICAgICAgICBsaXN0ZW5pbmcuZm9yRWFjaCh1YiA9PiB1Yj8uKCkpO1xuICAgICAgICByZXNpemVPYnM/LmRpc2Nvbm5lY3Q/LigpO1xuICAgICAgICBtdXRhdGlvbk9icz8uZGlzY29ubmVjdD8uKCk7XG4gICAgICAgIGludGVyc2VjdGlvbk9icz8uZGlzY29ubmVjdD8uKCk7XG4gICAgfVxuXG4gICAgLy9cbiAgICBpZiAoZGVzdHJveSkge1xuICAgICAgICBhcmVhLmZvckVhY2godWIgPT4gYWRkVG9DYWxsQ2hhaW4odWIsIFN5bWJvbC5kaXNwb3NlLCBkZXN0cm95KSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGFyZWE7XG59XG4iXX0=