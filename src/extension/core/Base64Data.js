const DEFAULT_MIME = "application/octet-stream";
const DATA_URL_RE = /^data:(?<mime>[^;,]+)?(?<params>(?:;[^,]*)*?),(?<data>[\s\S]*)$/i;
function canUseFromBase64() {
    return typeof Uint8Array.fromBase64 === "function";
}
function canUseToBase64(u8) {
    return typeof u8.toBase64 === "function";
}
function tryDecodeURIComponent(s) {
    try {
        return decodeURIComponent(s);
    }
    catch {
        return s;
    }
}
function likelyUriComponent(s) {
    return /%[0-9A-Fa-f]{2}/.test(s) || s.includes("+");
}
function isTextMime(mimeType) {
    const t = (mimeType || "").toLowerCase();
    return (t.startsWith("text/") ||
        t.includes("json") ||
        t.includes("xml") ||
        t.includes("svg") ||
        t.includes("javascript") ||
        t.includes("ecmascript"));
}
function bytesToArrayBuffer(bytes) {
    const buf = bytes.buffer;
    if (buf instanceof ArrayBuffer) {
        return buf.slice(bytes.byteOffset, bytes.byteOffset + bytes.byteLength);
    }
    const ab = new ArrayBuffer(bytes.byteLength);
    new Uint8Array(ab).set(bytes);
    return ab;
}
export function parseDataUrl(input) {
    const s = (input || "").trim();
    if (!s.toLowerCase().startsWith("data:"))
        return null;
    const m = s.match(DATA_URL_RE);
    if (!m?.groups)
        return null;
    const mimeType = (m.groups.mime || DEFAULT_MIME).trim() || DEFAULT_MIME;
    const params = (m.groups.params || "").toLowerCase();
    const isBase64 = params.includes(";base64");
    const data = m.groups.data ?? "";
    return { mimeType, isBase64, data };
}
export function decodeBase64ToBytes(base64, options = {}) {
    const alphabet = options.alphabet || "base64";
    const lastChunkHandling = options.lastChunkHandling || "loose";
    const s = (base64 || "").trim();
    if (canUseFromBase64()) {
        // Modern native: Uint8Array.fromBase64()
        // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array/fromBase64
        return Uint8Array.fromBase64(s, { alphabet, lastChunkHandling });
    }
    // Fallback: atob() for base64 only.
    // For base64url, convert to base64 first.
    const normalized = alphabet === "base64url"
        ? s.replace(/-/g, "+").replace(/_/g, "/")
        : s;
    // pad to multiple of 4
    const padLen = (4 - (normalized.length % 4)) % 4;
    const padded = normalized + "=".repeat(padLen);
    const binary = typeof atob === "function" ? atob(padded) : "";
    const out = new Uint8Array(binary.length);
    for (let i = 0; i < binary.length; i++)
        out[i] = binary.charCodeAt(i);
    return out;
}
export function encodeBytesToBase64(bytes, options = {}) {
    const alphabet = options.alphabet || "base64";
    if (canUseToBase64(bytes)) {
        // Modern native: Uint8Array.prototype.toBase64()
        // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array/toBase64
        return bytes.toBase64({ alphabet });
    }
    // Fallback: btoa() with chunking
    const chunkSize = 0x8000;
    let binary = "";
    for (let i = 0; i < bytes.length; i += chunkSize) {
        binary += String.fromCharCode(...bytes.subarray(i, i + chunkSize));
    }
    const b64 = typeof btoa === "function" ? btoa(binary) : "";
    if (alphabet !== "base64url")
        return b64;
    return b64.replace(/\+/g, "-").replace(/\//g, "_").replace(/=+$/g, "");
}
export async function blobToBytes(blob) {
    const ab = await blob.arrayBuffer();
    return new Uint8Array(ab);
}
export async function blobToText(blob, encoding = "utf-8") {
    // Prefer native Blob.text() when available.
    if (typeof blob.text === "function")
        return await blob.text();
    const bytes = await blobToBytes(blob);
    const dec = new TextDecoder(encoding);
    return dec.decode(bytes);
}
export async function blobToBase64(blob, options = {}) {
    const bytes = await blobToBytes(blob);
    return encodeBytesToBase64(bytes, options);
}
export async function blobToDataUrl(blob, options = {}) {
    const mimeType = (options.mimeType || blob.type || DEFAULT_MIME).trim() || DEFAULT_MIME;
    const wantsBase64 = options.base64 ?? !isTextMime(mimeType);
    if (wantsBase64) {
        const b64 = await blobToBase64(blob, options.base64Options || {});
        return `data:${mimeType};base64,${b64}`;
    }
    const text = await blobToText(blob, options.textEncoding || "utf-8");
    const payload = options.uriComponent ? encodeURIComponent(text) : text;
    return `data:${mimeType},${payload}`;
}
export async function fileToDataUrl(file, options = {}) {
    return await blobToDataUrl(file, options);
}
function looksLikeBase64(s) {
    const t = (s || "").trim();
    if (!t)
        return { isBase64: false, alphabet: "base64" };
    const hasUrlAlphabet = /[-_]/.test(t) && !/[+/]/.test(t);
    const alphabet = hasUrlAlphabet ? "base64url" : "base64";
    const normalized = alphabet === "base64url" ? t.replace(/-/g, "+").replace(/_/g, "/") : t;
    const cleaned = normalized.replace(/[\r\n\s]/g, "");
    const allowed = /^[A-Za-z0-9+/]*={0,2}$/.test(cleaned);
    if (!allowed)
        return { isBase64: false, alphabet };
    // Not perfect; good enough for "try base64 decode"
    if (cleaned.length < 8)
        return { isBase64: false, alphabet };
    return { isBase64: true, alphabet };
}
function canParseUrl(value) {
    try {
        if (typeof URL === "undefined")
            return false;
        if (typeof URL.canParse === "function")
            return URL.canParse(value);
        // Fallback for environments without URL.canParse
        new URL(value);
        return true;
    }
    catch {
        return false;
    }
}
function extensionByMimeType(mimeType) {
    const t = (mimeType || "").toLowerCase().split(";")[0].trim();
    if (!t)
        return "bin";
    const mapped = {
        "text/plain": "txt",
        "text/markdown": "md",
        "text/html": "html",
        "application/json": "json",
        "application/xml": "xml",
        "image/jpeg": "jpg",
        "image/png": "png",
        "image/webp": "webp",
        "image/gif": "gif",
        "image/svg+xml": "svg",
        "application/pdf": "pdf",
    };
    if (mapped[t])
        return mapped[t];
    const slashIdx = t.indexOf("/");
    if (slashIdx <= 0 || slashIdx >= t.length - 1)
        return "bin";
    let subtype = t.slice(slashIdx + 1);
    if (subtype.includes("+"))
        subtype = subtype.split("+")[0];
    if (subtype.includes("."))
        subtype = subtype.split(".").pop() || subtype;
    return subtype || "bin";
}
function fallbackHashHex(bytes) {
    // Non-cryptographic fallback only for environments without SubtleCrypto.
    let h = 2166136261;
    for (let i = 0; i < bytes.length; i++) {
        h ^= bytes[i];
        h = Math.imul(h, 16777619);
    }
    return (h >>> 0).toString(16).padStart(8, "0").repeat(8);
}
async function sha256Hex(bytes) {
    try {
        const subtle = globalThis.crypto?.subtle;
        if (!subtle)
            return fallbackHashHex(bytes);
        const digest = await subtle.digest("SHA-256", bytes);
        const out = new Uint8Array(digest);
        return Array.from(out, (b) => b.toString(16).padStart(2, "0")).join("");
    }
    catch {
        return fallbackHashHex(bytes);
    }
}
export function isBase64Like(input) {
    return looksLikeBase64(input).isBase64;
}
export async function normalizeDataAsset(input, options = {}) {
    const maxBytes = options.maxBytes ?? 50 * 1024 * 1024;
    const namePrefix = (options.namePrefix || "asset").trim() || "asset";
    const preserveFileName = options.preserveFileName ?? false;
    let source = "text";
    let blob;
    let incomingFile = null;
    if (input instanceof File) {
        source = "file";
        incomingFile = input;
        blob = options.mimeType && options.mimeType !== input.type
            ? new Blob([await input.arrayBuffer()], { type: options.mimeType })
            : input;
    }
    else if (input instanceof Blob) {
        source = "blob";
        blob = options.mimeType && options.mimeType !== input.type
            ? new Blob([await input.arrayBuffer()], { type: options.mimeType })
            : input;
    }
    else {
        const raw = (input instanceof URL ? input.toString() : String(input ?? "")).trim();
        const parsed = parseDataUrl(raw);
        const decodedUri = options.uriComponent ? tryDecodeURIComponent(raw) : (likelyUriComponent(raw) ? tryDecodeURIComponent(raw) : raw);
        if (parsed) {
            source = "data-url";
        }
        else if (canParseUrl(raw)) {
            source = "url";
        }
        else if (isBase64Like(raw)) {
            source = "base64";
        }
        else if (decodedUri !== raw && (parseDataUrl(decodedUri) || isBase64Like(decodedUri) || canParseUrl(decodedUri))) {
            source = "uri";
        }
        else {
            source = "text";
        }
        const stringSource = source === "uri" ? decodedUri : raw;
        blob = await stringToBlob(stringSource, {
            mimeType: options.mimeType,
            uriComponent: options.uriComponent,
            isBase64: source === "base64" ? true : undefined,
            maxBytes,
        });
    }
    const bytes = await blobToBytes(blob);
    if (bytes.byteLength > maxBytes)
        throw new Error(`Data too large: ${bytes.byteLength} bytes`);
    const hash = await sha256Hex(bytes);
    const mimeType = (options.mimeType || blob.type || DEFAULT_MIME).trim() || DEFAULT_MIME;
    const extension = extensionByMimeType(mimeType);
    const hashedName = options.filename || `${namePrefix}-${hash.slice(0, 16)}.${extension}`;
    const finalName = preserveFileName && incomingFile?.name ? incomingFile.name : hashedName;
    const file = incomingFile && preserveFileName && !options.mimeType
        ? incomingFile
        : new File([blob], finalName, { type: mimeType });
    return {
        hash,
        name: file.name,
        type: file.type || mimeType,
        size: file.size,
        source,
        file,
    };
}
export async function stringToBlobOrFile(input, options = {}) {
    const maxBytes = options.maxBytes ?? 50 * 1024 * 1024;
    const raw = (input ?? "").trim();
    const parsedDataUrl = parseDataUrl(raw);
    if (parsedDataUrl) {
        const mimeType = options.mimeType || parsedDataUrl.mimeType || DEFAULT_MIME;
        const payload = options.uriComponent ? tryDecodeURIComponent(parsedDataUrl.data) : (likelyUriComponent(parsedDataUrl.data) ? tryDecodeURIComponent(parsedDataUrl.data) : parsedDataUrl.data);
        const isBase64 = options.isBase64 ?? parsedDataUrl.isBase64;
        if (isBase64) {
            const bytes = decodeBase64ToBytes(payload, {
                alphabet: options.base64?.alphabet || "base64",
                lastChunkHandling: options.base64?.lastChunkHandling || "loose",
            });
            if (bytes.byteLength > maxBytes)
                throw new Error(`Decoded data too large: ${bytes.byteLength} bytes`);
            const blob = new Blob([bytesToArrayBuffer(bytes)], { type: mimeType });
            if (!options.asFile)
                return blob;
            return new File([blob], options.filename || "file", { type: mimeType });
        }
        // Non-base64 data URL: treat as URL-encoded bytes/string. We keep it as UTF-8 text by default.
        const blob = new Blob([payload], { type: mimeType });
        if (!options.asFile)
            return blob;
        return new File([blob], options.filename || "file", { type: mimeType });
    }
    // If it's a normal URL, fetch it.
    try {
        if (typeof URL !== "undefined" && URL.canParse?.(raw)) {
            const res = await fetch(raw);
            const blob = await res.blob();
            const mimeType = options.mimeType || blob.type || DEFAULT_MIME;
            const typed = blob.type === mimeType ? blob : new Blob([await blob.arrayBuffer()], { type: mimeType });
            if (!options.asFile)
                return typed;
            return new File([typed], options.filename || "file", { type: mimeType });
        }
    }
    catch {
        // fall through to treat as plain string / base64
    }
    // Plain string case: base64 bytes OR text.
    const maybeDecoded = options.uriComponent ? tryDecodeURIComponent(raw) : (likelyUriComponent(raw) ? tryDecodeURIComponent(raw) : raw);
    const base64Hint = looksLikeBase64(maybeDecoded);
    const isBase64 = options.isBase64 ?? base64Hint.isBase64;
    const mimeType = options.mimeType || (isBase64 ? DEFAULT_MIME : "text/plain;charset=utf-8");
    if (isBase64) {
        const bytes = decodeBase64ToBytes(maybeDecoded, {
            alphabet: options.base64?.alphabet || base64Hint.alphabet,
            lastChunkHandling: options.base64?.lastChunkHandling || "loose",
        });
        if (bytes.byteLength > maxBytes)
            throw new Error(`Decoded data too large: ${bytes.byteLength} bytes`);
        const blob = new Blob([bytesToArrayBuffer(bytes)], { type: mimeType });
        if (!options.asFile)
            return blob;
        return new File([blob], options.filename || "file", { type: mimeType });
    }
    const blob = new Blob([maybeDecoded], { type: mimeType });
    if (!options.asFile)
        return blob;
    return new File([blob], options.filename || "file", { type: mimeType });
}
export async function stringToBlob(input, options = {}) {
    return (await stringToBlobOrFile(input, { ...options, asFile: false }));
}
export async function stringToFile(input, filename, options = {}) {
    return (await stringToBlobOrFile(input, { ...options, asFile: true, filename }));
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQmFzZTY0RGF0YS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIkJhc2U2NERhdGEudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBeUdBLE1BQU0sWUFBWSxHQUFHLDBCQUEwQixDQUFDO0FBRWhELE1BQU0sV0FBVyxHQUFHLGtFQUFrRSxDQUFDO0FBRXZGLFNBQVMsZ0JBQWdCO0lBQ3JCLE9BQU8sT0FBUSxVQUFrQixDQUFDLFVBQVUsS0FBSyxVQUFVLENBQUM7QUFDaEUsQ0FBQztBQUVELFNBQVMsY0FBYyxDQUFDLEVBQWM7SUFDbEMsT0FBTyxPQUFRLEVBQVUsQ0FBQyxRQUFRLEtBQUssVUFBVSxDQUFDO0FBQ3RELENBQUM7QUFFRCxTQUFTLHFCQUFxQixDQUFDLENBQVM7SUFDcEMsSUFBSSxDQUFDO1FBQ0QsT0FBTyxrQkFBa0IsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUNqQyxDQUFDO0lBQUMsTUFBTSxDQUFDO1FBQ0wsT0FBTyxDQUFDLENBQUM7SUFDYixDQUFDO0FBQ0wsQ0FBQztBQUVELFNBQVMsa0JBQWtCLENBQUMsQ0FBUztJQUNqQyxPQUFPLGlCQUFpQixDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0FBQ3hELENBQUM7QUFFRCxTQUFTLFVBQVUsQ0FBQyxRQUFnQjtJQUNoQyxNQUFNLENBQUMsR0FBRyxDQUFDLFFBQVEsSUFBSSxFQUFFLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztJQUN6QyxPQUFPLENBQ0gsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxPQUFPLENBQUM7UUFDckIsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUM7UUFDbEIsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUM7UUFDakIsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUM7UUFDakIsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxZQUFZLENBQUM7UUFDeEIsQ0FBQyxDQUFDLFFBQVEsQ0FB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LElBQUksR0FBRyxJQUFJLElBQUksQ0FBQyxDQUFDLFlBQVksQ0FBQyxFQUFFLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRSxDQUFDLENBQUM7SUFDMUQsSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNO1FBQUUsT0FBTyxJQUFJLENBQUM7SUFDakMsT0FBTyxJQUFJLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLE9BQU8sQ0FBQyxRQUFRLElBQUksTUFBTSxFQUFFLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRSxDQUFDLENBQUM7QUFDNUUsQ0FBQztBQUVELE1BQU0sQ0FBQyxLQUFLLFVBQVUsWUFBWSxDQUFDLEtBQWEsRUFBRSxVQUE4RCxFQUFFO0lBQzlHLE9BQU8sQ0FBQyxNQUFNLGtCQUFrQixDQUFDLEtBQUssRUFBRSxFQUFFLEdBQUcsT0FBTyxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFTLENBQUM7QUFDcEYsQ0FBQztBQUVELE1BQU0sQ0FBQyxLQUFLLFVBQVUsWUFBWSxDQUFDLEtBQWEsRUFBRSxRQUFnQixFQUFFLFVBQThELEVBQUU7SUFDaEksT0FBTyxDQUFDLE1BQU0sa0JBQWtCLENBQUMsS0FBSyxFQUFFLEVBQUUsR0FBRyxPQUFPLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsQ0FBQyxDQUFTLENBQUM7QUFDN0YsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCB0eXBlIEJhc2U2NEFscGhhYmV0ID0gXCJiYXNlNjRcIiB8IFwiYmFzZTY0dXJsXCI7XG5leHBvcnQgdHlwZSBCYXNlNjRMYXN0Q2h1bmtIYW5kbGluZyA9IFwibG9vc2VcIiB8IFwic3RyaWN0XCIgfCBcInN0b3AtYmVmb3JlLXBhcnRpYWxcIjtcblxuZXhwb3J0IHR5cGUgRGF0YVVybFBhcnRzID0ge1xuICAgIG1pbWVUeXBlOiBzdHJpbmc7XG4gICAgaXNCYXNlNjQ6IGJvb2xlYW47XG4gICAgZGF0YTogc3RyaW5nO1xufTtcblxuZXhwb3J0IHR5cGUgRGVjb2RlQmFzZTY0T3B0aW9ucyA9IHtcbiAgICBhbHBoYWJldD86IEJhc2U2NEFscGhhYmV0O1xuICAgIGxhc3RDaHVua0hhbmRsaW5nPzogQmFzZTY0TGFzdENodW5rSGFuZGxpbmc7XG59O1xuXG5leHBvcnQgdHlwZSBFbmNvZGVCYXNlNjRPcHRpb25zID0ge1xuICAgIGFscGhhYmV0PzogQmFzZTY0QWxwaGFiZXQ7XG59O1xuXG5leHBvcnQgdHlwZSBCbG9iVG9TdHJpbmdPcHRpb25zID0ge1xuICAgIC8qKlxuICAgICAqIFdoZW4gdHJ1ZSwgZW5jb2RlIHJhdyB0ZXh0IHBheWxvYWQgd2l0aCBlbmNvZGVVUklDb21wb25lbnQoKS5cbiAgICAgKiBDb21tb24gZm9yIFNWRzogZGF0YTppbWFnZS9zdmcreG1sLCR7ZW5jb2RlVVJJQ29tcG9uZW50KHN2Zyl9LlxuICAgICAqL1xuICAgIHVyaUNvbXBvbmVudD86IGJvb2xlYW47XG4gICAgLyoqXG4gICAgICogSWYgcHJvdmlkZWQsIG92ZXJyaWRlcyBibG9iLnR5cGUgd2hlbiBwcm9kdWNpbmcgYSBkYXRhIFVSTC5cbiAgICAgKi9cbiAgICBtaW1lVHlwZT86IHN0cmluZztcbiAgICAvKipcbiAgICAgKiBPdXRwdXQgYXMgYmFzZTY0IChkZWZhdWx0IHRydWUgZm9yIG5vbi10ZXh0KS4gSWYgZmFsc2UsIG91dHB1dCBhcyB0ZXh0IChvcHRpb25hbGx5IFVSSS1lbmNvZGVkKS5cbiAgICAgKi9cbiAgICBiYXNlNjQ/OiBib29sZWFuO1xuICAgIC8qKlxuICAgICAqIEJhc2U2NCBlbmNvZGluZyBvcHRpb25zIGZvciBiYXNlNjQvYmFzZTY0dXJsLlxuICAgICAqL1xuICAgIGJhc2U2NE9wdGlvbnM/OiBFbmNvZGVCYXNlNjRPcHRpb25zO1xuICAgIC8qKlxuICAgICAqIEZvciB0ZXh0IHNlcmlhbGl6YXRpb24uXG4gICAgICovXG4gICAgdGV4dEVuY29kaW5nPzogXCJ1dGYtOFwiO1xufTtcblxuZXhwb3J0IHR5cGUgU3RyaW5nVG9CaW5hcnlPcHRpb25zID0ge1xuICAgIC8qKlxuICAgICAqIFByZWZlci9mb3JjZSBkZWNvZGluZyBhIFVSTC1lbmNvZGVkIHBheWxvYWQgdmlhIGRlY29kZVVSSUNvbXBvbmVudC5cbiAgICAgKiBJZiBvbWl0dGVkLCB3ZSBhdXRvLWRldGVjdCBieSB0cnlpbmcgdG8gZGVjb2RlIG9ubHkgd2hlbiBpdCBsb29rcyBlbmNvZGVkLlxuICAgICAqL1xuICAgIHVyaUNvbXBvbmVudD86IGJvb2xlYW47XG4gICAgLyoqXG4gICAgICogSWYgcHJvdmlkZWQsIG92ZXJyaWRlcyBhbnkgbWltZSB0eXBlIGRlcml2ZWQgZnJvbSBhIGRhdGEgVVJMLlxuICAgICAqL1xuICAgIG1pbWVUeXBlPzogc3RyaW5nO1xuICAgIC8qKlxuICAgICAqIFdoZW4gY3JlYXRpbmcgYSBGaWxlLCB1c2UgdGhpcyBmaWxlbmFtZS5cbiAgICAgKi9cbiAgICBmaWxlbmFtZT86IHN0cmluZztcbiAgICAvKipcbiAgICAgKiBXaGVuIHRydWUsIHJldHVybiBhIEZpbGUuIE90aGVyd2lzZSByZXR1cm4gYSBCbG9iLlxuICAgICAqL1xuICAgIGFzRmlsZT86IGJvb2xlYW47XG4gICAgLyoqXG4gICAgICogSWYgdHJ1ZSwgdHJlYXQgaW5wdXQgYXMgYmFzZTY0IChvciBiYXNlNjR1cmwpIGJ5dGVzIChub3QgVVRGLTggdGV4dCkuXG4gICAgICogSWYgb21pdHRlZCwgYXV0by1kZXRlY3QgdmlhIGRhdGEgVVJMIG9yIGJhc2U2NCBzaGFwZS5cbiAgICAgKi9cbiAgICBpc0Jhc2U2ND86IGJvb2xlYW47XG4gICAgLyoqXG4gICAgICogRGVjb2RlIG9wdGlvbnMgZm9yIGJhc2U2NC9iYXNlNjR1cmwuXG4gICAgICovXG4gICAgYmFzZTY0PzogRGVjb2RlQmFzZTY0T3B0aW9ucztcbiAgICAvKipcbiAgICAgKiBNYXggYnl0ZXMgYWxsb3dlZCBmb3IgZGVjb2RlZCBiaW5hcnkgZGF0YS5cbiAgICAgKi9cbiAgICBtYXhCeXRlcz86IG51bWJlcjtcbn07XG5cbmV4cG9ydCB0eXBlIERhdGFBc3NldElucHV0ID0gRmlsZSB8IEJsb2IgfCBzdHJpbmcgfCBVUkw7XG5leHBvcnQgdHlwZSBEYXRhQXNzZXRTb3VyY2UgPSBcImZpbGVcIiB8IFwiYmxvYlwiIHwgXCJkYXRhLXVybFwiIHwgXCJiYXNlNjRcIiB8IFwidXJsXCIgfCBcInVyaVwiIHwgXCJ0ZXh0XCI7XG5cbmV4cG9ydCB0eXBlIERhdGFBc3NldCA9IHtcbiAgICBoYXNoOiBzdHJpbmc7XG4gICAgbmFtZTogc3RyaW5nO1xuICAgIHR5cGU6IHN0cmluZztcbiAgICBzaXplOiBudW1iZXI7XG4gICAgc291cmNlOiBEYXRhQXNzZXRTb3VyY2U7XG4gICAgZmlsZTogRmlsZTtcbn07XG5cbmV4cG9ydCB0eXBlIE5vcm1hbGl6ZURhdGFBc3NldE9wdGlvbnMgPSB7XG4gICAgbWltZVR5cGU/OiBzdHJpbmc7XG4gICAgLyoqXG4gICAgICogUHJlZml4IGZvciBnZW5lcmF0ZWQgaGFzaC1iYXNlZCBmaWxlbmFtZXMuXG4gICAgICovXG4gICAgbmFtZVByZWZpeD86IHN0cmluZztcbiAgICAvKipcbiAgICAgKiBPcHRpb25hbCBleHBsaWNpdCBmaWxlbmFtZSBvdmVycmlkZS5cbiAgICAgKi9cbiAgICBmaWxlbmFtZT86IHN0cmluZztcbiAgICAvKipcbiAgICAgKiBXaGVuIHRydWUsIGtlZXAgaW5wdXQgRmlsZSBuYW1lIGluc3RlYWQgb2YgaGFzaC1uYW1lLlxuICAgICAqL1xuICAgIHByZXNlcnZlRmlsZU5hbWU/OiBib29sZWFuO1xuICAgIHVyaUNvbXBvbmVudD86IGJvb2xlYW47XG4gICAgbWF4Qnl0ZXM/OiBudW1iZXI7XG59O1xuXG5jb25zdCBERUZBVUxUX01JTUUgPSBcImFwcGxpY2F0aW9uL29jdGV0LXN0cmVhbVwiO1xuXG5jb25zdCBEQVRBX1VSTF9SRSA9IC9eZGF0YTooPzxtaW1lPlteOyxdKyk/KD88cGFyYW1zPig/OjtbXixdKikqPyksKD88ZGF0YT5bXFxzXFxTXSopJC9pO1xuXG5mdW5jdGlvbiBjYW5Vc2VGcm9tQmFzZTY0KCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0eXBlb2YgKFVpbnQ4QXJyYXkgYXMgYW55KS5mcm9tQmFzZTY0ID09PSBcImZ1bmN0aW9uXCI7XG59XG5cbmZ1bmN0aW9uIGNhblVzZVRvQmFzZTY0KHU4OiBVaW50OEFycmF5KTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHR5cGVvZiAodTggYXMgYW55KS50b0Jhc2U2NCA9PT0gXCJmdW5jdGlvblwiO1xufVxuXG5mdW5jdGlvbiB0cnlEZWNvZGVVUklDb21wb25lbnQoczogc3RyaW5nKTogc3RyaW5nIHtcbiAgICB0cnkge1xuICAgICAgICByZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KHMpO1xuICAgIH0gY2F0Y2gge1xuICAgICAgICByZXR1cm4gcztcbiAgICB9XG59XG5cbmZ1bmN0aW9uIGxpa2VseVVyaUNvbXBvbmVudChzOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICByZXR1cm4gLyVbMC05QS1GYS1mXXsyfS8udGVzdChzKSB8fCBzLmluY2x1ZGVzKFwiK1wiKTtcbn1cblxuZnVuY3Rpb24gaXNUZXh0TWltZShtaW1lVHlwZTogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgY29uc3QgdCA9IChtaW1lVHlwZSB8fCBcIlwiKS50b0xvd2VyQ2FzZSgpO1xuICAgIHJldHVybiAoXG4gICAgICAgIHQuc3RhcnRzV2l0aChcInRleHQvXCIpIHx8XG4gICAgICAgIHQuaW5jbHVkZXMoXCJqc29uXCIpIHx8XG4gICAgICAgIHQuaW5jbHVkZXMoXCJ4bWxcIikgfHxcbiAgICAgICAgdC5pbmNsdWRlcyhcInN2Z1wiKSB8fFxuICAgICAgICB0LmluY2x1ZGVzKFwiamF2YXNjcmlwdFwiKSB8fFxuICAgICAgICB0LmluY2x1ZGVzKFwiZWNtYXNjcmlwdFwiKVxuICAgICk7XG59XG5cbmZ1bmN0aW9uIGJ5dGVzVG9BcnJheUJ1ZmZlcihieXRlczogVWludDhBcnJheSk6IEFycmF5QnVmZmVyIHtcbiAgICBjb25zdCBidWY6IEFycmF5QnVmZmVyTGlrZSA9IGJ5dGVzLmJ1ZmZlcjtcbiAgICBpZiAoYnVmIGluc3RhbmNlb2YgQXJyYXlCdWZmZXIpIHtcbiAgICAgICAgcmV0dXJuIGJ1Zi5zbGljZShieXRlcy5ieXRlT2Zmc2V0LCBieXRlcy5ieXRlT2Zmc2V0ICsgYnl0ZXMuYnl0ZUxlbmd0aCk7XG4gICAgfVxuICAgIGNvbnN0IGFiID0gbmV3IEFycmF5QnVmZmVyKGJ5dGVzLmJ5dGVMZW5ndGgpO1xuICAgIG5ldyBVaW50OEFycmF5KGFiKS5zZXQoYnl0ZXMpO1xuICAgIHJldHVybiBhYjtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHBhcnNlRGF0YVVybChpbnB1dDogc3RyaW5nKTogRGF0YVVybFBhcnRzIHwgbnVsbCB7XG4gICAgY29uc3QgcyA9IChpbnB1dCB8fCBcIlwiKS50cmltKCk7XG4gICAgaWYgKCFzLnRvTG93ZXJDYXNlKCkuc3RhcnRzV2l0aChcImRhdGE6XCIpKSByZXR1cm4gbnVsbDtcblxuICAgIGNvbnN0IG0gPSBzLm1hdGNoKERBVEFfVVJMX1JFKTtcbiAgICBpZiAoIW0/Lmdyb3VwcykgcmV0dXJuIG51bGw7XG5cbiAgICBjb25zdCBtaW1lVHlwZSA9IChtLmdyb3Vwcy5taW1lIHx8IERFRkFVTFRfTUlNRSkudHJpbSgpIHx8IERFRkFVTFRfTUlNRTtcbiAgICBjb25zdCBwYXJhbXMgPSAobS5ncm91cHMucGFyYW1zIHx8IFwiXCIpLnRvTG93ZXJDYXNlKCk7XG4gICAgY29uc3QgaXNCYXNlNjQgPSBwYXJhbXMuaW5jbHVkZXMoXCI7YmFzZTY0XCIpO1xuICAgIGNvbnN0IGRhdGEgPSBtLmdyb3Vwcy5kYXRhID8/IFwiXCI7XG4gICAgcmV0dXJuIHsgbWltZVR5cGUsIGlzQmFzZTY0LCBkYXRhIH07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBkZWNvZGVCYXNlNjRUb0J5dGVzKGJhc2U2NDogc3RyaW5nLCBvcHRpb25zOiBEZWNvZGVCYXNlNjRPcHRpb25zID0ge30pOiBVaW50OEFycmF5IHtcbiAgICBjb25zdCBhbHBoYWJldDogQmFzZTY0QWxwaGFiZXQgPSBvcHRpb25zLmFscGhhYmV0IHx8IFwiYmFzZTY0XCI7XG4gICAgY29uc3QgbGFzdENodW5rSGFuZGxpbmc6IEJhc2U2NExhc3RDaHVua0hhbmRsaW5nID0gb3B0aW9ucy5sYXN0Q2h1bmtIYW5kbGluZyB8fCBcImxvb3NlXCI7XG4gICAgY29uc3QgcyA9IChiYXNlNjQgfHwgXCJcIikudHJpbSgpO1xuXG4gICAgaWYgKGNhblVzZUZyb21CYXNlNjQoKSkge1xuICAgICAgICAvLyBNb2Rlcm4gbmF0aXZlOiBVaW50OEFycmF5LmZyb21CYXNlNjQoKVxuICAgICAgICAvLyBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9KYXZhU2NyaXB0L1JlZmVyZW5jZS9HbG9iYWxfT2JqZWN0cy9VaW50OEFycmF5L2Zyb21CYXNlNjRcbiAgICAgICAgcmV0dXJuIChVaW50OEFycmF5IGFzIGFueSkuZnJvbUJhc2U2NChzLCB7IGFscGhhYmV0LCBsYXN0Q2h1bmtIYW5kbGluZyB9KTtcbiAgICB9XG5cbiAgICAvLyBGYWxsYmFjazogYXRvYigpIGZvciBiYXNlNjQgb25seS5cbiAgICAvLyBGb3IgYmFzZTY0dXJsLCBjb252ZXJ0IHRvIGJhc2U2NCBmaXJzdC5cbiAgICBjb25zdCBub3JtYWxpemVkID1cbiAgICAgICAgYWxwaGFiZXQgPT09IFwiYmFzZTY0dXJsXCJcbiAgICAgICAgICAgID8gcy5yZXBsYWNlKC8tL2csIFwiK1wiKS5yZXBsYWNlKC9fL2csIFwiL1wiKVxuICAgICAgICAgICAgOiBzO1xuXG4gICAgLy8gcGFkIHRvIG11bHRpcGxlIG9mIDRcbiAgICBjb25zdCBwYWRMZW4gPSAoNCAtIChub3JtYWxpemVkLmxlbmd0aCAlIDQpKSAlIDQ7XG4gICAgY29uc3QgcGFkZGVkID0gbm9ybWFsaXplZCArIFwiPVwiLnJlcGVhdChwYWRMZW4pO1xuXG4gICAgY29uc3QgYmluYXJ5ID0gdHlwZW9mIGF0b2IgPT09IFwiZnVuY3Rpb25cIiA/IGF0b2IocGFkZGVkKSA6IFwiXCI7XG4gICAgY29uc3Qgb3V0ID0gbmV3IFVpbnQ4QXJyYXkoYmluYXJ5Lmxlbmd0aCk7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBiaW5hcnkubGVuZ3RoOyBpKyspIG91dFtpXSA9IGJpbmFyeS5jaGFyQ29kZUF0KGkpO1xuICAgIHJldHVybiBvdXQ7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBlbmNvZGVCeXRlc1RvQmFzZTY0KGJ5dGVzOiBVaW50OEFycmF5LCBvcHRpb25zOiBFbmNvZGVCYXNlNjRPcHRpb25zID0ge30pOiBzdHJpbmcge1xuICAgIGNvbnN0IGFscGhhYmV0OiBCYXNlNjRBbHBoYWJldCA9IG9wdGlvbnMuYWxwaGFiZXQgfHwgXCJiYXNlNjRcIjtcblxuICAgIGlmIChjYW5Vc2VUb0Jhc2U2NChieXRlcykpIHtcbiAgICAgICAgLy8gTW9kZXJuIG5hdGl2ZTogVWludDhBcnJheS5wcm90b3R5cGUudG9CYXNlNjQoKVxuICAgICAgICAvLyBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9KYXZhU2NyaXB0L1JlZmVyZW5jZS9HbG9iYWxfT2JqZWN0cy9VaW50OEFycmF5L3RvQmFzZTY0XG4gICAgICAgIHJldHVybiAoYnl0ZXMgYXMgYW55KS50b0Jhc2U2NCh7IGFscGhhYmV0IH0pO1xuICAgIH1cblxuICAgIC8vIEZhbGxiYWNrOiBidG9hKCkgd2l0aCBjaHVua2luZ1xuICAgIGNvbnN0IGNodW5rU2l6ZSA9IDB4ODAwMDtcbiAgICBsZXQgYmluYXJ5ID0gXCJcIjtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGJ5dGVzLmxlbmd0aDsgaSArPSBjaHVua1NpemUpIHtcbiAgICAgICAgYmluYXJ5ICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoLi4uYnl0ZXMuc3ViYXJyYXkoaSwgaSArIGNodW5rU2l6ZSkpO1xuICAgIH1cbiAgICBjb25zdCBiNjQgPSB0eXBlb2YgYnRvYSA9PT0gXCJmdW5jdGlvblwiID8gYnRvYShiaW5hcnkpIDogXCJcIjtcbiAgICBpZiAoYWxwaGFiZXQgIT09IFwiYmFzZTY0dXJsXCIpIHJldHVybiBiNjQ7XG4gICAgcmV0dXJuIGI2NC5yZXBsYWNlKC9cXCsvZywgXCItXCIpLnJlcGxhY2UoL1xcLy9nLCBcIl9cIikucmVwbGFjZSgvPSskL2csIFwiXCIpO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gYmxvYlRvQnl0ZXMoYmxvYjogQmxvYik6IFByb21pc2U8VWludDhBcnJheT4ge1xuICAgIGNvbnN0IGFiID0gYXdhaXQgYmxvYi5hcnJheUJ1ZmZlcigpO1xuICAgIHJldHVybiBuZXcgVWludDhBcnJheShhYik7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBibG9iVG9UZXh0KGJsb2I6IEJsb2IsIGVuY29kaW5nOiBcInV0Zi04XCIgPSBcInV0Zi04XCIpOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIC8vIFByZWZlciBuYXRpdmUgQmxvYi50ZXh0KCkgd2hlbiBhdmFpbGFibGUuXG4gICAgaWYgKHR5cGVvZiBibG9iLnRleHQgPT09IFwiZnVuY3Rpb25cIikgcmV0dXJuIGF3YWl0IGJsb2IudGV4dCgpO1xuICAgIGNvbnN0IGJ5dGVzID0gYXdhaXQgYmxvYlRvQnl0ZXMoYmxvYik7XG4gICAgY29uc3QgZGVjID0gbmV3IFRleHREZWNvZGVyKGVuY29kaW5nKTtcbiAgICByZXR1cm4gZGVjLmRlY29kZShieXRlcyk7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBibG9iVG9CYXNlNjQoYmxvYjogQmxvYiwgb3B0aW9uczogRW5jb2RlQmFzZTY0T3B0aW9ucyA9IHt9KTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICBjb25zdCBieXRlcyA9IGF3YWl0IGJsb2JUb0J5dGVzKGJsb2IpO1xuICAgIHJldHVybiBlbmNvZGVCeXRlc1RvQmFzZTY0KGJ5dGVzLCBvcHRpb25zKTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGJsb2JUb0RhdGFVcmwoYmxvYjogQmxvYiwgb3B0aW9uczogQmxvYlRvU3RyaW5nT3B0aW9ucyA9IHt9KTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICBjb25zdCBtaW1lVHlwZSA9IChvcHRpb25zLm1pbWVUeXBlIHx8IGJsb2IudHlwZSB8fCBERUZBVUxUX01JTUUpLnRyaW0oKSB8fCBERUZBVUxUX01JTUU7XG4gICAgY29uc3Qgd2FudHNCYXNlNjQgPSBvcHRpb25zLmJhc2U2NCA/PyAhaXNUZXh0TWltZShtaW1lVHlwZSk7XG5cbiAgICBpZiAod2FudHNCYXNlNjQpIHtcbiAgICAgICAgY29uc3QgYjY0ID0gYXdhaXQgYmxvYlRvQmFzZTY0KGJsb2IsIG9wdGlvbnMuYmFzZTY0T3B0aW9ucyB8fCB7fSk7XG4gICAgICAgIHJldHVybiBgZGF0YToke21pbWVUeXBlfTtiYXNlNjQsJHtiNjR9YDtcbiAgICB9XG5cbiAgICBjb25zdCB0ZXh0ID0gYXdhaXQgYmxvYlRvVGV4dChibG9iLCBvcHRpb25zLnRleHRFbmNvZGluZyB8fCBcInV0Zi04XCIpO1xuICAgIGNvbnN0IHBheWxvYWQgPSBvcHRpb25zLnVyaUNvbXBvbmVudCA/IGVuY29kZVVSSUNvbXBvbmVudCh0ZXh0KSA6IHRleHQ7XG4gICAgcmV0dXJuIGBkYXRhOiR7bWltZVR5cGV9LCR7cGF5bG9hZH1gO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZmlsZVRvRGF0YVVybChmaWxlOiBGaWxlLCBvcHRpb25zOiBCbG9iVG9TdHJpbmdPcHRpb25zID0ge30pOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIHJldHVybiBhd2FpdCBibG9iVG9EYXRhVXJsKGZpbGUsIG9wdGlvbnMpO1xufVxuXG5mdW5jdGlvbiBsb29rc0xpa2VCYXNlNjQoczogc3RyaW5nKTogeyBpc0Jhc2U2NDogYm9vbGVhbjsgYWxwaGFiZXQ6IEJhc2U2NEFscGhhYmV0IH0ge1xuICAgIGNvbnN0IHQgPSAocyB8fCBcIlwiKS50cmltKCk7XG4gICAgaWYgKCF0KSByZXR1cm4geyBpc0Jhc2U2NDogZmFsc2UsIGFscGhhYmV0OiBcImJhc2U2NFwiIH07XG5cbiAgICBjb25zdCBoYXNVcmxBbHBoYWJldCA9IC9bLV9dLy50ZXN0KHQpICYmICEvWysvXS8udGVzdCh0KTtcbiAgICBjb25zdCBhbHBoYWJldDogQmFzZTY0QWxwaGFiZXQgPSBoYXNVcmxBbHBoYWJldCA/IFwiYmFzZTY0dXJsXCIgOiBcImJhc2U2NFwiO1xuXG4gICAgY29uc3Qgbm9ybWFsaXplZCA9IGFscGhhYmV0ID09PSBcImJhc2U2NHVybFwiID8gdC5yZXBsYWNlKC8tL2csIFwiK1wiKS5yZXBsYWNlKC9fL2csIFwiL1wiKSA6IHQ7XG4gICAgY29uc3QgY2xlYW5lZCA9IG5vcm1hbGl6ZWQucmVwbGFjZSgvW1xcclxcblxcc10vZywgXCJcIik7XG4gICAgY29uc3QgYWxsb3dlZCA9IC9eW0EtWmEtejAtOSsvXSo9ezAsMn0kLy50ZXN0KGNsZWFuZWQpO1xuICAgIGlmICghYWxsb3dlZCkgcmV0dXJuIHsgaXNCYXNlNjQ6IGZhbHNlLCBhbHBoYWJldCB9O1xuXG4gICAgLy8gTm90IHBlcmZlY3Q7IGdvb2QgZW5vdWdoIGZvciBcInRyeSBiYXNlNjQgZGVjb2RlXCJcbiAgICBpZiAoY2xlYW5lZC5sZW5ndGggPCA4KSByZXR1cm4geyBpc0Jhc2U2NDogZmFsc2UsIGFscGhhYmV0IH07XG4gICAgcmV0dXJuIHsgaXNCYXNlNjQ6IHRydWUsIGFscGhhYmV0IH07XG59XG5cbmZ1bmN0aW9uIGNhblBhcnNlVXJsKHZhbHVlOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICB0cnkge1xuICAgICAgICBpZiAodHlwZW9mIFVSTCA9PT0gXCJ1bmRlZmluZWRcIikgcmV0dXJuIGZhbHNlO1xuICAgICAgICBpZiAodHlwZW9mIChVUkwgYXMgYW55KS5jYW5QYXJzZSA9PT0gXCJmdW5jdGlvblwiKSByZXR1cm4gKFVSTCBhcyBhbnkpLmNhblBhcnNlKHZhbHVlKTtcbiAgICAgICAgLy8gRmFsbGJhY2sgZm9yIGVudmlyb25tZW50cyB3aXRob3V0IFVSTC5jYW5QYXJzZVxuICAgICAgICBuZXcgVVJMKHZhbHVlKTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSBjYXRjaCB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIGV4dGVuc2lvbkJ5TWltZVR5cGUobWltZVR5cGU6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgY29uc3QgdCA9IChtaW1lVHlwZSB8fCBcIlwiKS50b0xvd2VyQ2FzZSgpLnNwbGl0KFwiO1wiKVswXS50cmltKCk7XG4gICAgaWYgKCF0KSByZXR1cm4gXCJiaW5cIjtcblxuICAgIGNvbnN0IG1hcHBlZDogUmVjb3JkPHN0cmluZywgc3RyaW5nPiA9IHtcbiAgICAgICAgXCJ0ZXh0L3BsYWluXCI6IFwidHh0XCIsXG4gICAgICAgIFwidGV4dC9tYXJrZG93blwiOiBcIm1kXCIsXG4gICAgICAgIFwidGV4dC9odG1sXCI6IFwiaHRtbFwiLFxuICAgICAgICBcImFwcGxpY2F0aW9uL2pzb25cIjogXCJqc29uXCIsXG4gICAgICAgIFwiYXBwbGljYXRpb24veG1sXCI6IFwieG1sXCIsXG4gICAgICAgIFwiaW1hZ2UvanBlZ1wiOiBcImpwZ1wiLFxuICAgICAgICBcImltYWdlL3BuZ1wiOiBcInBuZ1wiLFxuICAgICAgICBcImltYWdlL3dlYnBcIjogXCJ3ZWJwXCIsXG4gICAgICAgIFwiaW1hZ2UvZ2lmXCI6IFwiZ2lmXCIsXG4gICAgICAgIFwiaW1hZ2Uvc3ZnK3htbFwiOiBcInN2Z1wiLFxuICAgICAgICBcImFwcGxpY2F0aW9uL3BkZlwiOiBcInBkZlwiLFxuICAgIH07XG4gICAgaWYgKG1hcHBlZFt0XSkgcmV0dXJuIG1hcHBlZFt0XTtcblxuICAgIGNvbnN0IHNsYXNoSWR4ID0gdC5pbmRleE9mKFwiL1wiKTtcbiAgICBpZiAoc2xhc2hJZHggPD0gMCB8fCBzbGFzaElkeCA+PSB0Lmxlbmd0aCAtIDEpIHJldHVybiBcImJpblwiO1xuICAgIGxldCBzdWJ0eXBlID0gdC5zbGljZShzbGFzaElkeCArIDEpO1xuICAgIGlmIChzdWJ0eXBlLmluY2x1ZGVzKFwiK1wiKSkgc3VidHlwZSA9IHN1YnR5cGUuc3BsaXQoXCIrXCIpWzBdO1xuICAgIGlmIChzdWJ0eXBlLmluY2x1ZGVzKFwiLlwiKSkgc3VidHlwZSA9IHN1YnR5cGUuc3BsaXQoXCIuXCIpLnBvcCgpIHx8IHN1YnR5cGU7XG4gICAgcmV0dXJuIHN1YnR5cGUgfHwgXCJiaW5cIjtcbn1cblxuZnVuY3Rpb24gZmFsbGJhY2tIYXNoSGV4KGJ5dGVzOiBVaW50OEFycmF5KTogc3RyaW5nIHtcbiAgICAvLyBOb24tY3J5cHRvZ3JhcGhpYyBmYWxsYmFjayBvbmx5IGZvciBlbnZpcm9ubWVudHMgd2l0aG91dCBTdWJ0bGVDcnlwdG8uXG4gICAgbGV0IGggPSAyMTY2MTM2MjYxO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYnl0ZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgaCBePSBieXRlc1tpXTtcbiAgICAgICAgaCA9IE1hdGguaW11bChoLCAxNjc3NzYxOSk7XG4gICAgfVxuICAgIHJldHVybiAoaCA+Pj4gMCkudG9TdHJpbmcoMTYpLnBhZFN0YXJ0KDgsIFwiMFwiKS5yZXBlYXQoOCk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHNoYTI1NkhleChieXRlczogVWludDhBcnJheSk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3Qgc3VidGxlID0gKGdsb2JhbFRoaXMuY3J5cHRvIGFzIENyeXB0byB8IHVuZGVmaW5lZCk/LnN1YnRsZTtcbiAgICAgICAgaWYgKCFzdWJ0bGUpIHJldHVybiBmYWxsYmFja0hhc2hIZXgoYnl0ZXMpO1xuICAgICAgICBjb25zdCBkaWdlc3QgPSBhd2FpdCBzdWJ0bGUuZGlnZXN0KFwiU0hBLTI1NlwiLCBieXRlcyk7XG4gICAgICAgIGNvbnN0IG91dCA9IG5ldyBVaW50OEFycmF5KGRpZ2VzdCk7XG4gICAgICAgIHJldHVybiBBcnJheS5mcm9tKG91dCwgKGIpID0+IGIudG9TdHJpbmcoMTYpLnBhZFN0YXJ0KDIsIFwiMFwiKSkuam9pbihcIlwiKTtcbiAgICB9IGNhdGNoIHtcbiAgICAgICAgcmV0dXJuIGZhbGxiYWNrSGFzaEhleChieXRlcyk7XG4gICAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gaXNCYXNlNjRMaWtlKGlucHV0OiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICByZXR1cm4gbG9va3NMaWtlQmFzZTY0KGlucHV0KS5pc0Jhc2U2NDtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIG5vcm1hbGl6ZURhdGFBc3NldChpbnB1dDogRGF0YUFzc2V0SW5wdXQsIG9wdGlvbnM6IE5vcm1hbGl6ZURhdGFBc3NldE9wdGlvbnMgPSB7fSk6IFByb21pc2U8RGF0YUFzc2V0PiB7XG4gICAgY29uc3QgbWF4Qnl0ZXMgPSBvcHRpb25zLm1heEJ5dGVzID8/IDUwICogMTAyNCAqIDEwMjQ7XG4gICAgY29uc3QgbmFtZVByZWZpeCA9IChvcHRpb25zLm5hbWVQcmVmaXggfHwgXCJhc3NldFwiKS50cmltKCkgfHwgXCJhc3NldFwiO1xuICAgIGNvbnN0IHByZXNlcnZlRmlsZU5hbWUgPSBvcHRpb25zLnByZXNlcnZlRmlsZU5hbWUgPz8gZmFsc2U7XG5cbiAgICBsZXQgc291cmNlOiBEYXRhQXNzZXRTb3VyY2UgPSBcInRleHRcIjtcbiAgICBsZXQgYmxvYjogQmxvYjtcbiAgICBsZXQgaW5jb21pbmdGaWxlOiBGaWxlIHwgbnVsbCA9IG51bGw7XG5cbiAgICBpZiAoaW5wdXQgaW5zdGFuY2VvZiBGaWxlKSB7XG4gICAgICAgIHNvdXJjZSA9IFwiZmlsZVwiO1xuICAgICAgICBpbmNvbWluZ0ZpbGUgPSBpbnB1dDtcbiAgICAgICAgYmxvYiA9IG9wdGlvbnMubWltZVR5cGUgJiYgb3B0aW9ucy5taW1lVHlwZSAhPT0gaW5wdXQudHlwZVxuICAgICAgICAgICAgPyBuZXcgQmxvYihbYXdhaXQgaW5wdXQuYXJyYXlCdWZmZXIoKV0sIHsgdHlwZTogb3B0aW9ucy5taW1lVHlwZSB9KVxuICAgICAgICAgICAgOiBpbnB1dDtcbiAgICB9IGVsc2UgaWYgKGlucHV0IGluc3RhbmNlb2YgQmxvYikge1xuICAgICAgICBzb3VyY2UgPSBcImJsb2JcIjtcbiAgICAgICAgYmxvYiA9IG9wdGlvbnMubWltZVR5cGUgJiYgb3B0aW9ucy5taW1lVHlwZSAhPT0gaW5wdXQudHlwZVxuICAgICAgICAgICAgPyBuZXcgQmxvYihbYXdhaXQgaW5wdXQuYXJyYXlCdWZmZXIoKV0sIHsgdHlwZTogb3B0aW9ucy5taW1lVHlwZSB9KVxuICAgICAgICAgICAgOiBpbnB1dDtcbiAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCByYXcgPSAoaW5wdXQgaW5zdGFuY2VvZiBVUkwgPyBpbnB1dC50b1N0cmluZygpIDogU3RyaW5nKGlucHV0ID8/IFwiXCIpKS50cmltKCk7XG4gICAgICAgIGNvbnN0IHBhcnNlZCA9IHBhcnNlRGF0YVVybChyYXcpO1xuICAgICAgICBjb25zdCBkZWNvZGVkVXJpID0gb3B0aW9ucy51cmlDb21wb25lbnQgPyB0cnlEZWNvZGVVUklDb21wb25lbnQocmF3KSA6IChsaWtlbHlVcmlDb21wb25lbnQocmF3KSA/IHRyeURlY29kZVVSSUNvbXBvbmVudChyYXcpIDogcmF3KTtcblxuICAgICAgICBpZiAocGFyc2VkKSB7XG4gICAgICAgICAgICBzb3VyY2UgPSBcImRhdGEtdXJsXCI7XG4gICAgICAgIH0gZWxzZSBpZiAoY2FuUGFyc2VVcmwocmF3KSkge1xuICAgICAgICAgICAgc291cmNlID0gXCJ1cmxcIjtcbiAgICAgICAgfSBlbHNlIGlmIChpc0Jhc2U2NExpa2UocmF3KSkge1xuICAgICAgICAgICAgc291cmNlID0gXCJiYXNlNjRcIjtcbiAgICAgICAgfSBlbHNlIGlmIChkZWNvZGVkVXJpICE9PSByYXcgJiYgKHBhcnNlRGF0YVVybChkZWNvZGVkVXJpKSB8fCBpc0Jhc2U2NExpa2UoZGVjb2RlZFVyaSkgfHwgY2FuUGFyc2VVcmwoZGVjb2RlZFVyaSkpKSB7XG4gICAgICAgICAgICBzb3VyY2UgPSBcInVyaVwiO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgc291cmNlID0gXCJ0ZXh0XCI7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBzdHJpbmdTb3VyY2UgPSBzb3VyY2UgPT09IFwidXJpXCIgPyBkZWNvZGVkVXJpIDogcmF3O1xuICAgICAgICBibG9iID0gYXdhaXQgc3RyaW5nVG9CbG9iKHN0cmluZ1NvdXJjZSwge1xuICAgICAgICAgICAgbWltZVR5cGU6IG9wdGlvbnMubWltZVR5cGUsXG4gICAgICAgICAgICB1cmlDb21wb25lbnQ6IG9wdGlvbnMudXJpQ29tcG9uZW50LFxuICAgICAgICAgICAgaXNCYXNlNjQ6IHNvdXJjZSA9PT0gXCJiYXNlNjRcIiA/IHRydWUgOiB1bmRlZmluZWQsXG4gICAgICAgICAgICBtYXhCeXRlcyxcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgY29uc3QgYnl0ZXMgPSBhd2FpdCBibG9iVG9CeXRlcyhibG9iKTtcbiAgICBpZiAoYnl0ZXMuYnl0ZUxlbmd0aCA+IG1heEJ5dGVzKSB0aHJvdyBuZXcgRXJyb3IoYERhdGEgdG9vIGxhcmdlOiAke2J5dGVzLmJ5dGVMZW5ndGh9IGJ5dGVzYCk7XG5cbiAgICBjb25zdCBoYXNoID0gYXdhaXQgc2hhMjU2SGV4KGJ5dGVzKTtcbiAgICBjb25zdCBtaW1lVHlwZSA9IChvcHRpb25zLm1pbWVUeXBlIHx8IGJsb2IudHlwZSB8fCBERUZBVUxUX01JTUUpLnRyaW0oKSB8fCBERUZBVUxUX01JTUU7XG4gICAgY29uc3QgZXh0ZW5zaW9uID0gZXh0ZW5zaW9uQnlNaW1lVHlwZShtaW1lVHlwZSk7XG4gICAgY29uc3QgaGFzaGVkTmFtZSA9IG9wdGlvbnMuZmlsZW5hbWUgfHwgYCR7bmFtZVByZWZpeH0tJHtoYXNoLnNsaWNlKDAsIDE2KX0uJHtleHRlbnNpb259YDtcbiAgICBjb25zdCBmaW5hbE5hbWUgPSBwcmVzZXJ2ZUZpbGVOYW1lICYmIGluY29taW5nRmlsZT8ubmFtZSA/IGluY29taW5nRmlsZS5uYW1lIDogaGFzaGVkTmFtZTtcblxuICAgIGNvbnN0IGZpbGUgPSBpbmNvbWluZ0ZpbGUgJiYgcHJlc2VydmVGaWxlTmFtZSAmJiAhb3B0aW9ucy5taW1lVHlwZVxuICAgICAgICA/IGluY29taW5nRmlsZVxuICAgICAgICA6IG5ldyBGaWxlKFtibG9iXSwgZmluYWxOYW1lLCB7IHR5cGU6IG1pbWVUeXBlIH0pO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgICAgaGFzaCxcbiAgICAgICAgbmFtZTogZmlsZS5uYW1lLFxuICAgICAgICB0eXBlOiBmaWxlLnR5cGUgfHwgbWltZVR5cGUsXG4gICAgICAgIHNpemU6IGZpbGUuc2l6ZSxcbiAgICAgICAgc291cmNlLFxuICAgICAgICBmaWxlLFxuICAgIH07XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzdHJpbmdUb0Jsb2JPckZpbGUoaW5wdXQ6IHN0cmluZywgb3B0aW9uczogU3RyaW5nVG9CaW5hcnlPcHRpb25zID0ge30pOiBQcm9taXNlPEJsb2IgfCBGaWxlPiB7XG4gICAgY29uc3QgbWF4Qnl0ZXMgPSBvcHRpb25zLm1heEJ5dGVzID8/IDUwICogMTAyNCAqIDEwMjQ7XG4gICAgY29uc3QgcmF3ID0gKGlucHV0ID8/IFwiXCIpLnRyaW0oKTtcblxuICAgIGNvbnN0IHBhcnNlZERhdGFVcmwgPSBwYXJzZURhdGFVcmwocmF3KTtcbiAgICBpZiAocGFyc2VkRGF0YVVybCkge1xuICAgICAgICBjb25zdCBtaW1lVHlwZSA9IG9wdGlvbnMubWltZVR5cGUgfHwgcGFyc2VkRGF0YVVybC5taW1lVHlwZSB8fCBERUZBVUxUX01JTUU7XG4gICAgICAgIGNvbnN0IHBheWxvYWQgPSBvcHRpb25zLnVyaUNvbXBvbmVudCA/IHRyeURlY29kZVVSSUNvbXBvbmVudChwYXJzZWREYXRhVXJsLmRhdGEpIDogKGxpa2VseVVyaUNvbXBvbmVudChwYXJzZWREYXRhVXJsLmRhdGEpID8gdHJ5RGVjb2RlVVJJQ29tcG9uZW50KHBhcnNlZERhdGFVcmwuZGF0YSkgOiBwYXJzZWREYXRhVXJsLmRhdGEpO1xuICAgICAgICBjb25zdCBpc0Jhc2U2NCA9IG9wdGlvbnMuaXNCYXNlNjQgPz8gcGFyc2VkRGF0YVVybC5pc0Jhc2U2NDtcblxuICAgICAgICBpZiAoaXNCYXNlNjQpIHtcbiAgICAgICAgICAgIGNvbnN0IGJ5dGVzID0gZGVjb2RlQmFzZTY0VG9CeXRlcyhwYXlsb2FkLCB7XG4gICAgICAgICAgICAgICAgYWxwaGFiZXQ6IG9wdGlvbnMuYmFzZTY0Py5hbHBoYWJldCB8fCBcImJhc2U2NFwiLFxuICAgICAgICAgICAgICAgIGxhc3RDaHVua0hhbmRsaW5nOiBvcHRpb25zLmJhc2U2ND8ubGFzdENodW5rSGFuZGxpbmcgfHwgXCJsb29zZVwiLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBpZiAoYnl0ZXMuYnl0ZUxlbmd0aCA+IG1heEJ5dGVzKSB0aHJvdyBuZXcgRXJyb3IoYERlY29kZWQgZGF0YSB0b28gbGFyZ2U6ICR7Ynl0ZXMuYnl0ZUxlbmd0aH0gYnl0ZXNgKTtcbiAgICAgICAgICAgIGNvbnN0IGJsb2IgPSBuZXcgQmxvYihbYnl0ZXNUb0FycmF5QnVmZmVyKGJ5dGVzKV0sIHsgdHlwZTogbWltZVR5cGUgfSk7XG4gICAgICAgICAgICBpZiAoIW9wdGlvbnMuYXNGaWxlKSByZXR1cm4gYmxvYjtcbiAgICAgICAgICAgIHJldHVybiBuZXcgRmlsZShbYmxvYl0sIG9wdGlvbnMuZmlsZW5hbWUgfHwgXCJmaWxlXCIsIHsgdHlwZTogbWltZVR5cGUgfSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBOb24tYmFzZTY0IGRhdGEgVVJMOiB0cmVhdCBhcyBVUkwtZW5jb2RlZCBieXRlcy9zdHJpbmcuIFdlIGtlZXAgaXQgYXMgVVRGLTggdGV4dCBieSBkZWZhdWx0LlxuICAgICAgICBjb25zdCBibG9iID0gbmV3IEJsb2IoW3BheWxvYWRdLCB7IHR5cGU6IG1pbWVUeXBlIH0pO1xuICAgICAgICBpZiAoIW9wdGlvbnMuYXNGaWxlKSByZXR1cm4gYmxvYjtcbiAgICAgICAgcmV0dXJuIG5ldyBGaWxlKFtibG9iXSwgb3B0aW9ucy5maWxlbmFtZSB8fCBcImZpbGVcIiwgeyB0eXBlOiBtaW1lVHlwZSB9KTtcbiAgICB9XG5cbiAgICAvLyBJZiBpdCdzIGEgbm9ybWFsIFVSTCwgZmV0Y2ggaXQuXG4gICAgdHJ5IHtcbiAgICAgICAgaWYgKHR5cGVvZiBVUkwgIT09IFwidW5kZWZpbmVkXCIgJiYgKFVSTCBhcyBhbnkpLmNhblBhcnNlPy4ocmF3KSkge1xuICAgICAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgZmV0Y2gocmF3KTtcbiAgICAgICAgICAgIGNvbnN0IGJsb2IgPSBhd2FpdCByZXMuYmxvYigpO1xuICAgICAgICAgICAgY29uc3QgbWltZVR5cGUgPSBvcHRpb25zLm1pbWVUeXBlIHx8IGJsb2IudHlwZSB8fCBERUZBVUxUX01JTUU7XG4gICAgICAgICAgICBjb25zdCB0eXBlZCA9IGJsb2IudHlwZSA9PT0gbWltZVR5cGUgPyBibG9iIDogbmV3IEJsb2IoW2F3YWl0IGJsb2IuYXJyYXlCdWZmZXIoKV0sIHsgdHlwZTogbWltZVR5cGUgfSk7XG4gICAgICAgICAgICBpZiAoIW9wdGlvbnMuYXNGaWxlKSByZXR1cm4gdHlwZWQ7XG4gICAgICAgICAgICByZXR1cm4gbmV3IEZpbGUoW3R5cGVkXSwgb3B0aW9ucy5maWxlbmFtZSB8fCBcImZpbGVcIiwgeyB0eXBlOiBtaW1lVHlwZSB9KTtcbiAgICAgICAgfVxuICAgIH0gY2F0Y2gge1xuICAgICAgICAvLyBmYWxsIHRocm91Z2ggdG8gdHJlYXQgYXMgcGxhaW4gc3RyaW5nIC8gYmFzZTY0XG4gICAgfVxuXG4gICAgLy8gUGxhaW4gc3RyaW5nIGNhc2U6IGJhc2U2NCBieXRlcyBPUiB0ZXh0LlxuICAgIGNvbnN0IG1heWJlRGVjb2RlZCA9IG9wdGlvbnMudXJpQ29tcG9uZW50ID8gdHJ5RGVjb2RlVVJJQ29tcG9uZW50KHJhdykgOiAobGlrZWx5VXJpQ29tcG9uZW50KHJhdykgPyB0cnlEZWNvZGVVUklDb21wb25lbnQocmF3KSA6IHJhdyk7XG4gICAgY29uc3QgYmFzZTY0SGludCA9IGxvb2tzTGlrZUJhc2U2NChtYXliZURlY29kZWQpO1xuICAgIGNvbnN0IGlzQmFzZTY0ID0gb3B0aW9ucy5pc0Jhc2U2NCA/PyBiYXNlNjRIaW50LmlzQmFzZTY0O1xuICAgIGNvbnN0IG1pbWVUeXBlID0gb3B0aW9ucy5taW1lVHlwZSB8fCAoaXNCYXNlNjQgPyBERUZBVUxUX01JTUUgOiBcInRleHQvcGxhaW47Y2hhcnNldD11dGYtOFwiKTtcblxuICAgIGlmIChpc0Jhc2U2NCkge1xuICAgICAgICBjb25zdCBieXRlcyA9IGRlY29kZUJhc2U2NFRvQnl0ZXMobWF5YmVEZWNvZGVkLCB7XG4gICAgICAgICAgICBhbHBoYWJldDogb3B0aW9ucy5iYXNlNjQ/LmFscGhhYmV0IHx8IGJhc2U2NEhpbnQuYWxwaGFiZXQsXG4gICAgICAgICAgICBsYXN0Q2h1bmtIYW5kbGluZzogb3B0aW9ucy5iYXNlNjQ/Lmxhc3RDaHVua0hhbmRsaW5nIHx8IFwibG9vc2VcIixcbiAgICAgICAgfSk7XG4gICAgICAgIGlmIChieXRlcy5ieXRlTGVuZ3RoID4gbWF4Qnl0ZXMpIHRocm93IG5ldyBFcnJvcihgRGVjb2RlZCBkYXRhIHRvbyBsYXJnZTogJHtieXRlcy5ieXRlTGVuZ3RofSBieXRlc2ApO1xuICAgICAgICBjb25zdCBibG9iID0gbmV3IEJsb2IoW2J5dGVzVG9BcnJheUJ1ZmZlcihieXRlcyldLCB7IHR5cGU6IG1pbWVUeXBlIH0pO1xuICAgICAgICBpZiAoIW9wdGlvbnMuYXNGaWxlKSByZXR1cm4gYmxvYjtcbiAgICAgICAgcmV0dXJuIG5ldyBGaWxlKFtibG9iXSwgb3B0aW9ucy5maWxlbmFtZSB8fCBcImZpbGVcIiwgeyB0eXBlOiBtaW1lVHlwZSB9KTtcbiAgICB9XG5cbiAgICBjb25zdCBibG9iID0gbmV3IEJsb2IoW21heWJlRGVjb2RlZF0sIHsgdHlwZTogbWltZVR5cGUgfSk7XG4gICAgaWYgKCFvcHRpb25zLmFzRmlsZSkgcmV0dXJuIGJsb2I7XG4gICAgcmV0dXJuIG5ldyBGaWxlKFtibG9iXSwgb3B0aW9ucy5maWxlbmFtZSB8fCBcImZpbGVcIiwgeyB0eXBlOiBtaW1lVHlwZSB9KTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHN0cmluZ1RvQmxvYihpbnB1dDogc3RyaW5nLCBvcHRpb25zOiBPbWl0PFN0cmluZ1RvQmluYXJ5T3B0aW9ucywgXCJhc0ZpbGVcIiB8IFwiZmlsZW5hbWVcIj4gPSB7fSk6IFByb21pc2U8QmxvYj4ge1xuICAgIHJldHVybiAoYXdhaXQgc3RyaW5nVG9CbG9iT3JGaWxlKGlucHV0LCB7IC4uLm9wdGlvbnMsIGFzRmlsZTogZmFsc2UgfSkpIGFzIEJsb2I7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzdHJpbmdUb0ZpbGUoaW5wdXQ6IHN0cmluZywgZmlsZW5hbWU6IHN0cmluZywgb3B0aW9uczogT21pdDxTdHJpbmdUb0JpbmFyeU9wdGlvbnMsIFwiYXNGaWxlXCIgfCBcImZpbGVuYW1lXCI+ID0ge30pOiBQcm9taXNlPEZpbGU+IHtcbiAgICByZXR1cm4gKGF3YWl0IHN0cmluZ1RvQmxvYk9yRmlsZShpbnB1dCwgeyAuLi5vcHRpb25zLCBhc0ZpbGU6IHRydWUsIGZpbGVuYW1lIH0pKSBhcyBGaWxlO1xufVxuXG4iXX0=