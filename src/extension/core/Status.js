import { setIdleInterval, addEvent } from "fest/dom";
import { ref } from "fest/object";
//
export const batteryStatusRef = () => {
    const rv = ref("battery-charging");
    // @ts-ignore
    const batteryStatus = navigator.getBattery?.();
    const batteryIcons = new Map([
        [0, "battery-warning"],
        [25, "battery"],
        [50, "battery-low"],
        [75, "battery-medium"],
        [100, "battery-full"],
    ]);
    //
    const byLevel = (lv = 1.0) => (batteryIcons.get(Math.max(Math.min(Math.round(lv * 4) * 25, 100), 0)) || "battery");
    const changeBatteryStatus = () => {
        let battery = "battery-charging";
        if (!batteryStatus) {
            rv.value = battery;
        }
        else {
            batteryStatus?.then?.((btr) => {
                if (btr.charging) {
                    battery = "battery-charging";
                }
                else // @ts-ignore
                 {
                    battery = byLevel(btr.level) || "battery";
                }
                ;
                rv.value = battery;
            })?.catch?.(console.warn.bind(console));
        }
    };
    //
    changeBatteryStatus();
    setIdleInterval(changeBatteryStatus, 1000);
    batteryStatus?.then?.((btr) => {
        addEvent(btr, "chargingchange", changeBatteryStatus);
        addEvent(btr, "levelchange", changeBatteryStatus);
        changeBatteryStatus();
    });
    return rv;
};
// TODO? support of seconds option (user-defined)
export const timeStatusRef = () => {
    const rv = ref("00:00:00");
    const updateTime = () => (rv.value = new Date().toLocaleTimeString(navigator.language, { hour12: false, timeStyle: "short" }));
    setIdleInterval(updateTime, 15000);
    document.addEventListener("DOMContentLoaded", updateTime, { once: true });
    return rv;
};
//
export const signalStatusRef = () => {
    const rv = ref("wifi-off");
    // @ts-ignore
    const changeSignal = () => (rv.value = signalIcons[navigator.onLine ? (navigator?.connection?.effectiveType || "4g") : "offline"]);
    const signalIcons = {
        "offline": "wifi-off",
        "4g": "wifi",
        "3g": "wifi-high",
        "2g": "wifi-low",
        "slow-2g": "wifi-zero"
    };
    // @ts-ignore
    addEvent(navigator.connection, "change", changeSignal);
    setIdleInterval(changeSignal, 1000);
    changeSignal?.();
    return rv;
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU3RhdHVzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiU3RhdHVzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxlQUFlLEVBQUUsUUFBUSxFQUFFLE1BQU0sVUFBVSxDQUFDO0FBQ3JELE9BQU8sRUFBRSxHQUFHLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFFbEMsRUFBRTtBQUNGLE1BQU0sQ0FBQyxNQUFNLGdCQUFnQixHQUFHLEdBQUUsRUFBRTtJQUNoQyxNQUFNLEVBQUUsR0FBRyxHQUFHLENBQUMsa0JBQWtCLENBQUMsQ0FBQztJQUVuQyxhQUFhO0lBQ2IsTUFBTSxhQUFhLEdBQUcsU0FBUyxDQUFDLFVBQVUsRUFBRSxFQUFFLENBQUM7SUFDL0MsTUFBTSxZQUFZLEdBQUcsSUFBSSxHQUFHLENBQUM7UUFDekIsQ0FBQyxDQUFDLEVBQUUsaUJBQWlCLENBQUM7UUFDdEIsQ0FBQyxFQUFFLEVBQUUsU0FBUyxDQUFDO1FBQ2YsQ0FBQyxFQUFFLEVBQUUsYUFBYSxDQUFDO1FBQ25CLENBQUMsRUFBRSxFQUFFLGdCQUFnQixDQUFDO1FBQ3RCLENBQUMsR0FBRyxFQUFFLGNBQWMsQ0FBQztLQUN4QixDQUFDLENBQUM7SUFFSCxFQUFFO0lBQ0YsTUFBTSxPQUFPLEdBQUcsQ0FBQyxFQUFFLEdBQUcsR0FBRyxFQUFDLEVBQUUsQ0FBQSxDQUFDLFlBQVksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQyxHQUFHLEVBQUUsRUFBRSxHQUFHLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFFLFNBQVMsQ0FBQyxDQUFDO0lBQy9HLE1BQU0sbUJBQW1CLEdBQUcsR0FBRSxFQUFFO1FBQzVCLElBQUksT0FBTyxHQUFHLGtCQUFrQixDQUFDO1FBQ2pDLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztZQUNqQixFQUFF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ZXRJZGxlSW50ZXJ2YWwsIGFkZEV2ZW50IH0gZnJvbSBcImZlc3QvZG9tXCI7XG5pbXBvcnQgeyByZWYgfSBmcm9tIFwiZmVzdC9vYmplY3RcIjtcblxuLy9cbmV4cG9ydCBjb25zdCBiYXR0ZXJ5U3RhdHVzUmVmID0gKCk9PntcbiAgICBjb25zdCBydiA9IHJlZihcImJhdHRlcnktY2hhcmdpbmdcIik7XG5cbiAgICAvLyBAdHMtaWdub3JlXG4gICAgY29uc3QgYmF0dGVyeVN0YXR1cyA9IG5hdmlnYXRvci5nZXRCYXR0ZXJ5Py4oKTtcbiAgICBjb25zdCBiYXR0ZXJ5SWNvbnMgPSBuZXcgTWFwKFtcbiAgICAgICAgWzAsIFwiYmF0dGVyeS13YXJuaW5nXCJdLFxuICAgICAgICBbMjUsIFwiYmF0dGVyeVwiXSxcbiAgICAgICAgWzUwLCBcImJhdHRlcnktbG93XCJdLFxuICAgICAgICBbNzUsIFwiYmF0dGVyeS1tZWRpdW1cIl0sXG4gICAgICAgIFsxMDAsIFwiYmF0dGVyeS1mdWxsXCJdLFxuICAgIF0pO1xuXG4gICAgLy9cbiAgICBjb25zdCBieUxldmVsID0gKGx2ID0gMS4wKT0+KGJhdHRlcnlJY29ucy5nZXQoTWF0aC5tYXgoTWF0aC5taW4oTWF0aC5yb3VuZChsdiAqIDQpICogMjUsIDEwMCksIDApKXx8XCJiYXR0ZXJ5XCIpO1xuICAgIGNvbnN0IGNoYW5nZUJhdHRlcnlTdGF0dXMgPSAoKT0+e1xuICAgICAgICBsZXQgYmF0dGVyeSA9IFwiYmF0dGVyeS1jaGFyZ2luZ1wiO1xuICAgICAgICBpZiAoIWJhdHRlcnlTdGF0dXMpIHtcbiAgICAgICAgICAgIHJ2LnZhbHVlID0gYmF0dGVyeTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGJhdHRlcnlTdGF0dXM/LnRoZW4/LigoYnRyKT0+e1xuICAgICAgICAgICAgICAgIGlmIChidHIuY2hhcmdpbmcpXG4gICAgICAgICAgICAgICAgICAgIHsgYmF0dGVyeSA9IFwiYmF0dGVyeS1jaGFyZ2luZ1wiOyB9IGVsc2UgLy8gQHRzLWlnbm9yZVxuICAgICAgICAgICAgICAgICAgICB7IGJhdHRlcnkgPSBieUxldmVsKGJ0ci5sZXZlbCl8fFwiYmF0dGVyeVwiOyB9O1xuICAgICAgICAgICAgICAgICAgICBydi52YWx1ZSA9IGJhdHRlcnk7XG4gICAgICAgICAgICB9KT8uY2F0Y2g/Lihjb25zb2xlLndhcm4uYmluZChjb25zb2xlKSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvL1xuICAgIGNoYW5nZUJhdHRlcnlTdGF0dXMoKTsgc2V0SWRsZUludGVydmFsKGNoYW5nZUJhdHRlcnlTdGF0dXMsIDEwMDApO1xuICAgIGJhdHRlcnlTdGF0dXM/LnRoZW4/LigoYnRyKT0+e1xuICAgICAgICBhZGRFdmVudChidHIsIFwiY2hhcmdpbmdjaGFuZ2VcIiwgY2hhbmdlQmF0dGVyeVN0YXR1cyk7XG4gICAgICAgIGFkZEV2ZW50KGJ0ciwgXCJsZXZlbGNoYW5nZVwiLCBjaGFuZ2VCYXR0ZXJ5U3RhdHVzKTtcbiAgICAgICAgY2hhbmdlQmF0dGVyeVN0YXR1cygpO1xuICAgIH0pOyByZXR1cm4gcnY7XG59XG5cbi8vIFRPRE8/IHN1cHBvcnQgb2Ygc2Vjb25kcyBvcHRpb24gKHVzZXItZGVmaW5lZClcbmV4cG9ydCBjb25zdCB0aW1lU3RhdHVzUmVmID0gKCk9PntcbiAgICBjb25zdCBydiA9IHJlZihcIjAwOjAwOjAwXCIpO1xuICAgIGNvbnN0IHVwZGF0ZVRpbWUgPSAoKT0+IChydi52YWx1ZSA9IG5ldyBEYXRlKCkudG9Mb2NhbGVUaW1lU3RyaW5nKG5hdmlnYXRvci5sYW5ndWFnZSwgeyBob3VyMTI6IGZhbHNlLCB0aW1lU3R5bGU6IFwic2hvcnRcIiB9KSlcbiAgICBzZXRJZGxlSW50ZXJ2YWwodXBkYXRlVGltZSwgMTUwMDApOyBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwiRE9NQ29udGVudExvYWRlZFwiLCB1cGRhdGVUaW1lLCB7IG9uY2U6IHRydWUgfSk7XG4gICAgcmV0dXJuIHJ2O1xufTtcblxuLy9cbmV4cG9ydCBjb25zdCBzaWduYWxTdGF0dXNSZWYgPSAoKT0+e1xuICAgIGNvbnN0IHJ2ID0gcmVmKFwid2lmaS1vZmZcIik7XG5cbiAgICAvLyBAdHMtaWdub3JlXG4gICAgY29uc3QgY2hhbmdlU2lnbmFsID0gKCk9Pihydi52YWx1ZSA9IHNpZ25hbEljb25zW25hdmlnYXRvci5vbkxpbmUgPyAobmF2aWdhdG9yPy5jb25uZWN0aW9uPy5lZmZlY3RpdmVUeXBlIHx8IFwiNGdcIikgOiBcIm9mZmxpbmVcIl0pO1xuICAgIGNvbnN0IHNpZ25hbEljb25zICA9IHtcbiAgICAgICAgXCJvZmZsaW5lXCI6IFwid2lmaS1vZmZcIixcbiAgICAgICAgXCI0Z1wiOiBcIndpZmlcIixcbiAgICAgICAgXCIzZ1wiOiBcIndpZmktaGlnaFwiLFxuICAgICAgICBcIjJnXCI6IFwid2lmaS1sb3dcIixcbiAgICAgICAgXCJzbG93LTJnXCI6IFwid2lmaS16ZXJvXCJcbiAgICB9XG5cbiAgICAvLyBAdHMtaWdub3JlXG4gICAgYWRkRXZlbnQobmF2aWdhdG9yLmNvbm5lY3Rpb24sIFwiY2hhbmdlXCIsIGNoYW5nZVNpZ25hbCk7XG4gICAgc2V0SWRsZUludGVydmFsKGNoYW5nZVNpZ25hbCwgMTAwMCk7XG4gICAgY2hhbmdlU2lnbmFsPy4oKTsgcmV0dXJuIHJ2O1xufTtcbiJdfQ==