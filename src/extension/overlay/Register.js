import { DOMMixin } from "fest/dom";
import { appendAsOverlay } from "./AnchorOverlay";
//
const registered = new Map();
//
export const registerOverlayElement = (name, construct) => {
    const withIt = new WeakMap();
    //
    const bindWith = (content, holder, inputChange) => {
        if (content?.style?.anchorName || withIt?.has?.(content))
            return false;
        if (content) {
            const self = construct?.(content, holder, inputChange);
            withIt?.set?.(content, self);
            appendAsOverlay(content, self, holder);
        }
        return true;
    };
    //
    class OverlayModifier extends DOMMixin {
        constructor(name) { super(name); }
        // @ts-ignore
        connect(ws) {
            const self = ws?.deref?.() ?? ws;
            if (withIt?.has?.(self))
                return;
            bindWith(self);
        }
    }
    //
    const pack = [withIt, bindWith, OverlayModifier];
    registered.set(name, pack);
    new OverlayModifier(name);
    return pack;
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUmVnaXN0ZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJSZWdpc3Rlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sVUFBVSxDQUFDO0FBQ3BDLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUVsRCxFQUFFO0FBQ0YsTUFBTSxVQUFVLEdBQUcsSUFBSSxHQUFHLEVBQUUsQ0FBQztBQUU3QixFQUFFO0FBQ0YsTUFBTSxDQUFDLE1BQU0sc0JBQXNCLEdBQUcsQ0FBQyxJQUFJLEVBQUUsU0FBUyxFQUFFLEVBQUU7SUFDdEQsTUFBTSxNQUFNLEdBQUcsSUFBSSxPQUFPLEVBQUUsQ0FBQztJQUU3QixFQUFFO0lBQ0YsTUFBTSxRQUFRLEdBQUcsQ0FBQyxPQUFZLEVBQUUsTUFBWSxFQUFFLFdBQXNCLEVBQUUsRUFBRTtRQUNwRSxJQUFJLE9BQU8sRUFBRSxLQUFLLEVBQUUsVUFBVSxJQUFJLE1BQU0sRUFBRSxHQUFHLEVBQUUsQ0FBQyxPQUFPLENBQUM7WUFBRSxPQUFPLEtBQUssQ0FBQztRQUN2RSxJQUFJLE9BQU8sRUFBRSxDQUFDO1lBQ1YsTUFBTSxJQUFJLEdBQVEsU0FBUyxFQUFFLENBQUMsT0FBTyxFQUFFLE1BQU0sRUFBRSxXQUFXLENBQUMsQ0FBQztZQUM1RCxNQUFNLEVBQUUsR0FBRyxFQUFFLENBQUMsT0FBTyxFQUFFLElBQUksQ0FBQyxDQUFDO1lBQUMsZUFBZSxDQUFDLE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSxDQUFDLENBQUM7UUFDekUsQ0FBQztRQUNELE9BQU8sSUFBSSxDQUFDO0lBQ2hCLENBQUMsQ0FBQTtJQUVELEVBQUU7SUFDRixNQUFNLGVBQWdCLFNBQVEsUUFBUTtRQUNsQyxZQUFZLElBQUssSUFBSSxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBRW5DLGFBQWE7UUFDYixPQUFPLENBQUMsRUFBRTtZQUNOLE1BQU0sSUFBSSxHQUFRLEVBQUUsRUFBRSxLQUFLLEVBQUUsRUFBRSxJQUFJLEVBQUUsQ0FBQztZQUN0QyxJQUFJLE1BQU0sRUFBRSxHQUFHLEVBQUUsQ0FBQyxJQUFJLENBQUM7Z0JBQUUsT0FBTztZQUNoQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDbkIsQ0FBQztLQUNKO0lBRUQsRUFBRTtJQUNGLE1BQU0sSUFBSSxHQUFHLENBQUMsTUFBTSxFQUFFLFFBQVEsRUFBRSxlQUFlLENBQUMsQ0FBQztJQUNqRCxVQUFVLENBQUMsR0FBRyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQztJQUMzQixJQUFJLGVBQWUsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUMxQixPQUFPLElBQUksQ0FBQztBQUNoQixDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBET01NaXhpbiB9IGZyb20gXCJmZXN0L2RvbVwiO1xuaW1wb3J0IHsgYXBwZW5kQXNPdmVybGF5IH0gZnJvbSBcIi4vQW5jaG9yT3ZlcmxheVwiO1xuXG4vL1xuY29uc3QgcmVnaXN0ZXJlZCA9IG5ldyBNYXAoKTtcblxuLy9cbmV4cG9ydCBjb25zdCByZWdpc3Rlck92ZXJsYXlFbGVtZW50ID0gKG5hbWUsIGNvbnN0cnVjdCkgPT4ge1xuICAgIGNvbnN0IHdpdGhJdCA9IG5ldyBXZWFrTWFwKCk7XG5cbiAgICAvL1xuICAgIGNvbnN0IGJpbmRXaXRoID0gKGNvbnRlbnQ6IGFueSwgaG9sZGVyPzogYW55LCBpbnB1dENoYW5nZT86IGFueXxudWxsKSA9PiB7XG4gICAgICAgIGlmIChjb250ZW50Py5zdHlsZT8uYW5jaG9yTmFtZSB8fCB3aXRoSXQ/Lmhhcz8uKGNvbnRlbnQpKSByZXR1cm4gZmFsc2U7XG4gICAgICAgIGlmIChjb250ZW50KSB7XG4gICAgICAgICAgICBjb25zdCBzZWxmOiBhbnkgPSBjb25zdHJ1Y3Q/Lihjb250ZW50LCBob2xkZXIsIGlucHV0Q2hhbmdlKTtcbiAgICAgICAgICAgIHdpdGhJdD8uc2V0Py4oY29udGVudCwgc2VsZik7IGFwcGVuZEFzT3ZlcmxheShjb250ZW50LCBzZWxmLCBob2xkZXIpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIC8vXG4gICAgY2xhc3MgT3ZlcmxheU1vZGlmaWVyIGV4dGVuZHMgRE9NTWl4aW4ge1xuICAgICAgICBjb25zdHJ1Y3RvcihuYW1lPykgeyBzdXBlcihuYW1lKTsgfVxuXG4gICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgY29ubmVjdCh3cykge1xuICAgICAgICAgICAgY29uc3Qgc2VsZjogYW55ID0gd3M/LmRlcmVmPy4oKSA/PyB3cztcbiAgICAgICAgICAgIGlmICh3aXRoSXQ/Lmhhcz8uKHNlbGYpKSByZXR1cm47XG4gICAgICAgICAgICBiaW5kV2l0aChzZWxmKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8vXG4gICAgY29uc3QgcGFjayA9IFt3aXRoSXQsIGJpbmRXaXRoLCBPdmVybGF5TW9kaWZpZXJdO1xuICAgIHJlZ2lzdGVyZWQuc2V0KG5hbWUsIHBhY2spO1xuICAgIG5ldyBPdmVybGF5TW9kaWZpZXIobmFtZSk7XG4gICAgcmV0dXJuIHBhY2s7XG59XG4iXX0=