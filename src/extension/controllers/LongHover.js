import { ROOT, addEvents } from "fest/dom";
//
export class LongHoverHandler {
    #holder;
    //
    constructor(holder, options, fx = (ev) => { ev.target.dispatchEvent(new PointerEvent("long-hover", { ...ev, bubbles: true })); }) {
        this.#holder = holder;
        holder["@control"] = this;
        if (!holder) {
            throw Error("Element is null...");
        }
        ;
        if (options) {
            this.longHover(options, fx);
        }
        ;
    }
    //
    defaultHandler(ev, weakRef) {
        return weakRef?.deref()?.dispatchEvent?.(new PointerEvent("long-hover", { ...ev, bubbles: true }));
    }
    //
    longHover(options, fx = (ev) => { ev.target.dispatchEvent(new PointerEvent("long-hover", { ...ev, bubbles: true })); }) {
        const action = { pointerId: -1, timer: null };
        const initiate = ((evc) => {
            const ev = evc;
            if ((ev.target.matches(options.selector) || ev.target.closest(options.selector)) && action.pointerId < 0) {
                action.pointerId = ev.pointerId;
                action.timer = setTimeout(() => {
                    fx?.(ev);
                }, options.holdTime ?? 300);
            }
        });
        //
        const cancelEv = ((evc) => {
            const ev = evc;
            if ((ev.target.matches(options.selector) || ev.target.closest(options.selector)) && action.pointerId == ev.pointerId) {
                if (action.timer) {
                    clearTimeout(action.timer);
                }
                ;
                //
                action.timer = null;
                action.pointerId = -1;
            }
        });
        //
        addEvents(ROOT, {
            "pointerover": initiate,
            "pointerdown": initiate,
            "pointerout": cancelEv,
            "pointerup": cancelEv,
            "pointercancel": cancelEv
        });
    }
}
//
export default LongHoverHandler;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTG9uZ0hvdmVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiTG9uZ0hvdmVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxJQUFJLEVBQUUsU0FBUyxFQUFFLE1BQU0sVUFBVSxDQUFDO0FBRTNDLEVBQUU7QUFDRixNQUFNLE9BQU8sZ0JBQWdCO0lBQ3pCLE9BQU8sQ0FBYztJQUVyQixFQUFFO0lBQ0YsWUFBWSxNQUFNLEVBQUUsT0FBUSxFQUFFLEVBQUUsR0FBRyxDQUFDLEVBQUUsRUFBRSxFQUFFLEdBQUUsRUFBRSxDQUFDLE1BQU0sQ0FBQyxhQUFhLENBQUMsSUFBSSxZQUFZLENBQUMsWUFBWSxFQUFFLEVBQUMsR0FBRyxFQUFFLEVBQUUsT0FBTyxFQUFFLElBQUksRUFBQyxDQUFDLENBQUMsQ0FBQyxDQUFBLENBQUM7UUFDekgsSUFBSSxDQUFDLE9BQU8sR0FBRyxNQUFNLENBQUM7UUFBQyxNQUFNLENBQUMsVUFBVSxDQUFDLEdBQUcsSUFBSSxDQUFDO1FBQ2pELElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQztZQUFDLE1BQU0sS0FBSyxDQUFDLG9CQUFvQixDQUFDLENBQUM7UUFBQyxDQUFDO1FBQUEsQ0FBQztRQUNwRCxJQUFJLE9BQU8sRUFBRSxDQUFDO1lBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxPQUFPLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFBQyxDQUFDO1FBQUEsQ0FBQztJQUNsRCxDQUFDO0lBRUQsRUFBRTtJQUNGLGNBQWMsQ0FBQyxFQUFFLEVBQUUsT0FBNkI7UUFDNUMsT0FBTyxPQUFPLEVBQUUsS0FBSyxFQUFFLEVBQUUsYUFBYSxFQUFFLENBQUMsSUFBSSxZQUFZLENBQUMsWUFBWSxFQUFFLEVBQUMsR0FBRyxFQUFFLEVBQUUsT0FBTyxFQUFFLElBQUksRUFBQyxDQUFDLENBQUMsQ0FBQztJQUNyRyxDQUFDO0lBRUQsRUFBRTtJQUNGLFNBQVMsQ0FBQyxPQUFPLEVBQUUsRUFBRSxHQUFHLENBQUMsRUFBRSxFQUFFLEVBQUUsR0FBRSxFQUFFLENBQUMsTUFBTSxDQUFDLGFBQWEsQ0FBQyxJQUFJLFlBQVksQ0FBQyxZQUFZLEVBQUUsRUFBQyxHQUFHLEVBQUUsRUFBRSxPQUFPLEVBQUUsSUFBSSxFQUFDLENBQUMsQ0FBQyxDQUFDLENBQUEsQ0FBQztRQUM5RyxNQUFNLE1BQU0sR0FBUSxFQUFFLFNBQVMsRUFBRSxDQUFDLENBQUMsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLENBQUM7UUFDbkQsTUFBTSxRQUFRLEdBQUcsQ0FBQyxDQUFDLEdBQUcsRUFBQyxFQUFFO1lBQ3JCLE1BQU0sRUFBRSxHQUFHLEdBQUcsQ0FBQztZQUNmLElBQUksQ0FBQyxFQUFFLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLElBQUksRUFBRSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDLElBQUksTUFBTSxDQUFDLFNBQVMsR0FBRyxDQUFDLEVBQUUsQ0FBQztnQkFDdkcsTUFBTSxDQUFDLFNBQVMsR0FBRyxFQUFFLENBQUMsU0FBUyxDQUFDO2dCQUNoQyxNQUFNLENBQUMsS0FBSyxHQUFHLFVBQVUsQ0FBQyxHQUFFLEVBQUU7b0JBQzFCLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDO2dCQUNiLENBQUMsRUFBRSxPQUFPLENBQUMsUUFBUSxJQUFJLEdBQUcsQ0FBQyxDQUFDO1lBQ2hDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUU7UUFDRixNQUFNLFFBQVEsR0FBRyxDQUFDLENBQUMsR0FBRyxFQUFDLEVBQUU7WUFDckIsTUFBTSxFQUFFLEdBQUcsR0FBRyxDQUFDO1lBQ2YsSUFBSSxDQUFDLEVBQUUsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsSUFBSSxFQUFFLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUMsSUFBSSxNQUFNLENBQUMsU0FBUyxJQUFJLEVBQUUsQ0FBQyxTQUFTLEVBQUUsQ0FBQztnQkFDbkgsSUFBSSxNQUFNLENBQUMsS0FBSyxFQUFFLENBQUM7b0JBQUMsWUFBWSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQztnQkFBQyxDQUFDO2dCQUFBLENBQUM7Z0JBRWxELEVBQUU7Z0JBQ0YsTUFBTSxDQUFDLEtBQUssR0FBSyxJQUFJLENBQUM7Z0JBQ3RCLE1BQU0sQ0FBQyxTQUFTLEdBQUcsQ0FBQyxDQUFDLENBQUM7WUFDMUIsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRTtRQUNGLFNBQVMsQ0FBQyxJQUFJLEVBQUU7WUFDWixhQUFhLEVBQUksUUFBUTtZQUN6QixhQUFhLEVBQUksUUFBUTtZQUN6QixZQUFZLEVBQUssUUFBUTtZQUN6QixXQUFXLEVBQU0sUUFBUTtZQUN6QixlQUFlLEVBQUUsUUFBUTtTQUM1QixDQUFDLENBQUM7SUFDUCxDQUFDO0NBQ0o7QUFFRCxFQUFFO0FBQ0YsZUFBZSxnQkFBZ0IsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFJPT1QsIGFkZEV2ZW50cyB9IGZyb20gXCJmZXN0L2RvbVwiO1xuXG4vL1xuZXhwb3J0IGNsYXNzIExvbmdIb3ZlckhhbmRsZXIge1xuICAgICNob2xkZXI6IEhUTUxFbGVtZW50O1xuXG4gICAgLy9cbiAgICBjb25zdHJ1Y3Rvcihob2xkZXIsIG9wdGlvbnM/LCBmeCA9IChldikgPT4ge2V2LnRhcmdldC5kaXNwYXRjaEV2ZW50KG5ldyBQb2ludGVyRXZlbnQoXCJsb25nLWhvdmVyXCIsIHsuLi5ldiwgYnViYmxlczogdHJ1ZX0pKTt9KSB7XG4gICAgICAgIHRoaXMuI2hvbGRlciA9IGhvbGRlcjsgaG9sZGVyW1wiQGNvbnRyb2xcIl0gPSB0aGlzO1xuICAgICAgICBpZiAoIWhvbGRlcikgeyB0aHJvdyBFcnJvcihcIkVsZW1lbnQgaXMgbnVsbC4uLlwiKTsgfTtcbiAgICAgICAgaWYgKG9wdGlvbnMpIHsgdGhpcy5sb25nSG92ZXIob3B0aW9ucywgZngpOyB9O1xuICAgIH1cblxuICAgIC8vXG4gICAgZGVmYXVsdEhhbmRsZXIoZXYsIHdlYWtSZWY6IFdlYWtSZWY8SFRNTEVsZW1lbnQ+KSB7XG4gICAgICAgIHJldHVybiB3ZWFrUmVmPy5kZXJlZigpPy5kaXNwYXRjaEV2ZW50Py4obmV3IFBvaW50ZXJFdmVudChcImxvbmctaG92ZXJcIiwgey4uLmV2LCBidWJibGVzOiB0cnVlfSkpO1xuICAgIH1cblxuICAgIC8vXG4gICAgbG9uZ0hvdmVyKG9wdGlvbnMsIGZ4ID0gKGV2KSA9PiB7ZXYudGFyZ2V0LmRpc3BhdGNoRXZlbnQobmV3IFBvaW50ZXJFdmVudChcImxvbmctaG92ZXJcIiwgey4uLmV2LCBidWJibGVzOiB0cnVlfSkpO30pIHtcbiAgICAgICAgY29uc3QgYWN0aW9uOiBhbnkgPSB7IHBvaW50ZXJJZDogLTEsIHRpbWVyOiBudWxsIH07XG4gICAgICAgIGNvbnN0IGluaXRpYXRlID0gKChldmMpPT57XG4gICAgICAgICAgICBjb25zdCBldiA9IGV2YztcbiAgICAgICAgICAgIGlmICgoZXYudGFyZ2V0Lm1hdGNoZXMob3B0aW9ucy5zZWxlY3RvcikgfHwgZXYudGFyZ2V0LmNsb3Nlc3Qob3B0aW9ucy5zZWxlY3RvcikpICYmIGFjdGlvbi5wb2ludGVySWQgPCAwKSB7XG4gICAgICAgICAgICAgICAgYWN0aW9uLnBvaW50ZXJJZCA9IGV2LnBvaW50ZXJJZDtcbiAgICAgICAgICAgICAgICBhY3Rpb24udGltZXIgPSBzZXRUaW1lb3V0KCgpPT57XG4gICAgICAgICAgICAgICAgICAgIGZ4Py4oZXYpO1xuICAgICAgICAgICAgICAgIH0sIG9wdGlvbnMuaG9sZFRpbWUgPz8gMzAwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy9cbiAgICAgICAgY29uc3QgY2FuY2VsRXYgPSAoKGV2Yyk9PntcbiAgICAgICAgICAgIGNvbnN0IGV2ID0gZXZjO1xuICAgICAgICAgICAgaWYgKChldi50YXJnZXQubWF0Y2hlcyhvcHRpb25zLnNlbGVjdG9yKSB8fCBldi50YXJnZXQuY2xvc2VzdChvcHRpb25zLnNlbGVjdG9yKSkgJiYgYWN0aW9uLnBvaW50ZXJJZCA9PSBldi5wb2ludGVySWQpIHtcbiAgICAgICAgICAgICAgICBpZiAoYWN0aW9uLnRpbWVyKSB7IGNsZWFyVGltZW91dChhY3Rpb24udGltZXIpOyB9O1xuXG4gICAgICAgICAgICAgICAgLy9cbiAgICAgICAgICAgICAgICBhY3Rpb24udGltZXIgICA9IG51bGw7XG4gICAgICAgICAgICAgICAgYWN0aW9uLnBvaW50ZXJJZCA9IC0xO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAvL1xuICAgICAgICBhZGRFdmVudHMoUk9PVCwge1xuICAgICAgICAgICAgXCJwb2ludGVyb3ZlclwiICA6IGluaXRpYXRlLFxuICAgICAgICAgICAgXCJwb2ludGVyZG93blwiICA6IGluaXRpYXRlLFxuICAgICAgICAgICAgXCJwb2ludGVyb3V0XCIgICA6IGNhbmNlbEV2LFxuICAgICAgICAgICAgXCJwb2ludGVydXBcIiAgICA6IGNhbmNlbEV2LFxuICAgICAgICAgICAgXCJwb2ludGVyY2FuY2VsXCI6IGNhbmNlbEV2XG4gICAgICAgIH0pO1xuICAgIH1cbn1cblxuLy9cbmV4cG9ydCBkZWZhdWx0IExvbmdIb3ZlckhhbmRsZXI7XG4iXX0=