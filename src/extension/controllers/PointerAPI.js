import { getBoundingOrientRect, orientOf, addEvent, addEvents, hasParent, removeEvent } from "fest/dom";
import { cvt_cs_to_os, withCtx } from "fest/core";
import { vector2Ref } from "fest/lure";
//
export class DecorWith {
    #addition;
    // needs prototype extends with Reflect
    constructor(addition) { this.#addition = addition; }
    get(target, name) { return withCtx(this.#addition, this.#addition?.[name]) ?? withCtx(target, target?.[name]); }
    set(target, name, val) {
        if (!Reflect.set(target, name, val)) {
            this.#addition[name] = val;
        }
        return true;
    }
    ownKeys(target) { return [...(Reflect.ownKeys(target) ?? []), ...(Reflect.ownKeys(this.#addition) ?? [])]; }
    getOwnPropertyDescriptor(target, name) { return Reflect.getOwnPropertyDescriptor(target, name) ?? Reflect.getOwnPropertyDescriptor(this.#addition, name); }
    getPrototypeOf(target) { return Reflect.getPrototypeOf(target) ?? Reflect.getPrototypeOf(this.#addition); }
    setPrototypeOf(target, proto) { return Reflect.setPrototypeOf(target, proto) ?? Reflect.setPrototypeOf(this.#addition, proto); }
    isExtensible(target) { return Reflect.isExtensible(target) ?? Reflect.isExtensible(this.#addition); }
    preventExtensions(target) { return Reflect.preventExtensions(target) ?? Reflect.preventExtensions(this.#addition); }
    defineProperty(target, name, desc) { return Reflect.defineProperty(this.#addition, name, desc) ?? Reflect.defineProperty(target, name, desc); }
    deleteProperty(target, name) { return Reflect.deleteProperty(this.#addition, name) ?? Reflect.deleteProperty(target, name); }
}
//
export const elementPointerMap = new WeakMap();
export const agWrapEvent = (cb) => {
    //
    const wpb = (ev) => {
        const el = (ev?.target?.matches?.(".ui-orientbox") ? ev?.target : null) || ev?.target?.closest?.(".ui-orientbox");
        if (!el) {
            return cb(ev);
        }
        ; //
        // @ts-ignore
        let { pointerCache, pointerMap } = elementPointerMap?.getOrInsert?.(el, { pointerCache: new Map(), pointerMap: new Map() });
        //const zoom: number = zoomOf(ev?.target || el) || 1;
        const coord = [(ev?.clientX || 0), (ev?.clientY || 0)];
        const cache = pointerCache?.getOrInsert?.(ev?.pointerId || 0, {
            client: coord,
            orient: null,
            boundingBox: null,
            movement: vector2Ref(0, 0)
        });
        //
        cache.delta = [coord[0] - cache.client[0], coord[1] - cache.client[1]];
        cache.movement.x.value = cache.delta[0];
        cache.movement.y.value = cache.delta[1];
        cache.orient = null, cache.client = coord;
        //
        const pointer = pointerMap?.getOrInsert?.(ev?.pointerId || 0, {
            type: (ev?.type || "pointer"),
            event: ev,
            target: ev?.target || el,
            cs_box: [el?.offsetWidth || 1, el?.offsetHeight || 1],
            cap_element: null,
            //
            get client() { return cache.client; },
            get orient() { return cache.orient ??= cvt_cs_to_os([...(pointer.client || cache.client)], [el?.offsetWidth || 1, el?.offsetHeight || 1], orientOf(ev.target || el) || 0); },
            get movement() { return [cache.movement.x.value, cache.movement.y.value]; },
            get boundingBox() { return (cache.boundingBox ??= getBoundingOrientRect(ev?.target || el, orientOf(ev.target || el) || 0)); },
            //
            capture(element = ev?.target || el) { return (pointer.cap_element = element?.setPointerCapture?.(ev?.pointerId || 0)); },
            release(element = null) {
                (element || pointer.cap_element || ev?.target || el)?.releasePointerCapture?.(ev?.pointerId || 0);
                pointer.cap_element = null;
            },
        });
        //
        Object.assign(pointer, {
            type: (ev?.type || "pointer"),
            event: ev,
            target: ev?.target || el,
            cs_box: [el?.offsetWidth || 1, el?.offsetHeight || 1],
            pointerId: ev?.pointerId || 0
        });
        //
        if (ev?.type == "contextmenu" || ev?.type == "click" || ev?.type == "pointerup" || ev?.type == "pointercancel") {
            pointerMap?.delete?.(ev?.pointerId || 0);
            pointerCache?.delete?.(ev?.pointerId || 0);
            if (ev?.type == "pointercancel") {
                pointer?.release?.();
            }
        }
        ;
        //
        if (pointer && ev) {
            return cb(new Proxy(ev, new DecorWith(pointer)));
        }
        ;
    };
    //
    return wpb;
};
//
class PointerEdge {
    pointer = [0, 0];
    results;
    //
    constructor(pointer = [0, 0]) {
        this.pointer = pointer;
        this.results = { left: false, top: false, bottom: false, right: false };
    }
    //
    get left() { const current = Math.abs(this.pointer[0] - 0) < 10; return (this.results.left = current); }
    get top() { const current = Math.abs(this.pointer[1] - 0) < 10; return (this.results.top = current); }
    get right() { const current = Math.abs(this.pointer[0] - globalThis.innerWidth) < 10; return (this.results.right = current); }
    get bottom() { const current = Math.abs(this.pointer[1] - globalThis.innerHeight) < 10; return (this.results.bottom = current); }
}
;
//
const preventedPointers = new Map();
export const clickPrevention = (element, pointerId = 0) => {
    if (preventedPointers.has(pointerId)) {
        return;
    }
    //
    const rmev = () => {
        preventedPointers.delete(pointerId);
        dce?.forEach?.(unbind => unbind?.());
        ece?.forEach?.(unbind => unbind?.());
    };
    //
    const preventClick = (e) => {
        if (e?.pointerId == pointerId || e?.pointerId == null || pointerId == null || pointerId < 0) {
            //e.stopPropagation();
            e.preventDefault();
            preventedPointers.set(pointerId, true);
            rmev();
        }
        else {
            preventedPointers.delete(pointerId);
        }
    };
    //
    const emt = [preventClick, { once: true }];
    const doc = [preventClick, { once: true, capture: true }];
    //
    const dce = addEvents(document.documentElement, {
        "click": doc,
        "pointerdown": doc,
        "contextmenu": doc
    });
    const ece = addEvents(element, {
        "click": emt,
        "pointerdown": emt,
        "contextmenu": emt
    });
    setTimeout(rmev, 10);
};
//
let PointerEventDrag = null;
if (typeof PointerEvent != "undefined") {
    PointerEventDrag = class PointerEventDrag extends PointerEvent {
        #holding;
        constructor(type, eventInitDict) { super(type, eventInitDict); this.#holding = eventInitDict?.holding; }
        get holding() { return this.#holding; }
        get event() { return this.#holding?.event; }
        get result() { return this.#holding?.result; }
        get shifting() { return this.#holding?.shifting; }
        get modified() { return this.#holding?.modified; }
        get canceled() { return this.#holding?.canceled; }
        get duration() { return this.#holding?.duration; }
        get element() { return this.#holding?.element?.deref?.() ?? null; }
        get propertyName() { return this.#holding?.propertyName ?? "drag"; }
    };
}
else {
    PointerEventDrag = class PointerEventDrag {
        #holding;
        constructor(type, eventInitDict) { this.#holding = eventInitDict?.holding; }
        get holding() { return this.#holding; }
    };
}
//
export const draggingPointerMap = new WeakMap();
export const grabForDrag = (em, ex = { pointerId: 0, pointerType: "mouse" }, { shifting = [0, 0], result = [{ value: 0 }, { value: 0 }] } = {}) => {
    let last = ex;
    let frameTime = 0.01, lastLoop = performance.now(), thisLoop;
    const filterStrength = 100;
    const computeDuration = () => {
        var thisFrameTime = (thisLoop = performance.now()) - lastLoop;
        frameTime += (thisFrameTime - frameTime) / filterStrength;
        lastLoop = thisLoop;
        return frameTime;
    };
    //
    const hm = {
        result,
        movement: [...(ex?.movement || [0, 0])],
        shifting: [...shifting],
        modified: [...shifting],
        canceled: false,
        duration: frameTime,
        element: new WeakRef(em),
        client: null ///[0, 0]
    };
    //
    const moveEvent = [/*agWrapEvent*/ ((evc) => {
            if (ex?.pointerId == evc?.pointerId) {
                evc?.preventDefault?.();
                if (hasParent(evc?.target, em)) {
                    const client = [...(evc?.client || [evc?.clientX || 0, evc?.clientY || 0] || [0, 0])];
                    hm.duration = computeDuration();
                    hm.movement = [...(hm.client ? [client?.[0] - (hm.client?.[0] || 0), client?.[1] - (hm.client?.[1] || 0)] : [0, 0])];
                    hm.client = client;
                    hm.shifting[0] += hm.movement[0] || 0, hm.shifting[1] += hm.movement[1] || 0;
                    hm.modified[0] = (hm.shifting[0] ?? hm.modified[0]) || 0, hm.modified[1] = (hm.shifting[1] ?? hm.modified[1]) | 0;
                    em?.dispatchEvent?.(new PointerEventDrag("m-dragging", {
                        ...evc,
                        bubbles: true,
                        holding: hm,
                        event: evc,
                    }));
                    if (hm?.result?.[0] != null)
                        hm.result[0].value = hm.modified[0] || 0;
                    if (hm?.result?.[1] != null)
                        hm.result[1].value = hm.modified[1] || 0;
                    if (hm?.result?.[2] != null)
                        hm.result[2].value = 0;
                }
            }
        }), { capture: true }];
    // @ts-ignore
    const promised = Promise.withResolvers();
    const releaseEvent = [/*agWrapEvent*/ ((evc) => {
            if (ex?.pointerId == evc?.pointerId) {
                const elm = em?.element || em;
                if (hasParent(evc?.target, elm) || evc?.currentTarget?.contains?.(elm) || evc?.target == elm) {
                    if (evc?.type == "pointerup") {
                        clickPrevention(elm, evc?.pointerId);
                    }
                    ;
                    //
                    queueMicrotask(() => promised?.resolve?.(result));
                    bindings?.forEach?.(binding => binding?.());
                    elm?.releaseCapturePointer?.(evc?.pointerId);
                    elm?.dispatchEvent?.(new PointerEventDrag("m-dragend", { ...evc, bubbles: true, holding: hm, event: evc }));
                    hm.canceled = true;
                    try {
                        ex.pointerId = -1;
                    }
                    catch (_) { /* noop */ }
                }
            }
        }), { capture: true }];
    //
    let bindings = null;
    clickPrevention(em, ex?.pointerId);
    queueMicrotask(() => {
        if (em?.dispatchEvent?.(new PointerEventDrag("m-dragstart", { ...ex, bubbles: true, holding: hm, event: ex }))) {
            //ex?.capture?.(em);
            em?.setPointerCapture?.(ex?.pointerId);
            //
            bindings = addEvents(em, {
                "pointermove": moveEvent,
                "pointercancel": releaseEvent,
                "pointerup": releaseEvent
            });
            //
            bindings?.push?.(...addEvents(document.documentElement, {
                "pointercancel": releaseEvent,
                "pointerup": releaseEvent
            }));
        }
        else {
            hm.canceled = true;
        }
    });
    //
    return promised?.promise ?? result;
};
//
export const bindDraggable = (elementOrEventListener, onEnd = () => { }, draggable = [{ value: 0 }, { value: 0 }], shifting = [0, 0]) => {
    if (!draggable) {
        return;
    }
    const process = (ev, el) => grabForDrag(el ?? elementOrEventListener, ev, { result: draggable, shifting: typeof shifting == "function" ? shifting?.(draggable) : shifting })?.then?.(onEnd);
    //
    if (typeof elementOrEventListener?.addEventListener == "function") {
        addEvent(elementOrEventListener, "pointerdown", process);
    }
    else if (typeof elementOrEventListener == "function") {
        elementOrEventListener(process);
    }
    else {
        throw new Error("bindDraggable: elementOrEventListener is not a function or an object with addEventListener");
    }
    //
    const dispose = () => { if (typeof elementOrEventListener?.removeEventListener == "function") {
        removeEvent(elementOrEventListener, "pointerdown", process);
    } };
    return { draggable, dispose, process };
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUG9pbnRlckFQSS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIlBvaW50ZXJBUEkudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLHFCQUFxQixFQUFFLFFBQVEsRUFBRSxRQUFRLEVBQUUsU0FBUyxFQUFFLFNBQVMsRUFBRSxXQUFXLEVBQUUsTUFBTSxVQUFVLENBQUM7QUFDeEcsT0FBTyxFQUFFLFlBQVksRUFBRSxPQUFPLEVBQUUsTUFBTSxXQUFXLENBQUM7QUFDbEQsT0FBTyxFQUFZLFVBQVUsRUFBRSxNQUFNLFdBQVcsQ0FBQztBQUVqRCxFQUFFO0FBQ0YsTUFBTSxPQUFPLFNBQVM7SUFDbEIsU0FBUyxDQUFNO0lBRWYsdUNBQXVDO0lBQ3ZDLFlBQVksUUFBUSxJQUFJLElBQUksQ0FBQyxTQUFTLEdBQUcsUUFBUSxDQUFDLENBQUMsQ0FBQztJQUNwRCxHQUFHLENBQUMsTUFBTSxFQUFFLElBQUksSUFBSSxPQUFPLE9BQU8sQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLElBQUksQ0FBQyxTQUFTLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLE9BQU8sQ0FBQyxNQUFNLEVBQUUsTUFBTSxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDaEgsR0FBRyxDQUFDLE1BQU0sRUFBRSxJQUFJLEVBQUUsR0FBRztRQUNqQixJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxNQUFNLEVBQUUsSUFBSSxFQUFFLEdBQUcsQ0FBQyxFQUFFLENBQUM7WUFDbEMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsR0FBRyxHQUFHLENBQUM7UUFDL0IsQ0FBQztRQUNELE9BQU8sSUFBSSxDQUFDO0lBQ2hCLENBQUM7SUFFRCxPQUFPLENBQUMsTUFBTSxJQUFJLE9BQU8sQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsSUFBSSxFQUFFLENBQUMsRUFBRSxHQUFHLENB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O0lBQUMsQ0FBQztTQUNoSSxJQUFJLE9BQU8sc0JBQXNCLElBQUksVUFBVSxFQUFHLENBQUM7UUFBQyxzQkFBc0IsQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUFDLENBQUM7U0FDdEYsQ0FBQztRQUFDLE1BQU0sSUFBSSxLQUFLLENBQUMsNEZBQTRGLENBQUMsQ0FBQztJQUFDLENBQUM7SUFFbEgsRUFBRTtJQUNGLE1BQU0sT0FBTyxHQUFHLEdBQUUsRUFBRSxHQUFFLElBQUksT0FBTyxzQkFBc0IsRUFBRSxtQkFBbUIsSUFBSSxVQUFVLEVBQUUsQ0FBQztRQUFDLFdBQVcsQ0FBQyxzQkFBc0IsRUFBRSxhQUFhLEVBQUUsT0FBTyxDQUFDLENBQUM7SUFBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQy9KLE9BQU8sRUFBRSxTQUFTLEVBQUUsT0FBTyxFQUFFLE9BQU8sRUFBRSxDQUFDO0FBQzNDLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGdldEJvdW5kaW5nT3JpZW50UmVjdCwgb3JpZW50T2YsIGFkZEV2ZW50LCBhZGRFdmVudHMsIGhhc1BhcmVudCwgcmVtb3ZlRXZlbnQgfSBmcm9tIFwiZmVzdC9kb21cIjtcbmltcG9ydCB7IGN2dF9jc190b19vcywgd2l0aEN0eCB9IGZyb20gXCJmZXN0L2NvcmVcIjtcbmltcG9ydCB7IFZlY3RvcjJELCB2ZWN0b3IyUmVmIH0gZnJvbSBcImZlc3QvbHVyZVwiO1xuXG4vL1xuZXhwb3J0IGNsYXNzIERlY29yV2l0aCB7XG4gICAgI2FkZGl0aW9uOiBhbnk7XG5cbiAgICAvLyBuZWVkcyBwcm90b3R5cGUgZXh0ZW5kcyB3aXRoIFJlZmxlY3RcbiAgICBjb25zdHJ1Y3RvcihhZGRpdGlvbikgeyB0aGlzLiNhZGRpdGlvbiA9IGFkZGl0aW9uOyB9XG4gICAgZ2V0KHRhcmdldCwgbmFtZSkgeyByZXR1cm4gd2l0aEN0eCh0aGlzLiNhZGRpdGlvbiwgdGhpcy4jYWRkaXRpb24/LltuYW1lXSkgPz8gd2l0aEN0eCh0YXJnZXQsIHRhcmdldD8uW25hbWVdKTsgfVxuICAgIHNldCh0YXJnZXQsIG5hbWUsIHZhbCkge1xuICAgICAgICBpZiAoIVJlZmxlY3Quc2V0KHRhcmdldCwgbmFtZSwgdmFsKSkge1xuICAgICAgICAgICAgdGhpcy4jYWRkaXRpb25bbmFtZV0gPSB2YWw7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgb3duS2V5cyh0YXJnZXQpIHsgcmV0dXJuIFsuLi4oUmVmbGVjdC5vd25LZXlzKHRhcmdldCkgPz8gW10pLCAuLi4oUmVmbGVjdC5vd25LZXlzKHRoaXMuI2FkZGl0aW9uKSA/PyBbXSldOyB9XG4gICAgZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHRhcmdldCwgbmFtZSkgeyByZXR1cm4gUmVmbGVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IodGFyZ2V0LCBuYW1lKSA/PyBSZWZsZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcih0aGlzLiNhZGRpdGlvbiwgbmFtZSk7IH1cbiAgICBnZXRQcm90b3R5cGVPZih0YXJnZXQpIHsgcmV0dXJuIFJlZmxlY3QuZ2V0UHJvdG90eXBlT2YodGFyZ2V0KSA/PyBSZWZsZWN0LmdldFByb3RvdHlwZU9mKHRoaXMuI2FkZGl0aW9uKTsgfVxuICAgIHNldFByb3RvdHlwZU9mKHRhcmdldCwgcHJvdG8pIHsgcmV0dXJuIFJlZmxlY3Quc2V0UHJvdG90eXBlT2YodGFyZ2V0LCBwcm90bykgPz8gUmVmbGVjdC5zZXRQcm90b3R5cGVPZih0aGlzLiNhZGRpdGlvbiwgcHJvdG8pOyB9XG4gICAgaXNFeHRlbnNpYmxlKHRhcmdldCkgeyByZXR1cm4gUmVmbGVjdC5pc0V4dGVuc2libGUodGFyZ2V0KSA/PyBSZWZsZWN0LmlzRXh0ZW5zaWJsZSh0aGlzLiNhZGRpdGlvbik7IH1cbiAgICBwcmV2ZW50RXh0ZW5zaW9ucyh0YXJnZXQpIHsgcmV0dXJuIFJlZmxlY3QucHJldmVudEV4dGVuc2lvbnModGFyZ2V0KSA/PyBSZWZsZWN0LnByZXZlbnRFeHRlbnNpb25zKHRoaXMuI2FkZGl0aW9uKTsgfVxuICAgIGRlZmluZVByb3BlcnR5KHRhcmdldCwgbmFtZSwgZGVzYykgeyByZXR1cm4gUmVmbGVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLiNhZGRpdGlvbiwgbmFtZSwgZGVzYykgPz8gUmVmbGVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIG5hbWUsIGRlc2MpOyB9XG4gICAgZGVsZXRlUHJvcGVydHkodGFyZ2V0LCBuYW1lKSB7IHJldHVybiBSZWZsZWN0LmRlbGV0ZVByb3BlcnR5KHRoaXMuI2FkZGl0aW9uLCBuYW1lKSA/PyBSZWZsZWN0LmRlbGV0ZVByb3BlcnR5KHRhcmdldCwgbmFtZSk7IH1cbiAgICAvL2NvbnN0cnVjdCh0YXJnZXQsIGFyZ3MsIG5ld1RhcmdldCkgeyByZXR1cm4gUmVmbGVjdC5jb25zdHJ1Y3QodGhpcy4jYWRkaXRpb24sIGFyZ3MsIG5ld1RhcmdldCkgPz8gUmVmbGVjdC5jb25zdHJ1Y3QodGFyZ2V0LCBhcmdzLCBuZXdUYXJnZXQpOyB9XG59XG5cbi8vXG5leHBvcnQgY29uc3QgZWxlbWVudFBvaW50ZXJNYXAgPSBuZXcgV2Vha01hcDxhbnksIGFueT4oKTtcbmV4cG9ydCBjb25zdCBhZ1dyYXBFdmVudCA9IChjYik9PntcblxuICAgIC8vXG4gICAgY29uc3Qgd3BiID0gKGV2OiBhbnkpPT57XG4gICAgICAgIGNvbnN0IGVsID0gKGV2Py50YXJnZXQ/Lm1hdGNoZXM/LihcIi51aS1vcmllbnRib3hcIikgPyBldj8udGFyZ2V0IDogbnVsbCkgfHwgZXY/LnRhcmdldD8uY2xvc2VzdD8uKFwiLnVpLW9yaWVudGJveFwiKTtcbiAgICAgICAgaWYgKCFlbCkgeyByZXR1cm4gY2IoZXYpOyB9OyAvL1xuXG4gICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgbGV0IHtwb2ludGVyQ2FjaGUsIHBvaW50ZXJNYXB9ID0gZWxlbWVudFBvaW50ZXJNYXA/LmdldE9ySW5zZXJ0Py4oZWwsIHsgcG9pbnRlckNhY2hlOiBuZXcgTWFwPG51bWJlciwgYW55PigpLCBwb2ludGVyTWFwOiBuZXcgTWFwPG51bWJlciwgYW55PigpIH0pO1xuXG4gICAgICAgIC8vY29uc3Qgem9vbTogbnVtYmVyID0gem9vbU9mKGV2Py50YXJnZXQgfHwgZWwpIHx8IDE7XG4gICAgICAgIGNvbnN0IGNvb3JkOiBbbnVtYmVyLCBudW1iZXJdID0gWyhldj8uY2xpZW50WCB8fCAwKSwgKGV2Py5jbGllbnRZIHx8IDApXTtcbiAgICAgICAgY29uc3QgY2FjaGU6IGFueSA9IHBvaW50ZXJDYWNoZT8uZ2V0T3JJbnNlcnQ/Lihldj8ucG9pbnRlcklkIHx8IDAsIHtcbiAgICAgICAgICAgIGNsaWVudDogY29vcmQsXG4gICAgICAgICAgICBvcmllbnQ6IG51bGwsXG4gICAgICAgICAgICBib3VuZGluZ0JveDogbnVsbCxcbiAgICAgICAgICAgIG1vdmVtZW50OiB2ZWN0b3IyUmVmKDAsIDApXG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vXG4gICAgICAgIGNhY2hlLmRlbHRhICA9IFtjb29yZFswXSAtIGNhY2hlLmNsaWVudFswXSwgY29vcmRbMV0gLSBjYWNoZS5jbGllbnRbMV1dO1xuICAgICAgICBjYWNoZS5tb3ZlbWVudC54LnZhbHVlID0gY2FjaGUuZGVsdGFbMF07XG4gICAgICAgIGNhY2hlLm1vdmVtZW50LnkudmFsdWUgPSBjYWNoZS5kZWx0YVsxXTtcbiAgICAgICAgY2FjaGUub3JpZW50ID0gbnVsbCwgY2FjaGUuY2xpZW50ID0gY29vcmQ7XG5cbiAgICAgICAgLy9cbiAgICAgICAgY29uc3QgcG9pbnRlciA9IHBvaW50ZXJNYXA/LmdldE9ySW5zZXJ0Py4oZXY/LnBvaW50ZXJJZCB8fCAwLCB7XG4gICAgICAgICAgICB0eXBlOiAoZXY/LnR5cGV8fFwicG9pbnRlclwiKSxcbiAgICAgICAgICAgIGV2ZW50OiBldixcbiAgICAgICAgICAgIHRhcmdldDogZXY/LnRhcmdldCB8fCBlbCxcbiAgICAgICAgICAgIGNzX2JveDogW2VsPy5vZmZzZXRXaWR0aCB8fCAxLCBlbD8ub2Zmc2V0SGVpZ2h0IHx8IDFdLFxuICAgICAgICAgICAgY2FwX2VsZW1lbnQ6IG51bGwsXG5cbiAgICAgICAgICAgIC8vXG4gICAgICAgICAgICBnZXQgY2xpZW50KCkgeyByZXR1cm4gY2FjaGUuY2xpZW50OyB9LFxuICAgICAgICAgICAgZ2V0IG9yaWVudCgpIHsgcmV0dXJuIGNhY2hlLm9yaWVudCA/Pz0gY3Z0X2NzX3RvX29zKFsuLi4ocG9pbnRlci5jbGllbnQgfHwgY2FjaGUuY2xpZW50KV0gYXMgW251bWJlciwgbnVtYmVyXSwgW2VsPy5vZmZzZXRXaWR0aCB8fCAxLCBlbD8ub2Zmc2V0SGVpZ2h0IHx8IDFdLCBvcmllbnRPZihldi50YXJnZXQgfHwgZWwpIHx8IDApOyB9LFxuICAgICAgICAgICAgZ2V0IG1vdmVtZW50KCkgeyByZXR1cm4gW2NhY2hlLm1vdmVtZW50LngudmFsdWUsIGNhY2hlLm1vdmVtZW50LnkudmFsdWVdOyB9LFxuICAgICAgICAgICAgZ2V0IGJvdW5kaW5nQm94KCkgeyByZXR1cm4gKGNhY2hlLmJvdW5kaW5nQm94ID8/PSBnZXRCb3VuZGluZ09yaWVudFJlY3QoZXY/LnRhcmdldCB8fCBlbCwgb3JpZW50T2YoZXYudGFyZ2V0IHx8IGVsKSB8fCAwKSk7IH0sXG5cbiAgICAgICAgICAgIC8vXG4gICAgICAgICAgICBjYXB0dXJlKGVsZW1lbnQgPSBldj8udGFyZ2V0IHx8IGVsKSB7IHJldHVybiAocG9pbnRlci5jYXBfZWxlbWVudCA9IGVsZW1lbnQ/LnNldFBvaW50ZXJDYXB0dXJlPy4oZXY/LnBvaW50ZXJJZCB8fCAwKSk7IH0sXG4gICAgICAgICAgICByZWxlYXNlKGVsZW1lbnQgPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgKGVsZW1lbnQgfHwgcG9pbnRlci5jYXBfZWxlbWVudCB8fCBldj8udGFyZ2V0IHx8IGVsKT8ucmVsZWFzZVBvaW50ZXJDYXB0dXJlPy4oZXY/LnBvaW50ZXJJZCB8fCAwKTtcbiAgICAgICAgICAgICAgICBwb2ludGVyLmNhcF9lbGVtZW50ID0gbnVsbDtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vXG4gICAgICAgIE9iamVjdC5hc3NpZ24ocG9pbnRlciwge1xuICAgICAgICAgICAgdHlwZTogKGV2Py50eXBlfHxcInBvaW50ZXJcIiksXG4gICAgICAgICAgICBldmVudDogZXYsXG4gICAgICAgICAgICB0YXJnZXQ6IGV2Py50YXJnZXQgfHwgZWwsXG4gICAgICAgICAgICBjc19ib3g6IFtlbD8ub2Zmc2V0V2lkdGggfHwgMSwgZWw/Lm9mZnNldEhlaWdodCB8fCAxXSxcbiAgICAgICAgICAgIHBvaW50ZXJJZDogZXY/LnBvaW50ZXJJZCB8fCAwXG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vXG4gICAgICAgIGlmIChldj8udHlwZSA9PSBcImNvbnRleHRtZW51XCIgfHwgZXY/LnR5cGUgPT0gXCJjbGlja1wiIHx8IGV2Py50eXBlID09IFwicG9pbnRlcnVwXCIgfHwgZXY/LnR5cGUgPT0gXCJwb2ludGVyY2FuY2VsXCIpIHtcbiAgICAgICAgICAgIHBvaW50ZXJNYXA/LmRlbGV0ZT8uKGV2Py5wb2ludGVySWQgfHwgMCk7XG4gICAgICAgICAgICBwb2ludGVyQ2FjaGU/LmRlbGV0ZT8uKGV2Py5wb2ludGVySWQgfHwgMCk7XG4gICAgICAgICAgICBpZiAoZXY/LnR5cGUgPT0gXCJwb2ludGVyY2FuY2VsXCIpIHtcbiAgICAgICAgICAgICAgICBwb2ludGVyPy5yZWxlYXNlPy4oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAvL1xuICAgICAgICBpZiAocG9pbnRlciAmJiBldikgeyByZXR1cm4gY2IobmV3IFByb3h5KGV2LCBuZXcgRGVjb3JXaXRoKHBvaW50ZXIpKSk7IH07XG4gICAgfVxuXG4gICAgLy9cbiAgICByZXR1cm4gd3BiO1xufTtcblxuLy9cbmNsYXNzIFBvaW50ZXJFZGdlIHtcbiAgICBwb2ludGVyOiBbbnVtYmVyLCBudW1iZXJdID0gWzAsIDBdO1xuICAgIHJlc3VsdHM6IGFueTtcblxuICAgIC8vXG4gICAgY29uc3RydWN0b3IocG9pbnRlcjogW251bWJlciwgbnVtYmVyXSA9IFswLCAwXSkge1xuICAgICAgICB0aGlzLnBvaW50ZXIgPSBwb2ludGVyO1xuICAgICAgICB0aGlzLnJlc3VsdHMgPSB7IGxlZnQ6IGZhbHNlLCB0b3A6IGZhbHNlLCBib3R0b206IGZhbHNlLCByaWdodDogZmFsc2UgfTtcbiAgICB9XG5cbiAgICAvL1xuICAgIGdldCBsZWZ0KCkgeyBjb25zdCBjdXJyZW50ID0gTWF0aC5hYnModGhpcy5wb2ludGVyWzBdIC0gMCkgPCAxMDsgcmV0dXJuICh0aGlzLnJlc3VsdHMubGVmdCA9IGN1cnJlbnQpOyB9XG4gICAgZ2V0IHRvcCAoKSB7IGNvbnN0IGN1cnJlbnQgPSBNYXRoLmFicyh0aGlzLnBvaW50ZXJbMV0gLSAwKSA8IDEwOyByZXR1cm4gKHRoaXMucmVzdWx0cy50b3AgID0gY3VycmVudCk7IH1cbiAgICBnZXQgcmlnaHQgKCkgeyBjb25zdCBjdXJyZW50ID0gTWF0aC5hYnModGhpcy5wb2ludGVyWzBdIC0gZ2xvYmFsVGhpcy5pbm5lcldpZHRoKSAgPCAxMDsgcmV0dXJuICh0aGlzLnJlc3VsdHMucmlnaHQgID0gY3VycmVudCk7IH1cbiAgICBnZXQgYm90dG9tKCkgeyBjb25zdCBjdXJyZW50ID0gTWF0aC5hYnModGhpcy5wb2ludGVyWzFdIC0gZ2xvYmFsVGhpcy5pbm5lckhlaWdodCkgPCAxMDsgcmV0dXJuICh0aGlzLnJlc3VsdHMuYm90dG9tID0gY3VycmVudCk7IH1cbn1cblxuLy9cbmludGVyZmFjZSBFdlN0dWIgeyBwb2ludGVySWQ6IG51bWJlcjsgfVxuaW50ZXJmYWNlIEhvbGRpbmdFbGVtZW50IHtcbiAgICBzaGlmdGluZz86IFtudW1iZXIsIG51bWJlcl07XG4gICAgbW9kaWZpZWQ/OiBbbnVtYmVyLCBudW1iZXJdO1xuICAgIGVsZW1lbnQ/OiBXZWFrUmVmPEhUTUxFbGVtZW50PjtcbiAgICByZXN1bHQ/OiBbYW55LCBhbnldO1xuICAgIHByb3BlcnR5TmFtZT86IHN0cmluZztcbn1cblxuLy9cbmludGVyZmFjZSBQb2ludGVyT2JqZWN0IHtcbiAgICBpZDogbnVtYmVyO1xuICAgIGRvd24/OiBbbnVtYmVyLCBudW1iZXJdLFxuICAgIGV2ZW50PzogTW91c2VFdmVudCB8IFBvaW50ZXJFdmVudCB8IEV2U3R1YjtcbiAgICBlZGdlcz86IFBvaW50ZXJFZGdlO1xuICAgIGN1cnJlbnQ6IFtudW1iZXIsIG51bWJlcl0sXG4gICAgaG9sZGluZz86IEhvbGRpbmdFbGVtZW50W107XG4gICAgbW92ZW1lbnQ6IFtudW1iZXIsIG51bWJlcl07XG59O1xuXG4vL1xuY29uc3QgcHJldmVudGVkUG9pbnRlcnMgPSBuZXcgTWFwPG51bWJlciwgYW55PigpO1xuZXhwb3J0IGNvbnN0IGNsaWNrUHJldmVudGlvbiA9IChlbGVtZW50LCBwb2ludGVySWQgPSAwKT0+e1xuICAgIGlmIChwcmV2ZW50ZWRQb2ludGVycy5oYXMocG9pbnRlcklkKSkgeyByZXR1cm47IH1cblxuICAgIC8vXG4gICAgY29uc3Qgcm1ldiA9ICgpPT57XG4gICAgICAgIHByZXZlbnRlZFBvaW50ZXJzLmRlbGV0ZShwb2ludGVySWQpO1xuICAgICAgICBkY2U/LmZvckVhY2g/Lih1bmJpbmQgPT4gdW5iaW5kPy4oKSk7XG4gICAgICAgIGVjZT8uZm9yRWFjaD8uKHVuYmluZCA9PiB1bmJpbmQ/LigpKTtcbiAgICB9XG5cbiAgICAvL1xuICAgIGNvbnN0IHByZXZlbnRDbGljayA9IChlOiBQb2ludGVyRXZlbnQgfCBNb3VzZUV2ZW50IHwgQ3VzdG9tRXZlbnQgfCBhbnkpID0+IHtcbiAgICAgICAgaWYgKGU/LnBvaW50ZXJJZCA9PSBwb2ludGVySWQgfHwgZT8ucG9pbnRlcklkID09IG51bGwgfHwgcG9pbnRlcklkID09IG51bGwgfHwgcG9pbnRlcklkIDwgMCkge1xuICAgICAgICAgICAgLy9lLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgcHJldmVudGVkUG9pbnRlcnMuc2V0KHBvaW50ZXJJZCwgdHJ1ZSk7XG4gICAgICAgICAgICBybWV2KCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBwcmV2ZW50ZWRQb2ludGVycy5kZWxldGUocG9pbnRlcklkKTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICAvL1xuICAgIGNvbnN0IGVtdDogWyhlOiBQb2ludGVyRXZlbnQgfCBNb3VzZUV2ZW50IHwgQ3VzdG9tRXZlbnQgfCBhbnkpID0+IGFueSwgQWRkRXZlbnRMaXN0ZW5lck9wdGlvbnNdID0gW3ByZXZlbnRDbGljaywge29uY2U6IHRydWV9XTtcbiAgICBjb25zdCBkb2M6IFsoZTogUG9pbnRlckV2ZW50IHwgTW91c2VFdmVudCB8IEN1c3RvbUV2ZW50IHwgYW55KSA9PiBhbnksIEFkZEV2ZW50TGlzdGVuZXJPcHRpb25zXSA9IFtwcmV2ZW50Q2xpY2ssIHtvbmNlOiB0cnVlLCBjYXB0dXJlOiB0cnVlfV07XG5cbiAgICAvL1xuICAgIGNvbnN0IGRjZSA9IGFkZEV2ZW50cyhkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQsIHtcbiAgICAgICAgXCJjbGlja1wiOiBkb2MsXG4gICAgICAgIFwicG9pbnRlcmRvd25cIjogZG9jLFxuICAgICAgICBcImNvbnRleHRtZW51XCI6IGRvY1xuICAgIH0pO1xuICAgIGNvbnN0IGVjZSA9IGFkZEV2ZW50cyhlbGVtZW50LCB7XG4gICAgICAgIFwiY2xpY2tcIjogZW10LFxuICAgICAgICBcInBvaW50ZXJkb3duXCI6IGVtdCxcbiAgICAgICAgXCJjb250ZXh0bWVudVwiOiBlbXRcbiAgICB9KTtcbiAgICBzZXRUaW1lb3V0KHJtZXYsIDEwKTtcbn1cblxuLy9cbmxldCBQb2ludGVyRXZlbnREcmFnOiBhbnkgPSBudWxsO1xuaWYgKHR5cGVvZiBQb2ludGVyRXZlbnQgIT0gXCJ1bmRlZmluZWRcIikge1xuICAgIFBvaW50ZXJFdmVudERyYWcgPSBjbGFzcyBQb2ludGVyRXZlbnREcmFnIGV4dGVuZHMgUG9pbnRlckV2ZW50IHtcbiAgICAgICAgI2hvbGRpbmc6IGFueTtcbiAgICAgICAgY29uc3RydWN0b3IodHlwZSwgZXZlbnRJbml0RGljdCkgeyBzdXBlcih0eXBlLCBldmVudEluaXREaWN0KTsgdGhpcy4jaG9sZGluZyA9IGV2ZW50SW5pdERpY3Q/LmhvbGRpbmc7IH1cbiAgICAgICAgZ2V0IGhvbGRpbmcoKSB7IHJldHVybiB0aGlzLiNob2xkaW5nOyB9XG4gICAgICAgIGdldCBldmVudCgpIHsgcmV0dXJuIHRoaXMuI2hvbGRpbmc/LmV2ZW50OyB9XG4gICAgICAgIGdldCByZXN1bHQoKSB7IHJldHVybiB0aGlzLiNob2xkaW5nPy5yZXN1bHQ7IH1cbiAgICAgICAgZ2V0IHNoaWZ0aW5nKCkgeyByZXR1cm4gdGhpcy4jaG9sZGluZz8uc2hpZnRpbmc7IH1cbiAgICAgICAgZ2V0IG1vZGlmaWVkKCkgeyByZXR1cm4gdGhpcy4jaG9sZGluZz8ubW9kaWZpZWQ7IH1cbiAgICAgICAgZ2V0IGNhbmNlbGVkKCkgeyByZXR1cm4gdGhpcy4jaG9sZGluZz8uY2FuY2VsZWQ7IH1cbiAgICAgICAgZ2V0IGR1cmF0aW9uKCkgeyByZXR1cm4gdGhpcy4jaG9sZGluZz8uZHVyYXRpb247IH1cbiAgICAgICAgZ2V0IGVsZW1lbnQoKSB7IHJldHVybiB0aGlzLiNob2xkaW5nPy5lbGVtZW50Py5kZXJlZj8uKCkgPz8gbnVsbDsgfVxuICAgICAgICBnZXQgcHJvcGVydHlOYW1lKCkgeyByZXR1cm4gdGhpcy4jaG9sZGluZz8ucHJvcGVydHlOYW1lID8/IFwiZHJhZ1wiOyB9XG4gICAgfVxufSBlbHNlIHtcbiAgICBQb2ludGVyRXZlbnREcmFnID0gY2xhc3MgUG9pbnRlckV2ZW50RHJhZyB7XG4gICAgICAgICNob2xkaW5nOiBhbnk7XG4gICAgICAgIGNvbnN0cnVjdG9yKHR5cGUsIGV2ZW50SW5pdERpY3QpIHsgdGhpcy4jaG9sZGluZyA9IGV2ZW50SW5pdERpY3Q/LmhvbGRpbmc7IH1cbiAgICAgICAgZ2V0IGhvbGRpbmcoKSB7IHJldHVybiB0aGlzLiNob2xkaW5nOyB9XG4gICAgfVxufVxuXG4vL1xuZXhwb3J0IGNvbnN0IGRyYWdnaW5nUG9pbnRlck1hcCA9IG5ldyBXZWFrTWFwPGFueSwgYW55PigpO1xuZXhwb3J0IGNvbnN0IGdyYWJGb3JEcmFnID0gKFxuICAgIGVtLFxuICAgIGV4OiBQb2ludGVyRXZlbnR8YW55ID0geyBwb2ludGVySWQ6IDAsIHBvaW50ZXJUeXBlOiBcIm1vdXNlXCIgfSxcbiAgICB7XG4gICAgICAgIHNoaWZ0aW5nID0gWzAsIDBdLFxuICAgICAgICByZXN1bHQgICA9IFt7dmFsdWU6IDB9LCB7dmFsdWU6IDB9XVxuICAgIH0gPSB7fVxuKSA9PiB7XG4gICAgbGV0IGxhc3Q6IGFueSA9IGV4O1xuICAgIGxldCBmcmFtZVRpbWUgPSAwLjAxLCBsYXN0TG9vcCA9IHBlcmZvcm1hbmNlLm5vdygpLCB0aGlzTG9vcDtcbiAgICBjb25zdCBmaWx0ZXJTdHJlbmd0aCAgPSAxMDA7XG4gICAgY29uc3QgY29tcHV0ZUR1cmF0aW9uID0gKCkgPT4ge1xuICAgICAgICB2YXIgdGhpc0ZyYW1lVGltZSA9ICh0aGlzTG9vcD1wZXJmb3JtYW5jZS5ub3coKSkgLSBsYXN0TG9vcDtcbiAgICAgICAgZnJhbWVUaW1lICs9ICh0aGlzRnJhbWVUaW1lIC0gZnJhbWVUaW1lKSAvIGZpbHRlclN0cmVuZ3RoO1xuICAgICAgICBsYXN0TG9vcCA9IHRoaXNMb29wO1xuICAgICAgICByZXR1cm4gZnJhbWVUaW1lO1xuICAgIH1cblxuICAgIC8vXG4gICAgY29uc3QgaG06IGFueSA9IHtcbiAgICAgICAgcmVzdWx0LFxuICAgICAgICBtb3ZlbWVudDogWy4uLihleD8ubW92ZW1lbnQgfHwgWzAsIDBdKV0sXG4gICAgICAgIHNoaWZ0aW5nOiBbLi4uc2hpZnRpbmddLFxuICAgICAgICBtb2RpZmllZDogWy4uLnNoaWZ0aW5nXSxcbiAgICAgICAgY2FuY2VsZWQ6IGZhbHNlLFxuICAgICAgICBkdXJhdGlvbjogZnJhbWVUaW1lLFxuICAgICAgICBlbGVtZW50OiBuZXcgV2Vha1JlZihlbSksXG4gICAgICAgIGNsaWVudDogbnVsbC8vL1swLCAwXVxuICAgIH07XG5cbiAgICAvL1xuICAgIGNvbnN0IG1vdmVFdmVudCA9IFsvKmFnV3JhcEV2ZW50Ki8oKGV2Yyk9PntcbiAgICAgICAgaWYgKGV4Py5wb2ludGVySWQgPT0gZXZjPy5wb2ludGVySWQpIHtcbiAgICAgICAgICAgIGV2Yz8ucHJldmVudERlZmF1bHQ/LigpO1xuICAgICAgICAgICAgaWYgKGhhc1BhcmVudChldmM/LnRhcmdldCwgZW0pKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgY2xpZW50ID0gWy4uLihldmM/LmNsaWVudCAgfHwgW2V2Yz8uY2xpZW50WCB8fCAwLCBldmM/LmNsaWVudFkgfHwgMF0gfHwgWzAsIDBdKV07IGhtLmR1cmF0aW9uID0gY29tcHV0ZUR1cmF0aW9uKCk7XG4gICAgICAgICAgICAgICAgaG0ubW92ZW1lbnQgID0gWy4uLihobS5jbGllbnQgPyBbY2xpZW50Py5bMF0gLSAoaG0uY2xpZW50Py5bMF0gfHwgMCksIGNsaWVudD8uWzFdIC0gKGhtLmNsaWVudD8uWzFdIHx8IDApXSA6IFswLCAwXSldO1xuICAgICAgICAgICAgICAgIGhtLmNsaWVudCAgICA9IGNsaWVudDtcbiAgICAgICAgICAgICAgICBobS5zaGlmdGluZ1swXSArPSAgaG0ubW92ZW1lbnRbMF0gfHwgMCAgICAgICAgICAgICAgICAgICAsIGhtLnNoaWZ0aW5nWzFdICs9ICBobS5tb3ZlbWVudFsxXSB8fCAwO1xuICAgICAgICAgICAgICAgIGhtLm1vZGlmaWVkWzBdICA9IChobS5zaGlmdGluZ1swXSA/PyBobS5tb2RpZmllZFswXSkgfHwgMCwgaG0ubW9kaWZpZWRbMV0gID0gKGhtLnNoaWZ0aW5nWzFdID8/IGhtLm1vZGlmaWVkWzFdKSB8IDA7XG4gICAgICAgICAgICAgICAgZW0/LmRpc3BhdGNoRXZlbnQ/LihuZXcgUG9pbnRlckV2ZW50RHJhZyhcIm0tZHJhZ2dpbmdcIiwge1xuICAgICAgICAgICAgICAgICAgICAuLi5ldmMsXG4gICAgICAgICAgICAgICAgICAgIGJ1YmJsZXM6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIGhvbGRpbmc6IGhtLFxuICAgICAgICAgICAgICAgICAgICBldmVudDogZXZjLFxuICAgICAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgICAgICBpZiAoaG0/LnJlc3VsdD8uWzBdICE9IG51bGwpIGhtLnJlc3VsdFswXS52YWx1ZSA9IGhtLm1vZGlmaWVkWzBdIHx8IDA7XG4gICAgICAgICAgICAgICAgaWYgKGhtPy5yZXN1bHQ/LlsxXSAhPSBudWxsKSBobS5yZXN1bHRbMV0udmFsdWUgPSBobS5tb2RpZmllZFsxXSB8fCAwO1xuICAgICAgICAgICAgICAgIGlmIChobT8ucmVzdWx0Py5bMl0gIT0gbnVsbCkgaG0ucmVzdWx0WzJdLnZhbHVlID0gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0pLCB7Y2FwdHVyZTogdHJ1ZX1dO1xuXG4gICAgLy8gQHRzLWlnbm9yZVxuICAgIGNvbnN0IHByb21pc2VkID0gUHJvbWlzZS53aXRoUmVzb2x2ZXJzKCk7XG4gICAgY29uc3QgcmVsZWFzZUV2ZW50ID0gWy8qYWdXcmFwRXZlbnQqLygoZXZjKT0+e1xuICAgICAgICBpZiAoZXg/LnBvaW50ZXJJZCA9PSBldmM/LnBvaW50ZXJJZCkge1xuICAgICAgICAgICAgY29uc3QgZWxtID0gZW0/LmVsZW1lbnQgfHwgZW07XG4gICAgICAgICAgICBpZiAoaGFzUGFyZW50KGV2Yz8udGFyZ2V0LCBlbG0pIHx8IGV2Yz8uY3VycmVudFRhcmdldD8uY29udGFpbnM/LihlbG0pIHx8IGV2Yz8udGFyZ2V0ID09IGVsbSkge1xuICAgICAgICAgICAgICAgIGlmIChldmM/LnR5cGUgPT0gXCJwb2ludGVydXBcIikgeyBjbGlja1ByZXZlbnRpb24oZWxtLCBldmM/LnBvaW50ZXJJZCk7IH07XG5cbiAgICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICAgIHF1ZXVlTWljcm90YXNrKCgpID0+IHByb21pc2VkPy5yZXNvbHZlPy4ocmVzdWx0KSk7XG4gICAgICAgICAgICAgICAgYmluZGluZ3M/LmZvckVhY2g/LihiaW5kaW5nID0+IGJpbmRpbmc/LigpKTtcbiAgICAgICAgICAgICAgICBlbG0/LnJlbGVhc2VDYXB0dXJlUG9pbnRlcj8uKGV2Yz8ucG9pbnRlcklkKTtcbiAgICAgICAgICAgICAgICBlbG0/LmRpc3BhdGNoRXZlbnQ/LihuZXcgUG9pbnRlckV2ZW50RHJhZyhcIm0tZHJhZ2VuZFwiLCB7IC4uLmV2YywgYnViYmxlczogdHJ1ZSwgaG9sZGluZzogaG0sIGV2ZW50OiBldmMgfSkpO1xuICAgICAgICAgICAgICAgIGhtLmNhbmNlbGVkID0gdHJ1ZTsgdHJ5IHsgZXgucG9pbnRlcklkID0gLTE7IH0gY2F0Y2ggKF8pIHsgLyogbm9vcCAqLyB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9KSwge2NhcHR1cmU6IHRydWV9XTtcblxuICAgIC8vXG4gICAgbGV0IGJpbmRpbmdzOiBhbnkgPSBudWxsO1xuICAgIGNsaWNrUHJldmVudGlvbihlbSwgZXg/LnBvaW50ZXJJZCk7XG4gICAgcXVldWVNaWNyb3Rhc2soKCkgPT4ge1xuICAgICAgICBpZiAoZW0/LmRpc3BhdGNoRXZlbnQ/LihuZXcgUG9pbnRlckV2ZW50RHJhZyhcIm0tZHJhZ3N0YXJ0XCIsIHsgLi4uZXgsIGJ1YmJsZXM6IHRydWUsIGhvbGRpbmc6IGhtLCBldmVudDogZXggfSkpKSB7XG4gICAgICAgICAgICAvL2V4Py5jYXB0dXJlPy4oZW0pO1xuICAgICAgICAgICAgZW0/LnNldFBvaW50ZXJDYXB0dXJlPy4oZXg/LnBvaW50ZXJJZCk7XG5cbiAgICAgICAgICAgIC8vXG4gICAgICAgICAgICBiaW5kaW5ncyA9IGFkZEV2ZW50cyhlbSwge1xuICAgICAgICAgICAgICAgIFwicG9pbnRlcm1vdmVcIjogbW92ZUV2ZW50LFxuICAgICAgICAgICAgICAgIFwicG9pbnRlcmNhbmNlbFwiOiByZWxlYXNlRXZlbnQsXG4gICAgICAgICAgICAgICAgXCJwb2ludGVydXBcIjogcmVsZWFzZUV2ZW50XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy9cbiAgICAgICAgICAgIGJpbmRpbmdzPy5wdXNoPy4oLi4uYWRkRXZlbnRzKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCwge1xuICAgICAgICAgICAgICAgIFwicG9pbnRlcmNhbmNlbFwiOiByZWxlYXNlRXZlbnQsXG4gICAgICAgICAgICAgICAgXCJwb2ludGVydXBcIjogcmVsZWFzZUV2ZW50XG4gICAgICAgICAgICB9KSk7XG4gICAgICAgIH0gZWxzZSB7IGhtLmNhbmNlbGVkID0gdHJ1ZTsgfVxuICAgIH0pO1xuXG4gICAgLy9cbiAgICByZXR1cm4gcHJvbWlzZWQ/LnByb21pc2UgPz8gcmVzdWx0O1xufTtcblxuLy9cbmV4cG9ydCBjb25zdCBiaW5kRHJhZ2dhYmxlID0gKGVsZW1lbnRPckV2ZW50TGlzdGVuZXIsIG9uRW5kOmFueSA9ICgpPT57fSwgZHJhZ2dhYmxlOiBhbnl8bnVsbCA9IFt7dmFsdWU6IDB9LCB7dmFsdWU6IDB9XSwgc2hpZnRpbmc6IGFueSA9IFswLCAwXSk9PntcbiAgICBpZiAoIWRyYWdnYWJsZSkgeyByZXR1cm47IH1cbiAgICBjb25zdCBwcm9jZXNzID0gKGV2LCBlbCk9PmdyYWJGb3JEcmFnKGVsID8/IGVsZW1lbnRPckV2ZW50TGlzdGVuZXIsIGV2LCB7cmVzdWx0OiBkcmFnZ2FibGUsIHNoaWZ0aW5nOiB0eXBlb2Ygc2hpZnRpbmcgPT0gXCJmdW5jdGlvblwiID8gc2hpZnRpbmc/LihkcmFnZ2FibGUpIDogc2hpZnRpbmd9KT8udGhlbj8uKG9uRW5kKTtcblxuICAgIC8vXG4gICAgaWYgKHR5cGVvZiBlbGVtZW50T3JFdmVudExpc3RlbmVyPy5hZGRFdmVudExpc3RlbmVyID09IFwiZnVuY3Rpb25cIikgeyBhZGRFdmVudChlbGVtZW50T3JFdmVudExpc3RlbmVyLCBcInBvaW50ZXJkb3duXCIsIHByb2Nlc3MpOyB9IGVsc2VcbiAgICBpZiAodHlwZW9mIGVsZW1lbnRPckV2ZW50TGlzdGVuZXIgPT0gXCJmdW5jdGlvblwiKSAgeyBlbGVtZW50T3JFdmVudExpc3RlbmVyKHByb2Nlc3MpOyB9IGVsc2VcbiAgICB7IHRocm93IG5ldyBFcnJvcihcImJpbmREcmFnZ2FibGU6IGVsZW1lbnRPckV2ZW50TGlzdGVuZXIgaXMgbm90IGEgZnVuY3Rpb24gb3IgYW4gb2JqZWN0IHdpdGggYWRkRXZlbnRMaXN0ZW5lclwiKTsgfVxuXG4gICAgLy9cbiAgICBjb25zdCBkaXNwb3NlID0gKCk9PnsgaWYgKHR5cGVvZiBlbGVtZW50T3JFdmVudExpc3RlbmVyPy5yZW1vdmVFdmVudExpc3RlbmVyID09IFwiZnVuY3Rpb25cIikgeyByZW1vdmVFdmVudChlbGVtZW50T3JFdmVudExpc3RlbmVyLCBcInBvaW50ZXJkb3duXCIsIHByb2Nlc3MpOyB9IH07XG4gICAgcmV0dXJuIHsgZHJhZ2dhYmxlLCBkaXNwb3NlLCBwcm9jZXNzIH07XG59XG4iXX0=