import { ROOT, addEvents } from "fest/dom";
//
export class SwipeHandler {
    #holder;
    //
    constructor(holder, options) {
        (this.#holder = holder)["@control"] = this;
        if (!holder) {
            throw Error("Element is null...");
        }
        if (options) {
            this.swipe(options);
        }
    }
    //
    swipe(options) {
        if (options?.handler) {
            const swipes = new Map([]);
            const swipes_w = new WeakRef(swipes);
            //
            const registerMove = (evc) => {
                const ev = evc;
                if (swipes?.has?.(ev.pointerId)) {
                    //ev.preventDefault();
                    const swipe = swipes?.get?.(ev.pointerId);
                    Object.assign(swipe || {}, {
                        current: [...(ev.client || [ev?.clientX, ev?.clientY])],
                        pointerId: ev.pointerId,
                        time: performance.now(),
                    });
                }
            };
            //
            const compAngle = (a, c) => { return ((a - c + 540) % 360) - 180; };
            const completeSwipe = (ev) => {
                const pointerId = ev.pointerId;
                if (swipes?.has?.(pointerId)) {
                    const swipe = swipes_w?.deref()?.get?.(pointerId);
                    const diffP = [
                        swipe.start[0] - swipe.current[0],
                        swipe.start[1] - swipe.current[1],
                    ];
                    const diffT = performance.now() - swipe.startTime;
                    const speed = Math.hypot(...diffP) / diffT;
                    if ((swipe.speed = speed) > (options.threshold || 0.5)) {
                        swipe.direction = "name";
                        swipe.swipeAngle = Math.atan2(swipe.current[1] - swipe.start[1], swipe.current[0] - swipe.start[0]);
                        //
                        if (Math.abs(compAngle(swipe.swipeAngle * (180 / Math.PI), 0)) <= 20) {
                            swipe.direction = "left";
                        }
                        ; //AR.get(el.getAttribute("data-swipe-action-left"))?.(el); swipe.direction = "left"; }
                        if (Math.abs(compAngle(swipe.swipeAngle * (180 / Math.PI), 180)) <= 20) {
                            swipe.direction = "right";
                        }
                        ; //AR.get(el.getAttribute("data-swipe-action-right"))?.(el); swipe.direction = "right"; }
                        if (Math.abs(compAngle(swipe.swipeAngle * (180 / Math.PI), 270)) <= 20) {
                            swipe.direction = "up";
                        }
                        ; //AR.get(el.getAttribute("data-swipe-action-up"))?.(el); swipe.direction = "up"; }
                        if (Math.abs(compAngle(swipe.swipeAngle * (180 / Math.PI), 90)) <= 20) {
                            swipe.direction = "down";
                        }
                        ; //AR.get(el.getAttribute("data-swipe-action-down"))?.(el); swipe.direction = "down"; }
                        options?.trigger?.(swipe);
                    }
                    swipes_w?.deref()?.delete?.(pointerId);
                }
            };
            //
            const takeAction = ((evc) => {
                const ev = evc;
                if (ev.target == options?.handler) {
                    swipes?.set(ev.pointerId, {
                        target: ev.target,
                        start: [...(ev.client || [ev?.clientX, ev?.clientY])],
                        current: [...(ev.client || [ev?.clientX, ev?.clientY])],
                        pointerId: ev.pointerId,
                        startTime: performance.now(),
                        time: performance.now(),
                        speed: 0,
                    }); // @ts-ignore // stronger policy now...
                    ev?.capture?.();
                }
            });
            //
            addEvents(ROOT, {
                "pointerdown": takeAction,
                "pointermove": registerMove,
                "pointerup": completeSwipe,
                "pointercancel": completeSwipe,
            });
        }
    }
}
//
export default SwipeHandler;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU3dpcGUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJTd2lwZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsSUFBSSxFQUFFLFNBQVMsRUFBRSxNQUFNLFVBQVUsQ0FBQztBQUUzQyxFQUFFO0FBQ0YsTUFBTSxPQUFPLFlBQVk7SUFDckIsT0FBTyxDQUFjO0lBRXJCLEVBQUU7SUFDRixZQUFZLE1BQU0sRUFBRSxPQUFRO1FBQ3hCLENBQUMsSUFBSSxDQUFDLE9BQU8sR0FBRyxNQUFNLENBQUMsQ0FBQyxVQUFVLENBQUMsR0FBRyxJQUFJLENBQUM7UUFDM0MsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDO1lBQUMsTUFBTSxLQUFLLENBQUMsb0JBQW9CLENBQUMsQ0FBQztRQUFDLENBQUM7UUFDbkQsSUFBSSxPQUFPLEVBQUUsQ0FBQztZQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUM7UUFBQyxDQUFDO0lBQ3pDLENBQUM7SUFFRCxFQUFFO0lBQ0YsS0FBSyxDQUFDLE9BQU87UUFDVCxJQUFJLE9BQU8sRUFBRSxPQUFPLEVBQUUsQ0FBQztZQUNuQixNQUFNLE1BQU0sR0FBRyxJQUFJLEdBQUcsQ0FBYyxFQUFFLENBQUMsQ0FBQztZQUN4QyxNQUFNLFFBQVEsR0FBRyxJQUFJLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUVyQyxFQUFFO1lBQ0YsTUFBTSxZQUFZLEdBQUcsQ0FBQyxHQUFHLEVBQUUsRUFBRTtnQkFDekIsTUFBTSxFQUFFLEdBQUcsR0FBRyxDQUFDO2dCQUNmLElBQUksTUFBTSxFQUFFLEdBQUcsRUFBRSxDQUFDLEVBQUUsQ0FBQyxTQUFTLENBQUMsRUFBRSxDQUFDO29CQUM5QixzQkFBc0I7b0JBQ3RCLE1BQU0sS0FBSyxHQUFHLE1BQU0sRUFBRSxHQUFHLEVBQUUsQ0FBQyxFQUFFLENBQUMsU0FBUyxDQUFDLENBQUM7b0JBQzFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsS0FBSyxJQUFJ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QkFDdkIsU0FBUyxFQUFFLFdBQVcsQ0FBQyxHQUFHLEVBQUU7d0JBQzVCLElBQUksRUFBRSxXQUFXLENBQUMsR0FBRyxFQUFFO3dCQUN2QixLQUFLLEVBQUUsQ0FBQztxQkFDWCxDQUFDLENBQUMsQ0FBQyx1Q0FBdUM7b0JBQzNDLEVBQUUsRUFBRSxPQUFPLEVBQUUsRUFBRSxDQUFDO2dCQUNwQixDQUFDO1lBQ0wsQ0FBQyxDQUFDLENBQUE7WUFFRixFQUFFO1lBQ0YsU0FBUyxDQUFDLElBQUksRUFBRTtnQkFDWixhQUFhLEVBQUksVUFBVTtnQkFDM0IsYUFBYSxFQUFJLFlBQVk7Z0JBQzdCLFdBQVcsRUFBTSxhQUFhO2dCQUM5QixlQUFlLEVBQUUsYUFBYTthQUNqQyxDQUFDLENBQUM7UUFDUCxDQUFDO0lBQ0wsQ0FBQztDQUNKO0FBRUQsRUFBRTtBQUNGLGVBQWUsWUFBWSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUk9PVCwgYWRkRXZlbnRzIH0gZnJvbSBcImZlc3QvZG9tXCI7XG5cbi8vXG5leHBvcnQgY2xhc3MgU3dpcGVIYW5kbGVyIHtcbiAgICAjaG9sZGVyOiBIVE1MRWxlbWVudDtcblxuICAgIC8vXG4gICAgY29uc3RydWN0b3IoaG9sZGVyLCBvcHRpb25zPykge1xuICAgICAgICAodGhpcy4jaG9sZGVyID0gaG9sZGVyKVtcIkBjb250cm9sXCJdID0gdGhpcztcbiAgICAgICAgaWYgKCFob2xkZXIpIHsgdGhyb3cgRXJyb3IoXCJFbGVtZW50IGlzIG51bGwuLi5cIik7IH1cbiAgICAgICAgaWYgKG9wdGlvbnMpIHsgdGhpcy5zd2lwZShvcHRpb25zKTsgfVxuICAgIH1cblxuICAgIC8vXG4gICAgc3dpcGUob3B0aW9ucykge1xuICAgICAgICBpZiAob3B0aW9ucz8uaGFuZGxlcikge1xuICAgICAgICAgICAgY29uc3Qgc3dpcGVzID0gbmV3IE1hcDxudW1iZXIsIGFueT4oW10pO1xuICAgICAgICAgICAgY29uc3Qgc3dpcGVzX3cgPSBuZXcgV2Vha1JlZihzd2lwZXMpO1xuXG4gICAgICAgICAgICAvL1xuICAgICAgICAgICAgY29uc3QgcmVnaXN0ZXJNb3ZlID0gKGV2YykgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IGV2ID0gZXZjO1xuICAgICAgICAgICAgICAgIGlmIChzd2lwZXM/Lmhhcz8uKGV2LnBvaW50ZXJJZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgLy9ldi5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBzd2lwZSA9IHN3aXBlcz8uZ2V0Py4oZXYucG9pbnRlcklkKTtcbiAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbihzd2lwZSB8fCB7fSwge1xuICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudDogWy4uLihldi5jbGllbnQgfHwgW2V2Py5jbGllbnRYLCBldj8uY2xpZW50WV0pXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50ZXJJZDogZXYucG9pbnRlcklkLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGltZTogcGVyZm9ybWFuY2Uubm93KCksXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8vXG4gICAgICAgICAgICBjb25zdCBjb21wQW5nbGUgPSAoYSwgYykgPT4geyByZXR1cm4gKChhIC0gYyArIDU0MCkgJSAzNjApIC0gMTgwOyB9O1xuICAgICAgICAgICAgY29uc3QgY29tcGxldGVTd2lwZSA9IChldikgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHBvaW50ZXJJZCA9IGV2LnBvaW50ZXJJZDtcbiAgICAgICAgICAgICAgICBpZiAoc3dpcGVzPy5oYXM/Lihwb2ludGVySWQpKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHN3aXBlID0gc3dpcGVzX3c/LmRlcmVmKCk/LmdldD8uKHBvaW50ZXJJZCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGRpZmZQID0gW1xuICAgICAgICAgICAgICAgICAgICAgICAgc3dpcGUuc3RhcnRbMF0gLSBzd2lwZS5jdXJyZW50WzBdLFxuICAgICAgICAgICAgICAgICAgICAgICAgc3dpcGUuc3RhcnRbMV0gLSBzd2lwZS5jdXJyZW50WzFdLFxuICAgICAgICAgICAgICAgICAgICBdO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBkaWZmVCA9IHBlcmZvcm1hbmNlLm5vdygpIC0gc3dpcGUuc3RhcnRUaW1lO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBzcGVlZCA9IE1hdGguaHlwb3QoLi4uZGlmZlApIC8gZGlmZlQ7XG4gICAgICAgICAgICAgICAgICAgIGlmICgoc3dpcGUuc3BlZWQgPSBzcGVlZCkgPiAob3B0aW9ucy50aHJlc2hvbGQgfHwgMC41KSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc3dpcGUuZGlyZWN0aW9uID0gXCJuYW1lXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICBzd2lwZS5zd2lwZUFuZ2xlID0gTWF0aC5hdGFuMihcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzd2lwZS5jdXJyZW50WzFdIC0gc3dpcGUuc3RhcnRbMV0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3dpcGUuY3VycmVudFswXSAtIHN3aXBlLnN0YXJ0WzBdXG4gICAgICAgICAgICAgICAgICAgICAgICApO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBNYXRoLmFicyggY29tcEFuZ2xlKHN3aXBlLnN3aXBlQW5nbGUgKiAoMTgwIC8gTWF0aC5QSSksIDAgICApICkgPD0gMjAgKSB7IHN3aXBlLmRpcmVjdGlvbiA9IFwibGVmdFwiOyB9OyAvL0FSLmdldChlbC5nZXRBdHRyaWJ1dGUoXCJkYXRhLXN3aXBlLWFjdGlvbi1sZWZ0XCIpKT8uKGVsKTsgc3dpcGUuZGlyZWN0aW9uID0gXCJsZWZ0XCI7IH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggTWF0aC5hYnMoIGNvbXBBbmdsZShzd2lwZS5zd2lwZUFuZ2xlICogKDE4MCAvIE1hdGguUEkpLCAxODAgKSApIDw9IDIwICkgeyBzd2lwZS5kaXJlY3Rpb24gPSBcInJpZ2h0XCI7IH07IC8vQVIuZ2V0KGVsLmdldEF0dHJpYnV0ZShcImRhdGEtc3dpcGUtYWN0aW9uLXJpZ2h0XCIpKT8uKGVsKTsgc3dpcGUuZGlyZWN0aW9uID0gXCJyaWdodFwiOyB9XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIE1hdGguYWJzKCBjb21wQW5nbGUoc3dpcGUuc3dpcGVBbmdsZSAqICgxODAgLyBNYXRoLlBJKSwgMjcwICkgKSA8PSAyMCApIHsgc3dpcGUuZGlyZWN0aW9uID0gXCJ1cFwiOyB9OyAvL0FSLmdldChlbC5nZXRBdHRyaWJ1dGUoXCJkYXRhLXN3aXBlLWFjdGlvbi11cFwiKSk/LihlbCk7IHN3aXBlLmRpcmVjdGlvbiA9IFwidXBcIjsgfVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBNYXRoLmFicyggY29tcEFuZ2xlKHN3aXBlLnN3aXBlQW5nbGUgKiAoMTgwIC8gTWF0aC5QSSksIDkwICApICkgPD0gMjAgKSB7IHN3aXBlLmRpcmVjdGlvbiA9IFwiZG93blwiOyB9OyAvL0FSLmdldChlbC5nZXRBdHRyaWJ1dGUoXCJkYXRhLXN3aXBlLWFjdGlvbi1kb3duXCIpKT8uKGVsKTsgc3dpcGUuZGlyZWN0aW9uID0gXCJkb3duXCI7IH1cbiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnM/LnRyaWdnZXI/Lihzd2lwZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgc3dpcGVzX3c/LmRlcmVmKCk/LmRlbGV0ZT8uKHBvaW50ZXJJZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgLy9cbiAgICAgICAgICAgIGNvbnN0IHRha2VBY3Rpb24gPSAoKGV2YykgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IGV2ID0gZXZjO1xuICAgICAgICAgICAgICAgIGlmIChldi50YXJnZXQgPT0gb3B0aW9ucz8uaGFuZGxlcikge1xuICAgICAgICAgICAgICAgICAgICBzd2lwZXM/LnNldChldi5wb2ludGVySWQsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldDogZXYudGFyZ2V0LFxuICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnQ6IFsuLi4oZXYuY2xpZW50IHx8IFtldj8uY2xpZW50WCwgZXY/LmNsaWVudFldKV0sXG4gICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50OiBbLi4uKGV2LmNsaWVudCB8fCBbZXY/LmNsaWVudFgsIGV2Py5jbGllbnRZXSldLFxuICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnRlcklkOiBldi5wb2ludGVySWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBzdGFydFRpbWU6IHBlcmZvcm1hbmNlLm5vdygpLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGltZTogcGVyZm9ybWFuY2Uubm93KCksXG4gICAgICAgICAgICAgICAgICAgICAgICBzcGVlZDogMCxcbiAgICAgICAgICAgICAgICAgICAgfSk7IC8vIEB0cy1pZ25vcmUgLy8gc3Ryb25nZXIgcG9saWN5IG5vdy4uLlxuICAgICAgICAgICAgICAgICAgICBldj8uY2FwdHVyZT8uKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgLy9cbiAgICAgICAgICAgIGFkZEV2ZW50cyhST09ULCB7XG4gICAgICAgICAgICAgICAgXCJwb2ludGVyZG93blwiICA6IHRha2VBY3Rpb24gICAsXG4gICAgICAgICAgICAgICAgXCJwb2ludGVybW92ZVwiICA6IHJlZ2lzdGVyTW92ZSAsXG4gICAgICAgICAgICAgICAgXCJwb2ludGVydXBcIiAgICA6IGNvbXBsZXRlU3dpcGUsXG4gICAgICAgICAgICAgICAgXCJwb2ludGVyY2FuY2VsXCI6IGNvbXBsZXRlU3dpcGUsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuLy9cbmV4cG9ydCBkZWZhdWx0IFN3aXBlSGFuZGxlcjtcbiJdfQ==